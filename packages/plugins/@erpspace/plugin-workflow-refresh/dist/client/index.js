/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("react"),require("@ant-design/icons"),require("@nocobase/client"),require("@nocobase/plugin-workflow/client")):"function"==typeof define&&define.amd?define("@erpspace/plugin-workflow-refresh",["react","@ant-design/icons","@nocobase/client","@nocobase/plugin-workflow/client"],n):"object"==typeof exports?exports["@erpspace/plugin-workflow-refresh"]=n(require("react"),require("@ant-design/icons"),require("@nocobase/client"),require("@nocobase/plugin-workflow/client")):e["@erpspace/plugin-workflow-refresh"]=n(e.react,e["@ant-design/icons"],e["@nocobase/client"],e["@nocobase/plugin-workflow/client"])}(self,function(e,n,t,r){return function(){"use strict";var o={482:function(e){e.exports=n},772:function(e){e.exports=t},433:function(e){e.exports=r},156:function(n){n.exports=e}},i={};function u(e){var n=i[e];if(void 0!==n)return n.exports;var t=i[e]={exports:{}};return o[e](t,t.exports,u),t.exports}u.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return u.d(n,{a:n}),n},u.d=function(e,n){for(var t in n)u.o(n,t)&&!u.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},u.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},u.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};u.r(c),u.d(c,{PluginWorkflowRefreshClient:function(){return P}});var a=u(772),l=u(433),f=u(482),s=u(156),p=u.n(s);function d(e,n,t,r,o,i,u){try{var c=e[i](u),a=c.value}catch(e){t(e);return}c.done?n(a):Promise.resolve(a).then(r,o)}function b(e){return function(){var n=this,t=arguments;return new Promise(function(r,o){var i=e.apply(n,t);function u(e){d(i,r,o,u,c,"next",e)}function c(e){d(i,r,o,u,c,"throw",e)}u(void 0)})}}function v(e,n,t){return n=m(n),function(e,n){return n&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(n)||"function"==typeof n)?n:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,j()?Reflect.construct(n,t||[],m(e).constructor):n.apply(e,t))}function y(e,n){if(!(e instanceof n))throw TypeError("Cannot call a class as a function")}function h(e,n,t){return(h=j()?Reflect.construct:function(e,n,t){var r=[null];r.push.apply(r,n);var o=new(Function.bind.apply(e,r));return t&&k(o,t.prototype),o}).apply(null,arguments)}function w(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,n){if("function"!=typeof n&&null!==n)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&k(e,n)}function k(e,n){return(k=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function O(e){var n="function"==typeof Map?new Map:void 0;return(O=function(e){var t;if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return h(e,arguments,m(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),k(r,e)})(e)}function j(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(j=function(){return!!e})()}function S(e,n){var t,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(t)throw TypeError("Generator is already executing.");for(;u;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(e,u)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}var P=function(e){var n,t,r;function o(){return y(this,o),v(this,o,arguments)}return x(o,e),n=o,t=[{key:"afterAdd",value:function(){return b(function(){return S(this,function(e){return[2]})})()}},{key:"beforeLoad",value:function(){return b(function(){return S(this,function(e){return[2]})})()}},{key:"load",value:function(){var e=this;return b(function(){return S(this,function(n){return console.log(e.app),e.app.pm.get("workflow").registerInstruction("refresh",_),e.app.addProvider(q,{name:"nocobase"}),[2]})})()}}],w(n.prototype,t),o}(O(a.Plugin));c.default=P;var _=function(e){function n(){var e;return y(this,n),e=v(this,n,arguments),g(e,"title",'{{t("Refresh")}}'),g(e,"type","refresh"),g(e,"group","collection"),g(e,"description","refresh"),g(e,"icon",p().createElement(f.LoadingOutlined,null)),g(e,"fieldset",{uri:{type:"string",title:"Adres URI lub URL","x-decorator":"FormItem","x-decorator-props":{},"x-component":"WorkflowVariableTextArea","x-component-props":{placeholder:"/"},required:!0,default:"/"}}),g(e,"scope",{useNodeSavedConfig:l.useNodeSavedConfig,useCollectionDataSource:a.useCollectionDataSource}),g(e,"components",{WorkflowVariableTextArea:l.WorkflowVariableTextArea}),g(e,"useVariables",a.useVariables),e}return x(n,e),n}(l.Instruction),q=function(e){e.name;var n=e.children,t=(0,a.useApp)(),r=(0,s.useCallback)(function(e){var n,t,r,o,i=e.detail.uri;((null===(t=window)||void 0===t?void 0:null===(n=t.location)||void 0===n?void 0:n.href)==i||(null===(o=window)||void 0===o?void 0:null===(r=o.location)||void 0===r?void 0:r.pathname)==i)&&window.location.reload()},[]);return(0,s.useEffect)(function(){return t.eventBus.addEventListener("ws:message:refresh",r),function(){t.eventBus.removeEventListener("ws:message:refresh",r)}},[t]),n};return c}()});