/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

"use strict";(self.webpackChunk_nocobase_plugin_ai=self.webpackChunk_nocobase_plugin_ai||[]).push([["506"],{387:function(e,t,o){o.r(t),o.d(t,{LLMServices:function(){return E},useProviderSettingsForm:function(){return D},Settings:function(){return F}});var r=o("772"),n=o("156"),i=o.n(n),c=o("903"),s=o("721"),p=o("482"),u={name:"llmServices",fields:[{name:"name",type:"uid",primaryKey:!0},{name:"title",type:"string",interface:"input",uiSchema:{title:'{{t("Title")}}',"x-component":"Input"}},{name:"provider",type:"string",interface:"select",uiSchema:{title:'{{t("Provider")}}',"x-component":"Select"}},{name:"options",type:"jsonb"}]},a={type:"void",properties:{drawer:{type:"void",title:'{{ t("Add new") }}',"x-component":"Action.Drawer","x-decorator":"FormV2","x-use-decorator-props":"useCreateFormProps",properties:{name:{type:"string","x-decorator":"FormItem",title:'{{ t("UID") }}',"x-component":"Input"},title:{type:"string","x-decorator":"FormItem",title:'{{ t("Title") }}',"x-component":"Input"},options:{type:"object","x-component":"Settings"},footer:{type:"void","x-component":"Action.Drawer.Footer",properties:{cancel:{title:'{{ t("Cancel") }}',"x-component":"Action","x-use-component-props":"useCancelActionProps"},submit:{title:'{{ t("Submit") }}',"x-component":"Action","x-component-props":{type:"primary"},"x-use-component-props":"useCreateActionProps"}}}}}}},l={type:"void",properties:{card:{type:"void","x-component":"CardItem","x-component-props":{heightMode:"fullHeight"},"x-decorator":"TableBlockProvider","x-decorator-props":{collection:"llmServices",action:"list"},properties:{actions:{type:"void","x-component":"ActionBar","x-component-props":{style:{marginBottom:20}},properties:{filter:{"x-component":"Filter.Action","x-use-component-props":"useFilterActionProps",title:"{{t('Filter')}}","x-component-props":{icon:"FilterOutlined"},"x-align":"left"},refresh:{title:"{{t('Refresh')}}","x-component":"Action","x-use-component-props":"useRefreshActionProps","x-component-props":{icon:"ReloadOutlined"}},bulkDelete:{title:"{{t('Delete')}}","x-action":"destroy","x-component":"Action","x-use-component-props":"useBulkDestroyActionProps","x-component-props":{icon:"DeleteOutlined",confirm:{title:"{{t('Delete record')}}",content:"{{t('Are you sure you want to delete it?')}}"}}},add:{type:"void","x-component":"AddNew",title:"{{t('Add new')}}","x-align":"right"}}},table:{type:"array","x-component":"TableV2","x-use-component-props":"useTableBlockProps","x-component-props":{rowKey:"id",rowSelection:{type:"checkbox"}},properties:{column1:{type:"void",title:'{{ t("UID") }}',"x-component":"TableV2.Column",properties:{name:{type:"string","x-component":"Input","x-read-pretty":!0}}},column2:{type:"void",title:'{{ t("Title") }}',"x-component":"TableV2.Column",properties:{title:{type:"string","x-component":"Input","x-read-pretty":!0}}},column3:{type:"void",title:'{{ t("Provider") }}',"x-component":"TableV2.Column",properties:{provider:{type:"string","x-component":"Select","x-read-pretty":!0,enum:"{{ providers }}"}}},column4:{type:"void",title:'{{ t("Actions") }}',"x-decorator":"TableV2.Column.ActionBar","x-component":"TableV2.Column",properties:{actions:{type:"void","x-component":"Space","x-component-props":{split:"|"},properties:{edit:{type:"void",title:'{{ t("Edit") }}',"x-action":"update","x-component":"Action.Link","x-component-props":{openMode:"drawer",icon:"EditOutlined"},properties:{drawer:{type:"void",title:'{{ t("Edit record") }}',"x-component":"Action.Drawer","x-decorator":"FormV2","x-use-decorator-props":"useEditFormProps",properties:{title:{type:"string","x-decorator":"FormItem",title:'{{ t("Title") }}',"x-component":"Input"},options:{type:"object","x-component":"Settings"},footer:{type:"void","x-component":"Action.Drawer.Footer",properties:{cancel:{title:'{{ t("Cancel") }}',"x-component":"Action","x-use-component-props":"useCancelActionProps"},submit:{title:'{{ t("Submit") }}',"x-component":"Action","x-component-props":{type:"primary"},"x-use-component-props":"useEditActionProps"}}}}}}},destroy:{type:"void",title:'{{ t("Delete") }}',"x-action":"destroy","x-component":"Action.Link","x-use-component-props":"useDestroyActionProps","x-component-props":{confirm:{title:"{{t('Delete record')}}",content:"{{t('Are you sure you want to delete it?')}}"}}}}}}}}}}}}},m=(0,n.createContext)({provider:""});m.displayName="LLMProvidersContext";var d=(0,n.createContext)({providers:[]});d.displayName="LLMProviderssContext";var y=o("505"),f=o("563"),v=o("875");function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=Array(t);o<t;o++)r[o]=e[o];return r}function b(e,t,o,r,n,i,c){try{var s=e[i](c),p=s.value}catch(e){o(e);return}s.done?t(p):Promise.resolve(p).then(r,n)}function h(e){return function(){var t=this,o=arguments;return new Promise(function(r,n){var i=e.apply(t,o);function c(e){b(i,r,n,c,s,"next",e)}function s(e){b(i,r,n,c,s,"throw",e)}c(void 0)})}}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o,r,n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i=[],c=!0,s=!1;try{for(n=n.call(e);!(c=(o=n.next()).done)&&(i.push(o.value),!t||i.length!==t);c=!0);}catch(e){s=!0,r=e}finally{try{!c&&null!=n.return&&n.return()}finally{if(s)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);if("Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return x(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var P=function(){var e=(0,n.useContext)(m).provider;return{form:(0,n.useMemo)(function(){return(0,f.createForm)({initialValues:{name:"v_".concat((0,v.uid)()),provider:e}})},[e])}},w=function(){var e=(0,r.useCollectionRecordData)();return{form:(0,n.useMemo)(function(){return(0,f.createForm)({initialValues:e})},[e])}},C=function(){var e=(0,r.useActionContext)().setVisible,t=(0,y.useForm)();return{type:"default",onClick:function(){e(!1),t.reset()}}},S=function(){var e=(0,r.useActionContext)().setVisible,t=s.App.useApp().message,o=(0,y.useForm)(),n=(0,r.useDataBlockResource)(),i=(0,r.useDataBlockRequest)().refresh,p=(0,c.NT)();return{type:"primary",onClick:function(){return h(function(){var r;return A(this,function(c){switch(c.label){case 0:return[4,o.submit()];case 1:return c.sent(),r=o.values,[4,n.create({values:r})];case 2:return c.sent(),i(),t.success(p("Saved successfully")),e(!1),o.reset(),[2]}})})()}}},O=function(){var e=(0,r.useActionContext)().setVisible,t=s.App.useApp().message,o=(0,y.useForm)(),n=(0,r.useDataBlockResource)(),i=(0,r.useDataBlockRequest)().refresh,p=(0,r.useCollection)().getFilterTargetKey(),u=(0,c.NT)();return{type:"primary",onClick:function(){return h(function(){var r;return A(this,function(c){switch(c.label){case 0:return[4,o.submit()];case 1:return c.sent(),r=o.values,[4,n.update({values:r,filterByTk:r[p]})];case 2:return c.sent(),i(),t.success(u("Saved successfully")),e(!1),o.reset(),[2]}})})()}}},k=function(){var e=(0,c.NT)(),t=g((0,n.useState)(!1),2),o=t[0],u=t[1],l=g((0,n.useState)(""),2),y=l[0],f=l[1],v=(0,n.useContext)(d).providers.map(function(e){var t,o;return t=function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},r=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),r.forEach(function(t){var r,n,i;r=e,n=t,i=o[t],n in r?Object.defineProperty(r,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[n]=i})}return e}({},e),o=(o={onClick:function(){u(!0),f(e.value)}},o),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):(function(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);o.push.apply(o,r)}return o})(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}),t});return i().createElement(r.ActionContextProvider,{value:{visible:o,setVisible:u}},i().createElement(m.Provider,{value:{provider:y}},i().createElement(s.Dropdown,{menu:{items:v}},i().createElement(s.Button,{icon:i().createElement(p.PlusOutlined,null),type:"primary"},e("Add new")," ",i().createElement(p.DownOutlined,null))),i().createElement(r.SchemaComponent,{scope:{setProvider:f,useCreateFormProps:P},schema:a})))},D=function(e){var t,o=(0,r.usePlugin)("ai").aiManager.llmProviders.get(e);return null==o?void 0:null===(t=o.components)||void 0===t?void 0:t.ProviderSettingsForm},F=(0,y.observer)(function(){var e=(0,y.useForm)(),t=(0,r.useCollectionRecordData)(),o=D(e.values.provider||t.provider);return o?i().createElement(o,null):null},{displayName:"LLMProviderSettings"}),E=function(){var e=(0,c.NT)(),t=g((0,n.useState)([]),2),o=t[0],s=t[1],p=(0,r.useAPIClient)();return(0,r.useRequest)(function(){return p.resource("ai").listLLMProviders().then(function(t){var o;return((null==t?void 0:null===(o=t.data)||void 0===o?void 0:o.data)||[]).map(function(t){return{key:t.name,label:y.Schema.compile(t.title||t.name,{t:e}),value:t.name}})})},{onSuccess:function(e){s(e)}}),i().createElement(d.Provider,{value:{providers:o}},i().createElement(r.ExtendCollectionsProvider,{collections:[u]},i().createElement(r.SchemaComponent,{schema:l,components:{AddNew:k,Settings:F},scope:{t:e,providers:o,useEditFormProps:w,useCancelActionProps:C,useCreateActionProps:S,useEditActionProps:O}})))}}}]);