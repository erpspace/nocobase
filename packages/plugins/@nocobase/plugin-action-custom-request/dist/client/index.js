/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react-i18next"),require("file-saver"),require("@formily/antd-v5"),require("@nocobase/utils/client"),require("@formily/shared"),require("@nocobase/client"),require("antd"),require("@formily/react"),require("react")):"function"==typeof define&&define.amd?define("@nocobase/plugin-action-custom-request",["react-i18next","file-saver","@formily/antd-v5","@nocobase/utils/client","@formily/shared","@nocobase/client","antd","@formily/react","react"],t):"object"==typeof exports?exports["@nocobase/plugin-action-custom-request"]=t(require("react-i18next"),require("file-saver"),require("@formily/antd-v5"),require("@nocobase/utils/client"),require("@formily/shared"),require("@nocobase/client"),require("antd"),require("@formily/react"),require("react")):e["@nocobase/plugin-action-custom-request"]=t(e["react-i18next"],e["file-saver"],e["@formily/antd-v5"],e["@nocobase/utils/client"],e["@formily/shared"],e["@nocobase/client"],e.antd,e["@formily/react"],e.react)}(self,function(e,t,r,n,o,i,a,u,c){return function(){"use strict";var s,l={632:function(e){e.exports=r},505:function(e){e.exports=u},875:function(e){e.exports=o},772:function(e){e.exports=i},584:function(e){e.exports=n},721:function(e){e.exports=a},346:function(e){e.exports=t},156:function(e){e.exports=c},238:function(t){t.exports=e}},p={};function f(e){var t=p[e];if(void 0!==t)return t.exports;var r=p[e]={exports:{}};return l[e](r,r.exports,f),r.exports}f.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(t,{a:t}),t},f.d=function(e,t){for(var r in t)f.o(t,r)&&!f.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},f.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},f.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var m={};f.r(m),f.d(m,{PluginActionCustomRequestClient:function(){return ec},default:function(){return es}});var y=f("772"),d=f("156"),b=f.n(d),h=f("505"),v=f("584"),g=f("721"),O=f("346");function S(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function x(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){S(i,n,o,a,u,"next",e)}function u(e){S(i,n,o,a,u,"throw",e)}a(void 0)})}}function w(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}var P=function(){var e=(0,y.useAPIClient)(),t=(0,y.useNavigateNoUpdate)(),r=(0,h.useFieldSchema)(),n=(0,y.useCompile)(),o=(0,h.useForm)(),i=((0,y.useBlockContext)()||{}).name,a=(0,y.useCollectionRecordData)(),u=(0,h.useFieldSchema)(),c=(0,h.useField)(),s=(0,y.useActionContext)().setVisible,l=g.App.useApp(),p=l.modal,f=l.message,m=(0,y.useDataSourceKey)();return{onClick:function(l,y){return x(function(){var l,d,b,h,g,S,P,j,C,A,q,k,T,I,R,E;return w(this,function(D){switch(D.label){case 0:if(h=(b=null!==(d=null==r?void 0:r["x-action-settings"])&&void 0!==d?d:{}).skipValidator,S=(g=b.onSuccess||{}).manualClose,P=g.redirecting,j=g.redirectTo,C=g.successMessage,A=g.actionAfterSuccess,q=null==r?void 0:r["x-action"],!(!0!==h&&"customize:form:request"===q))return[3,2];return[4,o.submit()];case 1:D.sent(),D.label=2;case 2:k=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}({},a),"customize:form:request"===q&&(k=o.values),null!==(T=(l=c).data)&&void 0!==T||(l.data={}),c.data.loading=!0,D.label=3;case 3:return D.trys.push([3,,5,6]),[4,e.request({url:"/customRequests:send/".concat(u["x-uid"]),method:"POST",data:{currentRecord:{dataSourceKey:m,data:k},$nForm:"form"===i?o.values:void 0},responseType:"stream"===u["x-response-type"]?"blob":"json"})];case 4:if((I=D.sent()).headers["content-disposition"]&&(R=/attachment;\s*filename="([^"]+)"/,(null==(E=I.headers["content-disposition"].match(R))?void 0:E[1])&&(0,O.saveAs)(I.data,E[1])),c.data.loading=!1,y&&(null==y||y()),("previous"===A||!A&&!0!==P)&&(null==s||s(!1)),!C)return(P&&!A||"redirect"===A)&&j&&((0,v.isURL)(j)?window.location.href=j:t(j)),[2];return S?p.success({title:n(C),onOk:x(function(){return w(this,function(e){return(P&&!A||"redirect"===A)&&j&&((0,v.isURL)(j)?window.location.href=j:t(j)),[2]})})}):(f.success(n(C)),(P&&!A||"redirect"===A)&&j&&((0,v.isURL)(j)?window.location.href=j:t(j))),[3,6];case 5:return c.data.loading=!1,[7];case 6:return[2]}})})()}}},j=function(){var e=(0,h.useFieldSchema)(),t="customRequests:get/".concat(e["x-uid"]);return(0,y.useRequest)({url:t,params:{appends:["roles"]}},{manual:!0,cacheKey:t})},C=f("238"),A="action-custom-request";function q(e){return"{{t('".concat(e,"', { ns: '").concat(A,"', nsMode: 'fallback' })}}")}function k(){return(0,C.useTranslation)(A,{nsMode:"fallback"})}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function I(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||R(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t){if(e){if("string"==typeof e)return T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T(e,t)}}var E=function(){var e,t,r=(0,y.useCollection_deprecated)(),n=k().t,o=(0,y.useCollectionFilterOptions)(r),i=(0,y.useCollectionFilterOptions)("users",y.DEFAULT_DATA_SOURCE_KEY),a=(0,y.useCompile)(),u=(0,y.useCollectionRecordData)(),c=((0,y.useBlockContext)()||{}).name;var s=(e=(0,d.useMemo)(function(){return[a(o),a(i)]},[o,i]),t=2,function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,u=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(u)throw n}}return i}}(e,2)||R(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=s[0],p=s[1],f=(0,y.useGlobalVariable)("$env");return(0,d.useMemo)(function(){return[f,u&&{name:"currentRecord",title:n("Current record",{ns:"client"}),children:I(l)},"form"===c&&{name:"$nForm",title:n("Current form",{ns:"client"}),children:I(l)},{name:"currentUser",title:n("Current user",{ns:"client"}),children:p},{name:"currentTime",title:n("Current time",{ns:"client"}),children:null},{name:"$nToken",title:"API token",children:null}].filter(Boolean)},[u,n,l,c,p])},D=f("632"),F=function(){return(0,y.useAPIClient)().resource("customRequests")},M={value:"name",label:"title"},_=function(){return{scope:E(),fieldNames:M,useTypedConstant:!0}},N={type:"object",properties:{method:{type:"string",required:!0,title:q("HTTP method"),"x-decorator-props":{tooltip:q("When the HTTP method is Post, Put or Patch, and this custom request inside the form, the request body will be automatically filled in with the form data")},"x-decorator":"FormItem","x-component":"Select","x-component-props":{showSearch:!1,allowClear:!1,className:"auto-width"},enum:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"},{label:"DELETE",value:"DELETE"}],default:"POST"},url:{type:"string",required:!0,title:q("URL"),"x-decorator":"FormItem","x-component":"Variable.TextArea","x-use-component-props":_,"x-component-props":{placeholder:"https://www.nocobase.com"}},headers:{type:"array","x-component":"ArrayItems","x-decorator":"FormItem",title:q("Headers"),description:q('"Content-Type" only support "application/json", and no need to specify'),items:{type:"object",properties:{space:{type:"void","x-component":"Space",properties:{name:{type:"string","x-decorator":"FormItem","x-component":"Input","x-component-props":{placeholder:q("Name")}},value:{type:"string","x-decorator":"FormItem","x-component":"Variable.TextArea","x-use-component-props":_},remove:{type:"void","x-decorator":"FormItem","x-component":"ArrayItems.Remove"}}}}},properties:{add:{type:"void",title:q("Add request header"),"x-component":"ArrayItems.Addition"}}},params:{type:"array","x-component":"ArrayItems","x-decorator":"FormItem",title:q("Parameters"),items:{type:"object",properties:{space:{type:"void","x-component":"Space",properties:{name:{type:"string","x-decorator":"FormItem","x-component":"Input","x-component-props":{placeholder:q("Name")}},value:{type:"string","x-decorator":"FormItem","x-component":"Variable.TextArea","x-use-component-props":_},remove:{type:"void","x-decorator":"FormItem","x-component":"ArrayItems.Remove"}}}}},properties:{add:{type:"void",title:q("Add parameter"),"x-component":"ArrayItems.Addition"}}},data:{type:"string",title:q("Body"),"x-decorator":"FormItem","x-decorator-props":{},"x-component":"Variable.JSON","x-component-props":{scope:"{{useCustomRequestVariableOptions}}",fieldNames:{value:"name",label:"title"},changeOnSelect:!0,autoSize:{minRows:10},placeholder:q("Input request data")},description:q("Only support standard JSON data")},timeout:{type:"number",title:q("Timeout config"),"x-decorator":"FormItem","x-decorator-props":{},"x-component":"InputNumber","x-component-props":{addonAfter:q("ms"),min:1,step:1e3,defaultValue:5e3}},responseType:{type:"string",title:q("Response type"),"x-decorator":"FormItem","x-decorator-props":{},"x-component":"Select",default:"json",enum:[{value:"json",label:"JSON"},{value:"stream",label:"Stream"}]}}};function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function V(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function z(){return(z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}function U(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function G(){var e,t,r,n=k().t,o=(0,y.useCollection_deprecated)().name,i=(0,y.useDataSourceKey)(),a=(0,h.useFieldSchema)(),u=F(),c=j(),s=c.data,l=c.refresh,p=(0,y.useDesignable)().dn,f=(0,d.useMemo)(function(){var e,t=L({},null==s?void 0:null===(e=s.data)||void 0===e?void 0:e.options);return t.data&&"string"!=typeof t.data&&(t.data=JSON.stringify(t.data,null,2)),t},[null==s?void 0:null===(r=s.data)||void 0===r?void 0:r.options]);return b().createElement(b().Fragment,null,b().createElement(y.SchemaSettingsActionModalItem,{title:n("Request settings"),components:{ArrayItems:D.ArrayItems},beforeOpen:function(){return!s&&l()},scope:{useCustomRequestVariableOptions:E},schema:N,initialValues:f,onSubmit:(t=(e=function(e){var t;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}(this,function(r){switch(r.label){case 0:return t=z({},function(e){if(null==e)throw TypeError("Cannot destructure "+e);return e}(e)),a["x-response-type"]=t.responseType,[4,u.updateOrCreate({values:{key:a["x-uid"],options:U(L({},t),{collectionName:o,dataSourceKey:i})},filterKeys:["key"]})];case 1:return r.sent(),p.emit("patch",{schema:{"x-response-type":t.responseType,"x-uid":a["x-uid"]}}),l(),p.refresh(),[2]}})},function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){V(i,n,o,a,u,"next",e)}function u(e){V(i,n,o,a,u,"throw",e)}a(void 0)})}),function(e){return t.apply(this,arguments)})}))}var K=new y.SchemaSettings({name:"CustomRequestActionSettings",items:[U(L({},y.actionSettingsItems["0"]),{children:((function(e){if(Array.isArray(e))return B(e)})(s=y.actionSettingsItems["0"].children)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(s)||function(e,t){if(e){if("string"==typeof e)return B(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B(e,t)}}(s)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([{name:"request settings",Component:G},y.SchemaSettingAccessControl])})]}),$={"customize:table:request":y.Action.Link},H=(0,y.withDynamicSchemaProps)(function(e){var t,r,n=$[(0,h.useFieldSchema)()["x-action"]]||y.Action;return b().createElement(n,(t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}({},e),r=(r={useProps:P},r),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}),t))});H.Designer=function(){var e=F(),t=(0,h.useFieldSchema)();return b().createElement(y.Action.Designer,{linkageAction:!0,schemaSettings:"CustomRequestActionSettings",buttonEditorProps:{isLink:"customize:table:request"===t["x-action"]},linkageRulesProps:{type:"button"},removeButtonProps:{onConfirmOk:function(){return e.destroy({filterByTk:t["x-uid"]})}}})},H.Decorator=function(e){return(0,y.useAPIClient)(),b().createElement(y.ACLActionProvider,null,e.children)};var J=f("875");function W(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}var Y=function(e){var t,r,n,o=F(),i=(0,y.useSchemaInitializerItem)(),a=(0,y.useSchemaInitializer)().insert,u={title:'{{ t("Custom request") }}',"x-component":"CustomRequestAction","x-action":"customize:form:request","x-toolbar":"ActionSchemaToolbar","x-settings":"actionSettings:customRequest","x-decorator":"CustomRequestAction.Decorator","x-uid":(0,J.uid)(),"x-action-settings":{onSuccess:{manualClose:!1,redirecting:!1,successMessage:'{{t("Request success")}}'}}};return b().createElement(y.SchemaInitializerItem,(r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}({},i),n=(n={onClick:(t=function(){var e,t;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}(this,function(r){switch(r.label){case 0:return t=(0,J.merge)(u||{},i.schema||{}),null==i||null===(e=i.schemaInitialize)||void 0===e||e.call(i,t),[4,o.create({values:{key:t["x-uid"]}})];case 1:return r.sent(),a(t),[2]}})},function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(e){W(i,n,o,a,u,"next",e)}function u(e){W(i,n,o,a,u,"throw",e)}a(void 0)})})},n),Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(n)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))}),r))};function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}function X(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}var Z=new y.SchemaSettings({name:"actionSettings:customRequest",items:[{name:"editButton",Component:y.ButtonEditor,useComponentProps:function(){return{isLink:"customize:table:request"===(0,h.useFieldSchema)()["x-action"]}}},{name:"linkageRules",Component:y.SchemaSettingsLinkageRules,useComponentProps:function(){var e=((0,y.useCollection)()||{}).name;return X(Q({},(0,y.useSchemaToolbar)().linkageRulesProps),{collectionName:e})},useVisible:function(){var e=(0,y.useCollectionRecord)();return e&&e.data&&!(null==e?void 0:e.isNew)}},{name:"secondConFirm",Component:y.SecondConFirm},{name:"afterSuccessfulSubmission",Component:y.AfterSuccess},{name:"request settings",Component:G},X(Q({},y.SchemaSettingAccessControl),{useVisible:function(){return!0}}),{name:"refreshDataBlockRequest",Component:y.RefreshDataBlockRequest,useComponentProps:function(){return{isPopupAction:!1}},useVisible:function(){return!!(0,y.useCollection)()}},{name:"delete",sort:100,Component:y.RemoveButton,useComponentProps:function(){return(0,y.useSchemaToolbar)().removeButtonProps}}]});function ee(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function et(e,t,r){return(et=ea()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&eo(o,r.prototype),o}).apply(null,arguments)}function er(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function en(e){return(en=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function eo(e,t){return(eo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ei(e){var t="function"==typeof Map?new Map:void 0;return(ei=function(e){var r;if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return et(e,arguments,en(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),eo(n,e)})(e)}function ea(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ea=function(){return!!e})()}var eu=function(e){return b().createElement(y.SchemaComponentOptions,{scope:{CustomRequestConfigurationFieldsSchema:N},components:{CustomRequestAction:H,CustomRequestInitializer:Y}},e.children)},ec=function(e){var t,r,n;function o(){var e,t,r;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),e=this,t=o,r=arguments,t=en(t),function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ea()?Reflect.construct(t,r||[],en(e).constructor):t.apply(e,r))}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&eo(e,t)}(o,e),t=o,r=[{key:"load",value:function(){var e,t=this;return(e=function(){return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}(this,function(e){return t.app.use(eu),t.app.schemaSettingsManager.add(Z),t.app.schemaSettingsManager.add(K),[2]})},function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){ee(i,n,o,a,u,"next",e)}function u(e){ee(i,n,o,a,u,"throw",e)}a(void 0)})})()}}],er(t.prototype,r),o}(ei(y.Plugin)),es=ec;return m}()});