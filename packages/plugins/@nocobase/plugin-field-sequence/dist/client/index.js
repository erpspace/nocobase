/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react-i18next"),require("react"),require("@nocobase/utils/client"),require("@formily/core"),require("@nocobase/client"),require("antd"),require("@formily/react"),require("@formily/antd-v5")):"function"==typeof define&&define.amd?define("@nocobase/plugin-field-sequence",["react-i18next","react","@nocobase/utils/client","@formily/core","@nocobase/client","antd","@formily/react","@formily/antd-v5"],t):"object"==typeof exports?exports["@nocobase/plugin-field-sequence"]=t(require("react-i18next"),require("react"),require("@nocobase/utils/client"),require("@formily/core"),require("@nocobase/client"),require("antd"),require("@formily/react"),require("@formily/antd-v5")):e["@nocobase/plugin-field-sequence"]=t(e["react-i18next"],e.react,e["@nocobase/utils/client"],e["@formily/core"],e["@nocobase/client"],e.antd,e["@formily/react"],e["@formily/antd-v5"])}(self,function(e,t,n,r,o,c,a,i){return function(){"use strict";var u,l={632:function(e){e.exports=i},563:function(e){e.exports=r},505:function(e){e.exports=a},772:function(e){e.exports=o},584:function(e){e.exports=n},721:function(e){e.exports=c},156:function(e){e.exports=t},238:function(t){t.exports=e}},s={};function p(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return l[e](n,n.exports,p),n.exports}p.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return p.d(t,{a:t}),t},p.d=function(e,t){for(var n in t)p.o(t,n)&&!p.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},p.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},p.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var f={};p.r(f),p.d(f,{PluginFieldSequenceClient:function(){return W},default:function(){return H}});var m=p("772"),d=p("156"),y=p.n(d),b=p("632"),v=p("563"),h=p("505"),x=p("584"),g=p("721"),O=p("238"),j="field-sequence";function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){w(e,t,n[t])})}return e}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(e,t){return!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function C(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(C=function(){return!!e})()}function I(){var e=q(["\n        display: flex;\n        gap: 1em;\n        flex-wrap: wrap;\n      "]);return I=function(){return e},e}function F(){var e=q(["\n                margin: 0;\n                padding: 0;\n              "]);return F=function(){return e},e}function D(){var e=q(["\n                  margin-bottom: 0;\n                "]);return D=function(){return e},e}function T(){var e=q(["\n                    justify-content: flex-end;\n                  "]);return T=function(){return e},e}function k(){var e=q(["\n                > *:not(:last-child) {\n                  margin-right: 0.5em;\n                }\n                button {\n                  padding: 0;\n                }\n              "]);return k=function(){return e},e}function Y(e){var t=(0,m.useCompile)(),n=(0,h.useForm)().setValuesIn,r=b.ArrayTable.useIndex();return(0,h.useFormEffects)(function(){(0,v.onFieldValueChange)("patterns.".concat(r,".type"),function(e){var t=_[e.value];n("patterns.".concat(r,".options"),t.defaults?P({},t.defaults):{})})}),y().createElement(g.Select,P({popupMatchSelectWidth:!1},e),Object.keys(_).map(function(e){return y().createElement(g.Select.Option,{key:e,value:e},t(_[e].title))}))}function M(){var e=(0,m.useCompile)(),t=(0,h.useForm)().values,n=b.ArrayTable.useIndex(),r=t.patterns[n],o=r.type,c=r.options,a=_[o];return y().createElement("div",{className:(0,m.css)(I())},Object.keys(c).filter(function(e){return void 0!==c[e]&&a.optionRenders[e]}).map(function(t){var n=a.optionRenders[t],r=a.fieldset[t].title;return n?y().createElement("dl",{key:t,className:(0,m.css)(F())},y().createElement("dt",null,e(r)),y().createElement("dd",{className:(0,m.css)(D())},y().createElement(n,{key:t,value:c[t]}))):null}))}var _={string:{title:'{{t("Fixed text", { ns: "'.concat(j,'" })}}'),optionRenders:{value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{value:""};return y().createElement("code",null,e.value)}},fieldset:{value:{type:"string",title:'{{t("Text content", { ns: "'.concat(j,'" })}}'),"x-decorator":"FormItem","x-component":"Input"}}},randomChar:{title:'{{t("Random character", { ns: "'.concat(j,'" })}}'),optionRenders:{length:function(e){var t=e.value;return y().createElement("code",null,t)},charsets:function(e){var t=e.value,n=(0,O.useTranslation)().t,r={number:n("Number",{ns:j}),lowercase:n("Lowercase letters",{ns:j}),uppercase:n("Uppercase letters",{ns:j}),symbol:n("Symbols",{ns:j})};return y().createElement("code",null,(null==t?void 0:t.map(function(e){return r[e]}).join(", "))||n("Number",{ns:j}))}},fieldset:{length:{type:"number",title:'{{t("Length", { ns: "'.concat(j,'" })}}'),description:'{{t("Will generate random characters with specified length.", { ns: "'.concat(j,'" })}}'),"x-decorator":"FormItem","x-component":"InputNumber","x-component-props":{min:1,max:32},required:!0,default:6},charsets:{type:"array",title:'{{t("Character sets", { ns: "'.concat(j,'" })}}'),description:'{{t("Select character sets to generate random characters.", { ns: "'.concat(j,'" })}}'),"x-decorator":"FormItem","x-component":"Select","x-component-props":{mode:"multiple",allowClear:!1},enum:[{value:"number",label:'{{t("Number", { ns: "'.concat(j,'" })}}')},{value:"lowercase",label:'{{t("Lowercase letters", { ns: "'.concat(j,'" })}}')},{value:"uppercase",label:'{{t("Uppercase letters", { ns: "'.concat(j,'" })}}')},{value:"symbol",label:'{{t("Symbols", { ns: "'.concat(j,'" })}}')}],required:!0,default:["number"],"x-validator":{minItems:1,message:'{{t("At least one character set should be selected", { ns: "'.concat(j,'" })}}')}}},defaults:{length:6,charsets:["number"]}},integer:{title:'{{t("Autoincrement", { ns: "'.concat(j,'" })}}'),optionRenders:{digits:function(e){var t=e.value;return y().createElement("code",null,t)},start:function(e){var t=e.value;return y().createElement("code",null,t)},cycle:m.Cron.ReadPretty},fieldset:{digits:{type:"number",title:'{{t("Digits", { ns: "'.concat(j,'" })}}'),"x-decorator":"FormItem","x-component":"InputNumber","x-component-props":{min:1,max:10},required:!0,default:1,"x-reactions":{target:"start",fulfill:{schema:{"x-component-props.max":"{{ 10 ** $self.value - 1 }}"}}}},start:{type:"number",title:'{{t("Start from", { ns: "'.concat(j,'" })}}'),"x-decorator":"FormItem","x-component":"InputNumber","x-component-props":{min:0},required:!0,default:0},cycle:(w(u={type:"string",title:'{{t("Reset cycle", { ns: "'.concat(j,'" })}}'),"x-decorator":"FormItem"},"x-component",function(e){var t=e.value,n=e.onChange,r=[{label:"No reset",value:0},{label:"Daily",value:1,cron:"0 0 * * *"},{label:"Every Monday",value:2,cron:"0 0 * * 1"},{label:"Monthly",value:3,cron:"0 0 1 * *"},{label:"Yearly",value:4,cron:"0 0 1 1 *"},{label:"Customize",value:5,cron:"* * * * *"}],o=void 0===t?r[0]:r.find(function(e){return e.cron==t})||r[5];return y().createElement("fieldset",null,y().createElement(g.Select,{value:o.value,onChange:function(e){return n(r[e].cron)}},r.map(function(e){return y().createElement(g.Select.Option,{key:e.value,value:e.value},function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m.i18n.t(e,(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,c;r=e,o=t,c=n[t],o in r?Object.defineProperty(r,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[o]=c})}return e}({},r),n=(n={ns:j},n),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t))}(e.label))})),5===o.value?y().createElement(m.Cron,{value:t,onChange:n,clearButton:!1}):null)}),w(u,"default",null),u)},defaults:{digits:4,start:1}},date:{title:'{{t("Date", { ns: "'.concat(j,'" })}}'),optionRenders:{format:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{value:"YYYYMMDD"};return y().createElement("code",null,e.value)}},fieldset:{format:{type:"string",title:'{{t("Date format", { ns: "'.concat(j,'" })}}'),description:'{{t(\'Supports all formats of the Day.js library, such as "YYYYMMDD", "YYYY-MM-DD", etc.\', { ns: "'.concat(j,'" })}}'),"x-decorator":"FormItem","x-component":"Input",default:"YYYYMMDD"}},defaults:{format:"YYYYMMDD"}}};function R(){var e=(0,O.useTranslation)().t,t=(0,m.useCompile)(),n=(0,d.useContext)(h.SchemaOptionsContext),r=(0,h.useForm)(),o=r.values,c=r.setValuesIn,a=b.ArrayTable.useIndex(),i=o.patterns[a],u=i.type,l=i.options,s=_[u],p=(0,m.useToken)().token;return(null==s?void 0:s.fieldset)?y().createElement(g.Button,{type:"link",onClick:function(){(0,b.FormDrawer)({title:t(s.title),zIndex:p.zIndexPopupBase+1e3},function(){return y().createElement(b.FormLayout,{layout:"vertical"},y().createElement(m.SchemaComponentOptions,{scope:n.scope,components:n.components},y().createElement(m.SchemaComponent,{schema:{type:"object","x-component":"fieldset",properties:s.fieldset}})),y().createElement(b.FormDrawer.Footer,null,y().createElement(b.FormButtonGroup,{className:(0,m.css)(T())},y().createElement(b.Submit,{onSubmit:function(e){return e}},e("Submit")))))}).open({initialValues:l}).then(function(e){c("patterns.".concat(a),{type:u,options:P({},e)})}).catch(function(e){(0,x.error)(e)})}},e("Configure")):null}var A=function(e){function t(){var e,n,r,o,c,a;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),n=this,r=t,o=arguments,r=S(r),w(e=function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(n,C()?Reflect.construct(r,o||[],S(n).constructor):r.apply(n,o)),"name","sequence"),w(e,"type","object"),w(e,"group","advanced"),w(e,"order",3),w(e,"title",'{{t("Sequence", { ns: "'.concat(j,'" })}}')),w(e,"description",'{{t("Automatically generate codes based on configured rules, supporting combinations of dates, numbers, and text.", { ns: "'.concat(j,'" })}}')),w(e,"sortable",!0),w(e,"default",{type:"sequence",uiSchema:{type:"string","x-component":"Input","x-component-props":{}}}),w(e,"availableTypes",["string"]),w(e,"hasDefaultValue",!1),w(e,"filterable",{operators:m.interfacesProperties.operators.string}),w(e,"titleUsable",!0),w(e,"properties",(c=P({},m.interfacesProperties.defaultProps),a=(a={unique:m.interfacesProperties.unique,patterns:{type:"array",title:'{{t("Sequence rules", { ns: "'.concat(j,'" })}}'),required:!0,"x-decorator":"FormItem","x-component":"ArrayTable",items:{type:"object",properties:{sort:{type:"void","x-component":"ArrayTable.Column","x-component-props":{width:50,title:"",align:"center"},properties:{sort:{type:"void","x-component":"ArrayTable.SortHandle"}}},type:{type:"void","x-component":"ArrayTable.Column","x-component-props":{title:'{{t("Type", { ns: "'.concat(j,'" })}}')},properties:{type:{type:"string",name:"type",required:!0,"x-decorator":"FormItem","x-component":Y}}},options:{type:"void","x-component":"ArrayTable.Column","x-component-props":{title:'{{t("Rule content", { ns: "'.concat(j,'" })}}')},properties:{options:{type:"object",name:"options","x-component":M}}},operations:{type:"void","x-component":"ArrayTable.Column","x-component-props":{title:'{{t("Operations", { ns: "'.concat(j,'" })}}'),dataIndex:"operations",fixed:"right",className:(0,m.css)(k())},properties:{config:{type:"void",properties:{options:{type:"object","x-component":R}}},remove:{type:"void","x-component":"ArrayTable.Remove"}}}}},properties:{add:{type:"void","x-component":"ArrayTable.Addition","x-component-props":{defaultValue:{type:"integer",options:P({},_.integer.defaults)}},title:'{{t("Add rule", { ns: "'.concat(j,'" })}}')}}},inputable:{type:"boolean",title:'{{t("Inputable", { ns: "'.concat(j,'" })}}'),"x-decorator":"FormItem","x-component":"Checkbox"},match:{type:"boolean",title:'{{t("Match rules", { ns: "'.concat(j,'" })}}'),"x-decorator":"FormItem","x-component":"Checkbox","x-reactions":{dependencies:["inputable"],fulfill:{state:{value:"{{$deps[0] && $self.value}}",visible:"{{$deps[0] === true}}"}}}}},a),Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(a)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(a)).forEach(function(e){Object.defineProperty(c,e,Object.getOwnPropertyDescriptor(a,e))}),c)),e}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,e),t}(m.CollectionFieldInterface),N=function(e){return y().createElement(m.SchemaComponentOptions,{components:{RuleConfigForm:R}},e.children)};function B(e,t,n,r,o,c,a){try{var i=e[c](a),u=i.value}catch(e){n(e);return}i.done?t(u):Promise.resolve(u).then(r,o)}function V(e,t,n){return(V=G()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&$(o,n.prototype),o}).apply(null,arguments)}function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function U(e){var t="function"==typeof Map?new Map:void 0;return(U=function(e){var n;if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return V(e,arguments,L(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),$(r,e)})(e)}function G(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(G=function(){return!!e})()}var W=function(e){var t,n,r;function o(){var e,t,n;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),e=this,t=o,n=arguments,t=L(t),function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,G()?Reflect.construct(t,n||[],L(e).constructor):t.apply(e,n))}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$(e,t)}(o,e),t=o,n=[{key:"load",value:function(){var e,t=this;return(e=function(){return function(e,t){var n,r,o,c,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return c={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(c){return function(i){return function(c){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,i])}}}(this,function(e){return t.app.use(N),t.app.dataSourceManager.addFieldInterfaces([A]),[2]})},function(){var t=this,n=arguments;return new Promise(function(r,o){var c=e.apply(t,n);function a(e){B(c,r,o,a,i,"next",e)}function i(e){B(c,r,o,a,i,"throw",e)}a(void 0)})})()}}],z(t.prototype,n),o}(U(m.Plugin)),H=W;return f}()});