/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

"use strict";(self.webpackChunk_nocobase_plugin_users=self.webpackChunk_nocobase_plugin_users||[]).push([["114"],{132:function(e,n,r){r.r(n),r.d(n,{RoleUsersManager:function(){return m}});var t=r("156"),o=r.n(t),u=r("721"),s=r("772"),l=r("465"),c=r("888"),i=r("241"),a=function(){var e,n,r=(0,t.useContext)(s.CollectionContext),o=(0,s.useFilterFieldOptions)(r.fields),u=(0,s.useResourceActionContext)();return(0,s.useFilterFieldProps)({options:o,params:(null===(n=u.state)||void 0===n?void 0:null===(e=n.params)||void 0===e?void 0:e[0])||u.params,service:u})};function f(e,n,r,t,o,u,s){try{var l=e[u](s),c=l.value}catch(e){r(e);return}l.done?n(c):Promise.resolve(c).then(t,o)}function v(e){return function(){var n=this,r=arguments;return new Promise(function(t,o){var u=e.apply(n,r);function s(e){f(u,t,o,s,l,"next",e)}function l(e){f(u,t,o,s,l,"throw",e)}s(void 0)})}}function p(e,n){var r,t,o,u,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function l(u){return function(l){return function(u){if(r)throw TypeError("Generator is already executing.");for(;s;)try{if(r=1,t&&(o=2&u[0]?t.return:u[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,u[1])).done)return o;switch(t=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,t=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){s=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){s.label=u[1];break}if(6===u[0]&&s.label<o[1]){s.label=o[1],o=u;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(u);break}o[2]&&s.ops.pop(),s.trys.pop();continue}u=n.call(e,s)}catch(e){u=[6,e],t=0}finally{r=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}}var d=function(){var e=(0,s.useAPIClient)(),n=(0,t.useContext)(l.RolesManagerContext).role,r=(0,s.useRecord)(),o=(0,s.useResourceActionContext)().refresh;return{run:function(){return v(function(){return p(this,function(t){switch(t.label){case 0:return[4,e.resource("roles.users",null==n?void 0:n.name).remove({values:[r.id]})];case 1:return t.sent(),o(),[2]}})})()}}},h=function(){var e=(0,c.B)().t,n=u.App.useApp().message,r=(0,s.useAPIClient)(),o=(0,s.useResourceActionContext)(),i=o.state,a=o.setState,f=o.refresh,d=(0,t.useContext)(l.RolesManagerContext).role;return{run:function(){return v(function(){var t;return p(this,function(o){switch(o.label){case 0:if(!(null==(t=null==i?void 0:i.selectedRowKeys)?void 0:t.length))return n.warning(e("Please select users")),[2];return[4,r.resource("roles.users",null==d?void 0:d.name).remove({values:t})];case 1:return o.sent(),null==a||a({selectedRowKeys:[]}),f(),[2]}})})()}}},b=function(e){var n=(0,t.useContext)(l.RolesManagerContext).role;return o().createElement(s.ResourceActionProvider,{collection:i.ij,request:{resource:"users",action:"listExcludeRole",params:{roleName:null==n?void 0:n.name}}},e.children)},m=function(){var e=(0,c.B)().t,n=(0,t.useContext)(l.RolesManagerContext).role,r=(0,s.useRequest)({resource:"roles.users",resourceOf:null==n?void 0:n.name,action:"list"},{ready:!!n});(0,t.useEffect)(function(){r.run()},[n]);var u=(0,t.useRef)([]),f=(0,t.useMemo)(function(){return(0,i.Lu)()},[n]);return o().createElement(s.ResourceActionContext.Provider,{value:function(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},t=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.forEach(function(n){var t,o,u;t=e,o=n,u=r[n],o in t?Object.defineProperty(t,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):t[o]=u})}return e}({},r)},o().createElement(s.CollectionProvider_deprecated,{collection:i.ij},o().createElement(s.SchemaComponent,{schema:f,components:{RoleUsersProvider:b},scope:{useBulkRemoveUsers:h,useRemoveUser:d,handleSelectRoleUsers:function(e,n){u.current=n},useAddRoleUsers:function(){var e=(0,t.useContext)(l.RolesManagerContext).role,n=(0,s.useAPIClient)(),r=(0,s.useActionContext)().setVisible,o=(0,s.useResourceActionContext)().refresh;return{run:function(){return v(function(){return p(this,function(t){switch(t.label){case 0:return[4,n.resource("roles.users",null==e?void 0:e.name).add({values:u.current.map(function(e){return e.id})})];case 1:return t.sent(),u.current=[],r(!1),o(),[2]}})})()}}},useFilterActionProps:a,t:e}})))}}}]);