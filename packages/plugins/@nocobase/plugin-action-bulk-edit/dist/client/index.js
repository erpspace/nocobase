/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react-i18next"),require("@formily/shared"),require("@nocobase/utils/client"),require("@nocobase/client"),require("antd"),require("@ant-design/icons"),require("@formily/react"),require("react"),require("@emotion/css")):"function"==typeof define&&define.amd?define("@nocobase/plugin-action-bulk-edit",["react-i18next","@formily/shared","@nocobase/utils/client","@nocobase/client","antd","@ant-design/icons","@formily/react","react","@emotion/css"],t):"object"==typeof exports?exports["@nocobase/plugin-action-bulk-edit"]=t(require("react-i18next"),require("@formily/shared"),require("@nocobase/utils/client"),require("@nocobase/client"),require("antd"),require("@ant-design/icons"),require("@formily/react"),require("react"),require("@emotion/css")):e["@nocobase/plugin-action-bulk-edit"]=t(e["react-i18next"],e["@formily/shared"],e["@nocobase/utils/client"],e["@nocobase/client"],e.antd,e["@ant-design/icons"],e["@formily/react"],e.react,e["@emotion/css"])}(self,function(e,t,n,o,r,i,a,c,l){return function(){"use strict";var u={482:function(e){e.exports=i},964:function(e){e.exports=l},505:function(e){e.exports=a},875:function(e){e.exports=t},772:function(e){e.exports=o},584:function(e){e.exports=n},721:function(e){e.exports=r},156:function(e){e.exports=c},238:function(t){t.exports=e}},s={};function p(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return u[e](n,n.exports,p),n.exports}p.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return p.d(t,{a:t}),t},p.d=function(e,t){for(var n in t)p.o(t,n)&&!p.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},p.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},p.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var d={};p.r(d),p.d(d,{PluginActionBulkEditClient:function(){return ed},default:function(){return em}});var m=p("772"),f=p("505"),b=p("156"),y=p.n(b),v=p("238");function h(){var e,t=(0,m.useDesignable)().dn,n=(0,v.useTranslation)().t,o=(0,f.useFieldSchema)();return y().createElement(m.SchemaSettingsSelectItem,{title:n("Data will be updated"),options:[{label:n("Selected"),value:"selected"},{label:n("Entire collection",{ns:"action-bulk-edit"}),value:"all"}],value:null==o?void 0:null===(e=o["x-action-settings"])||void 0===e?void 0:e.updateMode,onChange:function(e){o["x-action-settings"].updateMode=e,t.emit("patch",{schema:{"x-uid":o["x-uid"],"x-action-settings":o["x-action-settings"]}}),t.refresh()}})}function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,v.useTranslation)().t,n=(0,f.useFieldSchema)();return(null==n?void 0:n.parent["x-component"])!=="CollectionField"&&y().createElement(y().Fragment,null,y().createElement(m.SchemaSettingsDivider,null),y().createElement(m.SchemaSettingsRemove,{removeParentsIfNoChildren:!0,breakRemoveOn:function(e){return"Space"===e["x-component"]||e["x-component"].endsWith("ActionBar")},confirm:{title:t("Delete action"),onOk:e.onConfirmOk}}))}var S=new m.SchemaSettings({name:"ActionSettings:customize:bulkEdit",items:[{name:"editButton",Component:m.ActionDesigner.ButtonEditor,useComponentProps:function(){return(0,m.useSchemaToolbar)().buttonEditorProps}},{name:"openMode",Component:m.SchemaInitializerOpenModeSchemaItems,useComponentProps:function(){var e=["create","update","view","customize:popup","duplicate","customize:create"].includes((0,f.useFieldSchema)()["x-action"]||"");return{openMode:e,openSize:e}}},{name:"updateMode",Component:h},{name:"remove",sort:100,Component:g,useComponentProps:function(){return(0,m.useSchemaToolbar)().removeButtonProps}}]}),O=new m.SchemaSettings({name:"actionSettings:bulkEdit",items:[{name:"editButton",Component:m.ActionDesigner.ButtonEditor,useComponentProps:function(){return(0,m.useSchemaToolbar)().buttonEditorProps}},{name:"openMode",Component:m.SchemaInitializerOpenModeSchemaItems,useComponentProps:function(){var e=(0,m.useOpenModeContext)().hideOpenMode,t=["create","update","view","customize:popup","duplicate","customize:create"].includes((0,f.useFieldSchema)()["x-action"]||"");return{openMode:t&&!e,openSize:t&&!e}}},{name:"updateMode",Component:h},{name:"remove",sort:100,Component:g,useComponentProps:function(){return(0,m.useSchemaToolbar)().removeButtonProps}}]}),x=new m.SchemaSettings({name:"actionSettings:bulkEditSubmit",items:[{name:"editButton",Component:m.ActionDesigner.ButtonEditor,useComponentProps:function(){return(0,m.useSchemaToolbar)().buttonEditorProps}},{name:"secondConfirmation",Component:m.SecondConFirm},{name:"afterSuccessfulSubmission",Component:m.AfterSuccess},{name:"refreshDataBlockRequest",Component:m.RefreshDataBlockRequest,useComponentProps:function(){return{isPopupAction:!0}}},{name:"remove",sort:100,Component:g,useComponentProps:function(){return(0,m.useSchemaToolbar)().removeButtonProps}}]}),w=function(e){return y().createElement(m.PopupSettingsProvider,{enableURL:!1},y().createElement(m.ACLActionProvider,null,e.children))},k=function(){var e,t,n=(0,m.useOpenModeContext)().defaultOpenMode,o=(0,m.useSchemaInitializerItem)();return y().createElement(m.BlockInitializer,(e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){var o,r,i;o=e,r=t,i=n[t],r in o?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i})}return e}({},o),t=(t={schema:{type:"void",title:'{{t("Bulk edit")}}',"x-component":"Action","x-action":"customize:bulkEdit","x-action-settings":{updateMode:"selected"},"x-component-props":{openMode:n,icon:"EditOutlined"},properties:{drawer:{type:"void",title:'{{t("Bulk edit")}}',"x-component":"Action.Container","x-component-props":{className:"nb-action-popup"},properties:{tabs:{type:"void","x-component":"Tabs","x-component-props":{},"x-initializer":"popup:addTab","x-initializer-props":{gridInitializer:"popup:bulkEdit:addBlock"},properties:{tab1:{type:"void",title:'{{t("Bulk edit")}}',"x-component":"Tabs.TabPane","x-designer":"Tabs.Designer","x-component-props":{},properties:{grid:{type:"void","x-component":"Grid","x-initializer":"popup:bulkEdit:addBlock",properties:{}}}}}}}}}},item:o},t),Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n.push.apply(n,o)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e))},P=p("482"),C=p("875");function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e,t,n,o,r,i,a){try{var c=e[i](a),l=c.value}catch(e){n(e);return}c.done?t(l):Promise.resolve(l).then(o,r)}var I=function(){var e,t,n,o,r=(0,m.useSchemaInitializerItem)();r.onCreateBlockSchema,r.componentType,r.createBlockSchema;var i=function(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],!(t.indexOf(n)>=0)&&(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++){if(n=i[o],!(t.indexOf(n)>=0))Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}}return r}(r,["onCreateBlockSchema","componentType","createBlockSchema"]),a=(0,m.useSchemaInitializer)().insert,c=(0,m.useSchemaTemplateManager)().getTemplateSchemaByMode,l=(0,m.useAssociationName)(),u=(0,m.useCollection_deprecated)();return y().createElement(m.SchemaInitializerItem,(n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){var o,r,i;o=e,r=t,i=n[t],r in o?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i})}return e}({icon:y().createElement(P.FormOutlined,null)},i),o=(o={onClick:(t=(e=function(e){var t,n,o;return function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,function(r){switch(r.label){case 0:if(!(t=e.item).template)return[3,2];return[4,c(t)];case 1:return n=r.sent(),"FormItem"===t.template.componentName?(o=(0,m.createCreateFormBlockUISchema)(l?{association:l,dataSource:u.dataSource,templateSchema:n}:{collectionName:u.name,dataSource:u.dataSource,templateSchema:n}),"reference"===t.mode&&(o["x-template-key"]=t.template.key),a(o)):a(n),[3,3];case 2:a(function(e){var t=e.collectionName,n=e.association,o=e.dataSource;if(!t||!o)throw Error("collectionName and dataSource are required");return{type:"void","x-acl-action-props":{skipScopeCheck:!0},"x-acl-action":"".concat(n||t,":update"),"x-decorator":"FormBlockProvider","x-decorator-props":{dataSource:o,collection:t,association:n},"x-toolbar":"BlockSchemaToolbar","x-settings":"blockSettings:bulkEditForm","x-component":"CardItem",properties:j({},(0,C.uid)(),{type:"void","x-component":"FormV2","x-use-component-props":"useCreateFormBlockProps",properties:j({grid:{type:"void","x-component":"Grid","x-initializer":"bulkEditForm:configureFields",properties:{}}},(0,C.uid)(),{type:"void","x-initializer":"bulkEditForm:configureActions","x-component":"ActionBar","x-component-props":{layout:"one-column",style:{marginTop:24}}})})}}({association:l,collectionName:u.name,dataSource:u.dataSource})),r.label=3;case 3:return[2]}})},function(){var t=this,n=arguments;return new Promise(function(o,r){var i=e.apply(t,n);function a(e){E(i,o,r,a,c,"next",e)}function c(e){E(i,o,r,a,c,"throw",e)}a(void 0)})}),function(e){return t.apply(this,arguments)}),items:(0,m.useRecordCollectionDataSourceItems)("FormItem")},o),Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n.push.apply(n,o)}return n})(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))}),n))};function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){var o,r,i;o=e,r=t,i=n[t],r in o?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i})}return e}var B=new m.SchemaInitializer({name:"CreateFormBulkEditBlockInitializers",wrap:m.gridRowColWrap,title:'{{t("Add block")}}',icon:"PlusOutlined",items:[{type:"itemGroup",title:'{{t("Data blocks")}}',name:"dataBlocks",children:[{name:"form",title:'{{t("Form")}}',Component:I}]},{type:"itemGroup",title:'{{t("Other blocks")}}',name:"otherBlocks",children:[{name:"markdown",title:'{{t("Markdown")}}',Component:"MarkdownBlockInitializer"}]}]}),T={wrap:m.gridRowColWrap,title:'{{t("Add block")}}',icon:"PlusOutlined",items:[{type:"itemGroup",title:'{{t("Data blocks")}}',name:"dataBlocks",children:[{name:"form",title:'{{t("Form")}}',Component:I}]},{type:"itemGroup",title:'{{t("Other blocks")}}',name:"otherBlocks",children:[{name:"markdown",title:'{{t("Markdown")}}',Component:"MarkdownBlockInitializer"}]}]},z=new m.CompatibleSchemaInitializer(F({name:"BulkEditBlockInitializers"},T)),M=new m.CompatibleSchemaInitializer(F({name:"popup:bulkEdit:addBlock"},T),z);function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){var o,r,i;o=e,r=t,i=n[t],r in o?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i})}return e}var D={title:'{{t("Configure actions")}}',icon:"SettingOutlined",items:[{type:"itemGroup",title:'{{t("Enable actions")}}',name:"enableActions",children:[{name:"submit",title:'{{t("Submit")}}',Component:function(e){var t,n;return y().createElement(m.ActionInitializerItem,(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){var o,r,i;o=e,r=t,i=n[t],r in o?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i})}return e}({},e),n=(n={schema:{title:'{{ t("Submit") }}',"x-action":"submit","x-component":"Action","x-use-component-props":"useCustomizeBulkEditActionProps","x-toolbar":"ActionSchemaToolbar","x-settings":"actionSettings:bulkEditSubmit","x-component-props":{type:"primary",htmlType:"submit"}}},n),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n.push.apply(n,o)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t))},schema:{"x-action-settings":{}}}]}]},R=new m.CompatibleSchemaInitializer(A({name:"BulkEditFormActionInitializers"},D)),q=new m.CompatibleSchemaInitializer(A({name:"bulkEditForm:configureActions"},D),R),N=p("584"),_=p("721");function G(e,t,n,o,r,i,a){try{var c=e[i](a),l=c.value}catch(e){n(e);return}c.done?t(l):Promise.resolve(l).then(o,r)}function V(e){return function(){var t=this,n=arguments;return new Promise(function(o,r){var i=e.apply(t,n);function a(e){G(i,o,r,a,c,"next",e)}function c(e){G(i,o,r,a,c,"throw",e)}a(void 0)})}}function U(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}var L=function(){var e,t,n,o,r=(0,f.useForm)(),i=(0,v.useTranslation)().t,a=(0,m.useBlockRequestContext)(),c=a.field,l=a.resource,u=a.__parent,s=(0,b.useContext)(f.SchemaExpressionScopeContext),p=(0,m.useActionContext)(),d=(0,m.useNavigateNoUpdate)(),y=(0,m.useCompile)(),h=(0,f.useField)(),g=(0,m.useTableBlockContext)(),S=_.App.useApp().modal,O=g.rowKey,x=null!==(o=null!==(n=null===(t=g.field)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.selectedRowKeys)&&void 0!==n?n:null==s?void 0:s.selectedRecordKeys)&&void 0!==o?o:{},w=p.setVisible,k=p.fieldSchema,P=p.setSubmitted,C=(0,f.useFieldSchema)();return{onClick:function(){return V(function(){var e,t,n,o,a,s,p,m,f,b,v,g,j,E,I,F,B,T,z;return U(this,function(M){switch(M.label){case 0:if(n=(null!==(t=null==k?void 0:k["x-action-settings"])&&void 0!==t?t:{}).updateMode,s=(a=null!==(o=null==C?void 0:C["x-action-settings"])&&void 0!==o?o:{}).onSuccess,p=a.skipValidator,m=a.triggerWorkflows,b=(null!==(f=null==C?void 0:C["x-component-props"])&&void 0!==f?f:{}).refreshDataBlockRequest,g=(v=s||{}).manualClose,j=v.redirecting,E=v.redirectTo,I=v.successMessage,F=v.actionAfterSuccess,T=(null!==(B=null===(e=u.service.params)||void 0===e?void 0:e[0])&&void 0!==B?B:{}).filter,p)return[3,2];return[4,r.submit()];case 1:M.sent(),M.label=2;case 2:h.data=c.data||{},h.data.loading=!0,M.label=3;case 3:if(M.trys.push([3,,5,6]),z={values:r.values,filter:T,forceUpdate:!1,triggerWorkflows:(null==m?void 0:m.length)?m.map(function(e){return[e.workflowKey,e.context].filter(Boolean).join("!")}).join(","):void 0},"selected"===n){var A,D,R;if(!(null==x?void 0:x.length))return _.message.error(i("Please select the records to be updated")),[2];z.filter={$and:[(A={},D=O||"id",R={$in:x},D in A?Object.defineProperty(A,D,{value:R,enumerable:!0,configurable:!0,writable:!0}):A[D]=R,A)]}}return!z.filter&&(z.forceUpdate=!0),[4,l.update(z)];case 4:if(M.sent(),h.data.loading=!1,("previous"===F||!F&&!0!==j)&&(null==w||w(!1)),!1!==b&&P(!0),!I)return(j&&!F||"redirect"===F)&&E&&((0,N.isURL)(E)?window.location.href=E:d(E)),[2];return g?S.success({title:y(I),onOk:V(function(){return U(this,function(e){switch(e.label){case 0:return[4,r.reset()];case 1:return e.sent(),(j&&!F||"redirect"===F)&&E&&((0,N.isURL)(E)?window.location.href=E:d(E)),[2]}})})}):_.message.success(y(I)),[3,6];case 5:return h.data.loading=!1,[7];case 6:return[2]}})})()}}};function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){var o,r,i;o=e,r=t,i=n[t],r in o?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i})}return e}var K={wrap:m.gridRowColWrap,icon:"SettingOutlined",title:'{{t("Configure fields")}}',items:[{name:"displayFields",type:"itemGroup",title:'{{t("Display fields")}}',useChildren:function(e){var t=(0,m.useCollection_deprecated)(),n=t.name,o=t.fields,r=(0,m.useCollectionManager_deprecated)(),i=r.getInterface,a=r.getCollection,c=(0,f.useForm)(),l=e||{},u=l.readPretty,s=void 0===u?c.readPretty:u,p=l.block,d=void 0===p?"Form":p,y=(0,m.useRemoveGridFormItem)();return(0,b.useMemo)(function(){return null==o?void 0:o.filter(function(e){var t;return(null==e?void 0:e.interface)&&!(null==e?void 0:null===(t=e.uiSchema)||void 0===t?void 0:t["x-read-pretty"])&&"snapshot"!==e.interface&&"sequence"!==e.type}).map(function(e){var t,o,r,c=i(e.interface),l={type:"string",name:e.name,title:(null==e?void 0:null===(t=e.uiSchema)||void 0===t?void 0:t.title)||e.name,"x-toolbar":"FormItemSchemaToolbar","x-settings":"fieldSettings:BulkEditFormItem","x-component":"BulkEditField","x-decorator":"FormItem","x-collection-field":"".concat(n,".").concat(e.name)};return{name:(null==e?void 0:null===(o=e.uiSchema)||void 0===o?void 0:o.title)||e.name,type:"item",title:(null==e?void 0:null===(r=e.uiSchema)||void 0===r?void 0:r.title)||e.name,Component:"CollectionFieldInitializer",remove:y,schemaInitialize:function(t){var n;null==c||null===(n=c.schemaInitialize)||void 0===n||n.call(c,t,{field:e,block:d,readPretty:s,targetCollection:a(e.target)})},schema:l}})},[o])}},{name:"divider",type:"divider"},{name:"addText",title:'{{t("Add Markdown")}}',Component:"BlockItemInitializer",schema:{type:"void","x-editable":!1,"x-decorator":"FormItem","x-toolbar":"FormItemSchemaToolbar","x-settings":"blockSettings:markdown","x-component":"Markdown.Void","x-component-props":{content:'{{t("This is a demo text, **supports Markdown syntax**.")}}'}}}]},$=new m.CompatibleSchemaInitializer(W({name:"BulkEditFormItemInitializers"},K)),H=new m.CompatibleSchemaInitializer(W({name:"bulkEditForm:configureFields"},K),$),J=new m.SchemaSettings({name:"fieldSettings:BulkEditFormItem",items:[{name:"decoratorOptions",type:"itemGroup",hideIfNoChildren:!0,useComponentProps:function(){return{title:(0,(0,v.useTranslation)().t)("Generic properties")}},useChildren:function(){return[{name:"editFieldTitle",type:"modal",useComponentProps:function(){var e,t=(0,v.useTranslation)().t,n=(0,m.useCompile)(),o=(0,m.useDesignable)().dn,r=(0,f.useField)(),i=(0,f.useFieldSchema)(),a=(0,m.useCollectionManager_deprecated)().getCollectionJoinField,c=(0,m.useCollection_deprecated)().dataSource,l=a(i["x-collection-field"],c);return{title:t("Edit field title"),schema:{type:"object",title:t("Edit field title"),properties:{title:{title:t("Field title"),default:null==r?void 0:r.title,description:"".concat(t("Original field title: ")).concat(null==l?void 0:null===(e=l.uiSchema)||void 0===e?void 0:e.title),"x-decorator":"FormItem","x-component":"Input","x-component-props":{}}}},onSubmit:function(e){var t,a=e.title,c=""===a.trim()?null==l?void 0:null===(t=l.uiSchema)||void 0===t?void 0:t.title:a;r.title=n(c),i.title=a,o.emit("patch",{schema:{"x-uid":i["x-uid"],title:i.title}}),o.refresh()}}}},{name:"displayTitle",type:"switch",useComponentProps:function(){var e,t,n=(0,v.useTranslation)().t,o=(0,m.useDesignable)().dn,r=(0,f.useField)(),i=(0,f.useFieldSchema)();return{title:n("Display title"),checked:null===(t=null===(e=i["x-decorator-props"])||void 0===e?void 0:e.showTitle)||void 0===t||t,onChange:function(e){var t,n;i["x-decorator-props"]=i["x-decorator-props"]||{},i["x-decorator-props"].showTitle=e,r.decoratorProps.showTitle=e,o.emit("patch",{schema:{"x-uid":i["x-uid"],"x-decorator-props":(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){var o,r,i;o=e,r=t,i=n[t],r in o?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i})}return e}({},i["x-decorator-props"]),n=(n={showTitle:e},n),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n.push.apply(n,o)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t)}}),o.refresh()}}}},{name:"editDescription",type:"modal",useComponentProps:function(){var e=(0,v.useTranslation)().t,t=(0,m.useDesignable)().dn,n=(0,f.useField)(),o=(0,f.useFieldSchema)();return{title:e("Edit description"),schema:{type:"object",title:e("Edit description"),properties:{description:{default:null==n?void 0:n.description,"x-decorator":"FormItem","x-component":"Input.TextArea","x-component-props":{}}}},onSubmit:function(e){var r=e.description;n.description=r,o.description=r,t.emit("patch",{schema:{"x-uid":o["x-uid"],description:o.description}}),t.refresh()}}}},{name:"editTooltip",type:"modal",useComponentProps:function(){var e,t=(0,v.useTranslation)().t,n=(0,m.useDesignable)().dn,o=(0,f.useField)(),r=(0,f.useFieldSchema)();return{title:t("Edit tooltip"),schema:{type:"object",title:t("Edit tooltip"),properties:{tooltip:{default:null==r?void 0:null===(e=r["x-decorator-props"])||void 0===e?void 0:e.tooltip,"x-decorator":"FormItem","x-component":"Input.TextArea","x-component-props":{}}}},onSubmit:function(e){var t=e.tooltip;o.decoratorProps.tooltip=t,r["x-decorator-props"]=r["x-decorator-props"]||{},r["x-decorator-props"].tooltip=t,n.emit("patch",{schema:{"x-uid":r["x-uid"],"x-decorator-props":r["x-decorator-props"]}}),n.refresh()}}}},{name:"setValidationRules",type:"modal",Component:m.EditValidationRules,useVisible:function(){var e=(0,m.useFormBlockContext)().form,t=(0,m.useIsFormReadPretty)(),n=(0,m.useValidateSchema)();return e&&!t&&!!n}},m.fieldComponentSettingsItem]}},{name:"componentOptions",type:"itemGroup",hideIfNoChildren:!0,useComponentProps:function(){return{title:(0,(0,v.useTranslation)().t)("Specific properties")}},useChildren:function(){var e=(0,m.useApp)(),t=(0,m.useFieldComponentName)(),n=e.schemaSettingsManager.get("fieldSettings:component:".concat(t));return(null==n?void 0:n.items)||[]}},{name:"divider",type:"divider"},{name:"delete",type:"remove",sort:100,useComponentProps:function(){return{removeParentsIfNoChildren:!0,confirm:{title:(0,(0,v.useTranslation)().t)("Delete field")},breakRemoveOn:{"x-component":"Grid"}}}}]}),Q=new m.SchemaSettings({name:"blockSettings:bulkEditForm",items:[{name:"title",Component:m.SchemaSettingsBlockTitleItem},{name:"setTheBlockHeight",Component:m.SchemaSettingsBlockHeightItem},{name:"linkageRules",Component:m.SchemaSettingsLinkageRules,useComponentProps:function(){return{collectionName:(0,m.useCollection_deprecated)().name}}},{name:"divider",type:"divider"},{name:"formItemTemplate",Component:m.SchemaSettingsFormItemTemplate,useComponentProps:function(){var e,t,n=(0,m.useBlockTemplateContext)().componentNamePrefix,o=(0,m.useCollection)().name,r=(0,f.useFieldSchema)(),i=(null==r?void 0:null===(e=r["x-decorator-props"])||void 0===e?void 0:e.resource)||(null==r?void 0:null===(t=r["x-decorator-props"])||void 0===t?void 0:t.association);return{componentName:"".concat(n,"FormItem"),collectionName:o,resourceName:i}}},{name:"setBlockLayout",Component:m.SchemaSettingsLayoutItem},{name:"divider2",type:"divider"},{name:"remove",type:"remove",componentProps:{removeParentsIfNoChildren:!0,breakRemoveOn:{"x-component":"Grid"}}}]}),X=p("964");function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,o,r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i=[],a=!0,c=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{!a&&null!=r.return&&r.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function et(){var e,t,n=(e=["\n        display: flex;\n        > .ant-space-item {\n          width: 100%;\n        }\n      "],!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}})));return et=function(){return n},n}var en=function(e){var t=(0,f.useField)(),n=(0,f.useFieldSchema)(),o=(0,m.useCollectionField_deprecated)().uiSchema,r=(0,m.useComponent)(null==o?void 0:o["x-component"]),i=(0,m.useCompile)(),a=function(e,n){t[e]=void 0===t[e]?n:t[e]};return((0,b.useEffect)(function(){if(!!o){a("content",o["x-content"]),a("description",o.description),a("initialValue",o.default),!0===n["x-disabled"]&&(t.disabled=!0),!0===n["x-read-pretty"]&&(t.readPretty=!0),t.required=!0,t.dataSource=o.enum;var e=i(o["x-component-props"])||{},r=(0,C.merge)(e,t.componentProps||{});t.componentProps=r}},[JSON.stringify(o)]),o)?y().createElement(r,e,e.children):null},eo=(0,f.connect)(function(e){var t=(0,f.useFieldSchema)();return y().createElement(m.CollectionFieldProvider,{name:t.name},y().createElement(en,e))}),er=function(e){var t,n,o=(0,v.useTranslation)().t,r=(0,f.useFieldSchema)(),i=(0,f.useField)(),a=ee((0,b.useState)(1),2),c=a[0],l=a[1],u=ee((0,b.useState)(null),2),s=u[0],p=u[1],d=(0,(0,m.useCollection_deprecated)().getField)(r.name)||{};(0,b.useEffect)(function(){i.value=function(e){if(3 in e)return null;if(2 in e)return e[2];if(1 in e)return}(Z({},c,s)),i.required&&(i.value?(i.modify(),i.form.clearErrors(i.address)):i.modified&&i.form.validate(i.address))},[i,c,s]),(0,b.useEffect)(function(){null===i.value&&p(void 0)},[i.value]);var h=function(e){var t,n,o,r;p(null!==(r=null!==(o=null==e?void 0:null===(t=e.target)||void 0===t?void 0:t.value)&&void 0!==o?o:null==e?void 0:null===(n=e.target)||void 0===n?void 0:n.checked)&&void 0!==r?r:e)};return y().createElement(_.Space,{className:(0,X.css)(et())},y().createElement(_.Select,{defaultValue:c,value:c,onChange:function(e){l(e),i.required=2===e}},y().createElement(_.Select.Option,{value:1},o("Remains the same")),y().createElement(_.Select.Option,{value:2},o("Changed to")),y().createElement(_.Select.Option,{value:3},o("Clear"))),[2,4].includes(c)&&(null==d?void 0:d.interface)!=="checkbox"&&y().createElement(eo,(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){Z(e,t,n[t])})}return e}({},e),n=(n={value:s,onChange:h,style:{minWidth:150}},n),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n.push.apply(n,o)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t)),[2,4].includes(c)&&(null==d?void 0:d.interface)==="checkbox"&&y().createElement(_.Checkbox,{checked:s,onChange:h}))};function ei(e,t,n,o,r,i,a){try{var c=e[i](a),l=c.value}catch(e){n(e);return}c.done?t(l):Promise.resolve(l).then(o,r)}function ea(e,t,n){return(ea=ep()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&eu(r,n.prototype),r}).apply(null,arguments)}function ec(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function el(e){return(el=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function eu(e,t){return(eu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function es(e){var t="function"==typeof Map?new Map:void 0;return(es=function(e){var n;if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return ea(e,arguments,el(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),eu(o,e)})(e)}function ep(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ep=function(){return!!e})()}var ed=function(e){var t,n,o;function r(){var e,t,n;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),e=this,t=r,n=arguments,t=el(t),function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ep()?Reflect.construct(t,n||[],el(e).constructor):t.apply(e,n))}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&eu(e,t)}(r,e),t=r,n=[{key:"load",value:function(){var e,t=this;return(e=function(){var e;return function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,function(n){return t.app.addComponents({BulkEditField:er,BulkEditActionDecorator:w}),t.app.addScopes({useCustomizeBulkEditActionProps:L}),t.app.schemaSettingsManager.add(Q),t.app.schemaSettingsManager.add(S),t.app.schemaSettingsManager.add(O),t.app.schemaSettingsManager.add(x),t.app.schemaSettingsManager.add(J),t.app.schemaInitializerManager.add($),t.app.schemaInitializerManager.add(H),t.app.schemaInitializerManager.add(B),t.app.schemaInitializerManager.add(z),t.app.schemaInitializerManager.add(M),t.app.schemaInitializerManager.add(R),t.app.schemaInitializerManager.add(q),e={type:"item",title:'{{t("Bulk edit")}}',name:"bulkEdit",Component:k,schema:{"x-align":"right","x-decorator":"BulkEditActionDecorator","x-action":"customize:bulkEdit","x-toolbar":"ActionSchemaToolbar","x-settings":"actionSettings:bulkEdit","x-acl-action":"update","x-acl-action-props":{skipScopeCheck:!0}},useVisible:function(){return(0,m.useActionAvailable)("updateMany")}},t.app.schemaInitializerManager.addItem("table:configureActions","customize.bulkEdit",e),t.app.schemaInitializerManager.addItem("gantt:configureActions","customize.bulkEdit",e),t.app.schemaInitializerManager.addItem("map:configureActions","customize.bulkEdit",e),[2]})},function(){var t=this,n=arguments;return new Promise(function(o,r){var i=e.apply(t,n);function a(e){ei(i,o,r,a,c,"next",e)}function c(e){ei(i,o,r,a,c,"throw",e)}a(void 0)})})()}}],ec(t.prototype,n),r}(es(m.Plugin)),em=ed;return d}()});