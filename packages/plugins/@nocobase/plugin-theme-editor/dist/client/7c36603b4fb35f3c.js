/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

"use strict";(self.webpackChunk_nocobase_plugin_theme_editor=self.webpackChunk_nocobase_plugin_theme_editor||[]).push([["506"],{8390:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});var r=n("3772"),o=n("7584"),l=n("2721"),a=n("8156"),i=n.n(a),u=n("482"),s=n("6200"),c=n("15"),d=n("573"),m=n("7012"),f=n("4950");function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t,n,r,o,l,a){try{var i=e[l](a),u=i.value}catch(e){n(e);return}i.done?t(u):Promise.resolve(u).then(r,o)}function y(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var l=e.apply(t,n);function a(e){h(l,r,o,a,i,"next",e)}function i(e){h(l,r,o,a,i,"throw",e)}a(void 0)})}}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,l;r=e,o=t,l=n[t],o in r?Object.defineProperty(r,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[o]=l})}return e}function b(e,t){var n,r,o,l,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return l={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function i(l){return function(i){return function(l){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,i])}}}var g=function(e){var t,n,o=e.theme,a=(0,r.useToken)().token;return i().createElement(l.ConfigProvider,{theme:(t=v({},o),n=(n={inherit:!1},n),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t)},i().createElement("div",{style:{display:"flex",justifyContent:"space-between",pointerEvents:"none",width:"100%",height:129,borderRadius:a.borderRadiusLG,overflow:"hidden"}},i().createElement(l.Space,{style:{transform:"scale(0.7) translate(0, 0)",transformOrigin:"0 0"},size:0,align:"start"},i().createElement(s.sq,null))))},C=function(e){var t,n,s,h,C,w,k,E,O,T,S,j=(0,r.useGlobalTheme)(),P=j.theme,x=j.setTheme,A=j.setCurrentSettingTheme,D=j.setCurrentEditingTheme,I=j.getCurrentEditingTheme,_=(0,f.useThemeEditorContext)().setOpen,z=(0,r.useCurrentUserContext)(),q=e.item,G=e.style,U=void 0===G?{}:G,L=e.onChange,M=(0,r.useAPIClient)(),R=(0,c.Y)().updateUserThemeSettings,N=l.App.useApp().modal;var B=(t=i().useState(!1),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var l=[],a=!0,i=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(l.push(n.value),!t||l.length!==t);a=!0);}catch(e){i=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(i)throw r}}return l}}(t,2)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}}(t,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),Y=B[0],$=B[1],H=(0,m.useThemeId)(),F=H.currentThemeId,J=H.defaultThemeId,K=(0,d.$)().t,Q=(0,r.useToken)().token,V=q.id===J,W=(0,a.useCallback)(function(){if(!V)N.confirm({title:K("Delete theme"),content:K("Deletion is unrecoverable. Confirm deletion?"),onOk:y(function(){var e,t,n;return b(this,function(r){switch(r.label){case 0:return[4,M.request({url:"themeConfig:destroy/".concat(q.id)})];case 1:return r.sent(),q.id===(null==z?void 0:null===(n=z.data)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:null===(e=t.systemSettings)||void 0===e?void 0:e.themeId)&&R(null),l.message.success(K("Deleted successfully")),null==L||L({type:"delete",item:q}),[2]}})})})},[M,null==z?void 0:null===(k=z.data)||void 0===k?void 0:null===(w=k.data)||void 0===w?void 0:null===(C=w.systemSettings)||void 0===C?void 0:C.themeId,V,q,N,L,K,R]);var X=(0,a.useCallback)((s=y(function(e){var t,n,r,a;return b(this,function(i){switch(i.label){case 0:$(!0),i.label=1;case 1:if(i.trys.push([1,6,,7]),e)return[3,3];return[4,Promise.all([M.request({url:"themeConfig:update/".concat(q.id),method:"post",data:{optional:e,default:!1}}),q.id===(null==z?void 0:null===(r=z.data)||void 0===r?void 0:null===(n=r.data)||void 0===n?void 0:null===(t=n.systemSettings)||void 0===t?void 0:t.themeId)&&R(null)])];case 2:return i.sent(),[3,5];case 3:return[4,M.request({url:"themeConfig:update/".concat(q.id),method:"post",data:{optional:e}})];case 4:i.sent(),i.label=5;case 5:return[3,7];case 6:return a=i.sent(),(0,o.error)(a),[3,7];case 7:return $(!1),l.message.success(K("Updated successfully")),null==L||L({type:"optional",item:q}),[2]}})}),function(e){return s.apply(this,arguments)}),[M,null==z?void 0:null===(T=z.data)||void 0===T?void 0:null===(O=T.data)||void 0===O?void 0:null===(E=O.systemSettings)||void 0===E?void 0:E.themeId,q,L,K,R]);var Z=(0,a.useCallback)((h=y(function(e){var t;return b(this,function(n){switch(n.label){case 0:$(!0),n.label=1;case 1:if(n.trys.push([1,6,,7]),!e)return[3,3];return[4,Promise.all([M.request({url:"themeConfig:update/".concat(q.id),method:"post",data:{optional:!0,default:!0}})])];case 2:return n.sent(),[3,5];case 3:return[4,M.request({url:"themeConfig:update/".concat(q.id),method:"post",data:{default:!1}})];case 4:n.sent(),n.label=5;case 5:return[3,7];case 6:return t=n.sent(),(0,o.error)(t),[3,7];case 7:return $(!1),l.message.success(K("Updated successfully")),null==L||L({type:"optional",item:q}),[2]}})}),function(e){return h.apply(this,arguments)}),[M,q,L,K]),ee=(0,a.useCallback)(function(){A(P),D(q),x((0,r.compatOldTheme)(q.config)),_(!0)},[q,D,A,_,x,P]),et=(0,a.useMemo)(function(){return{items:[{key:"optional",label:i().createElement(l.Space,{style:{width:"100%",justifyContent:"space-between"},align:"center",size:"middle",onClick:function(e){return e.stopPropagation()}},i().createElement("span",null,K("User selectable")),i().createElement(l.Switch,{disabled:V,style:{transform:"translateY(-2px)"},checked:q.optional,size:"small",loading:Y,onChange:X}))},{key:"system",label:i().createElement(l.Space,{style:{width:"100%",justifyContent:"space-between"},align:"center",size:"middle",onClick:function(e){return e.stopPropagation()}},i().createElement("span",null,K("Default theme")),i().createElement(l.Switch,{disabled:V,style:{transform:"translateY(-2px)"},checked:V,size:"small",loading:Y,onChange:Z}))}]}},[Z,X,V,q.optional,Y,K]),en=(0,a.useMemo)(function(){return[i().createElement(u.EditOutlined,{key:"edit",onClick:ee}),i().createElement(u.DeleteOutlined,{key:"delete",style:V?{color:Q.colorTextDisabled,cursor:"not-allowed"}:null,disabled:V,onClick:W}),i().createElement(l.Dropdown,{key:"ellipsis",menu:et},i().createElement(u.EllipsisOutlined,null))]},[W,ee,V,et,Q.colorTextDisabled]),er=(0,a.useMemo)(function(){if(q.id!==J&&!q.optional)return null;var e=q.id===F?K("Current"):q.id===J?K("Default"):q.optional?K("Optional"):K("Non-optional"),t=q.id===F?"processing":q.id===J?"default":q.optional?"success":"error";return i().createElement(l.Tag,{style:{marginRight:0},color:t},e)},[F,J,q.id,q.optional,K]),eo=(0,a.useMemo)(function(){var e;return(null===(e=I())||void 0===e?void 0:e.id)===q.id?v({cursor:"default",width:240,height:240,overflow:"hidden",outline:"1px solid var(--colorSettings)"},U):v({cursor:"default",width:240,height:240,overflow:"hidden"},U)},[I,q.id,U]);return i().createElement(l.Card,{hoverable:!0,extra:er,title:K(null===(S=q.config)||void 0===S?void 0:S.name),size:"small",style:eo,headStyle:{minHeight:38},actions:en},i().createElement(g,{theme:q.config}))};C.displayName="ThemeCard";var w=n("3036"),k=function(){var e=(0,r.useGlobalTheme)(),t=e.theme,n=e.setTheme,o=e.setCurrentSettingTheme,s=(0,r.useToken)().token,c=(0,f.useThemeEditorContext)().setOpen,m=(0,d.$)().t,p=l.App.useApp().modal,h=(0,a.useCallback)(function(){var e=p.confirm({title:m("Add new theme"),closable:!0,maskClosable:!0,width:"fit-content",footer:i().createElement(l.Space,{style:{float:"right",marginTop:s.margin,justifyContent:"flex-end"},wrap:!0},i().createElement(l.Button,{onClick:function(){o(t),n((0,r.compatOldTheme)(t)),c(!0),e.destroy()}},m("Edit based on current theme")),i().createElement(l.Button,{type:"primary",onClick:function(){o(t),n((0,r.compatOldTheme)(r.defaultTheme)),c(!0),e.destroy()}},m("Create a brand new theme")))})},[p,o,c,n,m,t,s.margin]);return i().createElement(l.Button,{type:"dashed",style:{width:240,height:240,borderRadius:s.borderRadiusLG,borderColor:"var(--colorSettings)",color:"var(--colorSettings)"},icon:i().createElement(u.PlusOutlined,null),onClick:h},m("Add new theme"))};k.displayName="ToEditTheme";var E=function(){var e=(0,w.useThemeListContext)(),t=e.run,n=e.error,u=e.refresh,s=e.data,c=(0,r.useToken)().token;(0,a.useEffect)(function(){!s&&t()},[]);var d=(0,a.useCallback)(function(){u()},[u]);return n?((0,o.error)(n),null):i().createElement(l.Space,{size:c.marginLG,wrap:!0},null==s?void 0:s.map(function(e){return i().createElement(C,{item:e,key:e.id,onChange:d})}),i().createElement(k,null))};E.displayName="ThemeList";var O=E}}]);