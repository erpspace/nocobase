/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@nocobase/client"),require("@formily/react"),require("react"),require("react-i18next"),require("@emotion/css"),require("dayjs"),require("antd"),require("@ant-design/icons"),require("@formily/antd-v5"),require("@formily/shared"),require("@nocobase/utils/client"),require("@formily/core"),require("lodash"),require("ahooks")):"function"==typeof define&&define.amd?define("@nocobase/plugin-data-visualization",["@nocobase/client","@formily/react","react","react-i18next","@emotion/css","dayjs","antd","@ant-design/icons","@formily/antd-v5","@formily/shared","@nocobase/utils/client","@formily/core","lodash","ahooks"],t):"object"==typeof exports?exports["@nocobase/plugin-data-visualization"]=t(require("@nocobase/client"),require("@formily/react"),require("react"),require("react-i18next"),require("@emotion/css"),require("dayjs"),require("antd"),require("@ant-design/icons"),require("@formily/antd-v5"),require("@formily/shared"),require("@nocobase/utils/client"),require("@formily/core"),require("lodash"),require("ahooks")):e["@nocobase/plugin-data-visualization"]=t(e["@nocobase/client"],e["@formily/react"],e.react,e["react-i18next"],e["@emotion/css"],e.dayjs,e.antd,e["@ant-design/icons"],e["@formily/antd-v5"],e["@formily/shared"],e["@nocobase/utils/client"],e["@formily/core"],e.lodash,e.ahooks)}(self,function(e,t,r,n,o,i,a,l,c,u,s,f,p,m){return function(){var d,y,b,v,h,g,O,S,x={703:function(e){"use strict";var t=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===r}(e)}(e)},r="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function n(e,t){return!1!==t.clone&&t.isMergeableObject(e)?l(Array.isArray(e)?[]:{},e,t):e}function o(e,t,r){return e.concat(t).map(function(e){return n(e,r)})}function i(e){var t;return Object.keys(e).concat((t=e,Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter(function(e){return Object.propertyIsEnumerable.call(t,e)}):[]))}function a(e,t){try{return t in e}catch(e){return!1}}function l(e,r,c){(c=c||{}).arrayMerge=c.arrayMerge||o,c.isMergeableObject=c.isMergeableObject||t,c.cloneUnlessOtherwiseSpecified=n;var u,s,f,p,m=Array.isArray(r),d=Array.isArray(e);if(m!==d)return n(r,c);if(m)return c.arrayMerge(e,r,c);return u=e,s=r,p={},(f=c).isMergeableObject(u)&&i(u).forEach(function(e){p[e]=n(u[e],f)}),i(s).forEach(function(e){var t,r;if(!a(t=u,r=e)||!!(Object.hasOwnProperty.call(t,r)&&Object.propertyIsEnumerable.call(t,r)))a(u,e)&&f.isMergeableObject(s[e])?p[e]=(function(e,t){if(!t.customMerge)return l;var r=t.customMerge(e);return"function"==typeof r?r:l})(e,f)(u[e],s[e],f):p[e]=n(s[e],f)}),p}l.all=function(e,t){if(!Array.isArray(e))throw Error("first argument should be an array");return e.reduce(function(e,r){return l(e,r,t)},{})};e.exports=l},581:function(e){e.exports=function(e,t){return"undefined"!=typeof __deoptimization_sideEffect__&&__deoptimization_sideEffect__(e,t),t}},482:function(e){"use strict";e.exports=l},964:function(e){"use strict";e.exports=o},632:function(e){"use strict";e.exports=c},563:function(e){"use strict";e.exports=f},505:function(e){"use strict";e.exports=t},875:function(e){"use strict";e.exports=u},772:function(t){"use strict";t.exports=e},584:function(e){"use strict";e.exports=s},749:function(e){"use strict";e.exports=m},721:function(e){"use strict";e.exports=a},760:function(e){"use strict";e.exports=i},467:function(e){"use strict";e.exports=p},156:function(e){"use strict";e.exports=r},238:function(e){"use strict";e.exports=n}},j={};function w(e){var t=j[e];if(void 0!==t)return t.exports;var r=j[e]={exports:{}};return x[e].call(r.exports,r,r.exports,w),r.exports}w.m=x,w.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return w.d(t,{a:t}),t},y=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},w.t=function(e,t){if(1&t&&(e=this(e)),8&t||"object"==typeof e&&e&&(4&t&&e.__esModule||16&t&&"function"==typeof e.then))return e;var r=Object.create(null);w.r(r);var n={};d=d||[null,y({}),y([]),y(y)];for(var o=2&t&&e;"object"==typeof o&&!~d.indexOf(o);o=y(o))Object.getOwnPropertyNames(o).forEach(function(t){n[t]=function(){return e[t]}});return n.default=function(){return e},w.d(r,n),r},w.d=function(e,t){for(var r in t)w.o(t,r)&&!w.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},w.f={},w.e=function(e){return Promise.all(Object.keys(w.f).reduce(function(t,r){return w.f[r](e,t),t},[]))},w.u=function(e){return"77ce36306250faab.js"},w.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),w.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},b={},v="@nocobase/plugin-data-visualization:",w.l=function(e,t,r,n){if(b[e]){b[e].push(t);return}if(void 0!==r){for(var o,i,a=document.getElementsByTagName("script"),l=0;l<a.length;l++){var c=a[l];if(c.getAttribute("src")==e||c.getAttribute("data-webpack")==v+r){o=c;break}}}!o&&(i=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,w.nc&&o.setAttribute("nonce",w.nc),o.setAttribute("data-webpack",v+r),o.src=e),b[e]=[t];var u=function(t,r){o.onerror=o.onload=null,clearTimeout(s);var n=b[e];if(delete b[e],o.parentNode&&o.parentNode.removeChild(o),n&&n.forEach(function(e){return e(r)}),t)return t(r)},s=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),i&&document.head.appendChild(o)},w.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},w.p=(!(h=window.__nocobase_public_path__||"/").endsWith("/")&&(h+="/"),h+"static/plugins/@nocobase/plugin-data-visualization/dist/client/"),g={909:0},w.f.j=function(e,t){var r=w.o(g,e)?g[e]:void 0;if(0!==r){if(r)t.push(r[2]);else{var n=new Promise(function(t,n){r=g[e]=[t,n]});t.push(r[2]=n);var o=w.p+w.u(e),i=Error();w.l(o,function(t){if(w.o(g,e)&&(0!==(r=g[e])&&(g[e]=void 0),r)){var n=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;i.message="Loading chunk "+e+" failed.\n("+n+": "+o+")",i.name="ChunkLoadError",i.type=n,i.request=o,r[1](i)}},"chunk-"+e,e)}}},O=function(e,t){var r=t[0],n=t[1],o=t[2],i,a,l=0;if(r.some(function(e){return 0!==g[e]})){for(i in n)w.o(n,i)&&(w.m[i]=n[i]);o&&o(w)}for(e&&e(t);l<r.length;l++)a=r[l],w.o(g,a)&&g[a]&&g[a][0](),g[a]=0},(S=self.webpackChunk_nocobase_plugin_data_visualization=self.webpackChunk_nocobase_plugin_data_visualization||[]).forEach(O.bind(null,0)),S.push=O.bind(null,S.push.bind(S));var P={};return!function(){"use strict";w.r(P),w.d(P,{ChartConfigContext:function(){return tP},default:function(){return ob},Chart:function(){return nu},useSetChartSize:function(){return td}});var e,t,r=w("772"),n=w("156"),o=w.n(n),i=w("482"),a=w("632"),l=w("563"),c=w("505"),u=w("721"),s=w("467"),f=w.n(s),p=w("238"),m="data-visualization";function d(e){return r.i18n.t(e,{ns:[m,"client"]})}function y(){return(0,p.useTranslation)([m,"client"],{nsMode:"fallback"})}var b={datetime:[{label:d("YYYY"),value:"YYYY"},{label:d("MM"),value:"MM"},{label:d("DD"),value:"DD"},{label:d("YYYY-MM"),value:"YYYY-MM"},{label:d("YYYY-MM-DD"),value:"YYYY-MM-DD"},{label:d("YYYY-MM-DD hh:mm"),value:"YYYY-MM-DD hh:mm"},{label:d("YYYY-MM-DD hh:mm:ss"),value:"YYYY-MM-DD hh:mm:ss"}],date:[{label:d("YYYY"),value:"YYYY"},{label:d("MM"),value:"MM"},{label:d("DD"),value:"DD"},{label:d("YYYY-MM"),value:"YYYY-MM"},{label:d("YYYY-MM-DD"),value:"YYYY-MM-DD"}],time:[{label:d("hh:mm:ss"),value:"hh:mm:ss"},{label:d("hh:mm"),value:"hh:mm"},{label:d("hh"),value:"hh"}]},v=w("875");let h=(0,n.createContext)(null),g={didCatch:!1,error:null};class O extends n.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=g}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){let{error:e}=this.state;if(null!==e){for(var t,r,n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];null===(t=(r=this.props).onReset)||void 0===t||t.call(r,{args:o,reason:"imperative-api"}),this.setState(g)}}componentDidCatch(e,t){var r,n;null===(r=(n=this.props).onError)||void 0===r||r.call(n,e,t)}componentDidUpdate(e,t){let{didCatch:r}=this.state,{resetKeys:n}=this.props;if(r&&null!==t.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==t.length||e.some((e,r)=>!Object.is(e,t[r]))}(e.resetKeys,n)){var o,i;null===(o=(i=this.props).onReset)||void 0===o||o.call(i,{next:n,prev:e.resetKeys,reason:"keys"}),this.setState(g)}}render(){let{children:e,fallbackRender:t,FallbackComponent:r,fallback:o}=this.props,{didCatch:i,error:a}=this.state,l=e;if(i){let e={error:a,resetErrorBoundary:this.resetErrorBoundary};if((0,n.isValidElement)(o))l=o;else if("function"==typeof t)l=t(e);else if(r)l=(0,n.createElement)(r,e);else throw a}return(0,n.createElement)(h.Provider,{value:{didCatch:i,error:a,resetErrorBoundary:this.resetErrorBoundary}},l)}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(e,t)||E(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||E(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){if(e){if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S(e,t)}}var D=function(){var e,t,r;function n(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),j(this,"charts",new Map)}return e=n,t=[{key:"addGroup",value:function(e,t){if(this.charts.has(e))throw Error('[data-visualization] Chart group "'.concat(e,'" already exists'));this.charts.set(e,t)}},{key:"add",value:function(e,t){if(!!this.charts.has(e)){!Array.isArray(t)&&(t=[t]);var r,n,o=this.charts.get(e);this.charts.set(e,(r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){j(e,t,r[t])})}return e}({},o),n=(n={charts:F(o.charts).concat(F(t))},n),Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(n)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))}),r))}}},{key:"getChartTypes",value:function(){var e=[];return Array.from(this.charts.entries()).sort(function(e,t){var r=C(e,2)[1],n=C(t,2)[1];return r.sort||0-n.sort||0}).forEach(function(t){var r=C(t,2),n=r[0],o=r[1],i=o.title,a=o.charts.map(function(e){return{key:"".concat(n,".").concat(e.name),label:d(e.title),value:"".concat(n,".").concat(e.name)}});e.push({label:d(i),children:a})}),e}},{key:"getCharts",value:function(){var e={};return this.charts.forEach(function(t,r){t.charts.forEach(function(t){e["".concat(r,".").concat(t.name)]=t})}),e}},{key:"getChart",value:function(e){return this.getCharts()[e]}}],x(e.prototype,t),n}(),k=function(){return(0,r.usePlugin)(ob).charts.getChartTypes()},A=function(){var e,t,r;return null===(r=k()[0])||void 0===r?void 0:null===(t=r.children)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.value},I=function(){return(0,r.usePlugin)(ob).charts.getCharts()};function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function M(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(e,t)||z(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e){return function(e){if(Array.isArray(e))return Y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||z(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function z(e,t){if(e){if("string"==typeof e)return Y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Y(e,t)}}var B=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.collection,n=e.config||{},o=n.title,i=n.bordered;return{type:"void","x-decorator":"ChartRendererProvider","x-decorator-props":e,"x-acl-action":"".concat(r,":list"),"x-designer":"ChartRenderer.Designer","x-component":"CardItem","x-component-props":{size:"small",title:o,bordered:i},"x-initializer":"charts:addBlock",properties:M({actions:{type:"void","x-decorator":"div","x-decorator-props":{style:{position:"absolute",top:0,right:0,zIndex:10}},"x-component":"ActionBar","x-component-props":{style:{marginRight:"var(--nb-designer-offset)",marginTop:"var(--nb-designer-offset)"}},"x-initializer":"chart:configureActions"}},(0,v.uid)(),{type:"void","x-component":"ChartRenderer","x-component-props":t})}},q=function(e){var t,r,n;return Array.isArray(e)?1===e.length?r=e[0]:e.length>1&&(t=(n=T(e,2))[0],r=n[1]):r=e,{target:t,name:r,alias:t?"".concat(t,".").concat(r):r}},N=function(e,t){var r,n,o=q(t),i=o.target,a=o.name;return i?null===(n=e.find(function(e){return e.name===i}))||void 0===n?void 0:null===(r=n.targetFields)||void 0===r?void 0:r.find(function(e){return e.name===a}):e.find(function(e){return e.name===a})},V=function(e,t){var r=function(t){return t.map(function(t){var r,n,o=N(e,t.field);return r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){M(e,t,r[t])})}return e}({},o),n=(n={key:t.alias||(null==o?void 0:o.key),label:t.alias||(null==o?void 0:o.label),value:t.alias||(null==o?void 0:o.value),query:t},n),Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(n)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))}),r})},n=t.measures||[],o=t.dimensions||[],i=new Map(R(r(n)).concat(R(r(o))).map(function(e){return[e.value,e]}));return R(i.values())},U=function(e,t,r){var n=function(e,t){var o,i=null===(o=e.uiSchema)||void 0===o?void 0:o.enum;if(!i||!Array.isArray(i))return t;if(Array.isArray(t))return t.map(function(t){return n(e,t)});var a=i.find(function(e){var r;return e.value===((null==t?void 0:null===(r=t.toString)||void 0===r?void 0:r.call(t))||t)});return c.Schema.compile((null==a?void 0:a.label)||t,r)};return t.map(function(t){var r={};return Object.entries(t).forEach(function(t){var o=T(t,2),i=o[0],a=o[1],l=e.find(function(e){var t;return e.value===i&&!(null==e?void 0:null===(t=e.query)||void 0===t?void 0:t.aggregation)});if(!l){r[i]=a;return}switch(l.interface){case"select":case"radioGroup":case"multipleSelect":r[i]=n(l,a);break;default:r[i]=a}}),r})},L=function(e){if((void 0===e?"undefined":_(e))==="object"&&null!==e){if(Array.isArray(e)){var t=e.map(function(e){return L(e)}).filter(Boolean);return t.length>0?t:null}var r={};for(var n in e){var o=L(e[n]);null!=o&&!((void 0===o?"undefined":_(o))==="object"&&0===Object.keys(o).length)&&(r[n]=o)}return Object.keys(r).length>0?r:null}return"string"==typeof e&&e.startsWith("{{$nFilter.")&&e.endsWith("}}")?null:e},G=function(e,t){var r=t.split("."),n=f().get(e,r.slice(0,-1).join("."));return n=Array.isArray(n)?n.map(function(e){return f().get(e,r.slice(-1)[0])}):f().get(n,r.slice(-1)[0])},$=w("749");function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function K(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){K(e,t,r[t])})}return e}function J(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}var Q=(0,n.createContext)({});Q.displayName="ChartDataContext";var X=function(e){var t,r,i=(t=(0,n.useState)({}),r=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return W(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W(e,t)}}(t,r)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=i[0],l=i[1],c=(0,$.useMemoizedFn)(function(e,t){var r=t.dataSource,n=t.collection,o=t.service,i=t.query;l(function(t){return J(H({},t),K({},e,{dataSource:r,collection:n,service:o,query:i}))})}),u=(0,$.useMemoizedFn)(function(e){l(function(t){return J(H({},t),K({},e,void 0))})});return o().createElement(Q.Provider,{value:{charts:a,addChart:c,removeChart:u}},e.children)};function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function ee(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function et(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){ee(e,t,r[t])})}return e}function er(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Z(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var en=(0,n.createContext)({});en.displayName="ChartFilterContext";var eo=function(e){var t=er((0,n.useState)(!1),2),r=t[0],i=t[1],a=er((0,n.useState)(!1),2),l=a[0],c=a[1],u=er((0,n.useState)({}),2),s=u[0],f=u[1],p=er((0,n.useState)({collapsed:!1,row:1}),2),m=p[0],d=p[1],y=er((0,n.useState)(),2),b=y[0],v=y[1],h=(0,$.useMemoizedFn)(function(e,t){f(function(r){var n,o;return n=et({},r),o=null!=(o=ee({},e,et({},r[e]||{},t)))?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))}),n})}),g=(0,$.useMemoizedFn)(function(e){f(function(t){var r=et({},t);return r[e]=void 0,r})}),O=(0,$.useMemoizedFn)(v),S=(0,$.useMemoizedFn)(c);return(0,n.useEffect)(function(){return i(!0)},[]),o().createElement(en.Provider,{value:{ready:r,enabled:l,setEnabled:S,fields:s,setField:h,removeField:g,collapse:m,setCollapse:function(e){var t=e.collapsed,r=e.row;d(function(e){return{collapsed:void 0!==t?t:e.collapsed,row:void 0!==r?r:e.row}})},form:b,setForm:O}},e.children)};function ei(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var ea=o().createContext({}),el=function(e){var t,r,i=(t=(0,n.useState)(!1),r=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return ei(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ei(e,t)}}(t,r)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=i[0],l=i[1],c=(0,n.useRef)({}),u=(0,$.useMemoizedFn)(function(e,t){var r=t.service;c.current[e]={service:r}}),s=(0,$.useMemoizedFn)(function(e){var t=c.current[e];if(!!t)c.current[e]={service:t.service,selfAutoRefresh:!0}}),f=(0,$.useMemoizedFn)(function(){var e=!0,t=!1,r=void 0;try{for(var n,o=Object.values(c.current)[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var i=n.value;null==i||i.service.refresh()}}catch(e){t=!0,r=e}finally{try{!e&&null!=o.return&&o.return()}finally{if(t)throw r}}});return(0,n.useEffect)(function(){if(!!a){var e=setInterval(function(){var e=Object.values(c.current).filter(function(e){return!e.selfAutoRefresh}),t=!0,r=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;null==a||a.service.refresh()}}catch(e){r=!0,n=e}finally{try{!t&&null!=i.return&&i.return()}finally{if(r)throw n}}},1e3*a);return function(){return clearInterval(e)}}},[a]),o().createElement(ea.Provider,{value:{addChart:u,removeChart:s,autoRefresh:a,setAutoRefresh:l,refreshCharts:f}},e.children)};function ec(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function eu(e,t,r,n,o,i,a){try{var l=e[i](a),c=l.value}catch(e){r(e);return}l.done?t(c):Promise.resolve(c).then(n,o)}function es(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}function ef(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function ep(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ec(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ec(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var em=(0,n.createContext)({});em.displayName="ChartRendererContext";var ed=function(e){var t,i,a=e.query,l=e.config,u=e.collection,s=e.transform,f=e.dataSource,p=void 0===f?r.DEFAULT_DATA_SOURCE_KEY:f,m=e.disableAutoRefresh,d=(0,n.useContext)(Q).addChart,y=(0,n.useContext)(ea),b=y.addChart,v=y.removeChart,h=(0,n.useContext)(en),g=h.ready,O=h.form,S=h.enabled,x=ti(),j=x.getFilter,w=x.hasFilter,P=x.appendFilter,C=x.parseFilter,F=(0,c.useFieldSchema)(),E=(0,r.useAPIClient)(),D=ep(o().useState(!1),2),k=D[0],A=D[1],I=ep(o().useState(!1),2),Y=I[0],M=I[1];var T=(0,r.useRequest)((i=(t=function(e,t,r,n){var o,i,a,l,c,u,s,f,p;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(m){switch(m.label){case 0:if(!(t&&(null==r?void 0:null===(o=r.measures)||void 0===o?void 0:o.length))||S&&!O)return[2];return i=j(),[4,C(r.filter)];case 1:a=m.sent(),c={dataSource:e,collection:t,query:l=ef(es({},r),{filter:a})},u=!n&&w(c,i)?P(c,i):l,m.label=2;case 2:return m.trys.push([2,4,5,6]),[4,E.request({url:"charts:query",method:"POST",data:ef(es({uid:null==F?void 0:F["x-uid"],dataSource:e,collection:t},u),{filter:L(u.filter),dimensions:((null==r?void 0:r.dimensions)||[]).map(function(e){var t=es({},e);if(e.format&&!e.alias){var r=q(e.field).alias;t.alias=r}return t}),measures:((null==r?void 0:r.measures)||[]).map(function(e){var t=es({},e);if(e.aggregation&&!e.alias){var r=q(e.field).alias;t.alias=r}return t})})})];case 3:return[2,null==(f=m.sent())?void 0:null===(s=f.data)||void 0===s?void 0:s.data];case 4:throw console.error(p=m.sent()),p;case 5:return!n&&(null==F?void 0:F["x-uid"])&&(d(null==F?void 0:F["x-uid"],{dataSource:e,collection:t,service:T,query:r}),!k&&(null==b||b(null==F?void 0:F["x-uid"],{service:T}))),[7];case 6:return[2]}})},function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(e){eu(i,n,o,a,l,"next",e)}function l(e){eu(i,n,o,a,l,"throw",e)}a(void 0)})}),function(e,t,r,n){return i.apply(this,arguments)}),{defaultParams:[p,u,a],ready:g&&(!S||!!O)});return(0,n.useEffect)(function(){if(!m){if(!k){null==b||b(null==F?void 0:F["x-uid"],{service:T});return}null==v||v(null==F?void 0:F["x-uid"]);var e=setInterval(T.refresh,1e3*k);return function(){clearInterval(e)}}},[k,m]),o().createElement(r.CollectionManagerProvider,{dataSource:p},o().createElement(r.MaybeCollectionProvider,{collection:u},o().createElement(em.Provider,{value:{dataSource:p,collection:u,config:l,transform:s,service:T,query:a,autoRefresh:k,setAutoRefresh:A,showActionBar:Y}},o().createElement("div",{onMouseOver:function(){return M(!0)},onMouseOut:function(){return M(!1)}},e.children))))};function ey(e,t,r,n,o,i,a){try{var l=e[i](a),c=l.value}catch(e){r(e);return}l.done?t(c):Promise.resolve(c).then(n,o)}function eb(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var ev=u.Typography.Paragraph,eh=u.Typography.Text,eg=function(e){var t=e.error,r=y().t;return o().createElement("div",{style:{backgroundColor:"white"}},o().createElement(u.Result,{status:"error",title:r("Render Failed"),subTitle:r("Please check the configuration.")},o().createElement(ev,{copyable:!0},o().createElement(eh,{type:"danger",style:{whiteSpace:"pre-line",textAlign:"center"}},t.message))))},eO=function(e){var t,i,a,l=y().t,s=(0,n.useContext)(em),f=s.config,p=s.transform,m=s.dataSource,d=s.collection,b=s.service,h=s.data,g=eC(m,d),S=eD(h,m,d),x=(null==f?void 0:f.general)||{},j=(null==f?void 0:f.advanced)||{},w=(0,r.useAPIClient)();var P=(t=null==f?void 0:f.chartType,(0,r.usePlugin)(ob).charts.getChart(t)),C=eU(p,w.auth.getLocale());var F=(i=o().useState((0,v.uid)()),a=2,function(e){if(Array.isArray(e))return e}(i)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(i,2)||function(e,t){if(e){if("string"==typeof e)return eb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eb(e,t)}}(i,a)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),E=F[0],D=F[1];if((0,n.useEffect)(function(){D((0,v.uid)())},[f]),!P)return o().createElement(u.Empty,{image:u.Empty.PRESENTED_IMAGE_SIMPLE,description:l("Please configure chart")});if(!(S&&S.length)&&!b.loading)return o().createElement(u.Empty,{image:u.Empty.PRESENTED_IMAGE_SIMPLE,description:l("No data")});var k=P.getProps({data:S,general:x,advanced:j,fieldProps:Object.keys(S[0]||{}).reduce(function(e,t){if(!e[t]){var r=N(g,t.split(".")),n=C[t];e[t]={label:(null==r?void 0:r.label)||t,transformer:n,interface:null==r?void 0:r.interface}}return e},{})}),A=c.Schema.compile(k),I=P.Component;return o().createElement(u.Spin,{spinning:b.loading},o().createElement(O,{key:E,onError:console.error,FallbackComponent:eg},!b.loading&&o().createElement(I,A)))};function eS(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}eO.Designer=function(){var e,t=y().t,i=(0,n.useContext)(tP),a=i.setVisible,l=i.setCurrent,u=(0,n.useContext)(Q).removeChart,s=(0,n.useContext)(em).service,f=(0,c.useField)(),p=(0,c.useFieldSchema)(),m=(0,r.useDesignable)(),d=m.insertAdjacent,b=m.refresh,v=(0,r.useDataSource)(),h=(0,r.useCollection_deprecated)(),g=h.name,O=h.title;return o().createElement(r.GeneralSchemaDesigner,{disableInitializer:!0,title:O||g},o().createElement(r.SchemaSettingsItem,{title:"Configure",key:"configure",onClick:(e=function(){return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(e){return l({schema:p,field:f,dataSource:v.key,collection:g,service:s,data:s.data}),a(!0),[2]})},function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){ey(i,n,o,a,l,"next",e)}function l(e){ey(i,n,o,a,l,"throw",e)}a(void 0)})})},t("Configure")),o().createElement(r.SchemaSettingsItem,{title:"Duplicate",key:"duplicate",onClick:function(){d("afterEnd",(0,r.gridRowColWrap)(B(null==p?void 0:p["x-decorator-props"]))),b({refreshParentSchema:!0})}},t("Duplicate")),o().createElement(r.SchemaSettingsDivider,null),o().createElement(r.SchemaSettingsRemove,{breakRemoveOn:{"x-component":"ChartV2Block"},confirm:{onOk:function(){u(p["x-uid"])}}}))};function ex(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}function ej(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function ew(e){return function(e){if(Array.isArray(e))return eS(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return eS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eS(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var eP=function(e){var t=(0,n.useContext)(tP).current||{},o=t.dataSource,i=t.collection;e=e||o||r.DEFAULT_DATA_SOURCE_KEY;var a=(0,r.useDataSourceManager)(),l=a.getDataSource(e),c=a.collectionFieldInterfaceManager;return{cm:null==l?void 0:l.collectionManager,fim:c,collection:i}},eC=function(e,t){var r=(0,p.useTranslation)().t,o=eP(e),i=o.cm,a=o.fim,l=o.collection,u=(i.getCollectionFields(t||l)||[]).filter(function(e){return e.interface}).map(function(e){var t;return ej(ex({},e),{key:e.name,label:(null===(t=e.uiSchema)||void 0===t?void 0:t.title)||e.name,value:e.name})});return(0,n.useMemo)(function(){return u.map(function(e){var t,n,o,l,u=null===(t=a.getFieldInterface(e.interface))||void 0===t?void 0:t.filterable,s=c.Schema.compile((null===(n=e.uiSchema)||void 0===n?void 0:n.title)||e.name,{t:r});if(!(u&&((null==u?void 0:u.nested)||(null==u?void 0:null===(o=u.children)||void 0===o?void 0:o.length))))return ej(ex({},e),{label:s});var f=[];if(null==u?void 0:u.nested){var p=(i.getCollectionFields(e.target)||[]).filter(function(e){return e.interface}).map(function(t){var n;return ej(ex({},t),{key:"".concat(e.name,".").concat(t.name),label:"".concat(s," / ").concat(c.Schema.compile((null===(n=t.uiSchema)||void 0===n?void 0:n.title)||t.name,{t:r})),value:"".concat(e.name,".").concat(t.name)})});f=ew(f).concat(ew(p))}if(null==u?void 0:null===(l=u.children)||void 0===l?void 0:l.length){var m=u.children.map(function(t){var n;return ej(ex({},t),{key:"".concat(e.name,".").concat(t.name),label:"".concat(s," / ").concat(c.Schema.compile((null===(n=t.schema)||void 0===n?void 0:n.title)||t.title||t.name,{t:r})),value:"".concat(e.name,".").concat(t.name)})});f=ew(f).concat(ew(m))}return ej(ex({},e),{label:s,targetFields:f})})},[u])},eF=function(e){return function(t){var r=V(e,t.query("query").get("value")||{});t.dataSource=r}},eE=function(){var e=(0,p.useTranslation)().t,t=(0,r.useDataSourceManager)(),o=(0,r.useACLRoleContext)().parseAction,i=t.getAllCollections({filterCollection:function(e){return o("".concat(e.name,":list"))}}).filter(function(e){var t=e.key,n=e.isDBInstance;return t===r.DEFAULT_DATA_SOURCE_KEY||n}).map(function(e){return{value:e.key,label:e.displayName,children:e.collections.map(function(e){return{value:e.name,label:e.title}})}});return(0,n.useMemo)(function(){return c.Schema.compile(i,{t:e})},[i])},eD=function(e,t,r){var o,i=y().t,a=(0,n.useContext)(em),l=a.service,u=a.query,s=eC(t,r),f=(0,c.useForm)();return U(V(s,(null==f?void 0:null===(o=f.values)||void 0===o?void 0:o.query)||u),(null==l?void 0:l.data)||e||[],{t:i})},ek=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=eP(e),i=o.cm,a=o.fim,l=o.collection,c=i.getCollectionFields(t||l).filter(function(e){return!n.includes(e.interface)}),u=function(e,t,o){if(!e.interface)return;var l=a.getFieldInterface(e.interface);if(!(null==l?void 0:l.filterable))return;var c=l.filterable,u=c.nested,f=c.children,p=o?"".concat(o,".").concat(e.name):e.name,m=ej(ex({},e),{name:e.name,title:(null==e?void 0:null===(d=e.uiSchema)||void 0===d?void 0:d.title)||e.name,schema:null==e?void 0:e.uiSchema,key:p});if(!e.target||!(t>r)){if(t>r)return m;if((null==f?void 0:f.length)&&(m.children=f.map(function(t){return ej(ex({},t),{key:"".concat(e.name,".").concat(t.name)})})),u){var d,y,b=s(i.getCollectionFields(e.target).filter(function(e){return!n.includes(e.interface)}),t+1,e.name).filter(Boolean);m.children=m.children||[],(y=m.children).push.apply(y,ew(b))}return m}},s=function(e,t,r){var n=[];return e.forEach(function(e){var o=u(e,t,r);o&&n.push(o)}),n};return s(c,1)},eA=function(e,t){var r=eP(e),o=r.cm,i=r.fim,a=r.collection;return(0,n.useMemo)(function(){var e=o.getCollectionFields(t||a),r=function(e,t){if(!e.interface)return;var r=i.getFieldInterface(e.interface);if(!(null==r?void 0:r.filterable))return;var a=r.filterable,l=a.nested,c=a.children,u=a.operators,s={name:e.name,title:(null==e?void 0:null===(f=e.uiSchema)||void 0===f?void 0:f.title)||e.name,schema:null==e?void 0:e.uiSchema,operators:(null==u?void 0:null===(p=u.filter)||void 0===p?void 0:p.call(u,function(t){return!(null==t?void 0:t.visible)||t.visible(e)}))||[],interface:e.interface};if(!e.target||!(t>2)){if(t>2)return s;if((null==c?void 0:c.length)&&(s.children=c),l){var f,p,m,d=n(o.getCollectionFields(e.target),t+1).filter(Boolean);s.children=s.children||[],(m=s.children).push.apply(m,ew(d))}return s}},n=function(e,t){var n=[];return e.forEach(function(e){var o=r(e,t);o&&n.push(o)}),n};return n(e,1)},[t,o,i])},eI=w("760"),eY=w.n(eI),eM={general:{Prefix:{schema:{"x-component":"Input"},fn:function(e,t){return t?"".concat(t).concat(e):e}},Suffix:{schema:{"x-component":"Input"},fn:function(e,t){return t?"".concat(e).concat(t):e}}},datetime:{Format:{schema:{"x-component":"AutoComplete","x-component-props":{allowClear:!0,style:{minWidth:200}},enum:[{label:"YYYY",value:"YYYY"},{label:"YYYY-MM",value:"YYYY-MM"},{label:"YYYY-MM-DD",value:"YYYY-MM-DD"},{label:"YYYY-MM-DD hh:mm",value:"YYYY-MM-DD hh:mm"},{label:"YYYY-MM-DD hh:mm:ss",value:"YYYY-MM-DD hh:mm:ss"}]},fn:function(e,t){return eY()(e).format(t)}},YYYY:{label:"YYYY (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("YYYY")}},MM:{label:"MM (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("MM")}},DD:{label:"DD (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("DD")}},"YYYY-MM":{label:"YYYY-MM (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("YYYY-MM")}},"YYYY-MM-DD":{label:"YYYY-MM-DD (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("YYYY-MM-DD")}},"YYYY-MM-DD hh:mm":{label:"YYYY-MM-DD hh:mm (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("YYYY-MM-DD hh:mm")}},"YYYY-MM-DD hh:mm:ss":{label:"YYYY-MM-DD hh:mm:ss (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("YYYY-MM-DD hh:mm:ss")}}},date:{Format:{schema:{"x-component":"AutoComplete","x-component-props":{allowClear:!0,style:{minWidth:200}},enum:[{label:"YYYY",value:"YYYY"},{label:"MM",value:"MM"},{label:"DD",value:"DD"},{label:"YYYY-MM",value:"YYYY-MM"},{label:"YYYY-MM-DD",value:"YYYY-MM-DD"}]},fn:function(e,t){return eY()(e).format(t)}},YYYY:{label:"YYYY (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("YYYY")}},MM:{label:"MM (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("MM")}},DD:{label:"DD (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("DD")}},"YYYY-MM":{label:"YYYY-MM (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("YYYY-MM")}},"YYYY-MM-DD":{label:"YYYY-MM-DD (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("YYYY-MM-DD")}}},time:{Format:{schema:{"x-component":"AutoComplete","x-component-props":{allowClear:!0,style:{minWidth:200}},enum:[{label:"hh:mm:ss",value:"hh:mm:ss"},{label:"hh:mm",value:"hh:mm"},{label:"hh",value:"hh"}]},fn:function(e,t){return eY()(e).format(t)}},"hh:mm:ss":{label:"hh:mm:ss (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("hh:mm:ss")}},"hh:mm":{label:"hh:mm (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("hh:mm")}},hh:{label:"hh (Deprecated, use Format instead)",fn:function(e){return eY()(e).format("hh")}}},number:{Precision:{schema:{"x-component":"Select",enum:[{label:"1",value:0},{label:"1.0",value:1},{label:"1.00",value:2},{label:"1.000",value:3}]},fn:function(e,t){return Number(e.toFixed(t))}},Separator:{schema:{"x-component":"Select",enum:[{label:"100,000.00",value:"en-US"},{label:"100.000,00",value:"de-DE"},{label:"100 000.00",value:"ru-RU"},{label:"100 000,00",value:"pl-PL"}]},fn:function(e,t){switch(t){case"en-US":return e.toLocaleString("en-US",{minimumFractionDigits:2});case"de-DE":return e.toLocaleString("de-DE",{minimumFractionDigits:2});case"ru-RU":return e.toLocaleString("ru-RU",{minimumFractionDigits:2});case"pl-PL":return e.toLocaleString("pl-PL",{minimumFractionDigits:2});default:return e}}},Percent:function(e){return new Intl.NumberFormat("en-US",{style:"percent",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)},Currency:{label:"Currency (Deprecated, use Separator & Prefix instead)",fn:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US";return new Intl.NumberFormat(t,{style:"currency",currency:{"zh-CN":"CNY","en-US":"USD","ja-JP":"JPY","ko-KR":"KRW","pt-BR":"BRL","ru-RU":"RUB","tr-TR":"TRY","es-ES":"EUR"}[t]||"USD"}).format(e)}},Exponential:function(e){var t;return t=+e,t.toExponential()},Abbreviation:{schema:{"x-component":"Select",enum:[{label:"en-US",value:"en-US"},{label:"zh-CN",value:"zh-CN"}]},fn:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US";return new Intl.NumberFormat(t,{notation:"compact"}).format(e)}}},string:{"Type conversion":{schema:{"x-component":"Select",enum:[{label:"Number",value:"Number"},{label:"Date",value:"Date"}]},fn:function(e,t){try{return Function("return ".concat(t,"(").concat(e,")"))()}catch(t){return console.log(t),e}}}}};function eT(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function eR(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}function e_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(e,t)||ez(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ez(e,t){if(e){if("string"==typeof e)return eT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eT(e,t)}}var eB=function(){var e=(0,c.useField)();return{options:Object.keys(eM).filter(function(e){return"general"!==e}).map(function(e){return{label:d(e),value:e}}),onChange:function(t){e.value=t,e.query(".format").take().setValue(null)}}},eq=function(){var e=(0,c.useField)();return{onChange:function(t){e.value=t,e.query(".argument").take().setValue(null)}}},eN=function(e){var t=e.query(".type").get("value");if(!t){e.dataSource=[];return}var r=Object.entries(eR({},eM.general,eM[t]||{})).map(function(e){var t=e_(e,2),r=t[0],n=t[1];return{label:d("function"==typeof n?r:n.label||r),value:r}});e.dataSource=r},eV=function(e){var t=e.query(".type").get("value"),r=e.query(".format").get("value");if(!r||!t){e.setComponentProps({schema:null});return}var n=eM[t][r]||eM.general[r];if(!n||"function"==typeof n){e.setComponentProps({schema:null});return}var o=(0,v.uid)();e.setComponentProps({schema:eR({name:o},n.schema)})},eU=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US",r=(e||[]).filter(function(e){return e.field&&e.type&&e.format}).reduce(function(e,t){var r,n=eM[t.type][t.format]||eM.general[t.format];if(!n)return e;return e[t.field]=((function(e){if(Array.isArray(e))return eT(e)})(r=e[t.field]||[])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||ez(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([{transformer:n,argument:t.argument}]),e},{}),n={};return Object.entries(r).forEach(function(e){var r=e_(e,2),o=r[0],i=r[1];n[o]=i.reduce(function(e,r){var n=r.transformer,o=r.argument;return function(r){try{if("function"==typeof n)return n(e(r),o);return!o&&!n.schema&&(o=t),n.fn(e(r),o)}catch(e){return console.log(e),r}}},function(e){return e})}),n},eL=w("584"),eG=w("703"),e$=w.n(eG);function eW(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function eK(e,t,r,n,o,i,a){try{var l=e[i](a),c=l.value}catch(e){r(e);return}l.done?t(c):Promise.resolve(c).then(n,o)}var eH=function(e){var t={type:"boolean","x-content":'{{ t("Show time") }}',"x-decorator":"FormItem","x-component":"Checkbox"},r={type:"string",title:'{{t("Date format")}}',"x-component":"Radio.Group","x-decorator":"FormItem",default:"YYYY-MM-DD",enum:[{label:'{{t("Year/Month/Day")}}',value:"YYYY/MM/DD"},{label:'{{t("Year-Month-Day")}}',value:"YYYY-MM-DD"},{label:'{{t("Day/Month/Year")}}',value:"DD/MM/YYYY"}]},n={title:'{{t("Options")}}',type:"array","x-decorator":"FormItem","x-component":"ArrayItems",items:{type:"object","x-decorator":"ArrayItems.Item",properties:{space:{type:"void","x-component":"Space",properties:{label:{type:"string","x-decorator":"FormItem","x-component":"Input","x-component-props":{placeholder:'{{t("Option label")}}'},required:!0},value:{type:"string","x-decorator":"FormItem","x-component":"Input","x-component-props":{placeholder:'{{t("Option value")}}'},required:!0},remove:{type:"void","x-decorator":"FormItem","x-component":"ArrayItems.Remove"}}}}},properties:{add:{type:"void",title:"Add","x-component":"ArrayItems.Addition"}}};return({DatePicker:{type:"object",properties:{dateFormat:r,showTime:t}},"DatePicker.RangePicker":{type:"object",properties:{dateFormat:r,showTime:t}},Select:{type:"object",properties:{mode:{type:"string",enum:[{label:'{{ t("Single select") }}',value:""},{label:'{{ t("Multiple select") }}',value:"multiple"}],"x-decorator":"FormItem","x-component":"Radio.Group","x-component-props":{defaultValue:""}},options:n}},"Checkbox.Group":{type:"object",properties:{options:n}},"Radio.Group":{type:"object",properties:{options:n}}})[e]},eJ=function(e,t){if(!e)return e;if(eY().isDayjs(e))return!t.showTime&&(e=e.startOf("day")),(0,eL.moment2str)(e,t);if(Array.isArray(e)&&e.length&&eY().isDayjs(e[0])){var r=e[0],n=e[1];return t.showTime&&(r=r.startOf("day"),n=n.endOf("day")),[r.toISOString(),n.toISOString()]}return e};var eQ=(t=(e=function(e,t,r){var n,o;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(i){switch(i.label){case 0:if(!(!("string"==typeof(n=e.initialValue)&&(null==n?void 0:n.startsWith("{{$"))&&(null==n?void 0:n.endsWith("}}")))||!t))return[3,1];return e.setValue(n),e.setInitialValue(n),[3,3];case 1:return e.loading=!0,[4,t.parseVariable(n,r)];case 2:o=eJ(i.sent().value,e.componentProps),e.setValue(o),e.setInitialValue(o),e.loading=!1,i.label=3;case 3:return[2]}})},function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){eK(i,n,o,a,l,"next",e)}function l(e){eK(i,n,o,a,l,"throw",e)}a(void 0)})}),function(e,r,n){return t.apply(this,arguments)}),eX=function(e,t){return e?"".concat(e).concat("-").concat(t):t},eZ=function(e){var t,n,o=(t=e.split("-"),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return eW(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eW(e,t)}}(t,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1];return a?{dataSource:i,fieldName:a}:{dataSource:r.DEFAULT_DATA_SOURCE_KEY,fieldName:i}},e0=function(e,t,n){return c.Schema.isSchemaInstance(e)?e.reduceProperties(function(e,o){var i=o[t];if(!i.includes("-")&&(i="".concat(r.DEFAULT_DATA_SOURCE_KEY).concat("-").concat(i)),i===n)return o;if("Action.Container"!==o["x-component"]&&"AssociationField.Viewer"!==o["x-component"]){var a=e0(o,t,n);if(a)return a}return e}):null};function e1(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function e2(e){if(Array.isArray(e))return e}function e3(e,t,r,n,o,i,a){try{var l=e[i](a),c=l.value}catch(e){r(e);return}l.done?t(c):Promise.resolve(c).then(n,o)}function e6(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){e3(i,n,o,a,l,"next",e)}function l(e){e3(i,n,o,a,l,"throw",e)}a(void 0)})}}function e8(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function e5(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function e4(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function e7(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){e8(e,t,r[t])})}return e}function e9(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function te(e,t){return e2(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(e,t)||tr(e,t)||e4()}function tt(e){return e2(e)||e5(e)||tr(e)||e4()}function tr(e,t){if(e){if("string"==typeof e)return e1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e1(e,t)}}function tn(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}var to=function(){var e=(0,n.useContext)(Q).charts,t=(0,n.useMemo)(function(){return Object.values(e).filter(function(e){return e}).reduce(function(e,t){var r,n,o=t.dataSource,i=t.collection;if(null===(n=e[o])||void 0===n?void 0:n.includes(i))return e;return e[o]=((function(e){if(Array.isArray(e))return e1(e)})(r=e[o]||[])||e5(r)||tr(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([i]),e},{})},[e]),r=(0,n.useMemo)(function(){return Object.keys(t).length>1},[t]),o=(0,n.useCallback)(function(e,r){var n;return(null===(n=t[e])||void 0===n?void 0:n.includes(r))||!1},[t]);return{chartCollections:t,showDataSource:r,getIsChartCollectionExists:o}},ti=function(){var e,t,o,i=(0,r.useDataSourceManager)(),a=(0,n.useContext)(Q).charts,l=(0,r.useActionContext)().fieldSchema,u=null==l?void 0:l["x-action"],s=(0,n.useContext)(en),p=s.fields,m=s.form,d=(0,r.useVariables)(),y=(0,r.useLocalVariables)(),b=function(){var e=(null==m?void 0:m.values)||{},t={};return Object.entries(p).filter(function(e){var t=te(e,2);return t[0],t[1]}).forEach(function(r){var n=te(r,2),o=n[0],a=n[1],l=(a||{}).operator,c=a||{},u=c.dataSource,s=c.collectionField;if(!s){var p=eZ(o);u=p.dataSource,s=p.fieldName}var m=i.getDataSource(u).collectionManager.getCollectionField(s);if(null==m?void 0:m.target){var d=m.targetKey||"id";s="".concat(s,".").concat(d),o="".concat(o,".").concat(d)}var y=tt(s.split(".")),b=y[0],v=y.slice(1),h=G(e,o),g=(null==l?void 0:l.value)||"$eq";if("custom"!==b){var O=eX(u,b);t[O]=t[O]||{$and:[]};var S={};f().set(S,v.join("."),e8({},g,h)),t[O].$and.push(S)}else t[b]=t[b]||{},t[b]["$nFilter.".concat(v.join("."))]=h}),t},v=function(e,t){if(!e)return!1;var r=e.dataSource,n=e.collection,o=e.query,i=(0,eL.parse)(o.filter||"").parameters;return t[eX(r,n)]||t.custom&&(null==i?void 0:i.find(function(e){var r=e.key;return f().has(t.custom,r)}))},h=function(e,t){var r=e.dataSource,n=e.collection,o=e7({},e.query),i=e7({},o.filter||{}),a={},l=(0,eL.parse)(i),c=l.parameters;return t.custom&&(null==c?void 0:c.find(function(e){return t.custom[e.key]}))&&(a=l(t.custom)),a=e$()(i,a),o=e9(e7({},o),{filter:{$and:[a,t[eX(r,n)]]}})};return{filter:(e=e6(function(){var e;return tn(this,function(t){switch(t.label){case 0:return e=b(),[4,Promise.all(Object.values(a).filter(function(t){return v(t,e)}).map(function(t){return e6(function(){var r,n,o;return tn(this,function(i){switch(i.label){case 0:return r=t.dataSource,n=t.service,o=t.collection,[4,n.runAsync(r,o,h(t,e),!0)];case 1:return i.sent(),[2]}})})}).map(function(e){return e()}))];case 1:return t.sent(),[2]}})}),function(){return e.apply(this,arguments)}),refresh:(t=e6(function(){return tn(this,function(e){switch(e.label){case 0:return[4,Promise.all(Object.values(a).filter(function(e){return e}).map(function(e){return e6(function(){var t,r,n,o;return tn(this,function(i){switch(i.label){case 0:return t=e.service,r=e.dataSource,n=e.collection,o=e.query,[4,t.runAsync(r,n,o,!0)];case 1:return i.sent(),[2]}})})}).map(function(e){return e()}))];case 1:return e.sent(),[2]}})}),function(){return t.apply(this,arguments)}),getChartFilterFields:function(e){var t=e.dataSource,n=e.collection,o=e.cm,i=e.fim,a=o.getCollectionFields(n.name),l=function(e,r,n,a){var l,c,s,p,d,y=(null===(l=e.uiSchema)||void 0===l?void 0:l.title)||e.name,b=i.getFieldInterface(e.interface),v=null==b?void 0:null===(s=b.filterable)||void 0===s?void 0:null===(c=s.operators)||void 0===c?void 0:c[0],h=o.getCollection(e.target),g={type:"string",title:r=r?"".concat(r," / ").concat(y):y,name:"".concat(n,".").concat(e.name),required:!1,"x-designer":"ChartFilterItemDesigner","x-component":"CollectionField","x-decorator":"ChartFilterFormItem","x-data-source":t,"x-collection-field":"".concat(a,".").concat(e.name),"x-component-props":e9(e7({},null===(p=e.uiSchema)||void 0===p?void 0:p["x-component-props"]),{"filter-operator":v,"data-source":t,"collection-field":"".concat(a,".").concat(e.name)}),"x-filter-operators":null==v?void 0:v.value};if("formula"===e.interface){var O={boolean:"Checkbox",integer:"InputNumber",bigInt:"InputNumber",double:"InputNumber",decimal:"InputNumber",date:"DatePicker",string:"Input"}[e.dataType]||"Input";g=e9(e7({},g),{"x-component":O})}return["oho","o2m"].includes(e.interface)&&f().set(g,"x-component-props.useOriginalFilter",!0),{key:"".concat(n,".").concat(e.name),name:e.name,type:"item",title:(null==e?void 0:null===(d=e.uiSchema)||void 0===d?void 0:d.title)||e.name,Component:"CollectionFieldInitializer",find:e0,remove:function(e,t){t(e,{breakRemoveOn:{"x-component":"Grid"}})},schemaInitialize:function(t){var r;null==b||null===(r=b.schemaInitialize)||void 0===r||r.call(b,t,{field:e,block:"FilterForm",readPretty:m.readPretty,action:u,targetCollection:h})},schema:g}},s=function(e,n,o,i){var a,l=(null===(a=e.uiSchema)||void 0===a?void 0:a.title)||e.name;n=n?"".concat(n," / ").concat(l):l;var u=e.operators[0],s=e9(e7({type:"string",name:"".concat(o,".").concat(e.name),required:!1,"x-designer":"ChartFilterItemDesigner","x-decorator":"ChartFilterFormItem","x-data-source":t,"x-collection-field":"".concat(i,".").concat(e.name)},e.schema),{title:n,"x-component-props":{"filter-operator":u,"data-source":t,"collection-field":"".concat(i,".").concat(e.name)},"x-filter-operators":null==u?void 0:u.value});return(null==u?void 0:u.noValue)&&(s=e9(e7({},s),{"x-component":"ChartFilterCheckbox","x-component-props":e9(e7({},s["x-component-props"]),{content:c.Schema.compile(u.label,{t:r.i18n.t})})})),{key:"".concat(o,".").concat(e.name),name:e.name,type:"item",title:e.title||e.name,Component:"CollectionFieldInitializer",find:e0,remove:function(e,t){t(e,{breakRemoveOn:{"x-component":"Grid"}})},schema:s}},p=function(e,t,r,n,a){if(!e.interface||e.isForeignKey)return;var c=i.getFieldInterface(e.interface);if(!(null==c?void 0:c.filterable))return;var u=c.filterable,f=u.nested,m=u.children,d=(null===(b=e.uiSchema)||void 0===b?void 0:b.title)||e.name,y=l(e,r,n,a);if(!e.target||!(t>2)){if(r=r?"".concat(r," / ").concat(d):d,(null==m?void 0:m.length)&&!["chinaRegion","createdBy","updatedBy","attachment"].includes(e.interface)){var b,v,h=m.map(function(t){return s(t,r,"".concat(n,".").concat(e.name),"".concat(a,".").concat(e.name))});return{key:"".concat(n,".").concat(e.name),name:e.name,type:"subMenu",title:(null==e?void 0:null===(v=e.uiSchema)||void 0===v?void 0:v.title)||e.name,children:h}}if(!t||t>2)return y;if(f){var g,O=o.getCollectionFields(e.target).map(function(r){return p(r,t+1,"","".concat(n,".").concat(e.name),"".concat(a,".").concat(e.name))});return{key:"".concat(n,".").concat(e.name),name:e.name,type:"subMenu",title:(null==e?void 0:null===(g=e.uiSchema)||void 0===g?void 0:g.title)||e.name,children:O.filter(Boolean)}}return y}},d=[],y=[];return a.forEach(function(e){var r=e.interface,o=p(e,0,"",eX(t,n.name),n.name);if(o&&d.push(o),["m2o"].includes(r)){var i=p(e,1,"",eX(t,n.name),n.name);i&&y.push(i)}}),y.length&&d.push({name:"divider",type:"divider"},{name:"displayAssociationFields",type:"itemGroup",title:r.i18n.t("Display association fields"),children:y}),d},getFilter:b,hasFilter:v,appendFilter:h,getTranslatedTitle:(0,$.useMemoizedFn)(function(e){return e.split(" / ").map(function(e){return r.i18n.t(c.Schema.compile(e,{t:r.i18n.t}))}).join(" / ")}),parseFilter:(0,n.useCallback)((o=e6(function(e){var t;return tn(this,function(r){switch(r.label){case 0:var n;return[4,Promise.all(Object.keys(t=(0,eL.flatten)(e,{breakOn:function(e){var t=e.key;return t.startsWith("$")&&"$and"!==t&&"$or"!==t},transformValue:function(e){return!("string"==typeof e&&e.startsWith("{{$")&&(null==e?void 0:e.endsWith("}}")))||["$user","$date","$nDate","$nRole","$nFilter"].some(function(t){return e.includes(t)})?e:null==d?void 0:d.parseVariable(e,y).then(function(e){return e.value})}})).map((n=e6(function(e){return tn(this,function(r){switch(r.label){case 0:return[4,t[e]];case 1:return t[e]=r.sent(),void 0===t[e]&&delete t[e],[2,t[e]]}})}),function(e){return n.apply(this,arguments)})))];case 1:return r.sent(),[2,(0,eL.unflatten)(t)]}})}),function(e){return o.apply(this,arguments)}),[d])}},ta=function(){var e=y().t,t=(0,$.useMemoizedFn)(e),r=(0,n.useContext)(en),o=r.enabled,i=Object.entries(r.fields).filter(function(e){var t=te(e,2),r=t[0],n=t[1];return r.startsWith("custom.")&&n}).map(function(e){var t=te(e,2),r=t[0],n=t[1].title,o=r.replace(/^custom\./,"");return{key:o,value:o,label:n}}),a=(0,n.useMemo)(function(){return{label:t("Current filter"),value:"$nFilter",key:"$nFilter",children:i}},[i,t]);return o&&i.length?a:null},tl=function(){var e=y().t,t=to().chartCollections,o=(0,r.useDataSourceManager)(),i=o.collectionFieldInterfaceManager,a=tc().values,l=function(t,r,n){if(!r.interface)return;var o=i.getFieldInterface(r.interface);if(!(null==o?void 0:o.filterable))return;var c=o.filterable.nested,u={value:r.name,label:e((null==r?void 0:null===(s=r.uiSchema)||void 0===s?void 0:s.title)||r.name)};if(r.target&&n>2)return;if(n>2)return u;if(c){var s,f,p,m=t.getCollectionFields(r.target).map(function(e){return l(t,e,n+1)});return{value:r.name,label:e((null==r?void 0:null===(p=r.uiSchema)||void 0===p?void 0:p.title)||r.name),children:m.filter(function(e){return e})}}if(!!a.includes(null===(f=r.uiSchema)||void 0===f?void 0:f["x-component"])||!!a.includes(r.interface))return u};return(0,n.useMemo)(function(){return Object.entries(t).map(function(t){var r=te(t,2),n=r[0],i=r[1],a=o.getDataSource(n);return{value:n,label:c.Schema.compile(a.displayName,{t:e}),children:i.map(function(t){var r=a.collectionManager,n=r.getCollection(t),o=r.getCollectionFields(t).map(function(e){return l(r,e,1)}).filter(function(e){return e});return{value:t,label:c.Schema.compile(n.title,{t:e}),children:o}})}})},[t])},tc=function(){var e=y().t,t=[{label:e("Input"),value:"Input"},{label:e("Number"),value:"InputNumber"},{label:e("Date"),value:"DatePicker"},{label:e("Date range"),value:"DatePicker.RangePicker"},{label:e("Time"),value:"TimePicker"},{label:e("Time range"),value:"TimePicker.RangePicker"},{label:e("Select"),value:"Select"},{label:e("Radio group"),value:"Radio.Group"},{label:e("Checkbox group"),value:"Checkbox.Group"}];return{options:t,values:t.map(function(e){return e.value})}},tu=function(e,t){var o=y().t,i=(0,r.useDataSourceManager)(),a=to().showDataSource;return(0,n.useMemo)(function(){var r=i.getDataSource(e);if(!r)return;var n=r.collectionManager;if(!t)return;var l=tt(eZ(t).fieldName.split(".")),u=l[0],s=l.slice(1);if(!!(null==s?void 0:s.length)){for(var f=n.getCollection(u),p=u,m=c.Schema.compile(null==f?void 0:f.title,{t:o});p&&s.length>0;){var d,y,b=s.shift(),v=(null==(d=n.getCollectionField("".concat(p,".").concat(b)))?void 0:null===(y=d.uiSchema)||void 0===y?void 0:y.title)||(null==d?void 0:d.name);v&&(m+=" / ".concat(c.Schema.compile(v,{t:o}))),p=(null==d?void 0:d.target)?d.target:null}return a?"".concat(c.Schema.compile(r.displayName,{t:o})," > ").concat(m):m}},[t,e,a])};function ts(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var tf=function(e,t){var o=(0,r.useCurrentUserVariable)({collectionField:{uiSchema:e},uiSchema:e}).currentUserSettings,i=(0,r.useCurrentRoleVariable)({uiSchema:e}).currentRoleSettings,a=(0,r.useAPITokenVariable)({noDisabled:!0}).apiTokenSettings,l=(0,r.useDatetimeVariable)({operator:t,schema:e,noDisabled:!0}).datetimeSettings,c=(0,r.useURLSearchParamsVariable)().urlSearchParamsSettings,u=(0,r.usePopupVariable)({schema:e}),s=u.settings,f=u.shouldDisplayPopupRecord,p=(0,n.useMemo)(function(){return[o,i,a,l,c,f&&s].filter(Boolean)},[l,o,i,c,a,f,s]);return e?p:[]},tp=function(){var e=(0,c.useField)().data||{},t=e.operator,r=e.schema,o=ta(),i=tf(r,t),a=(0,n.useMemo)(function(){var e;return((function(e){if(Array.isArray(e))return ts(e)})(e=i)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ts(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ts(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([o]).filter(Boolean)},[i,o]);return t&&r?a:[]};function tm(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var td=function(e,t){var r,o,i,a,l=(r=(0,n.useState)(0),o=2,function(e){if(Array.isArray(e))return e}(r)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(r,2)||function(e,t){if(e){if("string"==typeof e)return tm(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tm(e,t)}}(r,o)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=l[0],u=l[1],s=(0,n.useRef)(null),f=(0,n.useContext)(em).service;return(0,n.useEffect)(function(){var r,n,o=s.current;if(!!o&&!0!==f.loading&&!t){var i=0;"ratio"===e.type&&(null===(r=e.ratio)||void 0===r?void 0:r.width)&&(null===(n=e.ratio)||void 0===n?void 0:n.height)&&(i=e.ratio.height/e.ratio.width);var a=new ResizeObserver(function(e){e.forEach(function(e){if(i){u(e.contentRect.width*i);return}u(e.contentRect.height>400?e.contentRect.height:400)})});return a.observe(o),function(){return a.disconnect()}}},[f.loading,t,e.type,null===(i=e.ratio)||void 0===i?void 0:i.width,null===(a=e.ratio)||void 0===a?void 0:a.height]),{chartRef:s,chartHeight:t||c}};function ty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tb(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){ty(e,t,r[t])})}return e}function tv(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}var th=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return tv(tb({type:"array","x-decorator":"FormItem","x-component":"ArrayItems"},t),{items:{type:"object",properties:{space:{type:"void","x-component":"Space",properties:tv(tb({sort:{type:"void","x-decorator":"FormItem","x-component":"ArrayItems.SortHandle"}},e),{remove:{type:"void","x-decorator":"FormItem","x-component":"ArrayItems.Remove"}})}}},properties:{add:{type:"void",title:'{{t("Add field")}}',"x-component":"ArrayItems.Addition"}}})},tg=function(e,t){var r;return{type:"void",properties:{config:{type:"object",properties:{collapse:{type:"void","x-component":"FormCollapse","x-component-props":{formCollapse:"{{formCollapse}}",size:"small",style:{border:"none",boxShadow:"none"}},properties:{pane1:{type:"void","x-component":"FormCollapse.CollapsePanel","x-component-props":{header:d("Container"),key:"card"},properties:{title:{type:"string",title:'{{t("Title")}}',"x-decorator":"FormItem","x-component":"Input"},bordered:{type:"boolean","x-content":d("Show border"),"x-decorator":"FormItem","x-component":"Checkbox",default:!1}}},pane2:{type:"void","x-component":"FormCollapse.CollapsePanel","x-component-props":{header:d("Chart"),key:"basic",style:{border:"none"}},properties:tb(ty({chartType:{type:"string",title:'{{t("Chart type")}}',"x-decorator":"FormItem","x-component":"Select","x-component-props":{placeholder:'{{t("Please select a chart type.")}}'},enum:"{{ chartTypes }}"}},(0,v.uid)(),{type:"void",properties:{general:e}}),t?(ty(r={},(0,v.uid)(),{type:"void",properties:{advanced:{type:"json",title:'{{t("JSON config")}}',"x-decorator":"FormItem","x-decorator-props":{extra:d("Same properties set in the form above will be overwritten by this JSON config.")},"x-component":"Input.JSON","x-component-props":{autoSize:{minRows:3},json5:!0}}}}),ty(r,"reference",{type:"string","x-reactions":{dependencies:[".chartType"],fulfill:{schema:{"x-content":"{{ getReference($deps[0]) }}"}}}}),r):{})}}}}}}}},tO={type:"void",properties:{settings:{type:"void",properties:{collection:{title:'{{t("Collection")}}',type:"string","x-decorator":"FormItem","x-component":"Cascader",enum:"{{ collectionOptions }}","x-component-props":{onChange:"{{ onCollectionChange }}",placeholder:'{{t("Collection")}}',showSearch:!0}}}},query:{type:"object",properties:{builder:{type:"void",properties:{collapse:{type:"void","x-decorator":"FormItem","x-component":"FormCollapse","x-component-props":{formCollapse:"{{formCollapse}}",size:"small",style:{border:"none",boxShadow:"none"}},properties:{pane1:{type:"void","x-component":"FormCollapse.CollapsePanel","x-component-props":{header:d("Measures"),key:"measures"},properties:{measures:th({field:{type:"string","x-decorator":"FormItem","x-component":"Cascader","x-component-props":{placeholder:'{{t("Field")}}',fieldNames:{label:"title",value:"name",children:"children"}},enum:"{{ fieldOptions }}",required:!0},aggregation:{type:"string","x-decorator":"FormItem","x-component":"Select","x-component-props":{placeholder:'{{t("Aggregation")}}'},enum:[{label:'{{t("Sum")}}',value:"sum"},{label:'{{t("Count")}}',value:"count"},{label:'{{t("Avg")}}',value:"avg"},{label:'{{t("Max")}}',value:"max"},{label:'{{t("Min")}}',value:"min"}]},alias:{type:"string","x-decorator":"FormItem","x-component":"Input","x-component-props":{placeholder:'{{t("Alias")}}',style:{minWidth:"100px"}}},distinct:{type:"boolean","x-decorator":"FormItem","x-component":"Checkbox","x-content":'{{t("Distinct")}}'}},{required:!0,"x-component-props":{style:{overflow:"auto"}}})}},pane2:{type:"void","x-component":"FormCollapse.CollapsePanel","x-component-props":{header:d("Dimensions"),key:"dimensions"},properties:{dimensions:th({field:{type:"string","x-decorator":"FormItem","x-component":"Cascader","x-component-props":{placeholder:'{{t("Field")}}',fieldNames:{label:"title",value:"name",children:"children"}},enum:"{{ fieldOptions }}",required:!0},format:{type:"string","x-decorator":"FormItem","x-component":"Select","x-component-props":{placeholder:'{{t("Format")}}',style:{maxWidth:"120px"}},"x-reactions":"{{ useFormatterOptions }}","x-visible":"{{ $self.dataSource && $self.dataSource.length }}"},alias:{type:"string","x-decorator":"FormItem","x-component":"Input","x-component-props":{placeholder:'{{t("Alias")}}',style:{minWidth:"100px"}}}},{"x-component-props":{style:{overflow:"auto"}}})}},pane3:{type:"void","x-component":"FormCollapse.CollapsePanel","x-component-props":{header:d("Filter"),key:"filter"},properties:{filter:{type:"object","x-decorator":"FormItem","x-decorator-props":{style:{overflow:"auto"}},enum:"{{ filterOptions }}","x-component":"Filter","x-component-props":{dynamicComponent:"FilterDynamicComponent"}}}},pane4:{type:"void","x-component":"FormCollapse.CollapsePanel","x-component-props":{header:d("Sort"),key:"sort",style:{border:"none"}},properties:{orders:th({field:{type:"string","x-decorator":"FormItem","x-component":"Cascader","x-component-props":{placeholder:'{{t("Field")}}'},"x-reactions":"{{ useOrderOptions }}",required:!0},order:{type:"string","x-decorator":"FormItem","x-component":"Select","x-component-props":{defaultValue:"ASC"},enum:["ASC","DESC"]},nulls:{type:"string","x-decorator":"FormItem","x-component":"Select","x-component-props":{defaultValue:"default"},enum:[{label:d("Default"),value:"default"},{label:d("NULLS first"),value:"first"},{label:d("NULLS last"),value:"last"}]}},{"x-reactions":"{{ useOrderReaction }}","x-component-props":{style:{overflow:"auto"}}})}}}},limit:{title:'{{t("Limit")}}',type:"number","x-decorator":"FormItem","x-component":"InputNumber","x-component-props":{defaultValue:2e3,min:1,style:{width:"100px"}}},offset:{title:'{{t("Offset")}}',type:"number","x-decorator":"FormItem","x-component":"InputNumber","x-component-props":{defaultValue:0,min:0,style:{width:"100px"}}}}},cache:{type:"object",properties:{enabled:{type:"boolean",title:'{{t("Enable cache")}}',"x-decorator":"FormItem","x-component":"Switch"},ttl:{type:"number",title:'{{t("TTL (second)")}}',"x-decorator":"FormItem","x-component":"InputNumber","x-component-props":{defaultValue:60,min:1,style:{width:"100px"}}}}}}}}},tS={type:"void",properties:{transform:{type:"array","x-decorator":"FormItem","x-component":"ArrayItems",items:{type:"object",properties:{space:{type:"void","x-component":"Space","x-component-props":{wrap:!0},properties:{sort:{type:"void","x-decorator":"FormItem","x-component":"ArrayItems.SortHandle"},field:{type:"string","x-decorator":"FormItem","x-component":"Select","x-component-props":{placeholder:'{{t("Field")}}'},"x-use-component-props":"useFieldSelectProps","x-reactions":"{{ useChartFields }}"},type:{type:"string","x-decorator":"FormItem","x-component":"Select","x-component-props":{placeholder:'{{t("Type")}}'},"x-use-component-props":"useFieldTypeSelectProps"},format:{type:"string","x-decorator":"FormItem","x-component":"Select","x-component-props":{placeholder:'{{t("Transformer")}}',style:{maxWidth:"200px"}},"x-use-component-props":"useTransformerSelectProps","x-reactions":"{{ useTransformers }}","x-visible":"{{ $self.dataSource && $self.dataSource.length }}"},argument:{type:"string","x-decorator":"FormItem","x-component":"TransformerDynamicComponent","x-reactions":"{{ useArgument }}"},remove:{type:"void","x-decorator":"FormItem","x-component":"ArrayItems.Remove"}}}}},properties:{add:{type:"void",title:'{{t("Add transformation")}}',"x-component":"ArrayItems.Addition"}}}}};function tx(e){var t=e.value,n=e.onChange,i=e.renderSchemaComponent,a=tp();return o().createElement(r.Variable.Input,{value:t,onChange:n,scope:a},i())}function tj(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function tw(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return tj(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tj(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var tP=(0,n.createContext)({visible:!0});tP.displayName="ChartConfigContext";var tC=function(e){var t,i,a,l=(0,r.useDesignable)().insertAdjacent,c=tw((0,n.useState)(!1),2),u=c[0],s=c[1],f=tw((0,n.useState)({}),2),p=f[0],m=f[1];return o().createElement(tP.Provider,{value:{visible:u,setVisible:s,current:p,setCurrent:m}},e.children,o().createElement(ed,(t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}({},null===(a=p.field)||void 0===a?void 0:a.decoratorProps),i=(i={disableAutoRefresh:!0},i),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}),t),o().createElement(tN,{insert:function(e,t){return l("beforeEnd",e,t)}})))},tF=w("964");function tE(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tD(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){tE(e,t,r[t])})}return e}function tk(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}var tA=function(e){var t=e.schema,n=(0,c.useField)();return t?o().createElement(r.SchemaComponent,{schema:{type:"void",properties:tE({},t.name,tk(tD({type:"void"},t),{value:n.value,"x-component-props":tk(tD({},t["x-component-props"]),{defaultValue:n.value,onChange:function(e){var t;if((void 0===e?"undefined":(t=e)&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t)=="object"&&(null==e?void 0:e.target)){n.value=e.target.value;return}n.value=e}})}))}}):null};function tI(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function tY(e,t,r,n,o,i,a){try{var l=e[i](a),c=l.value}catch(e){r(e);return}l.done?t(c):Promise.resolve(c).then(n,o)}function tM(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}function tT(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function tR(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return tI(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tI(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t_(e,t){return!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function tz(){var e=t_(["\n        .ant-modal-content {\n          padding: 0;\n        }\n      "]);return tz=function(){return e},e}function tB(){var e=t_(["\n          .ant-formily-item-feedback-layout-loose {\n            margin-bottom: 0;\n          }\n          .ant-space {\n            margin-bottom: 15px;\n          }\n        "]);return tB=function(){return e},e}u.Typography.Paragraph;var tq=u.Typography.Text,tN=function(e){var t=y().t,c=(0,n.useContext)(em).service,f=(0,n.useContext)(tP),p=f.visible,m=f.setVisible,d=f.current,b=d||{},v=b.schema,h=b.field,g=b.dataSource,O=b.collection,S=b.initialValues,x=(0,r.useDesignable)().dn,j=u.App.useApp().modal,w=e.insert,P=I(),C=eC(g,O),F=function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!z.modified)return;var r=null===(e=z.values.config)||void 0===e?void 0:e.chartType;if(!!r){var n=P[r];if(!(null==n?void 0:n.init)){t&&(z.values.config.general={},z.values.config.advanced={});return}var o=z.values.query,i=V(C,o),a=n.init(i,o),l=a.general,c=a.advanced;(l||t)&&(z.setInitialValuesIn("config.general",{}),z.values.config.general=l),(c||t)&&(z.values.config.advanced=c||{})}},E=tR(o().useState([]),2),D=E[0],k=E[1],Y=tR(o().useState([]),2),M=Y[0],T=Y[1],R=function(e,t){var r,n,o=(null===(r=e.values.query)||void 0===r?void 0:r.measures.filter(function(e){return e.field}))||[],i=(null===(n=e.values.query)||void 0===n?void 0:n.dimensions.filter(function(e){return e.field}))||[];if(!((0,s.isEqual)(o,D)&&(0,s.isEqual)(i,M)))null==t||t(),k((0,s.cloneDeep)(o)),T((0,s.cloneDeep)(i))},_=A(),z=(0,n.useMemo)(function(){var e,t=S||(null==v?void 0:v["x-decorator-props"]),r=(null==t?void 0:t.config)||{};return(0,l.createForm)({values:tT(tM({},t),{config:tT(tM({chartType:_},r),{title:r.title||(null==h?void 0:null===(e=h.componentProps)||void 0===e?void 0:e.title)}),collection:[g,O]}),effects:function(e){(0,l.onFieldChange)("config.chartType",function(){return F(!0)}),(0,l.onFormInit)(function(){return R(e)})}})},[h,p,g,O]),q=(0,n.memo)(function(){var e;return o().createElement(u.Button,{type:"link",loading:null==c?void 0:c.loading,icon:o().createElement(i.RightSquareOutlined,null),onClick:(e=function(){var e,t;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(t){switch(t.label){case 0:e=z.query("query").take(),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,null==e?void 0:e.validate()];case 2:return t.sent(),[3,4];case 3:return t.sent(),[2];case 4:return t.trys.push([4,6,,7]),[4,c.runAsync(g,O,z.values.query,!0)];case 5:return t.sent(),[3,7];case 6:return console.log(t.sent()),[3,7];case 7:return R(z,F),[2]}})},function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){tY(i,n,o,a,l,"next",e)}function l(e){tY(i,n,o,a,l,"throw",e)}a(void 0)})})},t("Run query"))}),N=(0,n.useRef)(null),U=(0,n.useRef)(null);return(0,n.useEffect)(function(){var e;if(!!p)c.run(O,null==h?void 0:null===(e=h.decoratorProps)||void 0===e?void 0:e.query,"configure")},[p]),o().createElement(u.Modal,{title:t("Configure chart"),open:p,onOk:function(){var e=z.values,t=e.query,n=e.config,o=e.transform,i=e.mode,a=n||{},l=a.title,u=a.bordered,s=function(){var e;m(!1),null===(e=d.service)||void 0===e||e.run(g,O,t),N.current.scrollTop=0,U.current.scrollTop=0,c.mutate(void 0)},f={query:t,config:n,dataSource:g,collection:O,transform:o,mode:i||"builder"};if(v&&v["x-uid"]){v["x-component-props"]=tT(tM({},v["x-component-props"]),{title:l,bordered:u}),v["x-decorator-props"]=f,h.decoratorProps=f,h.componentProps=tT(tM({},h.componentProps),{title:l,bordered:u}),h["x-acl-action"]="".concat(O,":list"),x.emit("patch",{schema:v}),s();return}w((0,r.gridRowColWrap)(B(f)),{onSuccess:s})},onCancel:function(){j.confirm({title:t("Are you sure to cancel?"),content:t("You changes are not saved. If you click OK, your changes will be lost."),okButtonProps:{danger:!0},onOk:function(){m(!1),N.current.scrollTop=0,U.current.scrollTop=0,c.mutate(void 0)}})},width:"95%",className:(0,tF.css)(tz()),styles:{header:{padding:"12px 24px 0px 24px"},body:{background:"rgba(128, 128, 128, 0.08)"},footer:{padding:"0px 24px 12px 24px"}}},o().createElement(r.FormProvider,{form:z},o().createElement(a.FormLayout,{layout:"vertical"},o().createElement(u.Row,{gutter:8},o().createElement(u.Col,{span:7},o().createElement(u.Card,{style:{height:"calc(100vh - 288px)",overflow:"auto",margin:"6px 0 6px 12px"},bodyStyle:{padding:"0 16px"},ref:N},o().createElement(u.Tabs,{tabBarExtraContent:o().createElement(q,null),items:[{label:t("Query"),key:"query",children:o().createElement(tN.Query,null)},{label:t("Data"),key:"data",children:o().createElement(tN.Data,null)}]}))),o().createElement(u.Col,{span:6},o().createElement(u.Card,{style:{height:"calc(100vh - 288px)",overflow:"auto",margin:"6px 0"},bodyStyle:{padding:"0 16px 10px 16px"},ref:U},o().createElement(u.Tabs,{items:[{label:t("Chart"),key:"chart",children:o().createElement(tN.Config,null)},{label:t("Transformation"),key:"transformation",children:o().createElement(tN.Transform,null)}]}))),o().createElement(u.Col,{span:11},o().createElement(tN.Renderer,null))))))};tN.Renderer=function(e){var t=(0,n.useContext)(tP).current||{},r=t.collection,i=t.data,a=(0,n.useContext)(em).service;return o().createElement(c.FormConsumer,null,function(t){var n,l,c=(0,s.cloneDeep)(t.values.config),f=(0,s.cloneDeep)(t.values.transform);return o().createElement(u.Card,{size:"small",title:null===(n=t.values.config)||void 0===n?void 0:n.title,style:{margin:"6px 12px 6px 0"},bordered:null===(l=t.values.config)||void 0===l?void 0:l.bordered},o().createElement(em.Provider,{value:{collection:r,config:c,transform:f,service:a,data:i}},o().createElement(eO,e)))})},tN.Query=function(){var e,t,i,l,s,f=y().t,p=eC();var m=(e=p,function(t){var r,n=t.query(".field").get("value");if(!n){t.dataSource=[];return}var o=[];switch(null===(r=N(e,n))||void 0===r?void 0:r.interface){case"datetime":case"datetimeTz":case"unixTimestamp":case"datetimeNoTz":case"createdAt":case"updatedAt":o=b.datetime;break;case"date":o=b.date;break;case"time":o=b.time;break;default:o=[]}t.dataSource=o}),d=eE(),v=(0,n.useContext)(tP),h=v.current,g=v.setCurrent,O=h||{},S=O.dataSource,x=O.collection,j=ek(S,x,1),w=c.Schema.compile(j,{t:f}),P=eA(S,x),C=u.theme.useToken().token,F=(0,n.useContext)(em).service,E=a.FormCollapse.createFormCollapse(["measures","dimensions","filter","sort"]);return o().createElement(r.SchemaComponent,{schema:tO,scope:{t:f,formCollapse:E,fieldOptions:w,filterOptions:P,useOrderOptions:(t=w,i=p,function(e){var r=e.query("query").get("value")||{},n=r.measures;if(!(void 0===n?[]:n).some(function(e){return e.aggregation})){e.componentProps.fieldNames={label:"title",value:"name",children:"children"},e.dataSource=t;return}var o=V(i,r);e.componentProps.fieldNames={},e.dataSource=o}),collectionOptions:d,useFormatterOptions:m,onCollectionChange:function(e){var t=h.schema,r=h.field,n=tR(e,2),o=n[0];g({schema:t,field:r,collection:n[1],dataSource:o,service:h.service,initialValues:{},data:void 0}),F.mutate(void 0)},collection:null==h?void 0:h.collection,useOrderReaction:(l=w,s=p,function(e){var t=e.query("query").get("value")||{},r=t.measures,n=(void 0===r?[]:r).some(function(e){return e.aggregation}),o=l,i=[];n?(o=V(s,t)).forEach(function(e){i.push(e.value)}):o.forEach(function(e){var t=e.children||[];!t.length&&i.push(e.value||e.name),t.forEach(function(t){i.push("".concat(e.name,".").concat(t.name))})});var a=(e.value||[]).reduce(function(e,t){var r=q(t.field).alias;return(!t.field||i.includes(r))&&e.push(t),e},[]);e.setValue(a)}),collapsePanelBg:C.colorBgContainer},components:{ArrayItems:a.ArrayItems,Editable:a.Editable,FormCollapse:a.FormCollapse,FormItem:a.FormItem,Space:u.Space,Switch:a.Switch,FromSql:function(){return o().createElement(tq,{code:!0},"From ",o().createElement("span",{style:{color:"#1890ff"}},null==h?void 0:h.collection))},FilterDynamicComponent:tx}})},tN.Config=function(){var e=y().t,t=k(),n=eC(),i=I(),l=eF(n),s=function(t){var r,n,a=null===(n=i[t])||void 0===n?void 0:null===(r=n.getReference)||void 0===r?void 0:r.call(n);if(!a)return"";var l=a.title,c=a.link;return o().createElement("span",null,e("Config reference: "),o().createElement("a",{href:c,target:"_blank",rel:"noreferrer"},e(l)))},f=a.FormCollapse.createFormCollapse(["card","basic"]);return o().createElement(c.FormConsumer,null,function(n){var c,p=i[null===(c=n.values.config)||void 0===c?void 0:c.chartType],m=null==p?void 0:p.enableAdvancedConfig,d=(null==p?void 0:p.schema)||{};return o().createElement(r.SchemaComponent,{schema:tg(d,m),scope:{t:e,chartTypes:t,useChartFields:l,getReference:s,formCollapse:f},components:{FormItem:a.FormItem,ArrayItems:a.ArrayItems,Space:u.Space,AutoComplete:r.AutoComplete,FormCollapse:a.FormCollapse}})})},tN.Transform=function(){var e,t=y().t,n=eC(),i=eF(n);return o().createElement(o().Fragment,null,o().createElement(u.Alert,{type:"info",style:{marginBottom:"20px"},message:t("Transformation tip"),closable:!0}),o().createElement("div",{className:(0,tF.css)(tB())},o().createElement(r.SchemaComponent,{schema:tS,components:{FormItem:a.FormItem,ArrayItems:a.ArrayItems,Space:u.Space,TransformerDynamicComponent:tA,Select:(0,r.withDynamicSchemaProps)(r.Select)},scope:{useChartFields:i,useTransformers:eN,useTransformerSelectProps:eq,useFieldSelectProps:(e=n,function(){var t=(0,c.useField)(),r=V(e,t.query("query").get("value")||{}),n=Object.keys(eM).filter(function(e){return"general"!==e});return{onChange:function(e){t.value=e;var o=t.query(".type").take();!e&&o.setState({value:null});var i=r.find(function(t){return t.value===e});o.dataSource=n.map(function(e){return{label:d(e),value:e}});var a={createdAt:"datetime",updatedAt:"datetime",double:"number",integer:"number",percent:"number"},l=null==i?void 0:i.interface,c=null==i?void 0:i.type,u=a[l]||a[c]||c;if(n.includes(u)){o.setState({value:u});return}o.setState({value:null})}}}),useFieldTypeSelectProps:eB,useArgument:eV,t:t}})))},tN.Data=function(){var e,t,r,i,a=(0,n.useContext)(em).service,l=(0,n.useContext)(tP).current,c=eC(),s=eD(null==l?void 0:l.data),f=null==a?void 0:a.error;return f?o().createElement(u.Alert,{message:"Error",type:"error",description:(null==f?void 0:null===(i=f.response)||void 0===i?void 0:null===(r=i.data)||void 0===r?void 0:null===(t=r.errors)||void 0===t?void 0:null===(e=t.map)||void 0===e?void 0:e.call(t,function(e){return e.message}).join("\n"))||f.message,showIcon:!0}):o().createElement(u.Table,{dataSource:s.map(function(e,t){return tT(tM({},e),{_key:t})}),rowKey:"_key",scroll:{x:"max-content"},columns:Object.keys(s[0]||{}).map(function(e){var t=N(c,e.split("."));return{title:(null==t?void 0:t.label)||e,dataIndex:e,key:e}}),size:"small"})};var tV=function(){var e=y().t;return o().createElement(r.GeneralSchemaDesigner,{disableInitializer:!0,title:e("Filter"),showDataSource:!1},o().createElement(r.SchemaSettingsRemove,{breakRemoveOn:{"x-component":"ChartV2Block"}}))};function tU(){var e,t,r=(e=["\n        .ant-nb-grid {\n          overflow: hidden;\n          height: ",";\n        }\n      "],!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}})));return tU=function(){return r},r}var tL=function(){var e,t,r;return{type:"void","x-action":"filter","x-decorator":"ChartFilterBlockProvider","x-component":"CardItem","x-component-props":{size:"small"},"x-designer":"ChartFilterBlockDesigner",properties:(e={},t=(0,v.uid)(),r={type:"void","x-component":"ChartFilterForm",properties:{grid:{type:"void","x-component":"ChartFilterGrid","x-initializer":"chartFilterForm:configureFields",properties:{}},actions:{type:"void","x-initializer":"chartFilterForm:configureActions","x-component":"ActionBar","x-component-props":{layout:"one-column",style:{float:"right"}},properties:{}}}},t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e)}},tG=function(e){var t=(0,n.useContext)(en).collapse.collapsed,i=u.theme.useToken().token;return o().createElement("div",{className:(0,tF.css)(tU(),t?"".concat(2*i.controlHeight,"px"):"auto")},o().createElement(r.Grid,e,e.children))};function t$(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function tW(e){if(Array.isArray(e))return e}function tK(e,t,r,n,o,i,a){try{var l=e[i](a),c=l.value}catch(e){r(e);return}l.done?t(c):Promise.resolve(c).then(n,o)}function tH(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tJ(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function tQ(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){tH(e,t,r[t])})}return e}function tX(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function tZ(e,t){return tW(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(e,t)||t1(e,t)||tJ()}function t0(e,t){return!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function t1(e,t){if(e){if("string"==typeof e)return t$(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t$(e,t)}}function t2(){var e=t0(["\n          & .ant-space {\n            flex-wrap: wrap;\n          }\n        "]);return t2=function(){return e},e}function t3(){var e=t0(["\n            > .ant-formily-item-label {\n              display: none;\n            }\n          "]);return t3=function(){return e},e}var t6=u.Typography.Paragraph,t8=u.Typography.Text,t5=(0,c.observer)(function(e){var t=eH((0,c.useForm)().values.component);return t?o().createElement(r.SchemaComponent,tQ({schema:t},e)):null},{displayName:"FieldComponentProps"}),t4=function(e){var t=e.error;return o().createElement(t6,{copyable:!0},o().createElement(t8,{type:"danger",style:{whiteSpace:"pre-line",textAlign:"center",padding:"5px"}},t.message))},t7=(0,c.observer)(function(e){y().t;var t,i,l=(0,c.useField)(),u=(0,c.useFieldSchema)(),s=null===(i=null===(t=u["x-decorator-props"])||void 0===t?void 0:t.showTitle)||void 0===i||i,f=(0,n.useMemo)(function(){return"string"==typeof l.description?o().createElement("div",{dangerouslySetInnerHTML:{__html:(0,r.HTMLEncode)(l.description).split("\n").join("<br/>")}}):l.description},[l.description]),p=(0,n.useMemo)(function(){return(0,tF.cx)((0,tF.css)(t2()),tH({},(0,tF.css)(t3()),!1===s))},[s]),m=(null==u?void 0:u["x-data-source"])||r.DEFAULT_DATA_SOURCE_KEY,d=tZ(((null==u?void 0:u["x-collection-field"])||"").split("."),1)[0];return o().createElement(r.BlockItem,{className:"nb-form-item"},o().createElement(r.CollectionManagerProvider,{dataSource:m},o().createElement(r.CollectionProvider,{name:d,allowNull:!d},o().createElement(r.CollectionFieldProvider,{name:u.name,allowNull:!u["x-collection-field"]},o().createElement(r.ACLCollectionFieldProvider,null,o().createElement(O,{onError:console.log,FallbackComponent:t4},o().createElement(r.IsInNocoBaseRecursionFieldContext.Provider,{value:!1},o().createElement(a.FormItem,tX(tQ({className:p},e),{extra:f})))))))))},{displayName:"ChartFilterFormItem"}),t9=(0,n.memo)(function(e){var t,i=(0,n.useContext)(u.ConfigProvider.ConfigContext).locale,s=y().t,f=(0,$.useMemoizedFn)(s),p=(0,n.useContext)(c.SchemaOptionsContext),m=p.scope,d=p.components,b=(0,r.useGlobalTheme)().theme,h=e.insert,g=(0,r.useSchemaInitializerItem)(),O=(0,r.useDataSourceManager)(),S=tl(),x=tc(),j=x.options,w=x.values;var P=(0,n.useCallback)((t=function(){var e,t,n,c,s,p,y,g;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(x){switch(x.label){case 0:return[4,(0,r.FormDialog)(f("Add custom field"),function(){return o().createElement(r.SchemaComponentOptions,{scope:tX(tQ({},m),{useChartFilterSourceFields:tl}),components:tX(tQ({},d),{FieldComponentProps:t5})},o().createElement(a.FormLayout,{layout:"vertical"},o().createElement(u.Alert,{type:"info",message:f('To filter with custom fields, use "Current filter" variables in the chart configuration.'),style:{marginBottom:16}}),o().createElement(u.ConfigProvider,{locale:i},o().createElement(r.SchemaComponent,{schema:{properties:{name:{type:"string",required:!0},title:{type:"string",title:f("Field title"),"x-component":"Input","x-decorator":"FormItem",required:!0},source:{type:"string",title:f("Field source"),"x-decorator":"FormItem","x-component":"Cascader",enum:S,description:f("Select a source field to use metadata of the field")},component:{type:"string",title:f("Field component"),"x-component":"Select","x-decorator":"FormItem",required:!0,enum:j},props:{type:"object",title:f("Component properties"),"x-component":"FieldComponentProps"}}}}))))},b).open({values:{name:"f_".concat((0,v.uid)())},effects:function(){(0,l.onFieldValueChange)("source",function(e){if(!e.value)return;var t,r,n=tW(t=e.value)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||t1(t)||tJ(),o=n[0],i=n.slice(1),a=O.getDataSource(o);if(!a)return;var l=a.collectionManager,c=i.join("."),u=l.getCollectionField(c);if(!u)return;var s=u.uiSchema||{};if(w.includes(s["x-component"])){r=s["x-component"];var f=s["x-component-props"]||{};s.enum&&(f.options=s.enum),e.query(".props").take().setValue(f)}else w.includes(u.interface)&&(r=u.interface);if(!!r)e.query(".component").take().setValue(r)})}})];case 1:return c=(n=x.sent()).name,s=n.title,p=n.component,y=n.props,g=(null===(t=O.collectionFieldInterfaceManager.getFieldInterface(p))||void 0===t?void 0:null===(e=t.default)||void 0===e?void 0:e.uiSchema)||{},h((0,r.gridRowColWrap)(tX(tQ({"x-component":p},g),{type:"string",title:s,name:"custom.".concat(c),required:!1,"x-designer":"ChartFilterItemDesigner","x-decorator":"ChartFilterFormItem","x-component-props":tQ({},g["x-component-props"]||{},y)}))),[2]}})},function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(e){tK(i,n,o,a,l,"next",e)}function l(e){tK(i,n,o,a,l,"throw",e)}a(void 0)})}),[b,h]);return o().createElement(r.SchemaInitializerItem,tX(tQ({},g,e),{onClick:P}))});t9.displayName="ChartFilterCustomItemInitializer";var re={name:"chartFilterForm:configureFields","data-testid":"configure-fields-button-of-chart-filter-item",wrap:r.gridRowColWrap,icon:"SettingOutlined",title:'{{ t("Configure fields") }}',items:[{type:"itemGroup",name:"displayFields",title:'{{ t("Display fields") }}',useChildren:function(){var e=y().t,t=to(),o=t.chartCollections,i=t.showDataSource,a=ti().getChartFilterFields,l=(0,r.useDataSourceManager)(),u=l.collectionFieldInterfaceManager;return(0,n.useMemo)(function(){var t,r=Object.entries(o).map(function(t){var r=tZ(t,2),n=r[0],o=r[1],i=l.getDataSource(n);return{name:i.key,title:c.Schema.compile(i.displayName,{t:e}),type:"subMenu",children:o.map(function(t){var r=i.collectionManager,o=r.getCollection(t),l=a({dataSource:n,collection:o,cm:r,fim:u});return{name:o.key,title:c.Schema.compile(o.title,{t:e}),type:"subMenu",children:l}})}});return i?r:(null===(t=r[0])||void 0===t?void 0:t.children)||[]},[o,i])}},{name:"divider",type:"divider"},{name:"custom",type:"item",title:d("Custom"),Component:function(){var e=(0,r.useDesignable)().insertAdjacent;return o().createElement(t9,{insert:function(t){return e("beforeEnd",t)}})}}]},rt=new r.CompatibleSchemaInitializer(tX(tQ({},re),{name:"ChartFilterItemInitializers"})),rr=new r.CompatibleSchemaInitializer(re,rt);function rn(e,t,r,n,o,i,a){try{var l=e[i](a),c=l.value}catch(e){r(e);return}l.done?t(c):Promise.resolve(c).then(n,o)}function ro(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}function ri(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}var ra=function(){return{onClick:ti().filter}},rl=function(){var e,t=(0,c.useForm)(),r=ti().filter;return{onClick:(e=function(){return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(e){switch(e.label){case 0:return t.reset(),[4,r()];case 1:return e.sent(),[2]}})},function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){rn(i,n,o,a,l,"next",e)}function l(e){rn(i,n,o,a,l,"throw",e)}a(void 0)})})}},rc=function(){var e=(0,n.useContext)(en),t=e.collapse.collapsed,r=e.setCollapse,a=y().t;return{onClick:function(){return r({collapsed:!t})},title:o().createElement(o().Fragment,null,o().createElement(i.DownOutlined,{rotate:t?0:180})," ",a(t?"Expand":"Collapse"))}},ru=function(e){var t=y().t;return o().createElement(r.GeneralSchemaDesigner,ri(ro({},e),{disableInitializer:!0}),o().createElement(r.SchemaSettingsRemove,{breakRemoveOn:function(e){return"Space"===e["x-component"]||e["x-component"].endsWith("ActionBar")},confirm:{title:t("Delete action")}}))},rs=function(e){var t=e.buttonEditorProps,n=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],!(t.indexOf(r)>=0)&&(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++){if(r=i[n],!(t.indexOf(r)>=0))Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}}return o}(e,["buttonEditorProps"]),i=y().t;return o().createElement(r.GeneralSchemaDesigner,ri(ro({},n),{disableInitializer:!0}),o().createElement(r.Action.Designer.ButtonEditor,t),o().createElement(r.SchemaSettingsDivider,null),o().createElement(r.SchemaSettingsRemove,{breakRemoveOn:function(e){return"Space"===e["x-component"]||e["x-component"].endsWith("ActionBar")},confirm:{title:i("Delete action")}}))},rf={"data-testid":"configure-actions-button-of-chart-filter",title:'{{t("Configure actions")}}',icon:"SettingOutlined",items:[{name:"filter",type:"item",title:'{{t("Filter")}}',component:function(e){return o().createElement(r.ActionInitializer,ri(ro({},e),{schema:{title:'{{ t("Filter") }}',"x-action":"submit","x-component":"Action","x-use-component-props":"useChartFilterActionProps","x-designer":"ChartFilterActionDesigner","x-component-props":{htmlType:"submit",type:"primary"}}}))},schema:{"x-action-settings":{}}},{name:"reset",type:"item",title:'{{t("Reset")}}',component:function(e){return o().createElement(r.ActionInitializer,ri(ro({},e),{schema:{title:'{{ t("Reset") }}',"x-action":"reset","x-component":"Action","x-use-component-props":"useChartFilterResetProps","x-designer":"ChartFilterActionDesigner"}}))},schema:{"x-action-settings":{}}},{name:"collapse",type:"item",title:'{{t("Collapse")}}',component:function(e){return o().createElement(r.ActionInitializer,ri(ro({},e),{schema:{title:'{{ t("Collapse") }}',"x-action":"collapse","x-component":"Action","x-use-component-props":"useChartFilterCollapseProps","x-component-props":{type:"link"},"x-designer":"ChartFilterCollapseDesigner"}}))},schema:{"x-action-settings":{}}}]},rp=new r.CompatibleSchemaInitializer(ro({name:"ChartFilterActionInitializers"},rf)),rm=new r.CompatibleSchemaInitializer(ro({name:"chartFilterForm:configureActions"},rf),rp);function rd(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function ry(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}function rb(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}var rv=function(e){var t,i,a,l=e.value,c=e.onChange,u=e.fieldSchema;var s=(t=((null==u?void 0:u["x-collection-field"])||"").split("."),i=1,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(t,1)||function(e,t){if(e){if("string"==typeof e)return rd(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rd(e,t)}}(t,i)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],f=tf(u,null===(a=u["x-component-props"])||void 0===a?void 0:a["filter-operator"]),p=rb(ry({},u),{"x-component":u["x-component"]||"Input",title:"",name:"value",default:"","x-read-pretty":!1}),m=u["x-component-props"]||{},d=(0,$.useMemoizedFn)(c);return(0,n.useEffect)(function(){u.default&&d({value:u.default})},[u.default,d]),o().createElement(r.VariableScopeProvider,{scope:f},o().createElement(r.VariableInput,rb(ry({},m),{renderSchemaComponent:function(){return o().createElement(r.CollectionProvider,{name:s,allowNull:!s},o().createElement(r.IsInNocoBaseRecursionFieldContext.Provider,{value:!1},o().createElement(r.SchemaComponent,{schema:p})))},fieldNames:{},value:null==l?void 0:l.value,scope:f,onChange:function(e){c({value:e})},shouldChange:(0,r.getShouldChange)({})})))};function rh(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rg(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){rh(e,t,r[t])})}return e}function rO(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}var rS=u.Typography.Text,rx=function(){var e=(0,c.useField)(),t=(0,c.useFieldSchema)(),i=y().t,a=(0,r.useDesignable)().dn,l=(0,n.useContext)(en).setField;return o().createElement(r.SchemaSettingsModalItem,{key:"edit-field-title",title:i("Edit field title"),schema:{type:"object",title:i("Edit field title"),properties:{title:{title:i("Field title"),default:null==e?void 0:e.title,required:!0,"x-decorator":"FormItem","x-component":"Input","x-component-props":{}}}},onSubmit:function(r){var n=r.title;n&&(e.title=n,t.title=n,a.emit("patch",{schema:{"x-uid":t["x-uid"],title:t.title}}),l(t.name,{title:n})),a.refresh()}})},rj=function(){var e,t,i,a,l=(0,r.useCompile)(),u=(0,c.useFieldSchema)(),s=(0,c.useField)(),f=y().t,p=(0,r.useDesignable)().dn,m=(0,n.useContext)(en).setField,d=u["x-collection-field"],b=eP(u["x-data-source"]||r.DEFAULT_DATA_SOURCE_KEY),v=b.cm,h=b.fim;if(!v)return null;var g=function(e){var t,r=null==e?void 0:e.interface;if("formula"===r)r=({boolean:"boolean",integer:"integer",bigInt:"integer",double:"number",decimal:"number",date:"datetime",string:"input"})[e.dataType]||e.dataType;var n=h.getFieldInterface(r);return{operatorList:(null==n?void 0:null===(t=n.filterable)||void 0===t?void 0:t.operators)||[],interfaceConfig:n}},O=v.getCollectionField(d),S=g(O),x=S.operatorList,j=S.interfaceConfig;if(!x.length){var w=d.split("."),P=w.pop();if(w.length<2||!(O=v.getCollectionField(w.join("."))))return null;var C=g(O);if(x=C.operatorList,!(j=C.interfaceConfig))return null;var F=((null==j?void 0:j.filterable.children)||[]).find(function(e){return e.name===P});x=(null==F?void 0:F.operators)||[]}if(!x.length)return null;var E=(null==j?void 0:null===(t=j.default)||void 0===t?void 0:null===(e=t.uiSchema)||void 0===e?void 0:e["x-component"])||"Input",D=null===(i=u["x-component-props"])||void 0===i?void 0:i["filter-operator"],k=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"DatePicker.FilterWithPicker"===t&&(t="DatePicker");var n=s.componentProps||{};s.component=t,s.componentProps=rg(rO(rg({},n),{"filter-operator":e}),r),u["x-component"]=t,u["x-component-props"]=rg(rO(rg({},u["x-component-props"]),{"filter-operator":e}),r),u["x-filter-operator"]=null==e?void 0:e.value,p.emit("patch",{schema:{"x-uid":u["x-uid"],"x-component":t,"x-component-props":rg(rO(rg({},u["x-component-props"]),{"filter-operator":e}),r),"x-filter-operator":null==e?void 0:e.value}})};return o().createElement(r.SchemaSettingsSelectItem,{key:"operator",title:f("Operator"),value:(null==D?void 0:D.value)||(null===(a=x[0])||void 0===a?void 0:a.value),options:l(x),onChange:function(e){var t,r=x.find(function(t){return t.value===e});r.noValue?k(r,"ChartFilterCheckbox",{content:c.Schema.compile(r.label,{t:f})}):(null===(t=r.schema)||void 0===t?void 0:t["x-component"])?k(r,r.schema["x-component"]):k(r,E),m(u.name,{operator:r}),p.refresh()}})},rw=function(){var e=y().t,t=(0,r.useDesignable)().dn,n=(0,c.useField)(),i=(0,c.useFieldSchema)(),a=eH(i["x-component"]);return o().createElement(r.SchemaSettingsModalItem,{key:"edit-field-props",title:e("Edit field properties"),schema:rg({title:e("Edit field properties")},a),initialValues:n.componentProps,onSubmit:function(e){n.reset(),n.componentProps=e,i["x-component-props"]=e,t.emit("patch",{schema:{"x-uid":i["x-uid"],"x-component-props":e}}),t.refresh()}})},rP=function(){var e=y().t,t=(0,r.useDesignable)().dn,i=(0,n.useContext)(r.VariablesContext),a=(0,r.useLocalVariables)(),l=(0,c.useField)(),u=(0,c.useFieldSchema)(),s=(0,ti().getTranslatedTitle)(u.title);return o().createElement(r.SchemaSettingsModalItem,{key:"set field default value",title:e("Set default value"),components:{ChartFilterVariableInput:rv},schema:{type:"void",title:e("Set default value"),properties:{default:{title:s,"x-decorator":"FormItem","x-component":"ChartFilterVariableInput","x-component-props":{fieldSchema:u}}}},onSubmit:function(e){var r=e.default.value;l.setInitialValue(r),u.default=r,t.emit("patch",{schema:{"x-uid":u["x-uid"],default:r}}),t.refresh(),eQ(l,i,a)}})},rC=function(){var e,t,n,i=(0,r.useCollectionManager_deprecated)(),a=i.getCollectionFields,l=i.getCollectionJoinField,u=i.getInterface,s=(0,c.useField)(),f=(0,c.useFieldSchema)(),p=y().t,m=(0,r.useDesignable)().dn,d=(0,r.useCompile)(),b=l(f["x-collection-field"]),v=((null==b?void 0:b.target)?a(null==b?void 0:b.target):null!==(n=a(null==b?void 0:b.targetCollection))&&void 0!==n?n:[]).filter(function(e){if((null==e?void 0:e.target)||"boolean"===e.type)return!1;var t=u(null==e?void 0:e.interface);return null==t?void 0:t.titleUsable}).map(function(e){var t;return{value:null==e?void 0:e.name,label:d(null==e?void 0:null===(t=e.uiSchema)||void 0===t?void 0:t.title)||(null==e?void 0:e.name)}});return v.length>0&&"CollectionField"===f["x-component"]?o().createElement(r.SchemaSettingsSelectItem,{key:"title-field",title:p("Title field"),options:v,value:null==s?void 0:null===(t=s.componentProps)||void 0===t?void 0:null===(e=t.fieldNames)||void 0===e?void 0:e.label,onChange:function(e){var t,r,n=rh({},"x-uid",f["x-uid"]),o=rO(rg({},null==b?void 0:null===(r=b.uiSchema)||void 0===r?void 0:null===(t=r["x-component-props"])||void 0===t?void 0:t.fieldNames,s.componentProps.fieldNames),{label:e});f["x-component-props"]=f["x-component-props"]||{},f["x-component-props"].fieldNames=o,n["x-component-props"]=f["x-component-props"],s.componentProps.fieldNames=f["x-component-props"].fieldNames,m.emit("patch",{schema:n}),m.refresh()}}):null},rF=function(){var e,t,n,i=(0,r.useDesignable)().dn,a=(0,c.useField)(),l=(0,c.useFieldSchema)(),u=l["x-data-source"]||r.DEFAULT_DATA_SOURCE_KEY,s=(0,r.useFormBlockContext)().form,p=eP(u).cm.getCollectionField(l["x-collection-field"]);return p?o().createElement(r.SchemaSettingsDataScope,{form:s,defaultFilter:(null==l?void 0:null===(n=l["x-component-props"])||void 0===n?void 0:null===(t=n.service)||void 0===t?void 0:null===(e=t.params)||void 0===e?void 0:e.filter)||{},collectionName:p.target,onSubmit:function(e){var t,n=e.filter;n=(0,r.removeNullCondition)(n),f().set(a.componentProps,"service.params.filter",n),l["x-component-props"]=a.componentProps,i.emit("patch",{schema:(rh(t={},"x-uid",l["x-uid"]),rh(t,"x-component-props",a.componentProps),t)})}}):null},rE=function(){var e=(0,r.useCollectionManager_deprecated)().getCollectionJoinField,t=(0,r.useCollection_deprecated)().getField,n=y().t,i=(0,c.useFieldSchema)(),a=i.name,l=i["x-data-source"]||r.DEFAULT_DATA_SOURCE_KEY,u=t(a)||e(i["x-collection-field"]),s=a.startsWith("custom."),f=eH(i["x-component"]),p=tu(l,a),m=(0,r.useIsAssociationField)();return o().createElement(r.GeneralSchemaDesigner,{disableInitializer:!0},!s&&o().createElement(o().Fragment,null,o().createElement(r.SchemaSettingsItem,{title:a},o().createElement(rS,{type:"secondary"},n("Original field"),": ",p)),o().createElement(r.SchemaSettingsDivider,null)),o().createElement(rx,null),o().createElement(r.EditDescription,null),f&&s&&o().createElement(rw,null),!s&&o().createElement(rj,null),o().createElement(rC,null),o().createElement(rP,null),m&&o().createElement(rF,null),u?o().createElement(r.SchemaSettingsDivider,null):null,o().createElement(r.SchemaSettingsRemove,{key:"remove",confirm:{title:n("Delete field")},breakRemoveOn:{"x-component":"Grid"}}))},rD=(0,c.connect)(function(e){var t=e.content,r=(0,c.useField)();return o().createElement(u.Checkbox,{onClick:function(){r.setValue(!r.value)},checked:r.value},t)});function rk(e,t,r,n,o,i,a){try{var l=e[i](a),c=l.value}catch(e){r(e);return}l.done?t(c):Promise.resolve(c).then(n,o)}var rA=(0,n.memo)(function(e){var t,i,a=(0,n.useContext)(en),c=a.setField,u=a.removeField,s=a.setForm,f=ti().getTranslatedTitle,p=(0,n.useRef)(null);p.current=(0,n.useContext)(r.VariablesContext);var m=(0,r.useLocalVariables)(),d=(0,n.useMemo)(function(){return(0,l.createForm)({effects:function(){var e,t,r=function(e){return"Field"!==e.displayName?null:(e.props||{}).name};(0,l.onFieldInit)("*",function(e){if(!!r(e))e.setValue(null)}),(0,l.onFieldMount)("*",(t=(e=function(e){var t;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(n){return(t=r(e))?(c(t,{title:e.title,operator:e.componentProps["filter-operator"],dataSource:e.componentProps["data-source"],collectionField:e.componentProps["collection-field"]}),e.title.includes("/")&&(e.title=f(e.title)),eQ(e,p.current,m),[2]):[2]})},function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){rk(i,n,o,a,l,"next",e)}function l(e){rk(i,n,o,a,l,"throw",e)}a(void 0)})}),function(e){return t.apply(this,arguments)})),(0,l.onFieldUnmount)("*",function(e){var t=r(e);if(!!t)u(t)})}})},[c,f,u,p,m]);return(0,n.useEffect)(function(){return s(d)},[d,s]),o().createElement(r.FormV2,(t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}({},e),i=(i={form:d},i),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}),t))});rA.displayName="ChartFilterForm";var rI=function(){var e,t,n=(0,r.useSchemaInitializerItem)();return o().createElement(r.InitializerWithSwitch,(e=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}({},n),t=(t={item:n,schema:{},type:"name"},t),Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e))};function rY(){var e,t,r=(e=["\n        .ant-card {\n          box-shadow: none;\n          border: none;\n          margin-bottom: 6px;\n        }\n      "],!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}})));return rY=function(){return r},r}var rM=function(e){var t=y().t,i=(0,n.useContext)(en).setEnabled;return(0,n.useEffect)(function(){i(!0)},[i]),o().createElement("div",{className:(0,tF.css)(rY())},o().createElement(r.SchemaComponentOptions,{components:{ChartFilterItemDesigner:rE,ChartFilterForm:rA,ChartFilterGrid:tG,ChartFilterCheckbox:rD,ChartFilterFormItem:t7,ArrayItems:a.ArrayItems,ChartFilterCollapseDesigner:ru,ChartFilterActionDesigner:rs,CollectionFieldInitializer:rI},scope:{t:t,useChartFilterActionProps:ra,useChartFilterResetProps:rl,useChartFilterCollapseProps:rc}},e.children))};function rT(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function rR(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}function r_(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function rz(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(e,t)||rB(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rB(e,t){if(e){if("string"==typeof e)return rT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rT(e,t)}}var rq=(0,n.forwardRef)(function(e,t){var a,l=y().t,c=(0,n.useContext)(em),s=c.autoRefresh,f=c.setAutoRefresh,p=c.showActionBar,m=(0,r.useDesignable)().designable,d={5:"5s",10:"10s",30:"30s",60:"1m",300:"5m",900:"15m",1800:"30m",3600:"1h",7200:"2h",86400:"1d"},b=Object.entries(d).map(function(e){var t=rz(e,2),r=t[0];return{key:r,label:t[1],onClick:function(){return f(+r)}}});return p||m?o().createElement(u.Dropdown.Button,r_(rR({},e),{menu:{items:[{key:"off",label:l("Off"),onClick:function(){return f(!1)}}].concat(function(e){if(Array.isArray(e))return rT(e)}(a=b)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(a)||rB(a)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())},icon:o().createElement(i.DownOutlined,null),buttonsRender:function(e){var t=rz(e,2),r=t[0],n=t[1];return[r,o().cloneElement(n,{iconPosition:"end"},s?d[s]:null)]}}),o().createElement(i.ReloadOutlined,null),e.children):null}),rN=function(){var e=(0,c.useFieldSchema)(),t=(0,n.useContext)(em),r=t.service,o=t.setAutoRefresh;return(0,n.useEffect)(function(){var t;return o(null===(t=e["x-component-props"])||void 0===t?void 0:t.autoRefresh),function(){o(!1)}},[e,o]),{onClick:r.refresh}};function rV(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function rU(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}function rL(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function rG(){var e,t,r=(e=["\n            .ant-nb-card-item {\n              .ant-card {\n                box-shadow: none;\n              }\n            }\n            .nb-grid-warp > button:last-child {\n              margin-bottom: 24px !important;\n            }\n          "],!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}})));return rG=function(){return r},r}var r$=function(e){var t,n=(0,r.useToken)().token,o=null===(t=e.style)||void 0===t?void 0:t.background;return rL(rU({},e),{style:rL(rU({},e.style),{background:"none"!==o?n.colorBgContainer:"none"})})},rW=function(e){var t,i,a=(t=(0,n.useState)(!1),i=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return rV(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rV(e,t)}}(t,i)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=a[0],c=a[1],u=(0,r.useSchemaInitializer)();return o().createElement(r.SchemaInitializerContext.Provider,{value:rL(rU({},u),{visible:l,setVisible:c})},o().createElement(r.SchemaComponentOptions,{components:{ChartRenderer:eO,ChartRendererProvider:ed,ChartFilterBlockProvider:rM,ChartFilterBlockDesigner:tV,RefreshButton:rq}},o().createElement("div",{className:(0,tF.css)(rG())},o().createElement(X,null,o().createElement(eo,null,o().createElement(tC,null,e.children))))))};function rK(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rH(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){rK(e,t,r[t])})}return e}function rJ(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}var rQ=function(){var e,t,n=y().t,i=(0,c.useField)(),a=(0,c.useFieldSchema)(),l=(0,r.useDesignable)().dn,u=(0,r.useToken)().token;return o().createElement(r.GeneralSchemaDesigner,{title:n("Charts"),showDataSource:!1},o().createElement(r.SchemaSettingsBlockTitleItem,null),o().createElement(r.SchemaSettingsSwitchItem,{title:n("Show background"),checked:(null===(e=i.componentProps.style)||void 0===e?void 0:e.background)!=="none",onChange:function(e){var t,r=rJ(rH({},i.componentProps.style),{background:e?u.colorBgContainer:"none",boxShadow:e?u.boxShadowTertiary:"none"});i.componentProps.style=r,i.componentProps.bordered=e,a["x-component-props"]=i.componentProps,l.emit("patch",{schema:(rK(t={},"x-uid",a["x-uid"]),rK(t,"x-component-props",i.componentProps),t)}),l.refresh()}}),o().createElement(r.SchemaSettingsSwitchItem,{title:n("Show padding"),checked:(null===(t=i.componentProps.bodyStyle)||void 0===t?void 0:t.padding)!=="5px 0 0",onChange:function(e){var t,r=rJ(rH({},i.componentProps.bodyStyle),{padding:e?"".concat(u.paddingLG,"px ").concat(u.paddingLG,"px 0"):"5px 0 0"});i.componentProps.bodyStyle=r,a["x-component-props"]=i.componentProps,l.emit("patch",{schema:(rK(t={},"x-uid",a["x-uid"]),rK(t,"x-component-props",i.componentProps),t)}),l.refresh()}}),o().createElement(r.SchemaSettingsDivider,null),o().createElement(r.SchemaSettingsRemove,{removeParentsIfNoChildren:!0,breakRemoveOn:{"x-component":"Grid"}}))};function rX(e,t,r,n,o,i,a){try{var l=e[i](a),c=l.value}catch(e){r(e);return}l.done?t(c):Promise.resolve(c).then(n,o)}function rZ(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function r0(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){rZ(e,t,r[t])})}return e}function r1(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}var r2={icon:"PlusOutlined",title:'{{t("Add block")}}',items:[{name:"chart",title:d("Chart"),Component:function(){var e,t,a=(0,n.useContext)(tP),l=a.setVisible,c=a.setCurrent,u=(0,r.useACLRoleContext)().parseAction,s=(0,r.useSchemaInitializerItem)(),f=(0,n.useCallback)(function(e){return u("".concat(e.name,":list"))},[u]);return o().createElement(r.DataBlockInitializer,r1(r0({},s),{filter:f,filterDataSource:function(e){return e.key===r.DEFAULT_DATA_SOURCE_KEY||e.getOptions().isDBInstance},icon:o().createElement(i.BarChartOutlined,null),componentType:"Chart",onCreateBlockSchema:(t=(e=function(e){var t;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(r){return c({schema:{},field:null,collection:(t=e.item).name,dataSource:t.dataSource,service:null,data:void 0}),l(!0),[2]})},function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){rX(i,n,o,a,l,"next",e)}function l(e){rX(i,n,o,a,l,"throw",e)}a(void 0)})}),function(e){return t.apply(this,arguments)})}))}},{name:"otherBlocks",type:"itemGroup",title:d("Other blocks"),children:[{name:"filter",title:d("Filter"),Component:function(){var e,t=(0,r.useDesignable)().insertAdjacent,a=(0,n.useContext)(en).setEnabled,l=(0,r.useSchemaInitializerItem)(),c=l.remove,u=l.disabled,s="x-action",f=tL(),p=(0,r.useCurrentSchema)((null==f?void 0:f[s])||(null==l?void 0:null===(e=l.schema)||void 0===e?void 0:e[s]),s,l.find,c||l.remove),m=p.exists,d=p.remove;return o().createElement(r.SchemaInitializerSwitch,{icon:o().createElement(i.FilterOutlined,null),checked:m,disabled:u,title:l.title,onClick:function(){if(!u){if(m)return a(!1),d();var e,n=(0,v.merge)(f||{},l.schema||{});null==l||null===(e=l.schemaInitialize)||void 0===e||e.call(l,n),t("afterBegin",(0,r.gridRowColWrap)(n)),a(!0)}}})}}]}]},r3=new r.CompatibleSchemaInitializer(r0({name:"ChartInitializers"},r2)),r6=new r.CompatibleSchemaInitializer(r0({name:"charts:addBlock"},r2),r3),r8=function(){var e=(0,r.useSchemaInitializerItem)(),t=(0,r.useSchemaInitializer)().insert;return o().createElement(r.SchemaInitializerItem,r1(r0({},e),{icon:o().createElement(i.LineChartOutlined,null),onClick:function(){t({type:"void","x-component":"ChartCardItem","x-use-component-props":"useChartBlockCardProps","x-designer":"ChartV2BlockDesigner","x-decorator":"ChartBlockProvider",properties:rZ({actions:{type:"void","x-component":"ActionBar","x-component-props":{style:{marginBottom:"var(--nb-designer-offset)"}},"x-initializer":"chartBlock:configureActions"}},(0,v.uid)(),{type:"void","x-component":"Grid","x-decorator":"ChartV2Block","x-initializer":"charts:addBlock"})})}}))};function r5(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function r4(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}function r7(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function r9(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(e,t)||ne(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(e,t){if(e){if("string"==typeof e)return r5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return r5(e,t)}}var nt=(0,n.forwardRef)(function(e,t){var r,a=y().t,l=(0,n.useContext)(ea),c=l.autoRefresh,s=l.setAutoRefresh,f={5:"5s",10:"10s",30:"30s",60:"1m",300:"5m",900:"15m",1800:"30m",3600:"1h",7200:"2h",86400:"1d"},p=Object.entries(f).map(function(e){var t=r9(e,2),r=t[0];return{key:r,label:t[1],onClick:function(){return s(+r)}}});return o().createElement(u.Dropdown.Button,r7(r4({},e),{menu:{items:[{key:"off",label:a("Off"),onClick:function(){return s(!1)}}].concat(function(e){if(Array.isArray(e))return r5(e)}(r=p)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||ne(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())},icon:o().createElement(i.DownOutlined,null),buttonsRender:function(e){var t=r9(e,2),r=t[0],n=t[1];return[r,o().cloneElement(n,{iconPosition:"end"},c?f[c]:null)]}}),o().createElement(i.ReloadOutlined,null),a("Refresh"),e.children)}),nr=function(){var e=(0,c.useFieldSchema)(),t=(0,n.useContext)(ea),r=t.setAutoRefresh,o=t.refreshCharts;return(0,n.useEffect)(function(){var t;return r(null===(t=e["x-decorator-props"])||void 0===t?void 0:t.autoRefresh),function(){r(!1)}},[e,r]),{onClick:function(){null==o||o()}}},nn=function(e){var t=(0,r.useCurrentPopupContext)(),n=(0,r.useLocalVariables)(),i=null==n?void 0:n.find(function(e){return"$nPopupRecord"===e.name});return f().isEmpty(t)||!(null==i?void 0:i.collectionName)||(null==i?void 0:i.ctx)?o().createElement(r.SchemaComponentOptions,{components:{BlockRefreshButton:nt}},o().createElement(el,null,e.children)):null};function no(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ni={field:function(e){var t=e.name,r=e.title,n=e.required,o=e.defaultValue,i=e.description;return no({},t,{title:d(r),type:"string","x-decorator":"FormItem","x-component":"Select","x-reactions":"{{ useChartFields }}",required:n,description:i,default:o})},input:function(e){var t=e.name,r=e.title,n=e.required,o=e.defaultValue,i=e.description;return no({},t,{title:d(r),type:"string","x-decorator":"FormItem","x-component":"Input",required:n,default:o,description:i})},boolean:function(e){var t=e.name,r=e.title,n=e.defaultValue,o=e.description;return no({},t,{"x-content":d(r),type:"boolean","x-decorator":"FormItem","x-component":"Checkbox",default:void 0!==n&&n,description:o})},select:function(e){var t=e.name,r=e.title,n=e.required,o=e.defaultValue,i=e.options,a=e.description;return no({},t,{title:d(r),type:"string","x-decorator":"FormItem","x-component":"Select",required:n,default:o,description:a,enum:i})},radio:function(e){var t=e.name,r=e.title,n=e.defaultValue,o=e.options,i=e.description,a=e.componentProps;return no({},t,{title:d(r),type:"string","x-decorator":"FormItem","x-component":"Radio.Group","x-component-props":function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){no(e,t,r[t])})}return e}({},a),default:n,description:i,enum:o})},percent:function(e){return no({},e.name,{title:e.title,type:"number","x-decorator":"FormItem","x-component":"InputNumber",default:e.defaultValue,description:e.description,"x-component-props":{suffix:"%"}})},xField:{configType:"field",name:"xField",title:"xField",required:!0},yField:{configType:"field",name:"yField",title:"yField",required:!0},seriesField:{configType:"field",name:"seriesField",title:"seriesField"},colorField:{configType:"field",name:"colorField",title:"colorField",required:!0},isStack:{configType:"boolean",name:"isStack",title:"isStack"},smooth:{configType:"boolean",name:"smooth",title:"smooth"},isPercent:{configType:"boolean",name:"isPercent",title:"isPercent"},isGroup:{configType:"boolean",name:"isGroup",title:"isGroup"},size:function(){return{size:{title:d("Size"),type:"object","x-decorator":"FormItem","x-component":"Space",properties:{type:{"x-component":"Select","x-component-props":{allowClear:!1},default:"ratio",enum:[{label:d("Aspect ratio"),value:"ratio"},{label:d("Fixed height"),value:"fixed"}]},fixed:{type:"number","x-component":"InputNumber","x-component-props":{min:0,addonAfter:"px"},"x-reactions":[{dependencies:[".type"],fulfill:{state:{visible:"{{$deps[0] === 'fixed'}}"}}}]},ratio:{type:"object","x-component":"Space","x-reactions":[{dependencies:[".type"],fulfill:{state:{visible:"{{$deps[0] === 'ratio'}}"}}}],properties:{width:{type:"number","x-component":"InputNumber","x-component-props":{placeholder:d("Width"),min:1}},colon:{type:"void","x-component":"Text","x-component-props":{children:":"}},height:{type:"number","x-component":"InputNumber","x-component-props":{placeholder:d("Height"),min:1}}}}}}}}};function na(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function nl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function nc(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var nu=function(){var e,t,r;function o(e){var t=e.name,r=e.title,i=e.enableAdvancedConfig,a=e.Component,l=e.config;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),nc(this,"name",void 0),nc(this,"title",void 0),nc(this,"enableAdvancedConfig",!1),nc(this,"Component",void 0),nc(this,"config",void 0),nc(this,"configTypes",new Map),this.name=t,this.title=r,this.Component=(0,n.memo)(a,function(e,t){return JSON.stringify(e)===JSON.stringify(t)}),this.config=l,this.enableAdvancedConfig=i||!1,this.addConfigTypes(ni)}return e=o,t=[{key:"schema",get:function(){var e=this;return this.config?{type:"object",properties:this.config.reduce(function(t,r){var n={};if("string"==typeof r&&(r=e.configTypes.get(r)),"function"==typeof r)n=r();else if(r.configType){var o=e.configTypes.get(r.configType);n=(null==o?void 0:o(r))||{}}else n=r;return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){nc(e,t,r[t])})}return e}({},t,n)},{})}:{}}},{key:"addConfigTypes",value:function(e){var t=this;Object.entries(e).forEach(function(e){var r,n,o=(n=2,function(e){if(Array.isArray(e))return e}(r=e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){l=!0,n=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw n}}return i}}(r,2)||function(e,t){if(e){if("string"==typeof e)return na(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return na(e,t)}}(r,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1];t.configTypes.set(i,a)})}},{key:"infer",value:function(e,t){var r=t.measures,n=t.dimensions,o=function(e,t){if(t.alias)return e.find(function(e){return e.value===t.alias});var r=q(t.field).alias;return e.find(function(e){return e.value===r})};if((null==r?void 0:r.length)&&(a=o(e,r[0]),u=r.map(function(t){return o(e,t)})),n){if(1===n.length)i=o(e,n[0]);else if(n.length>1){n.forEach(function(t,r){var n=o(e,t);["date","time","datetime"].includes(null==n?void 0:n.type)&&(i=n,s=r)}),s=s||0,i=i||o(e,n[s]);var i,a,l,c,u,s,f=n.filter(function(e,t){return t!==s}).map(function(t){return o(e,t)});1===f.length?(l=f[0],c=f[0]):f.length>1&&(c=f[0],l=f[1])}}return{xField:i,yField:a,seriesField:l,colorField:c,yFields:u}}},{key:"getProps",value:function(e){return e}}],nl(e.prototype,t),o}();function ns(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function nf(e){return(nf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function np(e,t){return(np=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nm(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(nm=function(){return!!e})()}var nd=function(e){var t,r,n;function o(){var e,t,r;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),e=this,t=o,r=arguments,t=nf(t),function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,nm()?Reflect.construct(t,r||[],nf(e).constructor):t.apply(e,r))}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&np(e,t)}(o,e),t=o,r=[{key:"getReference",value:function(){return{title:this.title,link:"https://ant.design/components/".concat(this.name)}}}],ns(t.prototype,r),o}(nu),ny=function(e){var t=e.link,r=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],!(t.indexOf(r)>=0)&&(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++){if(r=i[n],!(t.indexOf(r)>=0))Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}}return o}(e,["link"]);return o().createElement("div",{onClick:function(){t&&window.open(t,"__blank")},style:{cursor:t?"pointer":"auto"}},o().createElement(u.Statistic,r))};function nb(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function nv(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nh(e){return(nh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ng(e,t){return(ng=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(nO=function(){return!!e})()}var nS=function(e){var t,r,n;function o(){var e,t,r,n;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),t=this,r=o,n=[{name:"statistic",title:"Statistic",enableAdvancedConfig:!0,Component:ny,config:[{configType:"field",name:"field",title:"Field",required:!0},{title:{title:d("Title"),type:"string","x-decorator":"FormItem","x-component":"Input"}},{link:{title:d("Link"),type:"string","x-decorator":"FormItem","x-component":"Input"}}]}],r=nh(r),nv(e=function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(t,nO()?Reflect.construct(r,n||[],nh(t).constructor):r.apply(t,n)),"init",function(t,r){var n=r.measures,o=r.dimensions,i=e.infer(t,{measures:n,dimensions:o}).yField;return{general:{field:null==i?void 0:i.value,title:null==i?void 0:i.label}}}),e}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ng(e,t)}(o,e),t=o,r=[{key:"getProps",value:function(e){var t=e.data,r=e.fieldProps,n=e.general,o=e.advanced,i=t[0]||{},a=null==n?void 0:n.field,l=r[a];return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){nv(e,t,r[t])})}return e}({value:i[a],formatter:null==l?void 0:l.transformer},n,o)}}],nb(t.prototype,r),o}(nd);function nx(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function nj(e){return(nj=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nw(e,t){return(nw=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nP(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(nP=function(){return!!e})()}var nC=function(e){var t,r,n;function o(){var e,t,r;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),e=this,t=o,r=[{name:"table",title:"Table",enableAdvancedConfig:!0,Component:u.Table}],t=nj(t),function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,nP()?Reflect.construct(t,r||[],nj(e).constructor):t.apply(e,r))}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nw(e,t)}(o,e),t=o,r=[{key:"getProps",value:function(e){var t,r=e.data,n=e.fieldProps,o=e.general,i=e.advanced,a=r.length?Object.keys(r[0]).map(function(e){var t;return{title:(null===(t=n[e])||void 0===t?void 0:t.label)||e,dataIndex:e,key:e}}):[],l=r.map(function(e,t){return Object.keys(e).map(function(t){var r=n[t];if((null==r?void 0:r.interface)==="percent"){var o=Math.round(100*parseFloat(e[t])).toFixed(2);e[t]="".concat(o,"%")}"boolean"==typeof e[t]&&(e[t]=e[t].toString()),(null==r?void 0:r.transformer)&&(e[t]=r.transformer(e[t]))}),e._key=t,e}),c=(null==i?void 0:null===(t=i.pagination)||void 0===t?void 0:t.pageSize)||10;return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}({size:"middle",pagination:!(l.length<c)&&{pageSize:c},dataSource:l,columns:a,scroll:{x:"max-content"},rowKey:"_key"},o,i)}}],nx(t.prototype,r),o}(nd),nF=[new nS,new nC];function nE(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function nD(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function nk(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nA(e){return(nA=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nI(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){nk(e,t,r[t])})}return e}function nY(e,t){return(nY=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(nM=function(){return!!e})()}var nT=function(e){var t,n,i;function a(e){var t,n,i,l,c,u,s=e.name,f=e.title,p=e.Component,m=e.config;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,a),i=this,l=a,c=[{name:s,title:f,enableAdvancedConfig:!0,Component:(t=p,function(e){var n=(0,r.useGlobalTheme)().isDarkTheme,i=e.size,a=void 0===i?{}:i,l=e.height;!l&&"fixed"===a.type&&(l=a.fixed);var c=td(a,l),u=c.chartRef,s=c.chartHeight;return o().createElement("div",{ref:u,style:s?{height:"".concat(s,"px")}:{}},o().createElement(t,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}({theme:n?"classicDark":"classic"},e,s?{height:s}:{})))}),config:["xField","yField","seriesField","size"].concat(function(e){if(Array.isArray(e))return nE(e)}(n=m||[])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return nE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nE(e,t)}}(n)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}],l=nA(l),nk(u=function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(i,nM()?Reflect.construct(l,c||[],nA(i).constructor):l.apply(i,c)),"init",function(e,t){var r=t.measures,n=t.dimensions,o=u.infer(e,{measures:r,dimensions:n}),i=o.xField,a=o.yField,l=o.seriesField;return{general:{xField:null==i?void 0:i.value,yField:null==a?void 0:a.value,seriesField:null==l?void 0:l.value}}}),u}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nY(e,t)}(a,e),t=a,n=[nk({key:"getProps"},"value",function(e){var t,r,n,o,i=e.data,a=e.general,l=e.advanced,c=e.fieldProps,u=c[a.xField],s=c[a.yField],f=c[a.seriesField];return nI((t=nI((nk(o={legend:{color:{itemLabelText:function(e){var t=null==f?void 0:f.transformer;return t?t(e.label):e.label}}}},"tooltip",(nk(n={},"title",function(e){var t=e[a.xField];return(null==u?void 0:u.transformer)?u.transformer(t):t}),nk(n,"items",[function(e){e[a.xField];var t=e[a.yField],r=e[a.seriesField],n="";return{name:n=r?f.transformer?f.transformer(r):r:(null==s?void 0:s.label)||a.yField,value:(null==s?void 0:s.transformer)?s.transformer(t):t}}]),n)),nk(o,"axis",{x:{labelFormatter:function(e){var t=null==u?void 0:u.transformer;return t?t(e):e}},y:{labelFormatter:function(e){var t=null==s?void 0:s.transformer;return t?t(e):e}}}),nk(o,"data",i),nk(o,"animate",{enter:{type:!1},update:{type:!1},exit:{type:!1}}),nk(o,"colorField",a.seriesField),nk(o,"stack",a.isStack),nk(o,"percent",!!a.isPercent||void 0),o),a.smooth?{shapeField:"smooth"}:{},a),r=(r={seriesField:a.isGroup?a.seriesField:void 0},r),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}),t),l)}),{key:"getReference",value:function(){return{title:this.title,link:"https://ant-design-charts-next.antgroup.com/examples#statistics-".concat(this.name)}}}],nD(t.prototype,n),a}(nu),nR=w(581);function n_(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function nz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function nB(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nq(e,t,r){return(nq="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nN(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r||e):o.value}})(e,t,r||e)}function nN(e){return(nN=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nV(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){nB(e,t,r[t])})}return e}function nU(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function nL(e,t){return(nL=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nG(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(nG=function(){return!!e})()}var n$=(0,r.lazy)(function(){return nR("imported_-6m3i3f_component",w.e("950").then(w.bind(w,823)))},"Pie").Pie,nW=function(e){var t,r,n;function o(){var e,t,r,n;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),t=this,r=o,n=[{name:"pie",title:"Pie",Component:n$}],r=nN(r),nB(e=function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(t,nG()?Reflect.construct(r,n||[],nN(t).constructor):r.apply(t,n)),"init",function(t,r){var n=r.measures,o=r.dimensions,i=e.infer(t,{measures:n,dimensions:o}),a=i.xField,l=i.yField;return{general:{colorField:null==a?void 0:a.value,angleField:null==l?void 0:l.value}}}),e.config=[{configType:"field",name:"angleField",title:"angleField",required:!0},{configType:"field",name:"colorField",title:"colorField",required:!0},"size"],e}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nL(e,t)}(o,e),t=o,r=[nB({key:"getProps"},"value",function(e){var t=e.data,r=e.general,n=e.advanced,i=e.fieldProps,a=r.angleField,l=i[a]||{};if(t.some(function(e){return e[a]<0})){var c,u,s=(u=Math).min.apply(u,function(e){if(Array.isArray(e))return n_(e)}(c=t.map(function(e){return e[a]}))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(c)||function(e,t){if(e){if("string"==typeof e)return n_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n_(e,t)}}(c)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());t=t.map(function(e){return nU(nV({},e),nB({},a,e[a]-s))});var f=l.transformer;l.transformer=function(e){var t=e+s;return f?f(t):t}}var p=nq(nN(o.prototype),"getProps",this).call(this,{data:t,general:r,advanced:n,fieldProps:i}),m=nB({},"items",[function(e){var t=e[r.colorField],n=e[a],o=t||(null==l?void 0:l.label)||a,i=null==l?void 0:l.transformer;return{name:o,value:i?i(n):n}}]);return nU(nV({},p),{tooltip:n.tooltip||m})})],nz(t.prototype,r),o}(nT),nK=w(581);function nH(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function nJ(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nQ(e,t,r){return(nQ="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nX(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r||e):o.value}})(e,t,r||e)}function nX(e){return(nX=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nZ(e,t){return(nZ=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function n0(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(n0=function(){return!!e})()}var n1=(0,r.lazy)(function(){return nK("imported_-6m3i3f_component",w.e("950").then(w.bind(w,823)))},"DualAxes").DualAxes,n2=function(e){var t,r,n;function o(){var e,t,r,n;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),t=this,r=o,n=[{name:"dualAxes",title:"Dual axes",Component:n1}],r=nX(r),nJ(e=function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(t,n0()?Reflect.construct(r,n||[],nX(t).constructor):r.apply(t,n)),"init",function(t,r){var n=r.measures,o=r.dimensions,i=e.infer(t,{measures:n,dimensions:o}),a=i.xField,l=i.yFields;return{general:{xField:null==a?void 0:a.value,yField:(null==l?void 0:l.map(function(e){return e.value}))||[]}}}),e.config=["xField",{yField:{title:'{{t("yField")}}',type:"array","x-decorator":"FormItem","x-component":"ArrayItems",items:{type:"void","x-component":"Space",properties:{sort:{type:"void","x-decorator":"FormItem","x-component":"ArrayItems.SortHandle"},input:{type:"string","x-decorator":"FormItem","x-component":"Select","x-reactions":"{{ useChartFields }}","x-component-props":{style:{minWidth:"200px"}},required:!0},remove:{type:"void","x-decorator":"FormItem","x-component":"ArrayItems.Remove"}}},properties:{add:{type:"void",title:'{{t("Add")}}',"x-component":"ArrayItems.Addition"}}}},"size"],e}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nZ(e,t)}(o,e),t=o,r=[nJ({key:"getProps"},"value",function(e){var t,r,n,i=e.data,a=e.general,l=e.advanced,c=e.fieldProps,u=nQ(nX(o.prototype),"getProps",this).call(this,{data:i,general:a,advanced:l,fieldProps:c});return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){nJ(e,t,r[t])})}return e}({},f().omit(u,["legend","tooltip","yField"])),r=null!=(r=nJ({},"children",(null===(n=u.yField)||void 0===n?void 0:n.map(function(e,t){var r,n;return nJ(n={type:"line",yField:e},"tooltip",nJ({},"items",[function(t){var r=t[e],n=c[e];return{name:(null==n?void 0:n.label)||e,value:(null==n?void 0:n.transformer)?n.transformer(r):r}}])),nJ(n,"colorField",function(){var t=c[e];return(null==t?void 0:t.label)||e}),nJ(n,"axis",{y:{title:(null===(r=c[e])||void 0===r?void 0:r.label)||e,position:0===t?"left":"right",labelFormatter:function(t){var r=c[e],n=null==r?void 0:r.transformer;return n?n(t):t}}}),n}))||[]))?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}),t})],nH(t.prototype,r),o}(nT),n3=w(581),n6=(0,r.lazy)(function(){return n3("imported_-6m3i3f_component",w.e("950").then(w.bind(w,823)))},"Area","Column","Line","Scatter","Bar"),n8=n6.Area,n5=n6.Column,n4=n6.Line,n7=n6.Scatter,n9=n6.Bar,oe=[new nT({name:"line",title:"Line",Component:n4,config:["smooth","isStack"]}),new nT({name:"area",title:"Area",Component:n8,config:["smooth",{configType:"boolean",name:"isStack",title:"isStack",defaultValue:!0},"isPercent"]}),new nT({name:"column",title:"Column",Component:n5,config:["isGroup","isStack","isPercent"]}),new nT({name:"bar",title:"Bar",Component:n9,config:["isGroup","isStack","isPercent"]}),new nW,new n2,new nT({name:"scatter",title:"Scatter",Component:n7})],ot=new r.SchemaInitializer({name:"chart:configureActions",title:d("Configure actions"),icon:"SettingOutlined",items:[{name:"refresh",title:d("Refresh"),Component:function(e){return o().createElement(r.ActionInitializer,r_(rR({},e),{schema:{"x-component":"Action","x-use-component-props":"useChartRefreshActionProps","x-toolbar":"ActionSchemaToolbar","x-settings":"chartActionSettings:refresh","x-component-props":{size:"small",component:"RefreshButton"}}}))}}]}),or=function(e){var t=y().t;return o().createElement(r.SchemaSettingsSelectItem,{title:t("Auto refresh"),value:e.value,onChange:e.onChange,options:[{label:t("Off"),value:!1},{label:"5s",value:5},{label:"10s",value:10},{label:"30s",value:30},{label:"1m",value:60},{label:"5m",value:300},{label:"15m",value:900},{label:"30m",value:1800},{label:"1h",value:3600},{label:"2h",value:7200},{label:"1d",value:86400}]})};function on(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var oo=new r.SchemaSettings({name:"chartActionSettings:refresh",items:[{name:"refresh",Component:function(){var e,t=(0,c.useField)(),i=(0,c.useFieldSchema)(),a=(0,r.useDesignable)().dn,l=(0,n.useContext)(em).setAutoRefresh;return o().createElement(or,{value:(null===(e=t.componentProps)||void 0===e?void 0:e.autoRefresh)||!1,onChange:function(e){var r,n,o;l(e),t.componentProps=(n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){on(e,t,r[t])})}return e}({},t.componentProps),o=(o={autoRefresh:e},o),Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))}),n),i["x-component-props"]=t.componentProps,a.emit("patch",{schema:(on(r={},"x-uid",i["x-uid"]),on(r,"x-component-props",t.componentProps),r)}),a.refresh()}})}},{name:"divider",type:"divider"},{name:"delete",type:"remove",useComponentProps:function(){return{removeParentsIfNoChildren:!0,breakRemoveOn:function(e){return"Space"===e["x-component"]||e["x-component"].endsWith("ActionBar")},confirm:{title:(0,y().t)("Delete action")}}}}]}),oi=new r.SchemaInitializer({name:"chartBlock:configureActions",title:d("Configure actions"),icon:"SettingOutlined",items:[{name:"refresh",title:d("Refresh"),Component:function(e){return o().createElement(r.ActionInitializer,r7(r4({},e),{schema:{"x-component":"Action","x-use-component-props":"useChartBlockRefreshActionProps","x-toolbar":"ActionSchemaToolbar","x-settings":"chartBlockActionSettings:refresh","x-component-props":{component:"BlockRefreshButton"}}}))}}]});function oa(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ol=new r.SchemaSettings({name:"chartBlockActionSettings:refresh",items:[{name:"refresh",Component:function(){var e,t=(0,c.useField)(),i=(0,c.useFieldSchema)(),a=(0,r.useDesignable)().dn,l=(0,n.useContext)(ea).setAutoRefresh;return o().createElement(or,{value:(null===(e=t.decoratorProps)||void 0===e?void 0:e.autoRefresh)||!1,onChange:function(e){var r,n,o;l(e),t.decoratorProps=(n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){oa(e,t,r[t])})}return e}({},t.decoratorProps),o=(o={autoRefresh:e},o),Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))}),n),i["x-decorator-props"]=t.decoratorProps,a.emit("patch",{schema:(oa(r={},"x-uid",i["x-uid"]),oa(r,"x-decorator-props",t.decoratorProps),r)}),a.refresh()}})}},{name:"divider",type:"divider"},{name:"delete",type:"remove",useComponentProps:function(){return{removeParentsIfNoChildren:!0,breakRemoveOn:function(e){return"Space"===e["x-component"]||e["x-component"].endsWith("ActionBar")},confirm:{title:(0,y().t)("Delete action")}}}}]}),oc=(0,r.withDynamicSchemaProps)(function(e){var t=(0,r.useToken)().token;return o().createElement(r.CardItem,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,i;n=e,o=t,i=r[t],o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})}return e}({className:"nb-chart-block",name:"charts",bodyStyle:{padding:"".concat(t.paddingLG,"px ").concat(t.paddingLG,"px 0")}},e),e.children)},{displayName:"ChartCardItem"});function ou(e,t,r,n,o,i,a){try{var l=e[i](a),c=l.value}catch(e){r(e);return}l.done?t(c):Promise.resolve(c).then(n,o)}function os(e,t,r){return(os=oy()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&om(o,r.prototype),o}).apply(null,arguments)}function of(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function op(e){return(op=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function om(e,t){return(om=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function od(e){var t="function"==typeof Map?new Map:void 0;return(od=function(e){var r;if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return os(e,arguments,op(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),om(n,e)})(e)}function oy(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(oy=function(){return!!e})()}var ob=function(e){var t,r,n;function o(){var e,t,r,n,i,a,l;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),t=this,r=o,n=arguments,r=op(r),i=e=function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(t,oy()?Reflect.construct(r,n||[],op(t).constructor):r.apply(t,n)),a="charts",l=new D,a in i?Object.defineProperty(i,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[a]=l,e}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&om(e,t)}(o,e),t=o,r=[{key:"load",value:function(){var e,t=this;return(e=function(){var e;return function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(r){return t.charts.addGroup("antd",{title:"Ant Design",charts:nF}),t.charts.addGroup("ant-design-charts",{title:"Ant Design Charts",charts:oe}),t.app.addComponents({ChartV2BlockInitializer:r8,ChartV2BlockDesigner:rQ,ChartV2Block:rW,ChartCardItem:oc,ChartBlockProvider:nn}),t.app.addScopes({useChartBlockCardProps:r$,useChartRefreshActionProps:rN,useChartBlockRefreshActionProps:nr}),t.app.schemaInitializerManager.add(r3),t.app.schemaInitializerManager.add(r6),t.app.schemaInitializerManager.add(rt),t.app.schemaInitializerManager.add(rr),t.app.schemaInitializerManager.add(rp),t.app.schemaInitializerManager.add(rm),t.app.schemaInitializerManager.add(ot),t.app.schemaInitializerManager.add(oi),t.app.schemaSettingsManager.add(oo),t.app.schemaSettingsManager.add(ol),null==(e=t.app.schemaInitializerManager.get("page:addBlock"))||e.add("dataBlocks.chartV2",{title:d("Charts"),Component:"ChartV2BlockInitializer"}),t.app.schemaInitializerManager.addItem("mobile:addBlock","dataBlocks.chartV2",{title:d("Charts"),Component:"ChartV2BlockInitializer"}),t.app.schemaInitializerManager.addItem("popup:common:addBlock","dataBlocks.charts",{title:'{{t("Charts")}}',Component:"ChartV2BlockInitializer"}),[2]})},function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){ou(i,n,o,a,l,"next",e)}function l(e){ou(i,n,o,a,l,"throw",e)}a(void 0)})})()}}],of(t.prototype,r),o}(od(r.Plugin))}(),P}()});