/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

"use strict";(self.webpackChunk_nocobase_plugin_public_forms=self.webpackChunk_nocobase_plugin_public_forms||[]).push([["978"],{5223:function(e,t,n){n.r(t),n.d(t,{PageBackgroundColor:function(){return _},PublicFormPage:function(){return K},PublicFormMessageContext:function(){return R}});var r=n("4964"),o=n("3505"),a=n("3772"),i=n("2721"),u=n("8156"),l=n.n(u),c=n("3135"),s=n("5432"),f=n("4163"),p=n("6903"),d=function(){var e=(0,p.NY)().t;return l().createElement(a.BlockItemCard,{style:{boxShadow:"unset"}},l().createElement(i.Result,{status:"403",subTitle:e("The form is not enabled and cannot be accessed",{ns:p.A7})}))},m=function(){return(0,p.NY)().t,l().createElement(a.BlockItemCard,{style:{boxShadow:"unset"}},l().createElement(i.Result,{status:"404"}))},b=n("2992"),y=n("3238");function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function h(e){var t=e.toLowerCase();if(/\bss?\b/.test(t))return"second";if(/\bmm?\b/.test(t))return"minute";if(/\bhh?\b/.test(t))return"hour";else throw Error("Invalid time format")}var g=(0,o.connect)(function(e){var t,n,r,o,i=(0,y.useTranslation)().t,c=e.value,s=e.onChange,f=(e.dateFormat,e.timeFormat),p=void 0===f?"HH:mm":f,d=e.showTime,m=void 0!==d&&d,g=e.picker,w=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],!(t.indexOf(n)>=0)&&(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++){if(n=a[r],!(t.indexOf(n)>=0))Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}}return o}(e,["value","onChange","dateFormat","timeFormat","showTime","picker"]);var O=(t=(0,u.useState)(!1),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{!i&&null!=o.return&&o.return()}finally{if(u)throw r}}return a}}(t,2)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}}(t,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),S=O[0],k=O[1];console.log(h(p));var P=(0,u.useCallback)(function(e){k(!1),s(new Date(e))},[m,s]),C=(0,u.useCallback)(function(){k(!1),s(null)},[s]),E=(0,u.useCallback)(function(e,t){return t},[]);return l().createElement(l().Fragment,null,l().createElement("div",{contentEditable:"false",onClick:function(){return k(!0)}},l().createElement(a.DatePicker,(r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,a;r=e,o=t,a=n[t],o in r?Object.defineProperty(r,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[o]=a})}return e}({onClick:function(){return k(!0)},value:c,picker:g},w),o=(o={popupStyle:{display:"none"},style:{pointerEvents:"none",width:"100%"}},o),Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))}),r))),l().createElement(b.Mt,{cancelText:i("Cancel"),confirmText:i("Confirm"),visible:S,title:l().createElement("a",{onClick:C},i("Clear")),onClose:function(){k(!1)},precision:m?h(p):"date"===g?"day":g,renderLabel:E,min:new Date(1e3,0,1),max:new Date(9999,11,31),onConfirm:function(e){P(e)}}))},(0,o.mapProps)((0,a.mapDatePicker)()),(0,o.mapReadPretty)(a.DatePicker.ReadPretty));function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{!i&&null!=o.return&&o.return()}finally{if(u)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var S=(0,o.connect)(function(e){var t=e.value,n=e.onChange,r=e.options,o=void 0===r?[]:r,i=e.mode,c=(0,y.useTranslation)().t,s=O((0,u.useState)(!1),2),f=s[0],p=s[1],d=O((0,u.useState)(t||[]),2),m=d[0],v=d[1],h=O((0,u.useState)(null),2),g=h[0],w=h[1],S=(0,u.useMemo)(function(){return g?o.filter(function(e){return e.label.toLowerCase().includes(g.toLowerCase())}):o},[o,g]);return(0,u.useEffect)(function(){f||w(null)},[f]),l().createElement(l().Fragment,null,l().createElement("div",{contentEditable:"false",onClick:function(){return p(!0)}},l().createElement(a.Select,{placeholder:c("Select"),value:t,dropdownStyle:{display:"none"},multiple:"multiple"===i,onClear:function(){p(!1),n(null),v(null)},onFocus:function(e){return e.preventDefault()},style:{pointerEvents:"none"}})),l().createElement(b.GI,{visible:f,onMaskClick:function(){p(!1),(!t||(null==t?void 0:t.length)===0)&&v([])},destroyOnClose:!0},l().createElement("div",{style:{margin:"10px"}},l().createElement(b.E1,{placeholder:c("search"),value:g,onChange:function(e){return w(e)},showCancelButton:!0})),l().createElement("div",{style:{maxHeight:"60vh",overflowY:"auto"}},l().createElement(b.Su,{multiple:"multiple"===i,value:Array.isArray(m)?m:[m],onChange:function(e){"multiple"===i?v(e):(v(e[0]),n(e[0]),p(!1))}},S.map(function(e){return l().createElement(b.Su.Item,{key:e.value,value:e.value},e.label)}))),"multiple"===i&&l().createElement(b.zx,{block:!0,color:"primary",onClick:function(){n(m),p(!1)},style:{marginTop:"16px"}},c("Confirm"))))},(0,o.mapProps)({dataSource:"options"}));function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function P(e,t,n,r,o,a,i){try{var u=e[a](i),l=u.value}catch(e){n(e);return}u.done?t(l):Promise.resolve(l).then(r,o)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,a;r=e,o=t,a=n[t],o in r?Object.defineProperty(r,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[o]=a})}return e}function j(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{!i&&null!=o.return&&o.return()}finally{if(u)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(F=function(){return!!e})()}function T(){var e,t,n=(e=["\n              @media (min-width: 1025px) {\n                padding-top: 10vh;\n              }\n              padding-top: 0px;\n            "],!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}})));return T=function(){return n},n}var M=function(e){var t,n,r;function o(){var e,t,n;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),e=this,t=o,n=arguments,t=E(t),function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,F()?Reflect.construct(t,n||[],E(e).constructor):t.apply(e,n))}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(o,e),t=o,n=[{key:"getDataSource",value:function(){var e;return(e=function(){return function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}(this,function(e){return[2,{}]})},function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){P(a,r,o,i,u,"next",e)}function u(e){P(a,r,o,i,u,"throw",e)}i(void 0)})})()}}],C(t.prototype,n),o}(a.DataSource);function I(e){var t=e.dataSource,n=(0,a.useApp)(),r=D((0,u.useMemo)(function(){var e=new a.DataSourceManager({},n),r=e.addDataSource(M,t);return[e,new a.CollectionManager([],r)]},[n,t]),2),o=r[0],i=r[1];return l().createElement("div",null,l().createElement(a.DataSourceApplicationProvider,{dataSource:t.key,dataSourceManager:o,instance:i},e.children))}function B(e){var t=e.children,n=(0,a.useApp)(),r=(0,u.useMemo)(function(){var e=new a.APIClient(n.getOptions().apiClient);return e.app=n,e.axios.interceptors.request.use(function(e){return e.headers&&(e.headers["X-Form-Token"]=localStorage.getItem("NOCOBASE_FORM_TOKEN")||""),e}),e},[n]);return l().createElement(a.APIClientProvider,{apiClient:r},t)}var R=(0,u.createContext)({}),_="#f5f5f5",q=function(e){var t=e.children,n=D((0,u.useState)(!1),2),r=n[0],a=n[1],i=(0,o.useField)(),c=function(e,t){i.form.query(e).take(function(e){e&&(e.visible=t,e.hidden=!t)})};return(0,u.useEffect)(function(){c("success",r),c("form",!r),!r&&i.form.query("promptMessage").take(function(e){e&&(e.visible=!1,e.hidden=!0)})},[r]),l().createElement(R.Provider,{value:{showMessage:r,setShowMessage:a}},t)},N=function(e){return l().createElement(a.AssociationField,j(x({},e),{popupMatchSelectWidth:!0}))};N.SubTable=a.AssociationField.SubTable,N.Nester=a.AssociationField.Nester,N.AddNewer=a.Action.Container,N.Selector=a.Action.Container,N.Viewer=a.Action.Container,N.InternalSelect=a.AssociationField.InternalSelect,N.ReadPretty=a.AssociationField.ReadPretty,N.FileSelector=a.AssociationField.FileSelector;var V=function(e){return l().createElement(g,e)};V.FilterWithPicker=a.DatePicker.FilterWithPicker,V.RangePicker=a.DatePicker.RangePicker;var G={Button:b.zx,Select:function(e){return l().createElement(S,e)},DatePicker:V,UnixTimestamp:g,Modal:b.Vq,AssociationField:N};function z(){var e,t,n,o,p,b=(0,s.useParams)(),y=(0,a.useAPIClient)(),v=window.matchMedia("(max-width: 768px)").matches,h=(0,a.useRequest)({url:"publicForms:getMeta/".concat(b.name),skipAuth:!0},{onSuccess:function(e){var t;localStorage.setItem("NOCOBASE_FORM_TOKEN",null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.token),y.axios.interceptors.request.use(function(t){if(t.headers){var n;t.headers["X-Form-Token"]=(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.token)||""}return t})}}),g=h.error,w=h.data,O=h.loading,S=h.run,k=D((0,u.useState)(""),2),P=k[0],C=k[1],E=(0,u.useContext)(a.SchemaComponentContext);return((0,u.useEffect)(function(){if(!c.isDesktop){var e=document.querySelector('meta[name="viewport"]');!e&&((e=document.createElement("meta")).setAttribute("name","viewport"),document.head.appendChild(e)),e.setAttribute("content","width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"),document.body.style.backgroundColor=_,document.body.style.overflow="hidden";var t=document.createElement("div");document.body.appendChild(t),document.body.removeChild(t)}},[]),(null==g?void 0:null===(e=g.response)||void 0===e?void 0:e.status)===401||(null==w?void 0:null===(t=w.data)||void 0===t?void 0:t.passwordRequired))?l().createElement("div",null,l().createElement(i.Modal,{centered:!0,title:"Password",open:!0,cancelButtonProps:{hidden:!0},onOk:function(){S({password:P})}},l().createElement(i.Input.Password,{onChange:function(e){C(e.target.value)}}))):(null==g?void 0:null===(n=g.response)||void 0===n?void 0:n.status)===500?l().createElement(m,null):O?l().createElement(i.Spin,null):(null==w?void 0:w.data)?l().createElement(a.ACLCustomContext.Provider,{value:{allowAll:!0}},l().createElement(B,null,l().createElement("div",{style:{minHeight:"100vh",background:_,height:"100%",overflow:"auto"}},l().createElement("div",{style:{maxWidth:800,margin:"0 auto",position:"relative",zIndex:0},className:(0,r.css)(T())},l().createElement(I,{dataSource:null==w?void 0:null===(o=w.data)||void 0===o?void 0:o.dataSource},l().createElement(a.VariablesProvider,null,l().createElement(a.SchemaComponentContext.Provider,{value:j(x({},E),{designable:!1})},l().createElement(a.SchemaComponent,{schema:null==w?void 0:null===(p=w.data)||void 0===p?void 0:p.schema,scope:{useCreateActionProps:f.hG},components:x({PublicFormMessageProvider:q},v?G:{})})))),l().createElement("div",{style:{marginBottom:"20px"}},l().createElement(a.PoweredBy,null)))))):l().createElement(d,null)}function K(){return l().createElement(a.GlobalThemeProvider,{theme:{token:{marginBlock:18,borderRadiusBlock:0,boxShadowTertiary:"none",fontSize:14}}},l().createElement(z,null))}},4163:function(e,t,n){n.d(t,{j1:function(){return v},Dq:function(){return i},fC:function(){return c},hG:function(){return d}});var r=n("3772"),o=n("2721");function a(e,t,n,r,o,a,i){try{var u=e[a](i),l=u.value}catch(e){n(e);return}u.done?t(l):Promise.resolve(l).then(r,o)}function i(){var e=o.App.useApp().message,t=(0,r.useCollectionRecordData)(),n=(0,r.useDataBlockResource)(),i=(0,r.useBlockRequestContext)().service,u=(0,r.useCollection)();return{confirm:{title:"Delete",content:"Are you sure you want to delete it?"},onClick:function(){var r;return(r=function(){return function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}(this,function(r){switch(r.label){case 0:if(!u)throw Error("collection does not exist");return[4,n.destroy({filterByTk:t[u.filterTargetKey]})];case 1:return r.sent(),[4,i.refresh()];case 2:return r.sent(),e.success("Deleted!"),[2]}})},function(){var e=this,t=arguments;return new Promise(function(n,o){var i=r.apply(e,t);function u(e){a(i,n,o,u,l,"next",e)}function l(e){a(i,n,o,u,l,"throw",e)}u(void 0)})})()}}}var u=n("8563"),l=n("8156"),c=function(){var e=(0,r.useCollectionRecordData)();return{form:(0,l.useMemo)(function(){return(0,u.createForm)({initialValues:e})},[e])}},s=n("3505"),f=n("5223");function p(e,t,n,r,o,a,i){try{var u=e[a](i),l=u.value}catch(e){n(e);return}u.done?t(l):Promise.resolve(l).then(r,o)}var d=function(){var e=(0,s.useForm)(),t=(0,r.useDataBlockResource)(),n=(0,s.useField)(),o=(0,r.useCollectValuesToSubmit)(),a=(0,s.useFieldSchema)(),i=(0,r.useFormBlockContext)().updateAssociationValues,u=(0,l.useContext)(f.PublicFormMessageContext).setShowMessage;return{type:"primary",onClick:function(){var r;return(r=function(){var r,l,c,s,f,p;return function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}(this,function(p){switch(p.label){case 0:if(c=(l=null!==(r=null==a?void 0:a["x-action-settings"])&&void 0!==r?r:{}).skipValidator,s=l.triggerWorkflows,c)return[3,2];return[4,e.submit()];case 1:p.sent(),p.label=2;case 2:return[4,o()];case 3:f=p.sent(),n.data=n.data||{},n.data.loading=!0,p.label=4;case 4:return p.trys.push([4,8,,9]),[4,e.submit()];case 5:return p.sent(),[4,t.publicSubmit({values:f,triggerWorkflows:(null==s?void 0:s.length)?s.map(function(e){return[e.workflowKey,e.context].filter(Boolean).join("!")}).join(","):void 0,updateAssociationValues:i})];case 6:return p.sent(),[4,e.reset()];case 7:return p.sent(),n.data.loading=!1,u(!0),[3,9];case 8:return p.sent(),n.data.loading=!1,[3,9];case 9:return[2]}})},function(){var e=this,t=arguments;return new Promise(function(n,o){var a=r.apply(e,t);function i(e){p(a,n,o,i,u,"next",e)}function u(e){p(a,n,o,i,u,"throw",e)}i(void 0)})})()}}},m=n("8875"),b=n("7712");function y(e,t,n,r,o,a,i){try{var u=e[a](i),l=u.value}catch(e){n(e);return}u.done?t(l):Promise.resolve(l).then(r,o)}var v=function(){var e=(0,r.useActionContext)().setVisible,t=o.App.useApp().message,n=(0,s.useForm)(),a=(0,r.useDataBlockResource)(),i=(0,r.useCollection)(),u=(0,r.useAPIClient)(),l=(0,r.usePlugin)(b.default),c=(0,r.useBlockRequestContext)().service;return{type:"primary",onClick:function(){var r;return(r=function(){var r,o,s,f,p,d;return function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}(this,function(b){switch(b.label){case 0:return[4,n.submit()];case 1:if(b.sent(),!(r=n.values)[i.filterTargetKey])return[3,3];return[4,a.update({values:r,filterByTk:r[i.filterTargetKey]})];case 2:return b.sent(),[3,6];case 3:var y,v,h,g,w;return o=(0,m.uid)(),s=l.getFormSchemaByType(r.type),p=(f=r.collection.split(":")).pop(),y=0,v=s({collection:p,dataSource:f.pop()||"main"}),h=l.t.bind(l),(d={type:"void",name:(0,m.uid)(),"x-decorator":"PublicFormMessageProvider",properties:{form:v,promptMessage:{type:"void","x-component":"h3","x-component-props":{style:{margin:"10px 0px 10px"},children:'{{ t("Prompt after successful submission",{ns:"public-forms"})}}'}},success:{type:"void","x-editable":!1,"x-toolbar-props":{draggable:!1},"x-settings":"blockSettings:publicMarkdown","x-component":"Markdown.Void","x-decorator":"CardItem","x-component-props":{content:h("# Submitted successfully!\nThis is a demo text, **supports Markdown syntax**.")},"x-decorator-props":{name:"markdown",engine:"handlebars"}}}})["x-uid"]=o,[4,a.create({values:(g=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,a;r=e,o=t,a=n[t],o in r?Object.defineProperty(r,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[o]=a})}return e}({},r),w=null!=(w={key:o})?w:{},Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(w)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(w)).forEach(function(e){Object.defineProperty(g,e,Object.getOwnPropertyDescriptor(w,e))}),g)})];case 4:return b.sent(),[4,u.resource("uiSchemas").insert({values:d})];case 5:b.sent(),b.label=6;case 6:return n.reset(),[4,c.refresh()];case 7:return b.sent(),t.success("Saved successfully!"),e(!1),[2]}})},function(){var e=this,t=arguments;return new Promise(function(n,o){var a=r.apply(e,t);function i(e){y(a,n,o,i,u,"next",e)}function u(e){y(a,n,o,i,u,"throw",e)}i(void 0)})})()}}}}}]);