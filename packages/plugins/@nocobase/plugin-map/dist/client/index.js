/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@nocobase/client"),require("@ant-design/icons"),require("@formily/react"),require("react"),require("react-i18next"),require("@formily/antd-v5"),require("@formily/shared"),require("@emotion/css"),require("lodash"),require("ahooks"),require("antd")):"function"==typeof define&&define.amd?define("@nocobase/plugin-map",["@nocobase/client","@ant-design/icons","@formily/react","react","react-i18next","@formily/antd-v5","@formily/shared","@emotion/css","lodash","ahooks","antd"],t):"object"==typeof exports?exports["@nocobase/plugin-map"]=t(require("@nocobase/client"),require("@ant-design/icons"),require("@formily/react"),require("react"),require("react-i18next"),require("@formily/antd-v5"),require("@formily/shared"),require("@emotion/css"),require("lodash"),require("ahooks"),require("antd")):e["@nocobase/plugin-map"]=t(e["@nocobase/client"],e["@ant-design/icons"],e["@formily/react"],e.react,e["react-i18next"],e["@formily/antd-v5"],e["@formily/shared"],e["@emotion/css"],e.lodash,e.ahooks,e.antd)}(self,function(e,t,n,r,o,i,a,l,c,u,s){return function(){var p={49:function(e){"use strict";var t,n;t=0,n=function(){function e(e){var t=[];return e.AMapUI&&t.push(function(e){return new Promise(function(t,a){var l=[];if(e.plugins)for(var c=0;c<e.plugins.length;c+=1)-1==r.AMapUI.plugins.indexOf(e.plugins[c])&&l.push(e.plugins[c]);if(o.AMapUI===n.failed)a("前次请求 AMapUI 失败");else if(o.AMapUI===n.notload){o.AMapUI=n.loading,r.AMapUI.version=e.version||r.AMapUI.version,c=r.AMapUI.version;var u=document.body||document.head,s=document.createElement("script");s.type="text/javascript",s.src="https://webapi.amap.com/ui/"+c+"/main.js",s.onerror=function(e){o.AMapUI=n.failed,a("请求 AMapUI 失败")},s.onload=function(){if(o.AMapUI=n.loaded,l.length)window.AMapUI.loadUI(l,function(){for(var e=0,n=l.length;e<n;e++){var r=l[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}for(t();i.AMapUI.length;)i.AMapUI.splice(0,1)[0]()});else for(t();i.AMapUI.length;)i.AMapUI.splice(0,1)[0]()},u.appendChild(s)}else o.AMapUI===n.loaded?e.version&&e.version!==r.AMapUI.version?a("不允许多个版本 AMapUI 混用"):l.length?window.AMapUI.loadUI(l,function(){for(var e=0,n=l.length;e<n;e++){var r=l[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()}):t():e.version&&e.version!==r.AMapUI.version?a("不允许多个版本 AMapUI 混用"):i.AMapUI.push(function(e){e?a(e):l.length?window.AMapUI.loadUI(l,function(){for(var e=0,n=l.length;e<n;e++){var r=l[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()}):t()})})}(e.AMapUI)),e.Loca&&t.push(function(e){return new Promise(function(t,a){if(o.Loca===n.failed)a("前次请求 Loca 失败");else if(o.Loca===n.notload){o.Loca=n.loading,r.Loca.version=e.version||r.Loca.version;var l=r.Loca.version,c=r.AMap.version.startsWith("2"),u=l.startsWith("2");if(c&&!u||!c&&u)a("JSAPI 与 Loca 版本不对应！！");else{c=r.key,u=document.body||document.head;var s=document.createElement("script");s.type="text/javascript",s.src="https://webapi.amap.com/loca?v="+l+"&key="+c,s.onerror=function(e){o.Loca=n.failed,a("请求 AMapUI 失败")},s.onload=function(){for(o.Loca=n.loaded,t();i.Loca.length;)i.Loca.splice(0,1)[0]()},u.appendChild(s)}}else o.Loca===n.loaded?e.version&&e.version!==r.Loca.version?a("不允许多个版本 Loca 混用"):t():e.version&&e.version!==r.Loca.version?a("不允许多个版本 Loca 混用"):i.Loca.push(function(e){e?a(e):a()})})}(e.Loca)),Promise.all(t)}if(!window)throw Error("AMap JSAPI can only be used in Browser.");(t=n||(n={})).notload="notload",t.loading="loading",t.loaded="loaded",t.failed="failed";var t,n,r={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},o={AMap:n.notload,AMapUI:n.notload,Loca:n.notload},i={AMap:[],AMapUI:[],Loca:[]},a=[],l=function(e){"function"==typeof e&&(o.AMap===n.loaded?e(window.AMap):a.push(e))};return{load:function(t){return new Promise(function(i,c){if(o.AMap==n.failed)c("");else if(o.AMap==n.notload){var u=t.key,s=t.version,p=t.plugins;u?(window.AMap&&"lbs.amap.com"!==location.host&&c("禁止多种API加载方式混用"),r.key=u,r.AMap.version=s||r.AMap.version,r.AMap.plugins=p||r.AMap.plugins,o.AMap=n.loading,s=document.body||document.head,window.___onAPILoaded=function(r){if(delete window.___onAPILoaded,r)o.AMap=n.failed,c(r);else for(o.AMap=n.loaded,e(t).then(function(){i(window.AMap)}).catch(c);a.length;)a.splice(0,1)[0]()},(p=document.createElement("script")).type="text/javascript",p.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+r.AMap.version+"&key="+u+"&plugin="+r.AMap.plugins.join(","),p.onerror=function(e){o.AMap=n.failed,c(e)},s.appendChild(p)):c("请填写key")}else if(o.AMap==n.loaded){if(t.key&&t.key!==r.key)c("多个不一致的 key");else if(t.version&&t.version!==r.AMap.version)c("不允许多个版本 JSAPI 混用");else{if(u=[],t.plugins)for(s=0;s<t.plugins.length;s+=1)-1==r.AMap.plugins.indexOf(t.plugins[s])&&u.push(t.plugins[s]);u.length?window.AMap.plugin(u,function(){e(t).then(function(){i(window.AMap)}).catch(c)}):e(t).then(function(){i(window.AMap)}).catch(c)}}else if(t.key&&t.key!==r.key)c("多个不一致的 key");else if(t.version&&t.version!==r.AMap.version)c("不允许多个版本 JSAPI 混用");else{var f=[];if(t.plugins)for(s=0;s<t.plugins.length;s+=1)-1==r.AMap.plugins.indexOf(t.plugins[s])&&f.push(t.plugins[s]);l(function(){f.length?window.AMap.plugin(f,function(){e(t).then(function(){i(window.AMap)}).catch(c)}):e(t).then(function(){i(window.AMap)}).catch(c)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,r={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},o={AMap:n.notload,AMapUI:n.notload,Loca:n.notload},i={AMap:[],AMapUI:[],Loca:[]}}}},e.exports=n()},603:function(e){e.exports={}},482:function(e){"use strict";e.exports=t},964:function(e){"use strict";e.exports=l},632:function(e){"use strict";e.exports=i},505:function(e){"use strict";e.exports=n},875:function(e){"use strict";e.exports=a},772:function(t){"use strict";t.exports=e},749:function(e){"use strict";e.exports=u},721:function(e){"use strict";e.exports=s},467:function(e){"use strict";e.exports=c},156:function(e){"use strict";e.exports=r},238:function(e){"use strict";e.exports=o}},f={};function d(e){var t=f[e];if(void 0!==t)return t.exports;var n=f[e]={exports:{}};return p[e].call(n.exports,n,n.exports,d),n.exports}d.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return d.d(t,{a:t}),t},d.d=function(e,t){for(var n in t)d.o(t,n)&&!d.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},d.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},d.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var m={};return!function(){"use strict";d.r(m),d.d(m,{PluginMapClient:function(){return tX},default:function(){return tH}});var e,t,n=d("772"),r=d("156"),o=d.n(r),i=d("467"),a=d.n(i),l=d("482"),c=d("749"),u=d("721"),s=d("238");function p(e){return"{{t('".concat(e,"', { ns: '").concat("map","', nsMode: 'fallback' })}}")}function f(){return(0,s.useTranslation)(["map","client"],{nsMode:"fallback"})}var y=[{label:p("AMap"),value:"amap"},{label:p("Google Maps"),value:"google"}],v="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAA/CAMAAAC7OkrPAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAEJQTFRFAAAA8Yti8Yti8Itj8Iti74tj8Itj8YtiKwADKwADKhw5Kh07KwADKwADKwADKwAD4odn1YBlKwADKwADKwADKwAD/5y7LQAAABZ0Uk5TAP/8/f/B/PYOHjY3CCozLP3XCSkvMhA05K4AAAC4SURBVHic7dXLDoIwEIXhwSsoLSrw/q8qbSAiMy3/oivj2czmS5omnVORdapVJJFKBSEL2mrrUurbpdXa5dTH5dXi9tTsGNtX0TFG1OT+7PdY2YdEGd0FuFmUwXWm5UAZbCTKYA3SUrXZQTHLHbUy2OlsMO0ultLsajLlbEWZMEUZ+ig5E6YKM2GqMBOmGKubW1D3ps6g1nnvA5uGa5Os85E9nmF2ebYkzeKhc9wre4V+GMeh317hDfXgCWigIGJbAAAAAElFTkSuQmCC",g="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAA/CAYAAACM5Lr9AAAFkklEQVR42s3VaWxUVRjG8ddiEKPRxAQTCVSWLnZaWmjpTgulpYUBExP9Agou4IKAogUKAgItlNJCgUIXINFPfsFoDCjibkQRI0QIICAQWUpZugKtpcv0+DxyYqaTe2/vTLf58Etu7znnPf+0k44opQw5i5qsjIFs2APHoBZatFq+02vZeq94yyKs0dOjsAzOTCtuVtNKWtX0UpeaXqHU07tgt4ZnvuMa93Avz/CsniE2WIQV3iEaCDnQ8F/MTgZ4h2d4ljNgmZ4pFszDpmIRIuFP57YWDMcFu7uHMziLMyEKxJBl2MbbM6DZub2NQ3sUZ3K2vkMMGIdNKbi1ADqcZe1q2i7VKzibd8BCEE8GUQ3PQ4ez3KWcGNCbeAfv0neKm85hWRvqo+Hu1LJ2HuwTvAt3tkAciKbDIDO/7iE4l7X9rpqCA30pa3uLwt3nYRAIuIfV5mcWN6msnapf8G405IGQMGry+prB0DiloqPfwng3G3SLDltXnTt5S6PK3NnRr9jAFhDJyLsZAJcz8SGcjOr+xAa0XGGTpOfeSMrYUKcyKlx+gS1oSkbY9VXpm2+rjHKXX2ALm2TS2qq96duaVHp5u19gC5skbc3V05N23FWT8NIfsIVNkra6siGttE2llbX7h9JWhaZ6mfj+lfaJZW3Kn6DJJRNWXWqbgN+Y39jRqtDUKKkrL15PxfdjammrfyhpVmiqlNQVfx9KwX/cFJT6A7awSVLeu1CeUlinxu9o8QsphbUKTWUyfvn5Wcm511QSXvoDtrBJkpedewzaE/E58wdsYZMopSQ55+z+pKK6fo9KKqpXaDkAIgxLWnomK3H1JZVQ0tyv2ICW6XAvLHHJ6QD4K6GgRsVjQ3/g3WzQLffCKGHJqfHgisOXaNy2f/oU7+TdukGIUW5xJ0vic6+oWGzsS7yTd4NoncPiF594GC7FFlSrcVub+gTv4p36btE6h1Fc9nFn7IpzKmZrY5/gXbwTxI0O8xD77rGPYtZeVtE42Jt4B+8C8WAcNu6dPwZDzVh8PYzdcqdXcDbvgMdBPDHEOG7R0Xkxqy6oKAzpDZzNO0AMmIfFvH1kABwZk1epIotv9yjOxOyj+g4xYB4W/dbvlAAdozGsJ3Gmni0mzMPGLvyN6IMo/NojNt/qEZyFmR+CWLAIW3CYaDDUR+D/TTgGdwdncJaeKRbMw8bM/9XdosjlZ5VjU0O3cAZngXTBPCzqzV/cPQAXHeuqVBgu8IVj/TXFGXqWdME8LHLez55mRSw9qUI31fuEZzFjNogNFmFvHPQUACfC8IUbUlTvlbDcSsWzeobYYB42+vWfjDwbnn3c6zCewdnnQGwyD4t47UcjAXA2JO+qCi6ss4V7eUafFZuswn4wM8ex+LgKwqV2cC/OzAXxgnlY+KvfmxkIVaPyr6tRhbWWuId79RnxgnmYY+53VlaHLj2lRm6stRSSc0ph7xoQL1mEzfnWyhPQNrKgGgE1hrjGPTAExEvmYWGvfNOVPUErz6vhiDDCNez5GMQHVmFfd2Vq6MLD6smCGkNc4x4QH5iHPfXyV125H64NX1eFkOpO+I5reo/4wDws9KUDdhSPxFdNIGLc8R3XQHxkFfalHYnB8w6qYRuqO+E7roH4yDws5MX9dtwHlYF5lQi6qYjPfKfXxEcWYbO/sKtsBP50QxFFI/D/De8qQLrBPCwYizY9M2r+of/D+Mx3ID6zDJv1uaVwGfAIBDqGJsbhZ9eQ/BuK+OwYlhzPNe7hXh9Yhe0zwqBB4IAYouCZn1wIXH5GEZ/d1sjBMzzrBfOwoBf2GWFYBMS4C03JWRA087OaoBmf3uCz5zrP8Kx9lmF7jXiE2RbBs95ghB0MIo8/pS0OeJAzvOBLmKY//BAGURBN+jmMa3qPkLdh/wKOL8SpLbnYFgAAAABJRU5ErkJggg==",b=function(e,t,n){var r=null==t?void 0:t.reduce(function(e,r,o){return o===t.length-1&&("o2m"===n||"m2m"===n)?null==e?void 0:e.map(function(e){return e[r]}).filter(function(e){return null!=e}):null==e?void 0:e[r]},e);return"o2m"===n||"m2m"===n?r:[r]},h=d("505"),O=function(e){var t=(0,n.useCollectionRecordData)(),i=(0,n.useCollection)(),a=(0,h.useFieldSchema)(),l=(0,r.useMemo)(function(){return a.reduceProperties(function(e,t){return"drawer"===t.name?t:e},null)},[a]);return l?o().createElement(n.VariablePopupRecordProvider,{recordData:t,collection:i},o().createElement(n.NocoBaseRecursionField,{schema:l,name:l.name})):null},w=d("49"),S=d.n(w);d("603");var P="map-configuration",A=function(e){return"NOCOBASE_PLUGIN_MAP_CONFIGURATION_".concat(e)},j=function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],o=(0,r.useMemo)(function(){var t=sessionStorage.getItem(A(e));return t?JSON.parse(t):t},[e]),i=(0,n.useRequest)({resource:P,action:"get",params:{isRaw:!t,type:e}},{onSuccess:function(n){if(!!t)sessionStorage.setItem(A(e),JSON.stringify(null==n?void 0:n.data))},refreshOnWindowFocus:!1,refreshDeps:[],manual:!!o&&!!t}).data;return o&&t?o:null==i?void 0:i.data},x=function(){var e,t,r=(0,n.useDataBlockHeight)(),o=u.theme.useToken().token,i=(0,n.useDesignable)().designable,a=((0,n.useBlockHeightProps)()||{}).heightProps||{},l=a.title,c=a.titleHeight,s=(0,h.useFieldSchema)();if(!!r){var p=Object.keys((null===(t=s.parent)||void 0===t?void 0:null===(e=t.properties.actions)||void 0===e?void 0:e.properties)||{}).length>0,f=i||p?o.paddingLG+o.controlHeight+o.margin:o.paddingLG+o.margin,d=o.paddingLG;return r-f-d-(l?c:0)}};function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function E(){var e,t,n=(e=["\n        position: absolute;\n        top: 10px;\n        left: 10px;\n        z-index: 10;\n        width: calc(100% - 20px);\n      "],!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}})));return E=function(){return n},n}var M=function(e){var t,i,a=e.aMap,l=e.toCenter,s=f().t,p=(0,r.useRef)();var d=(t=(0,r.useState)([]),i=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw r}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}}(t,i)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),m=d[0],y=d[1];(0,r.useEffect)(function(){null==a||a.plugin("AMap.PlaceSearch",function(){p.current=new a.PlaceSearch({city:"全国",pageSize:30})})},[a]);var v=(0,c.useDebounceFn)(function(e){if(!!p.current)p.current.search(e||" ",function(e,t){if("complete"===e)y(t.poiList.pois.map(function(e){var t,n;return t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({},e),n=(n={label:"".concat(e.name,"-").concat(e.address),value:e.id},n),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t}));else{if("no_data"===e){y([]);return}u.message.error(s("Please configure the AMap securityCode or securityHost correctly"))}})},{wait:300}).run;return o().createElement("div",{className:(0,n.css)(E())},o().createElement(u.Select,{showSearch:!0,allowClear:!0,style:{background:"rgba(255, 255, 255, 0.8)"},placeholder:s("Enter keywords to search"),filterOption:!1,onSearch:v,onSelect:function(e){var t=m.find(function(t){return t.value===e});(null==t?void 0:t.location)&&l(t.location)},options:m,popupMatchSelectWidth:!1}))};function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){I(e,t,n[t])})}return e}function D(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){return!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function L(){var e=z(["\n        position: relative;\n        height: ","px !important;\n      "]);return L=function(){return e},e}function R(){var e=z(["\n            position: absolute;\n            inset: 0;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n          "]);return R=function(){return e},e}function B(){var e=z(["\n              position: absolute;\n              bottom: 80px;\n              right: 20px;\n              z-index: 10;\n            "]);return B=function(){return e},e}function N(){var e=z(["\n                position: absolute;\n                bottom: 20px;\n                left: 10px;\n                z-index: 2;\n                pointer-events: none;\n              "]);return N=function(){return e},e}function _(){var e=z(["\n              position: absolute;\n              bottom: 20px;\n              right: 20px;\n              z-index: 2;\n            "]);return _=function(){return e},e}var U={point:{mouseTool:"marker",propertyKey:"position",overlay:"Marker"},polygon:{mouseTool:"polygon",editor:"PolygonEditor",propertyKey:"path",overlay:"Polygon"},lineString:{mouseTool:"polyline",editor:"PolylineEditor",propertyKey:"path",overlay:"Polyline"},circle:{mouseTool:"circle",editor:"CircleEditor",transformOptions:function(e){return{center:e.slice(0,2),radius:e[2]}},overlay:"Circle"}},K=o().forwardRef(function(e,t){var i=j(e.mapType)||{},a=i.accessKey,s=i.securityJsCode,p=e.value,d=e.onChange,m=e.block,y=void 0!==m&&m,v=e.readonly,g=e.disabled,b=void 0===g?y:g,O=e.zoom,w=void 0===O?13:O,P=e.overlayCommonOptions,A=f().t,C=(0,h.useFieldSchema)(),E=(0,r.useRef)(),k=(0,r.useRef)(),z=(0,r.useRef)(),K=T((0,r.useState)([]),2),G=K[0],q=K[1],V=T((0,r.useState)(""),2),W=V[0],Y=V[1],J=(0,n.useCollection_deprecated)().getField,Z=(0,r.useMemo)(function(){if(e.type)return e.type;var t=J(null==C?void 0:C.name);return null==t?void 0:t.interface},[null==e?void 0:e.type,null==C?void 0:C.name]),X=(0,r.useRef)(),H=(0,r.useRef)(null),Q=(0,n.useNavigateNoUpdate)(),$=(0,r.useRef)("nocobase-map-".concat(Z||"","-").concat(Date.now().toString(32))),ee=u.App.useApp().modal,et=x(),en=T((0,r.useState)(F({strokeWeight:5,strokeColor:"#4e9bff",fillColor:"#4e9bff",strokeOpacity:1},P)),1)[0];(0,r.useEffect)(function(){k.current&&k.current.setZoom(w)},[w]);var er=(0,c.useMemoizedFn)(function(){X.current&&X.current.remove()}),eo=(0,c.useMemoizedFn)(function(){(!b||y)&&"point"!==Z&&H.current&&(H.current.setTarget(X.current),H.current.open())}),ei=(0,c.useMemoizedFn)(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null;if("point"===Z){var r=e.getPosition(),o=r.lat;n=[r.lng,o]}else if("polygon"===Z||"lineString"===Z){if((n=e.getPath().map(function(e){return[e.lng,e.lat]})).length<2)return}else if("circle"===Z){var i=e.getCenter(),a=e.getRadius();n=[i.lng,i.lat,a]}!t&&(er(),X.current=e,eo()),null==d||d(n)}),ea=(0,c.useMemoizedFn)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,t=U[e];if(t&&"editor"in t&&!H.current)return H.current=new E.current[t.editor](k.current,null,{createOptions:en,editOptions:en,controlPoint:D(F({},en),{strokeWeight:3}),midControlPoint:D(F({},en),{strokeWeight:2,fillColor:"#fff"})}),H.current.on("adjust",function(e){ei(e.target,!0)}),H.current.on("move",function(e){ei(e.target,!0)}),H.current}),el=(0,c.useMemoizedFn)(function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z;if(!(!z.current||(null===(e=H.current)||void 0===e?void 0:e.getTarget()))){var n=U[t];if(!n)return;z.current[n.mouseTool](F({},en))}}),ec=(0,c.useMemoizedFn)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z;!z.current&&(z.current=new E.current.MouseTool(k.current),z.current.on("draw",function(e){ei(e.obj)}),el(e))}),eu=(0,r.useCallback)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p,n=arguments.length>2?arguments[2]:void 0,r=U[e];if(!!r){var o=F({},en,n);return"transformOptions"in r?Object.assign(o,r.transformOptions(t)):"propertyKey"in r&&(o[r.propertyKey]=t),new E.current[r.overlay](o)}},[en]),es=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p,n=arguments.length>2?arguments[2]:void 0;if(E.current){var r=eu(e,t,n);return r.setMap(k.current),r}};(0,r.useEffect)(function(){if(E.current){if(!!p&&(!!v||!X.current)){var e=es();k.current.setFitView([e]),X.current=e,!b&&(ea(),eo())}}},[p,G,Z,en,b,v]),(0,r.useEffect)(function(){var e,t,n;z.current&&(b?(null===(e=z.current)||void 0===e||e.close(),null===(t=H.current)||void 0===t||t.close()):(el(),null===(n=H.current)||void 0===n||n.open()))},[b]),(0,r.useEffect)(function(){E.current&&Z&&!b&&(ec(),ea())},[b,G,Z]),(0,r.useEffect)(function(){if(!p&&(z.current||H.current)&&(er(),H.current&&(H.current.setTarget(),H.current.close()),null==d||d(null)),z.current&&H.current){var e,t;H.current.getTarget()?null===(e=(t=z.current).close)||void 0===e||e.call(t):el()}},[Z,p]),(0,r.useEffect)(function(){if(a&&!k.current){s&&(window._AMapSecurityConfig=I({},s.endsWith("_AMapService")?"serviceHOST":"securityJsCode",s));var e=window.define;if(window.define=void 0,window.AMap)try{requestIdleCallback(function(){k.current=new AMap.Map($.current,{resizeEnable:!0,zoom:w}),E.current=AMap,Y(""),q([])});return}catch(e){Y(e)}return S().load({key:a,version:"2.0",plugins:["AMap.MouseTool","AMap.PolygonEditor","AMap.PolylineEditor","AMap.CircleEditor"]}).then(function(t){return window.define=e,requestIdleCallback(function(){k.current=new t.Map($.current,{resizeEnable:!0,zoom:w}),E.current=t,Y(""),q([])})}).catch(function(e){"string"==typeof e?e.includes("多个不一致的 key")?Y(A("The AccessKey is incorrect, please check it")):Y(e):(null==e?void 0:e.type)==="error"&&Y("Something went wrong, please refresh the page and try again")}),function(){var e;null===(e=k.current)||void 0===e||e.destroy(),E.current=null,k.current=null,z.current=null,H.current=null,S().reset()}}},[a,Z,s]),(0,r.useImperativeHandle)(t,function(){return{setOverlay:es,getOverlay:eu,createMouseTool:ec,createEditor:ea,executeMouseTool:el,aMap:E.current,map:k.current,overlay:X.current,mouseTool:function(){return z.current},editor:function(){return H.current},errMessage:W}});var ep=(0,n.useApp)();return!a||W?o().createElement(u.Alert,{action:o().createElement(u.Button,{type:"primary",onClick:function(){return Q(ep.pluginSettingsManager.getRoutePath("map"))}},A("Go to the configuration page")),message:W||A("Please configure the AccessKey and SecurityJsCode first"),type:"error"}):o().createElement("div",{className:(0,n.css)(L(),et||500),id:$.current,style:null==e?void 0:e.style},!E.current&&o().createElement("div",{className:(0,n.css)(R())},o().createElement(u.Spin,null)),b?null:o().createElement(o().Fragment,null,o().createElement(M,{toCenter:function(e,t){k.current&&k.current.setZoomAndCenter(18,e,t)},aMap:E.current}),o().createElement("div",{className:(0,n.css)(B())},o().createElement(u.Button,{onClick:function(){X.current&&k.current.setFitView([X.current])},disabled:!X.current,type:"primary",shape:"round",size:"large",icon:o().createElement(l.SyncOutlined,null)})),"point"!==Z?o().createElement("div",{className:(0,n.css)(N())},o().createElement(u.Alert,{message:A("Click to select the starting point and double-click to end the drawing"),type:"info"})):null,o().createElement("div",{className:(0,n.css)(_())},o().createElement(u.Button,{disabled:!p,style:{height:"40px"},onClick:function(){var e=function(){er(),H.current&&(H.current.setTarget(),H.current.close()),null==d||d(null)};ee.confirm({title:A("Clear the canvas"),content:A("Are you sure to clear the canvas?"),okText:A("Confirm"),cancelText:A("Cancel"),getContainer:function(){return document.getElementById($.current)},onOk:function(){e()}})},type:"primary",danger:!0},A("Clear")))))});function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}K.displayName="AMapComponent";function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw r}}return i}}(e,t)||J(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,t){return!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function Y(e){return function(e){if(Array.isArray(e))return G(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||J(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){if(e){if("string"==typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return G(e,t)}}function Z(){var e=W(["\n        position: relative;\n        height: 100%;\n      "]);return Z=function(){return e},e}function X(){var e=W(["\n          position: absolute;\n          left: 10px;\n          top: 10px;\n          z-index: 999;\n        "]);return X=function(){return e},e}function H(e){e.dom?e.dom.style.filter="none":e.setOptions&&e.setOptions({strokeColor:"#4e9bff",fillColor:"#4e9bff"})}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}function ee(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}var et=function(e){var t,i,a=e.type,l=e.children,c=f().t,s=(0,n.useAPIClient)();var p=(t=u.Form.useForm(),i=1,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw r}}return i}}(t,1)||function(e,t){if(e){if("string"==typeof e)return Q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Q(e,t)}}(t,i)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],d=j(a,!1);(0,r.useEffect)(function(){d&&p.setFieldsValue(d)},[d]);var m=(0,r.useMemo)(function(){return s.resource(P)},[s]);return o().createElement(u.Form,{form:p,layout:"vertical",onFinish:function(e){m.set(ee($({},e),{type:a})).then(function(e){sessionStorage.removeItem(A(a)),u.message.success(c("Saved successfully"))}).catch(function(e){u.message.success(c("Saved failed"))})}},l,o().createElement(u.Form.Item,null,o().createElement(u.Button,{disabled:!1,type:"primary",htmlType:"submit"},c("Submit"))))},en={amap:function(){var e=f().t;return o().createElement(et,{type:"amap"},o().createElement(u.Form.Item,{required:!0,name:"accessKey",label:e("Access key")},o().createElement(n.TextAreaWithGlobalScope,null)),o().createElement(u.Form.Item,{required:!0,name:"securityJsCode",label:e("securityJsCode or serviceHost")},o().createElement(n.TextAreaWithGlobalScope,null)))},google:function(){var e=f().t;return o().createElement(et,{type:"google"},o().createElement(u.Form.Item,{required:!0,name:"accessKey",label:e("Api key")},o().createElement(n.TextAreaWithGlobalScope,null)))}},er=y.map(function(e){return ee($({},e),{component:en[e.value]})}),eo=function(){var e=(0,n.useCompile)(),t=new URLSearchParams((0,n.useLocationSearch)());return o().createElement(u.Card,{bordered:!0},o().createElement(u.Tabs,{type:"card",defaultActiveKey:t.get("tab")},er.map(function(t){return o().createElement(u.Tabs.TabPane,{key:t.value,tab:e(t.label)},o().createElement(t.component,{type:t.value}))})))},ei=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(o=r;0!=o--;)if(!e(t[o],n[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(i=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(o=r;0!=o--;)if(!Object.prototype.hasOwnProperty.call(n,i[o]))return!1;for(o=r;0!=o--;){var r,o,i,a=i[o];if(!e(t[a],n[a]))return!1}return!0}return t!=t&&n!=n};let ea="__googleMapsScriptId";(e=t||(t={}))[e.INITIALIZED=0]="INITIALIZED",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.FAILURE=3]="FAILURE";class el{constructor({apiKey:e,authReferrerPolicy:t,channel:n,client:r,id:o=ea,language:i,libraries:a=[],mapIds:l,nonce:c,region:u,retries:s=3,url:p="https://maps.googleapis.com/maps/api/js",version:f}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=t,this.channel=n,this.client=r,this.id=o||ea,this.language=i,this.libraries=a,this.mapIds=l,this.nonce=c,this.region=u,this.retries=s,this.url=p,this.version=f,el.instance){if(!ei(this.options,el.instance.options))throw Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(el.instance.options)}`);return el.instance}el.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?t.FAILURE:this.done?t.SUCCESS:this.loading?t.LOADING:t.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){let e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,t)=>{this.loadCallback(n=>{n?t(n.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,t;if(document.getElementById(this.id)){this.callback();return}let n={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(n).forEach(e=>!n[e]&&delete n[e]),!(null===(t=null===(e=null==window?void 0:window.google)||void 0===e?void 0:e.maps)||void 0===t?void 0:t.importLibrary)&&(e=>{let t,n,r,o="The Google Maps JavaScript API",i="google",a="importLibrary",l="__ib__",c=document,u=window,s=(u=u[i]||(u[i]={})).maps||(u.maps={}),p=new Set,f=new URLSearchParams,d=()=>t||(t=new Promise((a,u)=>{var d,m,y,v;return d=this,m=void 0,y=void 0,v=function*(){var d;for(r in yield n=c.createElement("script"),n.id=this.id,f.set("libraries",[...p]+""),e)f.set(r.replace(/[A-Z]/g,e=>"_"+e[0].toLowerCase()),e[r]);f.set("callback",i+".maps."+l),n.src=this.url+"?"+f,s[l]=a,n.onerror=()=>t=u(Error(o+" could not load.")),n.nonce=this.nonce||(null===(d=c.querySelector("script[nonce]"))||void 0===d?void 0:d.nonce)||"",c.head.append(n)},new(y||(y=Promise))(function(e,t){function n(e){try{o(v.next(e))}catch(e){t(e)}}function r(e){try{o(v.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):((o=t.value)instanceof y?o:new y(function(e){e(o)})).then(n,r)}o((v=v.apply(d,m||[])).next())})}));s[a]?console.warn(o+" only loads once. Ignoring:",e):s[a]=(e,...t)=>p.add(e)&&d().then(()=>s[a](e,...t))})(n);let r=this.libraries.map(e=>this.importLibrary(e));!r.length&&r.push(this.importLibrary("core")),Promise.all(r).then(()=>this.callback(),e=>{let t=new ErrorEvent("error",{error:e});this.loadErrorCallback(t)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){let e=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${e} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},e)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader.This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading||(this.loading=!0,this.setScript())}}}function ec(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eu(){var e,t,n=(e=["\n        position: absolute;\n        top: 10px;\n        left: 10px;\n        z-index: 10;\n        width: calc(100% - 20px);\n      "],!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}})));return eu=function(){return n},n}var es=function(e){var t,i,a=e.toCenter,l=e.mapRef,s=f().t,p=(0,r.useRef)();var d=(t=(0,r.useState)([]),i=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw r}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return ec(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ec(e,t)}}(t,i)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),m=d[0],y=d[1];(0,r.useEffect)(function(){google.maps.importLibrary("places").then(function(e){p.current=new e.AutocompleteService}).catch(function(){u.message.error("Please configure the Google API Key correctly")})},[l]);var v=(0,c.useDebounceFn)(function(e){if(!!p.current)p.current.getPlacePredictions({input:e||" "},function(e,t){if(t===google.maps.places.PlacesServiceStatus.OK)y(e.map(function(e){var t,n,r=e.structured_formatting;return t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({},e),n=(n={label:"".concat(r.main_text).concat(r.secondary_text?" "+r.secondary_text:""),value:e.place_id},n),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t}));else{y([]);return}})},{wait:300}).run;return o().createElement("div",{className:(0,n.css)(eu())},o().createElement(u.Select,{id:"google-map-search",showSearch:!0,allowClear:!0,style:{background:"rgba(255, 255, 255, 0.8)"},placeholder:s("Enter keywords to search"),filterOption:!1,onSearch:v,onSelect:function(e){var t=m.find(function(t){return t.value===e});new google.maps.places.PlacesService(l.current).getDetails({placeId:t.place_id,fields:["geometry"]},function(e,t){t===google.maps.places.PlacesServiceStatus.OK&&a(e.geometry.location)})},options:m}))},ep=function(e){return{url:e,scaledSize:{width:19,height:32},labelOrigin:new google.maps.Point(9.5,42)}};function ef(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ed(e,t,n,r,o,i,a){try{var l=e[i](a),c=l.value}catch(e){n(e);return}l.done?t(c):Promise.resolve(c).then(r,o)}function em(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function ey(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}function ev(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function eg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw r}}return i}}(e,t)||eh(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eb(e,t){return!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function eh(e,t){if(e){if("string"==typeof e)return ef(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ef(e,t)}}function eO(){var e=eb(["\n          position: relative;\n          height: ","px !important;\n        "]);return eO=function(){return e},e}function ew(){var e=eb(["\n              position: absolute;\n              inset: 0;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n            "]);return ew=function(){return e},e}function eS(){var e=eb(["\n                position: absolute;\n                bottom: 80px;\n                right: 20px;\n                z-index: 10;\n              "]);return eS=function(){return e},e}function eP(){var e=eb(["\n                  position: absolute;\n                  bottom: 20px;\n                  left: 10px;\n                  z-index: 2;\n                  pointer-events: none;\n                "]);return eP=function(){return e},e}function eA(){var e=eb(["\n                position: absolute;\n                bottom: 20px;\n                right: 20px;\n                z-index: 2;\n              "]);return eA=function(){return e},e}function ej(){var e=eb(["\n            width: 100%;\n            height: 100%;\n          "]);return ej=function(){return e},e}var ex={point:{propertyKey:"position",overlay:"Marker"},polygon:{propertyKey:"paths",overlay:"Polygon"},lineString:{propertyKey:"path",overlay:"Polyline"},circle:{transformOptions:function(e){return{center:new google.maps.LatLng(e[1],e[0]),radius:e[2]}},overlay:"Circle"}},eC=o().forwardRef(function(e,t){var i,a=e.value,s=e.onChange,p=e.block,d=e.readonly,m=e.disabled,y=void 0===m?void 0!==p&&p:m,v=e.zoom,b=void 0===v?13:v,O=e.overlayCommonOptions,w=(j(e.mapType)||{}).accessKey,S=f().t,P=(0,n.useCollection_deprecated)().getField,A=(0,h.useFieldSchema)(),C=(0,r.useRef)(),E=(0,r.useRef)(),M=(0,r.useRef)(),k=eg((0,r.useState)([]),2),I=k[0],F=k[1],D=eg((0,r.useState)(""),2),T=D[0],z=D[1],L=(0,n.useAPIClient)(),R=u.App.useApp().modal,B=x();(0,r.useEffect)(function(){E.current&&E.current.setZoom(b)},[b]);var N=(0,r.useMemo)(function(){if(e.type)return e.type;var t=P(null==A?void 0:A.name);return null==t?void 0:t.interface},[null==e?void 0:e.type,null==A?void 0:A.name]);var _=(0,r.useRef)("point"===(i=N)?"marker":"lineString"===i?"polyline":i),U=eg((0,r.useState)(ey({strokeWeight:5,strokeColor:"#4e9bff",fillColor:"#4e9bff",strokeOpacity:1,editable:!y,draggable:!y},O)),1)[0],K=(0,n.useNavigateNoUpdate)(),G=(0,r.useRef)(),q=(0,r.useRef)(new Set),V=(0,c.useMemoizedFn)(function(e){if(q.current.forEach(function(e){q.current.delete(e)}),"getPath"in e){var t=e.getPath();["insert_at","remove_at","set_at"].forEach(function(n){q.current.add(t.addListener(n,function(){X(e,!0)}).remove)})}else em(e,google.maps.Circle)&&["center_changed","radius_changed"].forEach(function(t){q.current.add(e.addListener(t,function(){X(e,!0)}).remove)})}),W=(0,c.useMemoizedFn)(function(){if(M.current&&(M.current.unbindAll(),M.current.setMap(null)),"point"!==N){var e;null===(e=C.current)||void 0===e||e.setDrawingMode(null)}}),Y=(0,c.useMemoizedFn)(function(e){if(E.current&&e){var t,n;null===(t=E.current)||void 0===t||t.setCenter(e),null===(n=E.current)||void 0===n||n.setZoom(b)}}),J=(0,c.useMemoizedFn)(function(e){W(),V(e),M.current=e}),Z=(0,c.useMemoizedFn)(function(e){var t,n,r=new google.maps.LatLngBounds;e.forEach(function(e){if(em(e,google.maps.Marker))r.extend(e.getPosition());else if(em(e,google.maps.Polyline)||em(e,google.maps.Polygon)){for(var t=e.getPath(),n=0;n<t.getLength();n++)r.extend(t.getAt(n))}else em(e,google.maps.Circle)&&r.union(e.getBounds())}),null===(n=E.current)||void 0===n||null===(t=n.setCenter)||void 0===t||t.call(n,r.getCenter())}),X=(0,c.useMemoizedFn)(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null;if("point"===N){var r=e.getPosition(),o=r.lat;n=[(0,r.lng)(),o()]}else if("polygon"===N||"lineString"===N){if((n=e.getPath().getArray().map(function(e){return[e.lng(),e.lat()]})).length<2)return}else if("circle"===N){var i=e.getCenter(),a=e.getRadius();n=[i.lng(),i.lat(),a]}!t&&J(e),null==s||s(n)}),H=(0,c.useMemoizedFn)(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,n=ev(ey({},U,t),{map:E.current});return C.current=new google.maps.drawing.DrawingManager({drawingMode:_.current,drawingControl:!1,markerOptions:ev(ey({},n),{icon:ep(g)}),polygonOptions:n,polylineOptions:n,circleOptions:n,map:E.current}),!e&&C.current.addListener("overlaycomplete",function(e){X(e.overlay)}),C.current}),Q=(0,c.useMemoizedFn)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,n=arguments.length>2?arguments[2]:void 0,r=ex[e];if(!!r){var o=ey(ev(ey({},U),{icon:ep(g)}),n);return"transformOptions"in r?Object.assign(o,r.transformOptions(t)):"propertyKey"in r&&(o[r.propertyKey]=Array.isArray(t[0])?t.map(function(e){return new google.maps.LatLng(e[1],e[0])}):new google.maps.LatLng(t[1],t[0])),new google.maps[r.overlay](o)}}),$=(0,c.useMemoizedFn)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,n=arguments.length>2?arguments[2]:void 0;if(E.current)return Q(e,t,ev(ey({},n),{map:E.current}))});(0,r.useEffect)(function(){if(!a&&E.current){var e,t;W(),null==C||null===(t=C.current)||void 0===t||null===(e=t.setDrawingMode)||void 0===e||e.call(t,_.current),null==s||s(null)}if(E.current){if(!a||!d&&M.current)return;var n=$();J(n),Z([n])}},[a,I,N,y,d,$,Z,J]),(0,r.useEffect)(function(){if(w&&!E.current&&G.current){try{n=new el({apiKey:w,version:"weekly",language:L.auth.getLocale()})}catch(e){z(S("Load google maps failed, Please check the Api key and refresh the page"));return}var e,t,n,r=console.error;return console.error=function(e){for(var t,n,o=arguments.length,i=Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];(null==e?void 0:null===(n=e.includes)||void 0===n?void 0:n.call(e,"InvalidKeyMapError"))&&z(S("Load google maps failed, Please check the Api key and refresh the page")),r.apply(void 0,[e].concat(function(e){if(Array.isArray(e))return ef(e)}(t=i)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||eh(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))},Promise.all([n.importLibrary("drawing"),n.importLibrary("core"),n.importLibrary("geometry")]).then((t=(e=function(e){var t;return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){var t=function(){e({lat:37.4224764,lng:-122.0842499})};navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var n=t.coords;e({lat:n.latitude,lng:n.longitude})},function(){t()},{timeout:2e3,maximumAge:0}):t()})];case 1:return t=e.sent(),E.current=new google.maps.Map(G.current,{zoom:b,center:t,mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControl:!1,streetViewControl:!1,panControl:!1,mapTypeControl:!1,fullscreenControl:!1}),z(""),F([]),[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){ed(i,r,o,a,l,"next",e)}function l(e){ed(i,r,o,a,l,"throw",e)}a(void 0)})}),function(e){return t.apply(this,arguments)})).catch(function(e){if(em(e,Error)){z(e.message);return}}),function(){var e,t;null===(e=E.current)||void 0===e||e.unbindAll(),E.current=null,null===(t=C.current)||void 0===t||t.unbindAll()}}},[w,L.auth,N,b]),(0,r.useEffect)(function(){E.current&&N&&!y&&!C.current&&H()},[H,y,I,N]),(0,r.useImperativeHandle)(t,function(){return{setOverlay:$,getOverlay:Q,setFitView:Z,createDraw:H,map:E.current,overlay:M.current,drawingManager:C.current,errMessage:T}});var ee=(0,c.useMemoizedFn)(function(){var e=function(){W(),C.current.setDrawingMode(_.current),null==s||s(null)};R.confirm({title:S("Clear the canvas"),content:S("Are you sure to clear the canvas?"),okText:S("Confirm"),cancelText:S("Cancel"),getContainer:function(){return G.current},onOk:function(){e()}})}),et=(0,n.useApp)();return!w||T?o().createElement(u.Alert,{action:o().createElement(u.Button,{type:"primary",onClick:function(){return K(et.pluginSettingsManager.getRoutePath("map")+"?tab=google")}},S("Go to the configuration page")),message:T||S("Please configure the Api key first"),type:"error"}):o().createElement("div",{className:(0,n.css)(eO(),B||500)},!E.current&&o().createElement("div",{className:(0,n.css)(ew())},o().createElement(u.Spin,null)),y?null:o().createElement(o().Fragment,null,E.current&&o().createElement(es,{toCenter:Y,mapRef:E}),o().createElement("div",{className:(0,n.css)(eS())},o().createElement(u.Button,{onClick:function(){M.current&&Z([M.current])},disabled:!M.current,type:"primary",shape:"round",size:"large",icon:o().createElement(l.SyncOutlined,null)})),"lineString"===N||"polygon"===N?o().createElement("div",{className:(0,n.css)(eP())},o().createElement(u.Alert,{message:S("Click to select the starting point and double-click to end the drawing"),type:"info"})):null,o().createElement("div",{className:(0,n.css)(eA())},o().createElement(u.Button,{disabled:!a,style:{height:"40px"},onClick:ee,type:"primary",danger:!0},S("Clear")))),o().createElement("div",{ref:G,className:(0,n.css)(ej()),style:null==e?void 0:e.style}))});function eE(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}eC.displayName="GoogleMapsComponent";function eM(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function ek(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}function eI(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw r}}return i}}(e,t)||eT(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eF(e,t){return!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function eD(e){return function(e){if(Array.isArray(e))return eE(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||eT(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eT(e,t){if(e){if("string"==typeof e)return eE(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eE(e,t)}}function ez(){var e=eF(["\n  margin-top: 6px;\n  padding: 2px 4px;\n  background: #fff;\n  border: 1px solid #0000f5;\n"]);return ez=function(){return e},e}function eL(){var e=eF(["\n  margin-top: -64px;\n  padding: 2px 4px;\n  background: #fff;\n  border: 1px solid #0000f5;\n"]);return eL=function(){return e},e}function eR(){var e=eF(["\n        position: relative;\n        height: 100%;\n      "]);return eR=function(){return e},e}function eB(){var e=eF(["\n              position: absolute;\n              left: 10px;\n              top: 10px;\n              z-index: 999;\n            "]);return eB=function(){return e},e}var eN="google-maps-overlay-id",e_="google-maps-overlay-selected",eU=(0,n.css)(ez()),eK=(0,n.css)(eL());function eG(e){if(eM(e,google.maps.Marker))return e.setIcon(ep(g));e.setOptions({strokeColor:"#4e9bff",fillColor:"#4e9bff"})}var eq={amap:K,google:eC},eV=o().forwardRef(function(e,t){var n=f().t,i=e.mapType,a=(0,r.useMemo)(function(){return eq[i]},[i]);return a?o().createElement(a,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({ref:t},e)):o().createElement("div",null,n("The ".concat(i," cannot found")))});eV.displayName="MapComponent";function eW(){var e,t,n=(e=["\n  height: 100%;\n  border: 1px solid transparent;\n  .ant-formily-item-error & {\n    border: 1px solid #ff4d4f;\n  }\n"],!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}})));return eW=function(){return n},n}var eY=(0,n.css)(eW()),eJ=(0,h.connect)(function(e){return o().createElement("div",{className:eY},o().createElement(eV,e))},(0,h.mapReadPretty)(function(e){var t,r,i,a=e.value,l=(0,h.useFieldSchema)(),c=(0,n.useCollection)().getField(l.name),u=e.mapType||(null==c?void 0:null===(t=c.uiSchema["x-component-props"])||void 0===t?void 0:t.mapType),s=(0,n.useFlag)().isInSubTable,p=(null==l?void 0:null===(r=l.parent)||void 0===r?void 0:r["x-component"])==="TableV2.Column"||s;return((0,n.useFieldTitle)(),p)?o().createElement("div",null,o().createElement(n.EllipsisWithTooltip,{ellipsis:!0},null==a?void 0:null===(i=a.map)||void 0===i?void 0:i.call(a,function(e){return Array.isArray(e)?"(".concat(e.join(","),")"):e}).join(","))):o().createElement(eV,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({readonly:!0,mapType:u},e))}));eJ.Designer=function(){var e,t=(0,n.useCollectionManager_deprecated)().getCollectionJoinField,r=(0,n.useCollection_deprecated)().getField,i=(0,n.useFormBlockContext)().form,l=(0,h.useField)(),c=(0,h.useFieldSchema)(),u=f().t,s=(0,n.useDesignable)(),p=s.dn;s.refresh;var d=r(c.name)||t(c["x-collection-field"]),m=null==d?void 0:null===(e=d.uiSchema)||void 0===e?void 0:e.title,y={title:l.title===m?void 0:l.title};!l.readPretty&&(y.required=l.required);var v="editable";return!0===c["x-disabled"]&&(v="readonly"),!0===c["x-read-pretty"]&&(v="read-pretty"),o().createElement(n.GeneralSchemaDesigner,null,o().createElement(n.GeneralSchemaItems,null),i&&!(null==i?void 0:i.readPretty)&&!(0,n.isPatternDisabled)(c)&&o().createElement(n.SchemaSettingsSelectItem,{key:"pattern",title:u("Pattern"),options:[{label:u("Editable"),value:"editable"},{label:u("Readonly"),value:"readonly"},{label:u("Easy-reading"),value:"read-pretty"}],value:v,onChange:function(e){var t,n,r,o=(t={},n="x-uid",r=c["x-uid"],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t);switch(e){case"readonly":c["x-read-pretty"]=!1,c["x-disabled"]=!0,o["x-read-pretty"]=!1,o["x-disabled"]=!0,l.readPretty=!1,l.disabled=!0;break;case"read-pretty":c["x-read-pretty"]=!0,c["x-disabled"]=!1,o["x-read-pretty"]=!0,o["x-disabled"]=!1,l.readPretty=!0;break;default:c["x-read-pretty"]=!1,c["x-disabled"]=!1,o["x-read-pretty"]=!1,o["x-disabled"]=!1,l.readPretty=!1,l.disabled=!1}p.emit("patch",{schema:o}),p.refresh()}}),o().createElement(n.SchemaSettingsModalItem,{key:"map-zoom",title:u("Set default zoom level"),schema:{type:"object",title:u("Set default zoom level"),properties:{zoom:{title:u("Zoom"),default:l.componentProps.zoom||13,description:u("The default zoom level of the map"),"x-decorator":"FormItem","x-component":"InputNumber","x-component-props":{precision:0}}}},onSubmit:function(e){var t=e.zoom;t&&(a().set(c,"x-component-props.zoom",t),Object.assign(l.componentProps,c["x-component-props"]),p.emit("patch",{schema:{"x-uid":c["x-uid"],"x-component-props":l.componentProps}})),p.refresh()}}),o().createElement(n.SchemaSettingsRemove,{key:"remove",removeParentsIfNoChildren:!0,confirm:{title:u("Delete field")},breakRemoveOn:{"x-component":"Grid"}}))};var eZ={amap:function(e){var t,i,a,s,p,d,m,y=(0,n.useProps)(e),h=y.collectionField,w=y.fieldNames,S=y.dataSource,P=y.fixedBlock,A=y.zoom,j=y.setSelectedRecordKeys,x=y.lineSort,C=(0,n.useCollection_deprecated)(),E=C.name,M=C.getPrimaryKey,k=(0,n.useCollectionManager_deprecated)().getCollectionJoinField,I=M(),F=V((0,r.useState)(!1),2),D=F[0],T=F[1],z=(0,r.useRef)(),L=null===(s=z.current)||void 0===s?void 0:null===(a=s.aMap)||void 0===a?void 0:a.GeometryUtil,R=V((0,r.useState)(),2),B=R[0],N=R[1],_=V((0,r.useState)(""),2),U=_[0],G=_[1],W=f().t,J=(0,n.useCompile)(),Q=(0,n.useFilterAPI)(),$=Q.isConnected,ee=Q.doFilter,et=V((0,r.useState)(null),2)[1],en=(0,r.useRef)(U);en.current=U;var er=(0,n.useCollection)().fields,eo=(0,n.useCollectionParentRecordData)(),ei=(0,n.usePopupUtils)().openPopup,ea=null===(p=er.find(function(e){return e.name===(null==w?void 0:w.marker)}))||void 0===p?void 0:p.uiSchema,el=function(e,t){var n=e.getExtData(),r=void 0===t?n.selected:!t;n.selected=!r,"setIcon"in e&&e.setIcon(new z.current.aMap.Icon({imageSize:[19,32],image:r?g:v})),e.setOptions(q({extData:n},r?{strokeColor:"#4e9bff",fillColor:"#4e9bff"}:{strokeColor:"#F18b62",fillColor:"#F18b62"}))},ec=function(){var e,t,n;z.current&&(null===(e=z.current)||void 0===e||e.mouseTool().close(!0),null===(t=z.current)||void 0===t||t.editor().setTarget(null),null===(n=z.current)||void 0===n||n.editor().close())};(0,r.useEffect)(function(){var e,t,n,r;if("selection"===U)return(null===(e=z.current)||void 0===e?void 0:e.editor())?null===(r=z.current)||void 0===r||r.executeMouseTool("polygon"):(null===(t=z.current)||void 0===t||t.createEditor("polygon"),null===(n=z.current)||void 0===n||n.createMouseTool("polygon")),function(){ec()}},[U]),(0,r.useEffect)(function(){if(U)return function(){if(!en.current){var e;null===(e=z.current)||void 0===e||e.map.getAllOverlays().forEach(function(e){el(e,!1)})}}},[U]);var eu=(0,c.useMemoizedFn)(function(){var e,t,n,r=null===(e=z.current)||void 0===e?void 0:e.editor().getTarget(),o=null===(t=z.current)||void 0===t?void 0:t.map.getAllOverlays(),i=null==o?void 0:o.filter(function(e){if(e!==r&&void 0!==e.getExtData().id)return"getPosition"in e?L.isPointInRing(e.getPosition(),null==r?void 0:r.getPath()):L.doesRingRingIntersect(e.getPath(),null==r?void 0:r.getPath())}),a=null==i?void 0:i.map(function(e){return el(e,!0),e.getExtData().id});j(function(e){return null==a?void 0:a.concat(e)}),null==r||r.remove(),null===(n=z.current)||void 0===n||n.editor().close()});(0,r.useEffect)(function(){if(h&&z.current&&S){var e=k([E].concat(Y(Array.isArray(null==w?void 0:w.field)&&(null==w?void 0:w.field.length)>1?null==w?void 0:w.field.slice(0,-1):null==w?void 0:w.field)).flat().join(".")),t=S.map(function(t){var r,o=null===(r=b(t,null==w?void 0:w.field,null==e?void 0:e.interface))||void 0===r?void 0:r.filter(Boolean),i=(0,n.getLabelFormatValue)(ea,t[w.marker]);return(null==o?void 0:o.length)?o.map(function(e){var n;return null===(n=z.current)||void 0===n?void 0:n.setOverlay(h.type,e,{strokeColor:"#4e9bff",fillColor:"#4e9bff",cursor:"pointer",label:{direction:"bottom",offset:[0,5],content:(null==w?void 0:w.marker)?J(i):void 0},extData:{id:t[I]}})}):[]}).flat().filter(Boolean);null===(i=z.current)||void 0===i||null===(o=i.map)||void 0===o||o.setFitView(t);var r=t.map(function(e){var t=function(t){var n=t.target,r=n.getExtData();if(r){if(en.current){"click"===en.current&&(j(function(e){return r.selected?e.filter(function(e){return e!==r.id}):Y(e).concat([r.id])}),el(n));return}var o=S.find(function(e){return r.id===e[I]});if($){et(function(t){return(t&&H(t),t===e)?(H(e),ee(null),null):(function(e){e.dom?e.dom.style.filter="brightness(1.2) contrast(1.2) hue-rotate(180deg)":e.setOptions&&e.setOptions({strokeColor:"#F18b62",fillColor:"#F18b62"})}(e),ee(o[I],function(e){return e.field||I},"$eq"),e)});return}o&&(N(o),ei({recordData:o}))}};return e.on("click",t),function(){return e.off("click",t)}});if("point"===h.type&&(null==x?void 0:x.length)&&(null==t?void 0:t.length)>1){var o,i,a,l=t.map(function(e){return e.getPosition()});t[0].setzIndex(13),t[t.length-1].setzIndex(13);var c=function(){var e,t,n=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(null===(e=z.current)||void 0===e?void 0:e.map)return new AMap.Text({label:{direction:"top",offset:[0,0],content:n?W("Start point"):W("End point")},position:l[n?0:l.length-1],map:null===(t=z.current)||void 0===t?void 0:t.map})};t.push.apply(t,Y([null===(a=z.current)||void 0===a?void 0:a.setOverlay("lineString",l,{strokeColor:"#4e9bff",fillColor:"#4e9bff",strokeWeight:2,cursor:"pointer"}),c(),c(!1)].filter(Boolean)))}return function(){t.forEach(function(e){e.remove()}),r.forEach(function(e){return e()})}}},[S,D,w,E,I,h.type,$,x,ei]),(0,r.useEffect)(function(){setTimeout(function(){j([])})},[S]);return o().createElement("div",{className:(0,n.css)(Z())},o().createElement("div",{className:(0,n.css)(X())},!D||(null===(d=z.current)||void 0===d?void 0:d.errMessage)?null:o().createElement(u.Space,{direction:"vertical"},o().createElement(u.Button,{style:{color:U?void 0:"#F18b62",borderColor:"currentcolor"},onClick:function(e){e.stopPropagation(),G("")},icon:o().createElement(l.EnvironmentOutlined,null)}),o().createElement(u.Button,{style:{color:"selection"===U?"#F18b62":void 0,borderColor:"currentcolor"},onClick:function(e){e.stopPropagation(),G("selection")},icon:o().createElement(l.ExpandOutlined,null)}),"selection"===U?o().createElement(u.Button,{type:"primary",icon:o().createElement(l.CheckOutlined,null),title:W("Confirm selection"),onClick:eu}):null)),o().createElement(n.RecordProvider,{record:B,parent:eo},o().createElement(O,null)),o().createElement(K,(t=q({},null==h?void 0:null===(m=h.uiSchema)||void 0===m?void 0:m["x-component-props"]),i=(i={ref:function(e){z.current=e,T(!!(null==e?void 0:e.map)&&!e.errMessage)},style:{height:P?"100%":null},zoom:A,disabled:!0,block:!0,overlayCommonOptions:{strokeColor:"#F18b62",fillColor:"#F18b62"}},i),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}),t)))},google:function(e){var t,i,a,s=(0,n.useProps)(e),p=s.collectionField,d=s.fieldNames,m=s.dataSource,y=s.fixedBlock,h=s.zoom,w=s.setSelectedRecordKeys,S=s.lineSort,P=(0,(0,n.useCollection_deprecated)().getPrimaryKey)(),A=d.marker,j=eI((0,r.useState)(!1),2),x=j[0],C=j[1],E=(0,r.useRef)(),M=eI((0,r.useState)(),2),k=M[0],I=M[1],F=eI((0,r.useState)(""),2),D=F[0],T=F[1],z=f().t,L=(0,n.useCompile)(),R=(0,n.useFilterAPI)(),B=R.isConnected,N=R.doFilter,_=eI((0,r.useState)(null),2)[1],U=(0,r.useRef)(D),K=(0,r.useRef)(null),G=(0,r.useRef)([]);U.current=D;var q=(0,n.useCollection)().fields,V=(0,n.useCollectionParentRecordData)(),W=null===(a=q.find(function(e){return e.name===(null==d?void 0:d.marker)}))||void 0===a?void 0:a.uiSchema,Y=(0,n.useCollectionManager_deprecated)().getCollectionJoinField,J=(0,n.usePopupUtils)().openPopup,Z=function(e,t){var n=void 0!==t?!t:e.get(e_);e.set(e_,!n),e.setOptions(ek({},n?{icon:ep(g),strokeColor:"#4e9bff",fillColor:"#4e9bff"}:{icon:ep(v),strokeColor:"#F18b62",fillColor:"#F18b62"}))};(0,r.useEffect)(function(){if("selection"===D){E.current&&!(null===(e=E.current)||void 0===e?void 0:e.drawingManager)&&(E.current.drawingManager=null===(r=E.current)||void 0===r?void 0:r.createDraw(!0,{editable:!0,draggable:!0}));var e,t,n,r,o=new Set;return null===(t=E.current)||void 0===t||t.drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYGON),null===(n=E.current)||void 0===n||n.drawingManager.addListener("overlaycomplete",function(e){var t,n=e.overlay;null===(t=E.current)||void 0===t||t.drawingManager.setDrawingMode(null),K.current=n;var r=n.getPath();["insert_at","remove_at","set_at"].forEach(function(e){o.add(r.addListener(e,function(){}).remove)})}),function(){var e,t,n,r;o.forEach(function(e){e()}),E.current&&(null===(e=K.current)||void 0===e||e.unbindAll(),null===(t=K.current)||void 0===t||t.setMap(null),K.current=null,null===(n=E.current)||void 0===n||n.drawingManager.setDrawingMode(null),null===(r=E.current)||void 0===r||r.drawingManager.unbindAll())}}},[D]),(0,r.useEffect)(function(){if(D)return function(){!U.current&&G.current.forEach(function(e){Z(e,!1)})}},[D]);var X=(0,c.useMemoizedFn)(function(){var e,t=K.current,n=G.current,r=google.maps.geometry.poly,o=n.filter(function(e){if(e!==t&&void 0!==e.get(eN)){if(eM(e,google.maps.Marker))return r.containsLocation(e.getPosition(),t);else if(eM(e,google.maps.Circle))return r.containsLocation(e.getCenter(),t);else return e.getPath().getArray().some(function(e){return r.containsLocation(e,t)})}}).map(function(e){return Z(e,!0),e.get(eN)});w(function(e){return o.concat(e)}),null==t||t.unbindAll(),null==t||t.setMap(null),null===(e=E.current)||void 0===e||e.drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYGON)});(0,r.useEffect)(function(){if(p&&(null==m?void 0:m.length)&&(null===(o=E.current)||void 0===o?void 0:o.map)){var e=Y([name].concat(eD(Array.isArray(null==d?void 0:d.field)&&(null==d?void 0:d.field.length)>1?null==d?void 0:d.field.slice(0,-1):null==d?void 0:d.field)).flat().join(".")),t=m.map(function(t){var r=b(t,null==d?void 0:d.field,null==e?void 0:e.interface),o=(0,n.getLabelFormatValue)(W,t[d.marker]);return(null==r?void 0:r.length)?null==r?void 0:r.filter(Boolean).map(function(e){if(r){var n,i=null===(n=E.current)||void 0===n?void 0:n.setOverlay(p.type,e,{strokeColor:"#4e9bff",fillColor:"#4e9bff",cursor:"pointer",label:{className:eU,fontFamily:"inherit",fontSize:"13px",color:"#333",text:(null==d?void 0:d.marker)?L(o):void 0}});return null==i||i.set(eN,t[P]),i}}):[]}).flat().filter(Boolean);G.current=t;var r=t.map(function(e){return e.addListener("click",function(t){var n=e.get(eN);if(n){var r=null==m?void 0:m.find(function(e){return n===e[P]});if(B){_(function(t){return(t&&eG(e),t===e)?(eG(e),N(null),null):(function(e){if(eM(e,google.maps.Marker))return e.setIcon(ep(v));e.setOptions({strokeColor:"#F18b62",fillColor:"#F18b62"})}(e),N(r[P],function(e){return e.field||P},"$eq"),e)});return}r&&(I(r),J({recordData:r}))}}),function(){return e.unbindAll()}});if("point"===p.type&&(null==S?void 0:S.length)&&(null==t?void 0:t.length)>1){var o,i,a=t.map(function(e){return e.getPosition()});t[0].setZIndex(138),t[t.length-1].setZIndex(138);var l=function(){var e,t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(null===(e=E.current)||void 0===e?void 0:e.map)return new google.maps.Marker({label:{className:eK,fontFamily:"inherit",fontSize:"13px",color:"#333",text:t?z("Start point"):z("End point")},icon:ep(g),position:t?a[0]:a[a.length-1],map:E.current.map})};t.push.apply(t,eD([E.current.setOverlay("lineString",a.map(function(e){return[e.lng(),e.lat()]}),{strokeColor:"#4e9bff",fillColor:"#4e9bff",strokeWeight:2,cursor:"pointer"}),l(),l(!1)].filter(Boolean)))}return null===(i=E.current)||void 0===i||i.setFitView(t),function(){t.forEach(function(e){e.setMap(null),e.unbindAll()}),r.forEach(function(e){return e()})}}},[m,x,void 0===A?"id":A,p.type,B,J]),(0,r.useEffect)(function(){setTimeout(function(){w([])})},[m]);return o().createElement("div",{className:(0,n.css)(eR())},x&&o().createElement(o().Fragment,null,o().createElement("div",{className:(0,n.css)(eB())},o().createElement(u.Space,{direction:"vertical"},o().createElement(u.Button,{style:{color:D?void 0:"#F18b62",borderColor:"currentcolor"},onClick:function(e){e.stopPropagation(),T("")},icon:o().createElement(l.EnvironmentOutlined,null)}),o().createElement(u.Button,{style:{color:"selection"===D?"#F18b62":void 0,borderColor:"currentcolor"},onClick:function(e){e.stopPropagation(),T("selection")},icon:o().createElement(l.ExpandOutlined,null)}),"selection"===D?o().createElement(u.Button,{type:"primary",icon:o().createElement(l.CheckOutlined,null),title:z("Confirm selection"),onClick:X}):null)),o().createElement(n.RecordProvider,{record:k,parent:V},o().createElement(O,null))),o().createElement(eC,(t=ek({},e),i=(i={ref:function(e){E.current=e,C(!!(null==e?void 0:e.map)&&!e.errMessage)},style:{height:y?"100%":null},zoom:h,disabled:!0,block:!0,overlayCommonOptions:{strokeColor:"#F18b62",fillColor:"#F18b62"}},i),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}),t)))}},eX=(0,n.withSkeletonComponent)(function(e){var t=f().t,i=e.mapType,a=(0,r.useMemo)(function(){return eZ[i]},[i]);return a?o().createElement(n.PopupContextProvider,null,o().createElement(a,e)):o().createElement("div",null,t("The ".concat(i," cannot found")))},{displayName:"MapBlockComponent"}),eH=(0,n.withDynamicSchemaProps)(function(e){var t,i,l,c,u=(0,n.usePopupUtils)().context;if(u.currentLevel&&!a().isNil(null===(l=u.params)||void 0===l?void 0:l.filterbytk))return o().createElement(n.PopupContextProvider,null,o().createElement(O,null));var s=(0,n.useProps)(e).fieldNames,p=(0,n.useCollectionManager)(),f=((0,n.useCollection)()||{}).name,d=(0,r.useMemo)(function(){return null==p?void 0:p.getCollectionField([f,null==s?void 0:s.field].flat().join("."))},[f,null==s?void 0:s.field]),m=null==d?void 0:null===(c=d.uiSchema)||void 0===c?void 0:c["x-component-props"];return o().createElement(eX,(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({},m,e),i=(i={collectionField:d},i),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}),t))}),eQ=function(){var e=(0,n.useCollection)(),t=e.name,r=e.title,i=(0,n.useSchemaTemplate)();return o().createElement(n.GeneralSchemaDesigner,{schemaSettings:"blockSettings:map",template:i,title:r||t})},e$=d("632"),e0=d("875"),e1=function(e){var t,n,r,o=e.collectionName,i=e.fieldNames,a=e.dataSource;return{type:"void","x-acl-action":"".concat(o,":list"),"x-decorator":"MapBlockProvider","x-decorator-props":{collection:o,dataSource:a,action:"list",fieldNames:i,params:{paginate:!1}},"x-toolbar":"BlockSchemaToolbar","x-settings":"blockSettings:map","x-component":"CardItem","x-filter-targets":[],properties:(t={actions:{type:"void","x-initializer":"map:configureActions","x-component":"ActionBar","x-component-props":{}}},n=(0,e0.uid)(),r={type:"void","x-component":"MapBlock","x-use-component-props":"useMapBlockProps",properties:{drawer:{type:"void","x-component":"Action.Container","x-component-props":{className:"nb-action-popup"},title:'{{ t("View record") }}',properties:{tabs:{type:"void","x-component":"Tabs","x-component-props":{},"x-initializer":"popup:addTab",properties:{tab1:{type:"void",title:'{{t("Details")}}',"x-component":"Tabs.TabPane","x-designer":"Tabs.Designer","x-component-props":{},properties:{grid:{type:"void","x-component":"Grid","x-initializer":"popup:common:addBlock"}}}}}}}}},n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t)}},e2=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return"string"==typeof e&&(e=[e]),null==e?void 0:e.reduce(function(t,n,r){var o=null==t?void 0:t.find(function(e){return e.value===n});return r===e.length-1?o:null==o?void 0:o.children},t)};function e3(e,t,n,r,o,i,a){try{var l=e[i](a),c=l.value}catch(e){n(e);return}l.done?t(c):Promise.resolve(c).then(r,o)}function e4(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}var e5=function(){var e,t,i=(0,n.useSchemaInitializerItem)(),a=(0,n.useSchemaInitializer)().insert,c=(0,r.useContext)(h.SchemaOptionsContext),u=(0,n.useCollectionManager_deprecated)().getCollectionFieldsOptions,s=f().t,p=(0,n.useGlobalTheme)().theme;return o().createElement(n.DataBlockInitializer,e4({componentType:"Map",icon:o().createElement(l.TableOutlined,null),onCreateBlockSchema:(t=(e=function(e){var t,r,i,l;return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(f){switch(f.label){case 0:return r=u((t=e.item).name,["point","lineString","polygon"],null,{association:["o2o","obo","oho","o2m","m2o","m2m"],dataSource:t.dataSource}),i=u(t.name,"string",null,{dataSource:t.dataSource}),[4,(0,n.FormDialog)(s("Create map block"),function(){var e;return o().createElement(n.SchemaComponentOptions,{scope:c.scope,components:e4({},c.components)},o().createElement(e$.FormLayout,{layout:"vertical"},o().createElement(n.SchemaComponent,{schema:{properties:{field:{title:s("Map field"),enum:r,required:!0,"x-component":"Cascader","x-decorator":"FormItem",default:r.length?[r[0].value,null===(e=r[0].children)||void 0===e?void 0:e[0].value].filter(function(e){return null!=e}):[]},marker:{title:s("Marker field"),enum:i,"x-component":"Select","x-decorator":"FormItem","x-reactions":function(e){var t=e.form.values.field;if(!!(null==t?void 0:t.length)){var n=e2(t,r);n&&(e.hidden="point"!==n.type)}}}}}})))},p).open({initialValues:{}})];case 1:return l=f.sent(),a(e1({collectionName:t.name,dataSource:t.dataSource,fieldNames:e4({},l)})),[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){e3(i,r,o,a,l,"next",e)}function l(e){e3(i,r,o,a,l,"throw",e)}a(void 0)})}),function(e){return t.apply(this,arguments)}),title:s("Map block")},i))},e8=d("964");function e6(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function e9(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}function e7(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function te(){var e,t,n=(e=["\n            .nb-action-bar {\n              margin-bottom: ","px;\n            }\n          "],!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}})));return te=function(){return n},n}var tt=(0,r.createContext)({});tt.displayName="MapBlockContext";var tn=function(e){var t,i,a,l=e.fieldNames,c=(0,h.useFieldSchema)(),s=(0,h.useField)(),p=(0,n.useBlockRequestContext)(),f=p.resource,d=p.service;var m=(t=(0,r.useState)([]),i=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw r}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return e6(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e6(e,t)}}(t,i)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),y=m[0],v=m[1],g=u.theme.useToken().token;return o().createElement(n.SchemaComponentOptions,{scope:{selectedRecordKeys:y}},o().createElement(tt.Provider,{value:{field:s,service:d,resource:f,fieldNames:l,fixedBlock:null==c?void 0:null===(a=c["x-decorator-props"])||void 0===a?void 0:a.fixedBlock,selectedRecordKeys:y,setSelectedRecordKeys:v}}," ",o().createElement("div",{className:(0,e8.css)(te(),g.margin)},e.children)))},tr=function(e){var t=(0,n.useParsedFilter)({filterOption:null==e?void 0:e.filter}),r=t.filter,o=t.parseVariableLoading;return{params:e7(e9({},e),{filter:r}),parseVariableLoading:o}},to=function(e){var t=(0,h.useField)(),r=e.fieldNames,i=tr(e.params),a=i.params;if(i.parseVariableLoading)return null;var l=a.appends||[],c=(r||{}).field;return Array.isArray(c)&&c.length>1&&l.push(c[0]),o().createElement(n.BlockProvider,e7(e9({name:"map"},e),{runWhenParamsChanged:!0,params:e7(e9({},a),{appends:l,paginate:!1,sort:t.componentProps.lineSort})}),o().createElement(tn,e))},ti=function(){return(0,r.useContext)(tt)},ta=function(){var e,t,n,r,o,i,a=ti();return e7(e9({},a),{dataSource:null==a?void 0:null===(t=a.service)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.data,zoom:(null==a?void 0:null===(r=a.field)||void 0===r?void 0:null===(n=r.componentProps)||void 0===n?void 0:n.zoom)||13,lineSort:null==a?void 0:null===(i=a.field)||void 0===i?void 0:null===(o=i.componentProps)||void 0===o?void 0:o.lineSort})},tl=function(e){return o().createElement(n.SchemaComponentOptions,{scope:{useMapBlockProps:ta},components:{MapBlockInitializer:e5,MapBlockDesigner:eQ,MapBlockProvider:to,MapBlock:eH}},e.children)};function tc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}var tu={title:"{{t('Configure actions')}}",icon:"SettingOutlined",style:{marginLeft:8},items:[{name:"filter",title:"{{t('Filter')}}",Component:"FilterActionInitializer",schema:{"x-align":"left"}},{name:"addNew",title:"{{t('Add new')}}",Component:"CreateActionInitializer",schema:{"x-align":"right","x-decorator":"ACLActionProvider","x-acl-action-props":{skipScopeCheck:!0}},useVisible:function(){return(0,n.useActionAvailable)("create")}},{name:"refresh",title:"{{t('Refresh')}}",Component:"RefreshActionInitializer",schema:{"x-align":"right"}},{name:"customRequest",title:'{{t("Custom request")}}',Component:"CustomRequestInitializer",schema:{"x-action":"customize:table:request:global"}}]},ts=new n.CompatibleSchemaInitializer(tc({name:"MapActionInitializers"},tu)),tp=new n.CompatibleSchemaInitializer(tc({name:"map:configureActions"},tu),ts);function tf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var td={name:"defaultZoomLevel",Component:n.SchemaSettingsModalItem,useComponentProps:function(){var e,t=f().t,r=(0,h.useFieldSchema)(),o=(0,h.useField)(),i=(0,n.useDesignable)().dn,l=(null==r?void 0:null===(e=r["x-component-props"])||void 0===e?void 0:e.zoom)||13;return{title:t("The default zoom level of the map"),schema:{type:"object",title:t("Set default zoom level"),properties:{zoom:{title:t("Zoom"),default:l,"x-component":"InputNumber","x-decorator":"FormItem","x-component-props":{precision:0}}}},onSubmit:function(e){var t=e.zoom;a().set(r,"x-component-props.zoom",t),o.componentProps.zoom=t,i.emit("patch",{schema:{"x-uid":r["x-uid"],"x-component-props":r["x-component-props"]}}),i.refresh()}}},useVisible:function(){return!(0,n.useColumnSchema)().fieldSchema}},tm=new n.SchemaSettings({name:"blockSettings:map",items:[{name:"title",Component:n.SchemaSettingsBlockTitleItem},{name:"setTheBlockHeight",Component:n.SchemaSettingsBlockHeightItem},{name:"mapField",Component:n.SchemaSettingsCascaderItem,useComponentProps:function(){var e,t=(0,n.useCollectionManager_deprecated)().getCollectionFieldsOptions,r=f().t,o=(0,h.useFieldSchema)(),i=(null==o?void 0:null===(e=o["x-decorator-props"])||void 0===e?void 0:e.fieldNames)||{},a=(0,h.useField)(),l=(0,n.useDesignable)().dn,c=ti().service,u=t((0,n.useCollection)().name,["point","lineString","polygon"],null,{association:["o2o","obo","oho","o2m","m2o","m2m"]});return{title:r("Map field"),value:i.field,options:u,allowClear:!1,onChange:function(e){var t,n=a.decoratorProps.fieldNames||{};n.field=e,a.decoratorProps.fieldNames=n,o["x-decorator-props"].fieldNames=n,c.refresh(),l.emit("patch",{schema:(tf(t={},"x-uid",o["x-uid"]),tf(t,"x-decorator-props",a.decoratorProps),t)}),l.refresh()}}}},{name:"markerField",Component:n.SchemaSettingsSelectItem,useComponentProps:function(){var e,t=f().t,r=(0,h.useFieldSchema)(),o=(null==r?void 0:null===(e=r["x-decorator-props"])||void 0===e?void 0:e.fieldNames)||{},i=ti().service,a=(0,h.useField)(),l=(0,n.useDesignable)().dn,c=(0,(0,n.useCollectionManager_deprecated)().getCollectionFieldsOptions)((0,n.useCollection)().name,"string");return{title:t("Marker field"),value:o.marker,options:c,onChange:function(e){var t,n=a.decoratorProps.fieldNames||{};n.marker=e,a.decoratorProps.fieldNames=n,r["x-decorator-props"].fieldNames=n,i.refresh(),l.emit("patch",{schema:(tf(t={},"x-uid",r["x-uid"]),tf(t,"x-decorator-props",a.decoratorProps),t)}),l.refresh()}}},useVisible:function(){var e,t,r=(0,h.useFieldSchema)(),o=(0,n.useCollectionManager_deprecated)().getCollectionFieldsOptions,i=(0,n.useCollection)().name,a=(null==r?void 0:null===(e=r["x-decorator-props"])||void 0===e?void 0:e.fieldNames)||{},l=o(i,["point","lineString","polygon"],null,{association:["o2o","obo","oho","o2m","m2o","m2m"]});return(null===(t=e2(a.field,l))||void 0===t?void 0:t.type)==="point"}},{name:"setDefaultSortingRules",Component:n.SchemaSettingsDefaultSortingRules,useComponentProps:function(){return{path:"x-component-props.lineSort",title:(0,f().t)("Concatenation order field")}}},n.setDataLoadingModeSettingsItem,td,{name:"dataScope",Component:n.SchemaSettingsDataScope,useComponentProps:function(){var e,t,r=(0,n.useCollection)().name,o=(0,h.useFieldSchema)(),i=(0,n.useFormBlockContext)().form,a=(0,h.useField)(),l=ti().service,c=(0,n.useDesignable)().dn;return{collectionName:r,defaultFilter:(null==o?void 0:null===(t=o["x-decorator-props"])||void 0===t?void 0:null===(e=t.params)||void 0===e?void 0:e.filter)||{},form:i,onSubmit:function(e){var t,n,r,i=e.filter,u=a.decoratorProps.params||{};u.filter=i,a.decoratorProps.params=u,o["x-decorator-props"].params=u,null===(n=l.params)||void 0===n||null===(t=n[1])||void 0===t||t.filters,c.emit("patch",{schema:(tf(r={},"x-uid",o["x-uid"]),tf(r,"x-decorator-props",o["x-decorator-props"]),r)})}}}},{name:"ConnectDataBlocks",Component:n.SchemaSettingsConnectDataBlocks,useComponentProps:function(){var e=f().t;return{type:n.FilterBlockType.TABLE,emptyDescription:e("No blocks to connect")}}},{name:"divider",type:"divider"},{name:"template",Component:n.SchemaSettingsTemplate,useComponentProps:function(){var e,t,r=(0,n.useCollection)().name,o=(0,h.useFieldSchema)(),i=(0,n.useBlockTemplateContext)().componentNamePrefix,a=(null==o?void 0:null===(e=o["x-decorator-props"])||void 0===e?void 0:e.resource)||(null==o?void 0:null===(t=o["x-decorator-props"])||void 0===t?void 0:t.association);return{componentName:"".concat(i,"Map"),collectionName:r,resourceName:a}}},{name:"divider2",type:"divider"},{name:"remove",type:"remove",componentProps:{removeParentsIfNoChildren:!0,breakRemoveOn:{"x-component":"Grid"}}}]});function ty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tv(e){return(tv=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tg(e,t){return(tg=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tb(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tb=function(){return!!e})()}var th=n.interfacesProperties.defaultProps;Array.isArray(n.interfacesProperties.type.enum)&&n.interfacesProperties.type.enum.push({label:"Point",value:"point"},{label:"LineString",value:"lineString"},{label:"Polygon",value:"polygon"},{label:"Circle",value:"circle"});var tO=function(e){function t(){var e,n,r,o,i,a;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),n=this,r=t,o=arguments,r=tv(r),ty(e=function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(n,tb()?Reflect.construct(r,o||[],tv(n).constructor):r.apply(n,o)),"properties",(i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ty(e,t,n[t])})}return e}({},th),a=(a={"uiSchema.x-component-props.mapType":{title:p("Map type"),type:"string",required:!0,"x-decorator":"FormItem","x-component":"Select","x-component-props":{showSearch:!1,allowClear:!1},"x-disabled":"{{ isOverride || !createOnly }}",default:"amap",enum:y}},a),Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(a)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(a,e))}),i)),e}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tg(e,t)}(t,e),t}(n.CollectionFieldInterface);function tw(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tS(e){return(tS=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tP(e,t){return(tP=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tA=function(){return!!e})()}var tj=function(e){function t(){var e,n,r,o;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),n=this,r=t,o=arguments,r=tS(r),tw(e=function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(n,tA()?Reflect.construct(r,o||[],tS(n).constructor):r.apply(n,o)),"name","circle"),tw(e,"type","object"),tw(e,"group","map"),tw(e,"order",3),tw(e,"title",p("Circle")),tw(e,"availableTypes",["circle","json"]),tw(e,"description",p("Circle")),tw(e,"sortable",!0),tw(e,"default",{type:"circle",uiSchema:{type:"void","x-component":"Map","x-component-designer":"Map.Designer","x-component-props":{}}}),e}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tP(e,t)}(t,e),t}(tO);function tx(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tC(e){return(tC=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tE(e,t){return(tE=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tM=function(){return!!e})()}var tk=function(e){function t(){var e,n,r,o;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),n=this,r=t,o=arguments,r=tC(r),tx(e=function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(n,tM()?Reflect.construct(r,o||[],tC(n).constructor):r.apply(n,o)),"name","lineString"),tx(e,"type","object"),tx(e,"group","map"),tx(e,"order",2),tx(e,"title",p("Line")),tx(e,"description",p("Line")),tx(e,"availableTypes",["lineString","json"]),tx(e,"sortable",!0),tx(e,"default",{type:"lineString",uiSchema:{type:"void","x-component":"Map","x-component-designer":"Map.Designer","x-component-props":{}}}),e}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tE(e,t)}(t,e),t}(tO);function tI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tF(e){return(tF=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tD(e,t){return(tD=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tT(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tT=function(){return!!e})()}var tz=function(e){function t(){var e,n,r,o;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),n=this,r=t,o=arguments,r=tF(r),tI(e=function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(n,tT()?Reflect.construct(r,o||[],tF(n).constructor):r.apply(n,o)),"name","point"),tI(e,"type","object"),tI(e,"group","map"),tI(e,"order",1),tI(e,"title",p("Point")),tI(e,"description",p("Point")),tI(e,"availableTypes",["point","json"]),tI(e,"sortable",!0),tI(e,"default",{type:"point",uiSchema:{type:"void","x-component":"Map","x-component-designer":"Map.Designer","x-component-props":{}}}),e}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tD(e,t)}(t,e),t}(tO);function tL(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tR(e){return(tR=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tB(e,t){return(tB=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tN=function(){return!!e})()}var t_=[tz,function(e){function t(){var e,n,r,o;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),n=this,r=t,o=arguments,r=tR(r),tL(e=function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(n,tN()?Reflect.construct(r,o||[],tR(n).constructor):r.apply(n,o)),"name","polygon"),tL(e,"type","object"),tL(e,"group","map"),tL(e,"order",4),tL(e,"title",p("Polygon")),tL(e,"description",p("Polygon")),tL(e,"availableTypes",["polygon","json"]),tL(e,"sortable",!0),tL(e,"default",{type:"polygon",uiSchema:{type:"void","x-component":"Map","x-component-designer":"Map.Designer","x-component-props":{}}}),e}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tB(e,t)}(t,e),t}(tO),tk,tj],tU=new n.SchemaSettings({name:"fieldSettings:component:Map",items:[td]});function tK(e,t,n,r,o,i,a){try{var l=e[i](a),c=l.value}catch(e){n(e);return}l.done?t(c):Promise.resolve(c).then(r,o)}function tG(e,t,n){return(tG=tJ()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&tW(o,n.prototype),o}).apply(null,arguments)}function tq(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tV(e){return(tV=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tW(e,t){return(tW=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tY(e){var t="function"==typeof Map?new Map:void 0;return(tY=function(e){var n;if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return tG(e,arguments,tV(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),tW(r,e)})(e)}function tJ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tJ=function(){return!!e})()}var tZ=o().memo(function(e){return o().createElement(n.SchemaComponentOptions,{components:{Map:eJ}},o().createElement(tl,null,e.children))});tZ.displayName="MapProvider";var tX=function(e){var t,n,r;function o(){var e,t,n;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),e=this,t=o,n=arguments,t=tV(t),function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,tJ()?Reflect.construct(t,n||[],tV(e).constructor):t.apply(e,n))}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tW(e,t)}(o,e),t=o,n=[{key:"load",value:function(){var e,t=this;return(e=function(){var e;return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(n){return t.app.use(tZ),t.app.dataSourceManager.addFieldInterfaces(t_),t.app.dataSourceManager.addFieldInterfaceGroups({map:{label:p("Map-based geometry"),order:51}}),t.app.schemaInitializerManager.add(ts),t.app.schemaInitializerManager.add(tp),t.schemaSettingsManager.add(tm),t.schemaSettingsManager.add(tU),null==(e=t.app.schemaInitializerManager.get("page:addBlock"))||e.add("dataBlocks.map",{title:p("Map"),Component:"MapBlockInitializer"}),t.app.schemaInitializerManager.addItem("mobile:addBlock","dataBlocks.map",{title:p("Map"),Component:"MapBlockInitializer"}),t.app.pluginSettingsManager.add("map",{title:'{{t("Map manager", { ns: "'.concat("map",'" })}}'),icon:"EnvironmentOutlined",Component:eo,aclSnippet:"pm.map.configuration"}),t.app.addScopes({useMapBlockProps:ta}),[2]})},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){tK(i,r,o,a,l,"next",e)}function l(e){tK(i,r,o,a,l,"throw",e)}a(void 0)})})()}}],tq(t.prototype,n),o}(tY(n.Plugin)),tH=tX}(),m}()});