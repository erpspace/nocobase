/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

"use strict";(self.webpackChunk_nocobase_plugin_graph_collection_manager=self.webpackChunk_nocobase_plugin_graph_collection_manager||[]).push([["34"],{8909:function(e,t,n){n.r(t),n.d(t,{GraphCollectionPane:function(){return tY}});var r,o,i,a,l,c=n("482"),u=n("8875"),s=n("3772"),d=n("8156"),p=n.n(d),f=n("3505"),m=n("5229"),h=n("7584"),y=n("2721"),g=n("9007"),v=n.n(g),b=n("3238"),x=(0,d.createContext)(null);x.displayName="GraphCollectionContext";var C=function(e){var t=e.record,n=e.setTargetNode,r=e.node,o=e.handelOpenPorts;return p().createElement(x.Provider,{value:{node:r,record:t,positionTargetNode:function(e){n(e||r)},openPorts:o}},e.children)};function w(e,t,n,r,o,i,a){try{var l=e[i](a),c=l.value}catch(e){n(e);return}l.done?t(c):Promise.resolve(c).then(r,o)}function O(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){w(i,r,o,a,l,"next",e)}function l(e){w(i,r,o,a,l,"throw",e)}a(void 0)})}}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}function P(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}var S=function(e,t){var n,r,o=(0,s.useRequest)(function(){return Promise.resolve({data:v()(t)})},(n=E({},e),r=(r={manual:!0},r),Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(r)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))}),n)),i=(0,s.useActionContext)();return(0,d.useEffect)(function(){i.visible&&o.run()},[i.visible]),o};(0,f.observer)(function(){var e=(0,d.useContext)(x).record,t=(0,s.useCompile)();return p().createElement("div",null,p().createElement(y.Select,{popupMatchSelectWidth:!1,disabled:!0,value:e.name,options:[{value:e.name,label:t(e.title)}]}))},{displayName:"SourceCollection"});var A=function(){var e=(0,f.useForm)(),t=(0,s.useActionContext)();return{run:function(){return O(function(){return P(this,function(n){return t.setVisible(!1),e.reset(),[2]})})()}}},k=function(e){var t=(0,f.useForm)(),n=(0,s.useAPIClient)(),r=(0,s.useActionContext)(),o=(0,s.useCollectionManager_deprecated)().refreshCM;return{run:function(){return O(function(){return P(this,function(i){switch(i.label){case 0:return[4,t.submit()];case 1:return i.sent(),[4,n.resource("collections").create({values:t.values})];case 2:return i.sent(),r.setVisible(!1),[4,t.reset()];case 3:return i.sent(),e("last"),[4,o()];case 4:return i.sent(),[2]}})})()}}},j=function(e,t){var n=(0,f.useForm)(),r=(0,s.useAPIClient)(),o=(0,s.useActionContext)(),i=(0,s.useCollectionManager_deprecated)().refreshCM,a=(0,d.useContext)(x),l=a.positionTargetNode,c=a.openPorts,u=(0,s.useCollectionFieldFormValues)().getValues;return{run:function(){return O(function(){var a,s,d,p,f;return P(this,function(m){switch(m.label){case 0:return[4,n.submit()];case 1:return m.sent(),a=u(),s=h.lodash.omit(a,["key","uiSchemaUid","collectionName","autoCreateReverseField","uiSchema.x-uid","reverseField.key","reverseField.uiSchemaUid"]),d=!["obo","oho","o2o","o2m","m2o","m2m","linkTo","id"].includes(a.interface),[4,r.resource("collections.fields",e).create({values:s})];case 2:if(p=m.sent().data.data,!(f=t))return[3,4];return[4,r.resource("fields").move({sourceId:p.key,targetId:t,targetScope:e,method:"insertAfter"})];case 3:f=m.sent(),m.label=4;case 4:return o.setVisible(!1),[4,n.reset()];case 5:return m.sent(),l(),d&&c&&c(),[4,i()];case 6:return m.sent(),[2]}})})()}}},I=function(e){var t=e.collectionName,n=e.name,r=e.key,o=(0,s.useCollectionManager_deprecated)().refreshCM,i=(0,b.useTranslation)().t,a=(0,f.useForm)(),l=(0,s.useActionContext)(),c=(0,s.useAPIClient)(),u=(0,d.useContext)(x),p=u.positionTargetNode,m=u.node;return{run:function(){return O(function(){var e;return P(this,function(u){switch(u.label){case 0:return[4,a.submit()];case 1:return u.sent(),[4,c.resource("collections.fields",t).update({filterByTk:n,values:a.values})];case 2:return u.sent(),l.setVisible(!1),y.message.success(i("Saved successfully")),p(),o(),m.setPortProp(r,"uiSchema",{title:null===(e=a.values)||void 0===e?void 0:e.uiSchema.title}),[4,a.reset()];case 3:return u.sent(),[2]}})})()}}},N=function(){var e=(0,b.useTranslation)().t,t=(0,f.useForm)(),n=(0,s.useActionContext)(),r=t.values.name,o=(0,s.useAPIClient)(),i=(0,s.useCollectionManager_deprecated)().refreshCM,a=(0,d.useContext)(x).positionTargetNode;return{run:function(){return O(function(){return P(this,function(l){switch(l.label){case 0:return[4,t.submit()];case 1:return l.sent(),[4,o.resource("collections").update({filterByTk:r,values:E({},h.lodash.omit(t.values,["fields"]))})];case 2:return l.sent(),n.setVisible(!1),y.message.success(e("Saved successfully")),[4,t.reset()];case 3:return l.sent(),a(),i(),[2]}})})()}}},T=function(e){var t=(0,s.useAPIClient)(),n=(0,f.useForm)(),r=((null==n?void 0:n.values)||{}).cascade;return{run:function(){return O(function(){return P(this,function(n){switch(n.label){case 0:return[4,t.resource("collections").destroy({filterByTk:e,cascade:r})];case 1:return n.sent(),[4,t.resource("graphPositions").destroy({filter:{collectionName:e}})];case 2:return n.sent(),[2]}})})()}}},B=function(e){var t=T(e.name).run,n=(0,s.useCollectionManager_deprecated)().refreshCM,r=(0,d.useContext)(x).positionTargetNode;return{run:function(){return O(function(){return P(this,function(e){switch(e.label){case 0:return[4,t()];case 1:return e.sent(),r("destory"),[4,n()];case 2:return e.sent(),[2]}})})()}}},M=function(e,t){var n=(0,s.useAPIClient)(),r=(0,d.useContext)(x).positionTargetNode;return{run:function(){return O(function(){return P(this,function(o){switch(o.label){case 0:return[4,n.resource("collections.fields",e).destroy({filterByTk:t})];case 1:return o.sent(),r(),[2]}})})()}}},D=function(e){var t=e.collectionName,n=e.name,r=(0,s.useCollectionManager_deprecated)().refreshCM,o=M(t,n).run;return{run:function(){return O(function(){return P(this,function(e){switch(e.label){case 0:return[4,o()];case 1:return e.sent(),[4,r()];case 2:return e.sent(),[2]}})})()}}},F=function(e){return function(t,n){var r=n.targetScope;t.loading=!0,e(r).then(m.action.bound(function(e){t.dataSource=e,t.loading=!1})).catch(function(e){(0,h.error)(e)})}},L=n("5535"),R=n("5666"),_=n("655"),G=n("3502"),V=n("546"),z=n("2403"),K=n("4964"),H=n("1011"),U=n.n(H),W=n("467"),$=n.n(W),q=n("6128");function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}function Q(e){return function(e){if(Array.isArray(e))return Y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var X=$().groupBy,Z=$().reduce,ee=$().uniq,et=$().uniqBy,en="er-rect",er=function(){return(0,b.useTranslation)("graph-collection-manager")},eo=function(e,t){var n=[],r=function(t){var o=null==e?void 0:e.find(function(e){return e.name===t});if(o){var i=o.inherits;if(i)for(var a=0;a<i.length;a++){var l=i[a];n.push(l),r(l)}}return ee(n)};return r(t)},ei=function(e,t){var n=[],r=function(t){return e.filter(function(e){var n;return null===(n=e.inherits)||void 0===n?void 0:n.includes(t)}).forEach(function(e){var t=e.name;return n.push(e),r(t)}),n};return r(t)},ea=function(e){var t=[],n=[],r=e.map(function(r){var o=[],i=Q(r.fields),a=Z(eo(e,r.name),function(t,n){var o,i=null===(o=e.find(function(e){return e.name===n}))||void 0===o?void 0:o.fields.map(function(e){var t,n;return t=J({},e),n=(n={sourceCollectionName:r.name},n),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t});return i?t.concat(i):t},[]);et(i.concat(a),"name").forEach(function(e){e.uiSchema&&o.push(J({id:e.name,group:"list"},e)),["obo","oho","o2o","o2m","m2o","m2m","linkTo","mbm"].includes(e.interface)&&t.push(e)}),n.push(r.name);var l=el(o);return{id:r.name,shape:en,name:r.name,title:r.title,width:250,ports:Q(l.initPorts||[]).concat(Q(l.morePorts||[])),item:r}}),o=eu(t,n,r);return{nodesData:r,edgesData:o,inheritEdges:ec(e)}},el=function(e){return X(e,function(e){return e.isForeignKey||e.primaryKey||["obo","oho","o2o","o2m","m2o","m2m","linkTo","id","mbm"].includes(e.interface)?"initPorts":"morePorts"})},ec=function(e){var t={attrs:{line:{strokeWidth:1,textAnchor:"middle",textVerticalAnchor:"middle",stroke:"#ddd",sourceMarker:null}},router:{name:"smooth",args:{direction:"H"}},labels:[{markup:[{tagName:"ellipse",selector:"labelBody",style:{cursor:"pointer"}},{tagName:"text",selector:"labelText",style:{cursor:"pointer"}}],attrs:{labelText:{text:"inherits",fill:"rgba(0, 0, 0, 0.3)",textAnchor:"middle",textVerticalAnchor:"middle"},labelBody:{ref:"labelText",refWidth:"100%",refHeight:"100%",fill:"var(--nb-box-bg)"}},position:{distance:.5,args:{keepGradient:!0,ensureLegibility:!0}}}]},n=[];return e.forEach(function(e){var r=e.inherits||[];r.length&&r.forEach(function(r){n.push(J({id:e.name+r,source:{cell:e.name,connectionPoint:"rect"},target:{cell:r,connectionPoint:"rect"},connector:{name:"normal",zIndex:1e3},connectionType:"inherited"},t))})}),n},eu=function(e,t,n){for(var r=function(r){if(t.includes(e[r].target)){var i=n.find(function(t){return t.name===e[r].target}),a=n.find(function(t){return t.name===(e[r].sourceCollectionName||e[r].collectionName)}),l={attrs:{line:{strokeWidth:1,textAnchor:"middle",textVerticalAnchor:"middle",stroke:"#ddd",sourceMarker:null,targetMarker:null}},router:a.id===i.id?{name:"oneSide",args:{side:"left"}}:{name:"er",args:{direction:"H"}},labels:[{markup:[{tagName:"ellipse",selector:"labelBody",style:{cursor:"pointer"}},{tagName:"text",selector:"labelText",style:{cursor:"pointer"}}],attrs:{labelText:{text:es(e[r].interface)[0],fill:"rgba(0, 0, 0, 0.3)",textAnchor:"middle",textVerticalAnchor:"middle"},labelBody:{ref:"labelText",refWidth:"100%",refHeight:"100%",stroke:"#ddd",fill:"var(--nb-box-bg)",strokeWidth:1,rx:10,ry:10}},position:{distance:.3,args:{keepGradient:!0,ensureLegibility:!0}}},{markup:[{tagName:"ellipse",selector:"labelBody",style:{cursor:"pointer"}},{tagName:"text",selector:"labelText",style:{cursor:"pointer"}}],attrs:{labelText:{text:es(e[r].interface)[1],fill:"rgba(0, 0, 0, 0.3)",textAnchor:"middle",textVerticalAnchor:"middle"},labelBody:{ref:"labelText",refWidth:"100%",refHeight:"100%",stroke:"#ddd",fill:"var(--nb-box-bg)",rx:10,ry:10,strokeWidth:1}},position:{distance:.7,args:{keepGradient:!0,ensureLegibility:!0}}}],connector:{name:"normal",zIndex:1e3}},c=function(t){var n=o.find(function(e){return e.id===t});return!n||(n.associated.push(e[r].name),!1)};if(["m2m","linkTo"].includes(e[r].interface)){var u=n.find(function(t){return t.name===e[r].through});if(u){var s,d,p,f,m=a.id,h=u.id,y=null===(s=a.ports.find(function(t){return t.name===e[r].sourceKey}))||void 0===s?void 0:s.id,g=null===(d=u.ports.find(function(t){return t.name===e[r].foreignKey}))||void 0===d?void 0:d.id,v=i.id,b=u.id,x=null===(p=i.ports.find(function(t){return t.name===e[r].targetKey}))||void 0===p?void 0:p.id,C=null===(f=u.ports.find(function(t){return t.name===e[r].otherKey}))||void 0===f?void 0:f.id,w=m+y+h+g,O=v+x+b+C;o.push(J({id:w,source:{cell:m,port:y,anchor:{name:"right"}},target:{cell:h,port:g,anchor:{name:"left"}},associated:[e[r].name],m2m:[w,O]},l)),o.push(J({id:O,source:{cell:v,port:x,anchor:{name:"right"}},target:{cell:b,port:C,anchor:{name:"left"}},associated:[e[r].name],m2m:[w,O]},l))}}else{var E,P,S,A=n.find(function(t){return t.name==(e[r].sourceCollectionName||e[r].collectionName)}).ports.find(function(t){return t.name===e[r].foreignKey}),k=a.id,j=i.id,I=null==A?void 0:A.id,N=null===(E=i.ports.find(function(t){return t.name===e[r].targetKey}))||void 0===E?void 0:E.id,T=a.id,B=i.id,M=null===(P=a.ports.find(function(t){return t.name===e[r].sourceKey}))||void 0===P?void 0:P.id,D=null===(S=i.ports.find(function(t){return t.name===e[r].foreignKey}))||void 0===S?void 0:S.id;c(j+N+k+I)&&A&&N&&o.push(J({id:k+I+j+N,source:{cell:k,port:I,anchor:{name:"right"}},target:{cell:j,port:N,anchor:{name:"left"}},associated:[e[r].name]},l)),c(B+D+T+M)&&M&&D&&o.push(J({id:T+M+B+D,source:{cell:T,port:M,anchor:{name:"right"}},target:{cell:B,port:D,anchor:{name:"left"}},associated:[e[r].name]},l))}}},o=[],i=0;i<e.length;i++)r(i);return et(o,"id")},es=function(e){switch(e){case"m2m":case"linkTo":case"o2m":return["1","N"];case"m2o":return["N","1"];case"obo":case"oho":return["1","1"];case"mbm":return["N","N"];default:return[]}},ed=function(e,t){for(var n=function(n){if(t.find(function(t){return t.id===e[n].id})){var r=t.find(function(t){return t.id===e[n].id}),i=null==r?void 0:r.ports.items,a=e[n].ports;if(r){for(var l=function(t){!i.find(function(e){return e.id===a[t].id})&&o.push({status:"insertPort",node:e[n],port:{index:t,port:a[t]}})},c=function(t){!a.find(function(e){return e.id===i[t].id})&&o.push({status:"deletePort",node:e[n],port:i[t]})},u=0;u<a.length;u++)l(u);for(var s=0;s<i.length;s++)c(s);r.title!==e[n].title&&o.push({status:"updateNode",node:e[n]})}}else o.push({status:"add",node:e[n]})},r=function(n){!e.find(function(e){return e.id===t[n].id})&&o.push({status:"delete",node:t[n]})},o=[],i=e.length,a=t.length,l=0;l<i;l++)n(l);for(var c=0;c<a;c++)r(c);return o},ep=function(e,t){for(var n=function(n){!t.find(function(t){return t.id===e[n].id})&&a.push({status:"add",edge:e[n]})},r=function(n){!e.find(function(e){return e.id===t[n].id})&&a.push({status:"delete",edge:t[n]})},o=e.length,i=null==t?void 0:t.length,a=[],l=0;l<o;l++)n(l);for(var c=0;c<i;c++)r(c);return a},ef=function(){return i?i:i=document.getElementById("graph_container")},em=function(){i=null},eh={name:"collections",filterTargetKey:"name",targetKey:"name",sortable:!0,fields:[{type:"integer",name:"title",interface:"input",uiSchema:{title:'{{ t("Collection display name") }}',type:"number","x-component":"Input",required:!0}},{type:"string",name:"name",interface:"input",uiSchema:{title:'{{ t("Collection name") }}',type:"string","x-component":"Input",description:'{{t("Randomly generated and can be modified. Support letters, numbers and underscores, must start with an letter.")}}'}},{type:"string",name:"template",interface:"input",uiSchema:{title:'{{ t("Collection Template") }}',type:"string","x-component":"Input"}},{type:"hasMany",name:"fields",target:"fields",collectionName:"collections",sourceKey:"name",targetKey:"name",uiSchema:{}},{type:"hasMany",name:"inherits",interface:"select",uiSchema:{title:'{{ t("Inherits") }}',type:"string","x-component":"Select","x-component-props":{mode:"multiple"}}},{type:"string",name:"description",interface:"input",uiSchema:{title:'{{ t("Description") }}',type:"string","x-component":"Input"}}]},ey=function(e){var t=e.item;return p().createElement(s.AddCollection,{trigger:["click"],align:{overflow:{adjustY:!1}},item:t,scope:{useCancelAction:A},getContainer:ef},p().createElement(y.Button,{type:"primary"},p().createElement(c.PlusOutlined,null)))};function eg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ev(e,t){return!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function eb(){var e=ev(["\n          .ant-menu-item {\n            height: 32px;\n            line-height: 32px;\n          }\n        "]);return eb=function(){return e},e}function ex(){var e=ev(["\n        .ant-popover-inner-content {\n          padding: 0;\n        }\n      "]);return ex=function(){return e},e}var eC=function(e){var t,n=e.onClick,r=er().t,o=[{key:t_.Both,label:"All relationships"},{key:t_.Entity,label:"Entity relationship only"},{key:t_.Inherit,label:"Inheritance relationship only"}];var i=p().createElement("div",null,p().createElement(y.Menu,{defaultSelectedKeys:[t_.Both],selectable:!0,className:(0,K.css)(eb()),style:{maxHeight:"70vh",overflowY:"auto",border:"none"},items:[{type:"divider"}].concat(function(e){if(Array.isArray(e))return eg(e)}(t=o.map(function(e){return{key:e.key,label:r(e.label),onClick:function(t){null==n||n(e.key)}}}))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return eg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eg(e,t)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}));return p().createElement(y.Popover,{content:i,autoAdjustOverflow:!0,placement:"bottomRight",trigger:["click"],getPopupContainer:ef,overlayClassName:(0,K.css)(ex())},p().createElement(y.Button,null,p().createElement(c.ShareAltOutlined,null)))};function ew(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eO(e,t){return!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function eE(){var e=eO(["\n          .ant-menu-item {\n            height: 32px;\n            line-height: 32px;\n          }\n        "]);return eE=function(){return e},e}function eP(){var e=eO(["\n        .ant-popover-inner-content {\n          padding: 0;\n        }\n      "]);return eP=function(){return e},e}var eS=function(e){var t,n=e.onClick,r=er().t,o=[{key:tR.Both,label:"All directions"},{key:tR.Target,label:"Target index"},{key:tR.Source,label:"Source index"}];var i=p().createElement("div",null,p().createElement(y.Menu,{defaultSelectedKeys:[tR.Target],selectable:!0,className:(0,K.css)(eE()),style:{maxHeight:"70vh",overflowY:"auto",border:"none"},items:[{type:"divider"}].concat(function(e){if(Array.isArray(e))return ew(e)}(t=o.map(function(e){return{key:e.key,label:r(e.label),onClick:function(){null==n||n(e.key)}}}))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return ew(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ew(e,t)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}));return p().createElement(y.Popover,{content:i,autoAdjustOverflow:!0,placement:"bottomRight",trigger:["click"],getPopupContainer:ef,overlayClassName:(0,K.css)(eP())},p().createElement(y.Button,null,p().createElement(c.LineHeightOutlined,null)))};function eA(e,t){return!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function ek(){var e=eA(["\n      .x6-widget-minimap {\n        background-color: ",";\n      }\n    "]);return ek=function(){return e},e}function ej(){var e=eA(["\n      flex-shrink: 0;\n      padding: 2em 0;\n    "]);return ej=function(){return e},e}function eI(){var e=eA(["\n      .btn-del {\n        border-color: transparent;\n        background-color: ",";\n        color: ",";\n        height: 20px;\n        width: 20px;\n        &:hover {\n          background-color: ",";\n        }\n      }\n      .btn-add {\n        background: ",";\n        border-color: transparent;\n        color: ",";\n        width: 20px;\n        &:hover {\n          background-color: ",";\n        }\n      }\n      .btn-edit {\n        color: ",";\n        display: flex;\n        &:hover {\n          background: ",";\n        }\n      }\n      .btn-edit-in-head {\n        border-color: transparent;\n        color: ",";\n        height: 20px;\n        width: 22px;\n        margin: 0px 5px 4px;\n        line-height: 25px;\n        &:hover {\n          background: ",";\n        }\n      }\n      .btn-inheriedParent {\n        background: ",";\n        border-color: transparent;\n        color: ",";\n        width: 20px;\n        height: 20px;\n        line-height: 25px;\n        &:hover {\n          background-color: ",";\n        }\n      }\n      .btn-inheriedChild {\n        background: ",";\n        border-color: transparent;\n        color: ",";\n        width: 20px;\n        height: 20px;\n        margin: 0px 5px 4px;\n        &:hover {\n          background-color: ",";\n        }\n      }\n      width: 250px;\n      height: 100%;\n      border-radius: ","px;\n      background-color: ",";\n      border: 0;\n      overflow: hidden;\n      &:hover {\n        box-shadow: ",";\n      }\n      .body {\n        width: 100%;\n        height: 100%;\n        background-color: ",";\n        cursor: pointer;\n        .morePorts {\n          max-height: 300px;\n          overflow: auto;\n        }\n        .body-item {\n          display: inline-table;\n          width: 100%;\n          max-width: 250px;\n          height: 40px;\n          font-size: 14px;\n          color: ",";\n          border-top: 1px solid ",";\n          text-overflow: ellipsis;\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          justify-content: space-between;\n\n          .field-operator {\n            display: none;\n          }\n          &:hover {\n            .field-operator {\n              display: flex;\n              flex-direction: row-reverse;\n              height: 32px;\n              line-height: 32px;\n              z-index: 999;\n              cursor: pointer;\n              text-align: right;\n              background: ",";\n              padding-right: 3px;\n              span {\n                margin: 3px;\n                margin-left: 4px;\n                padding: 3px;\n                height: 20px;\n                width: 20px;\n              }\n              .btn-override {\n                border-color: transparent;\n                width: 20px;\n                color: ",";\n                &:hover {\n                  background-color: ",";\n                }\n              }\n              .btn-view {\n                border-color: transparent;\n                color: ",";\n                width: 20px;\n              }\n              .btn-view:hover {\n                background: ",";\n              }\n              .btn-assocition {\n                border-color: transparent;\n                color: ",";\n                width: 20px;\n              }\n              .btn-assocition:hover {\n                background: ",";\n              }\n            }\n            .field_type {\n              display: none;\n            }\n          }\n\n          .name {\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            overflow: hidden;\n            margin-left: 8px;\n            min-width: 50%;\n            .ant-badge {\n              padding-right: 5px;\n            }\n          }\n\n          .type {\n            color: ",";\n            margin-right: 8px;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            overflow: hidden;\n          }\n        }\n      }\n    "]);return eI=function(){return e},e}function eN(){var e=eA(["\n      height: 50px;\n      font-size: 14px;\n      font-weight: 500;\n      display: flex;\n      flex-direction: row;\n      justify-content: space-between;\n      align-items: center;\n      background: ",";\n      color: ",";\n      padding: 0 8px;\n    "]);return eN=function(){return e},e}function eT(){var e=eA(["\n      max-width: 80%;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n      font-weight: 500;\n    "]);return eT=function(){return e},e}function eB(){var e=eA(["\n      display: flex;\n      span {\n        cursor: pointer;\n      }\n    "]);return eB=function(){return e},e}function eM(){var e=eA(["\n      div.field-content {\n        font-size: 14px;\n        color: ",";\n        opacity: 0.8;\n        display: block;\n        .field-type {\n          color: ",";\n          float: right;\n        }\n      }\n    "]);return eM=function(){return e},e}function eD(){var e=eA(["\n      .nb-action-bar {\n        float: right;\n        position: fixed;\n        margin-top: 24px;\n        right: 24px;\n        z-index: 1000;\n        .trigger {\n          float: right;\n          margin: 2px 4px;\n          font-size: 16px;\n        }\n        .ant-input {\n          margin: 4px;\n        }\n        .ant-menu-inline {\n          border-top: 1px solid ",";\n        }\n        .ant-layout-sider {\n          margin-top: 24px;\n        }\n        .ant-menu-item {\n          height: 32px;\n        }\n        .ant-btn {\n          border: 0;\n        }\n      }\n    "]);return eD=function(){return e},e}function eF(){var e=eA(["\n      overflow: hidden;\n      #container {\n        height: 100% !important;\n      }\n      .x6-graph-scroller {\n        height: calc(100vh) !important;\n        width: calc(100vw) !important;\n      }\n    "]);return eF=function(){return e},e}var eL=(0,s.createStyles)(function(e){var t=e.token,n=e.css;return{graphMinimap:n(ek(),t.colorBgContainer),addButtonClass:n(ej()),entityContainer:n(eI(),t.colorErrorBg,t.colorErrorText,t.colorErrorBgHover,t.colorSuccessBg,t.colorSuccessText,t.colorSuccessBgHover,t.colorText,t.colorBgTextHover,t.colorText,t.colorBgTextHover,t.colorInfoBg,t.colorInfo,t.colorInfoBgHover,t.colorInfoBg,t.colorInfo,t.colorInfoBgHover,t.borderRadiusLG,t.colorBgContainer,t.boxShadowTertiary,t.colorBgContainer,t.colorText,t.colorBorderSecondary,t.colorBgContainer,t.colorText,t.colorBgTextHover,t.colorText,t.colorBgTextHover,t.colorPrimary,t.colorBgTextHover,t.colorTextTertiary),headClass:n(eN(),t.colorFillAlter,t.colorTextHeading),tableNameClass:n(eT()),tableBtnClass:n(eB()),collectionPopoverClass:n(eM(),t.colorTextSecondary,t.colorText),collectionListClass:n(eD(),t.colorBorderSecondary),graphCollectionContainerClass:n(eF())}});function eR(e,t,n,r,o,i,a){try{var l=e[i](a),c=l.value}catch(e){n(e);return}l.done?t(c):Promise.resolve(c).then(r,o)}var e_=function(e){var t=j(e.collectionName,e.key).run;return{run:function(){var e;return(e=function(){return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(e){switch(e.label){case 0:return[4,t()];case 1:return e.sent(),[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){eR(i,r,o,a,l,"next",e)}function l(e){eR(i,r,o,a,l,"throw",e)}a(void 0)})})()}}},eG=function(e){var t=e.item,n=e.database;return p().createElement(s.AddFieldAction,{trigger:["click"],align:{overflow:{adjustY:!1}},item:t,database:n,scope:{useCancelAction:A,useCreateCollectionField:function(){return e_(t)}},getContainer:ef},p().createElement(c.PlusOutlined,{className:"btn-add",id:"graph_btn_add_field"}))},eV=function(e){var t=e.targetGraph,n=e.item;return p().createElement(c.BranchesOutlined,{className:"btn-assocition",onClick:function(){t.onConnectionAssociation(n)}})},ez=function(e){var t=e.targetGraph,n=e.item,r=er().t,o=(0,(0,s.useCollectionManager_deprecated)().getChildrenCollections)(n.name);return(null==o?void 0:o.some(function(e){var n=e.name;return!t.hasCell(n)}))?p().createElement(y.Tooltip,{title:r("Show child"),getPopupContainer:ef},p().createElement(c.FallOutlined,{className:"btn-inheriedChild",onClick:function(){t.onConnectionChilds(o.map(function(e){return e.name}))}})):""},eK=function(e){var t=e.targetGraph,n=e.item,r=er().t,o=(0,(0,s.useCollectionManager_deprecated)().getInheritCollections)(n.name);return(null==o?void 0:o.some(function(e){return!t.hasCell(e)}))?p().createElement(y.Tooltip,{title:r("Show parent"),getPopupContainer:ef},p().createElement(c.RiseOutlined,{className:"btn-inheriedParent",onClick:function(){t.onConnectionParents(o)}})):""},eH=function(e){var t=e.item,n=e.className,r=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],!(t.indexOf(n)>=0)&&(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++){if(n=i[r],!(t.indexOf(n)>=0))Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}}return o}(e,["item","className"]);return p().createElement(s.DeleteCollection,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({item:t,scope:{useCancelAction:A,useUpdateCollectionActionAndRefreshCM:N,createOnly:!1},getContainer:ef},r),p().createElement(c.DeleteOutlined,{className:n}))},eU=function(e){var t=e.item,n=e.className;return p().createElement(s.EditCollection,{item:t,scope:{useCancelAction:A,useUpdateCollectionActionAndRefreshCM:N,createOnly:!1},getContainer:ef},p().createElement(c.EditOutlined,{className:n}))};function eW(e,t,n,r,o,i,a){try{var l=e[i](a),c=l.value}catch(e){n(e);return}l.done?t(c):Promise.resolve(c).then(r,o)}var e$=function(e){var t=I({collectionName:e.collectionName,name:e.name,key:e.id}).run;return{run:function(){var e;return(e=function(){return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(e){switch(e.label){case 0:return[4,t()];case 1:return e.sent(),[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){eW(i,r,o,a,l,"next",e)}function l(e){eW(i,r,o,a,l,"throw",e)}a(void 0)})})()}}},eq=function(e){var t=e.item,n=e.parentItem;return p().createElement(s.EditFieldAction,{item:t,parentItem:n,scope:{useCancelAction:A,useUpdateCollectionField:function(){return e$(t)}},getContainer:ef},p().createElement(c.EditOutlined,{className:"btn-edit"}))};function eY(e,t){return!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function eJ(){var e=eY(["\n          background: #f6f6f6;\n          margin-bottom: 24px;\n          padding: 16px;\n        "]);return eJ=function(){return e},e}function eQ(){var e=eY([""]);return eQ=function(){return e},e}function eX(){var e=eY(["\n              margin-top: 8px;\n              color: rgba(0, 0, 0, 0.45);\n            "]);return eX=function(){return e},e}var eZ=(0,f.observer)(function(e){var t=e.schemaKey,n=(0,s.useCollectionManager_deprecated)().getInterface,r=(0,s.useCompile)(),o=(0,b.useTranslation)().t,i=n(t);return i?p().createElement("div",{className:(0,s.css)(eJ())},p().createElement("div",{className:(0,s.css)(eQ())},o("Field interface"),": ",p().createElement(y.Tag,null,r(i.title))),i.description?p().createElement("div",{className:(0,s.css)(eX())},r(i.description)):null):null},{displayName:"FieldSummary"});function e0(e,t,n,r,o,i,a){try{var l=e[i](a),c=l.value}catch(e){n(e);return}l.done?t(c):Promise.resolve(c).then(r,o)}var e1=function(e){var t=j(e.targetCollection).run;return{run:function(){var e;return(e=function(){return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,function(e){switch(e.label){case 0:return[4,t()];case 1:return e.sent(),[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){e0(i,r,o,a,l,"next",e)}function l(e){e0(i,r,o,a,l,"throw",e)}a(void 0)})})()}}},e2=function(e){var t=e.item,n=e.parentItem;return p().createElement(s.OverridingFieldAction,{item:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({},t),parentItem:n,scope:{useCancelAction:A,useOverridingCollectionField:function(){return e1(t)}},getContainer:ef},p().createElement(c.CopyOutlined,{className:"btn-override"}))},e4=function(e){var t=e.item,n=e.parentItem;return p().createElement(s.ViewFieldAction,{item:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({},t),parentItem:n,getContainer:ef},p().createElement(c.EyeOutlined,{className:"btn-view"}))};function e3(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function e5(e,t,n,r,o,i,a){try{var l=e[i](a),c=l.value}catch(e){n(e);return}l.done?t(c):Promise.resolve(c).then(r,o)}function e6(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){e5(i,r,o,a,l,"next",e)}function l(e){e5(i,r,o,a,l,"throw",e)}a(void 0)})}}function e8(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function e9(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){e8(e,t,n[t])})}return e}function e7(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return e3(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e3(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}function tn(){var e,t,n=(e=["\n          display: block;\n          color: #958f8f;\n          padding: 10px 5px;\n          &:hover {\n            color: rgb(99 90 88);\n          }\n        "],!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}})));return tn=function(){return n},n}var tr=p().memo(function(e){var t=e.property,n=e.loadCollections,r=e.collectionData,o=e.setTargetNode,i=e.node,a=e.handelOpenPorts,l=e.title,m=e.name,h=e.targetGraph,y=!(t.collectionName!==m),g=(0,d.useContext)(f.SchemaOptionsContext),v=["hasOne","hasMany","belongsTo","belongsToMany"].includes(t.type)&&!(t.through?h.hasCell(t.through):h.hasCell(t.target)),b=((0,s.useCurrentAppInfo)()||{data:{database:{}}}).data.database;return p().createElement("div",{className:"field-operator"},p().createElement(s.SchemaComponentProvider,{components:e9({Select:function(e){return p().createElement(s.Select,e7(e9({popupMatchSelectWidth:!1},e),{getPopupContainer:ef}))},FieldSummary:eZ,AddFieldAction:eG,OverrideFieldAction:e2,ViewFieldAction:e4,EditFieldAction:eq,ConnectAssociationAction:eV},g.components),scope:e9({useAsyncDataSource:F,loadCollections:n,useCancelAction:A,useNewId:function(e){return"".concat(e||"").concat((0,u.uid)())},useCurrentFields:function(){var e=(0,s.useRecord)();return(0,(0,s.useCollectionManager_deprecated)().getCollectionFields)(e.collectionName||e.name)},useValuesFromRecord:S,useUpdateCollectionActionAndRefreshCM:N,isInheritField:y,isShowAssocition:v},g.scope)},p().createElement(C,{record:r.current,setTargetNode:o,node:i,handelOpenPorts:function(){return a(!0)}},p().createElement(s.SchemaComponent,{scope:A,schema:{type:"object",properties:{create:{type:"void","x-action":"create","x-component":"AddFieldAction","x-visible":"{{isInheritField}}","x-component-props":{item:e7(e9({},t),{title:l}),database:b}},update:{type:"void","x-action":"update","x-component":"EditFieldAction","x-visible":"{{isInheritField}}","x-component-props":{item:e7(e9({},t),{title:l}),parentItem:r.current}},delete:{type:"void","x-action":"destroy","x-component":"Action.Link","x-visible":"{{isInheritField}}","x-component-props":{component:c.DeleteOutlined,icon:"DeleteOutlined",className:"btn-del",confirm:{getContainer:ef,title:"{{t('Delete record')}}",content:"{{t('Are you sure you want to delete it?')}}"},useAction:function(){return D({collectionName:t.collectionName,name:t.name})}}},override:{type:"void","x-action":"create","x-visible":"{{!isInheritField}}","x-component":"OverrideFieldAction","x-component-props":{icon:"ReconciliationOutlined",item:e7(e9({},t),{title:l,targetCollection:m}),parentItem:r.current}},view:{type:"void","x-action":"view","x-visible":"{{!isInheritField}}","x-component":"ViewFieldAction","x-component-props":{icon:"ReconciliationOutlined",item:e7(e9({},t),{title:l}),parentItem:r.current}},connectAssociation:{type:"void","x-action":"view","x-visible":"{{isShowAssocition}}","x-component":"ConnectAssociationAction","x-component-props":{item:e7(e9({},t),{title:l,__parent:r.current}),targetGraph:h}}}}}))))});tr.displayName="OperationButton";var to=p().forwardRef(function(e,t){var n,r,o,i,a,l=e.property,c=e.node,u=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],!(t.indexOf(n)>=0)&&(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++){if(n=i[r],!(t.indexOf(n)>=0))Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}}return o}(e,["property","node"]),f=c.store.data,m=f.title,h=f.name,g=f.sourcePort,v=f.associated,b=f.targetPort,x=(0,s.useCompile)(),C=eL().styles,w=(0,s.useCollectionManager_deprecated)().getInterface,O=te((0,d.useState)(!1),2),E=O[0],P=O[1],S=p().useCallback(function(e){var t=e.type,n=e.name,r=e.primaryKey,o=e.allowNull,i=e.autoIncrement;return p().createElement("div",{className:C.collectionPopoverClass},p().createElement("div",{className:"field-content"},p().createElement("div",null,p().createElement("span",null,"name"),": ",p().createElement("span",{className:"field-type"},n)),p().createElement("div",null,p().createElement("span",null,"type"),": ",p().createElement("span",{className:"field-type"},t))),p().createElement("p",null,r&&p().createElement(y.Tag,{color:"green"},"PRIMARY"),o&&p().createElement(y.Tag,{color:"geekblue"},"ALLOWNULL"),i&&p().createElement(y.Tag,{color:"purple"},"AUTOINCREMENT")))},[]),A=e9({title:m,name:h,node:c},u);return p().createElement("div",null,p().createElement("div",{className:"body-item",key:l.id,id:l.id,style:{background:b===l.id||g===l.id||(null==v?void 0:v.includes(l.name))?"#e6f7ff":null},onMouseEnter:function(){P(!0)},onMouseLeave:function(){return P(!1)}},p().createElement(s.StablePopover,{content:S(l),getPopupContainer:ef,mouseLeaveDelay:0,title:p().createElement("div",null,x(null===(r=l.uiSchema)||void 0===r?void 0:r.title),p().createElement("span",{style:{color:"#ffa940",float:"right"}},x(null===(o=w(l.interface))||void 0===o?void 0:o.title))),key:l.id,placement:"right"},p().createElement("div",{className:"name"},p().createElement(y.Badge,{color:(n=l).isForeignKey||n.primaryKey||"id"===n.interface?"red":["obo","oho","o2o","o2m","m2o","m2m","linkTo"].includes(n.interface)?"orange":void 0}),x(null===(i=l.uiSchema)||void 0===i?void 0:i.title))),p().createElement("div",{className:"type  field_type"},x(null===(a=w(l.interface))||void 0===a?void 0:a.title)),E&&p().createElement(tr,e9({property:l},A))))});to.displayName="PopoverContent";var ti=p().memo(function(e){var t,n,r=e.targetGraph,o=e.collectionData,i=e.setTargetNode,a=e.node,l=e.loadCollections,u=a.store.data,s=u.item,f=u.ports,m=u.data,h=te((0,d.useState)(!1),2),y=h[0],g=h[1],v=er().t,b=$().groupBy(f.items,function(e){return e.isForeignKey||e.primaryKey||["obo","oho","o2o","o2m","m2o","m2m","linkTo","id","mbm"].includes(e.interface)?"initPorts":"morePorts"}),x=function(e){null===(t=r.getCellById(s.name))||void 0===t||t.toFront(),g(e);var t,n=r.collapseNodes||[];n.push(e8({},s.name,e)),r.collapseNodes=n,r.getCellById(s.name).setData({collapse:!0})},C=y&&(null==m?void 0:m.collapse),w={collectionData:o,setTargetNode:i,loadCollections:l,handelOpenPorts:x,node:a,targetGraph:r};return p().createElement("div",{className:"body"},null===(t=b.initPorts)||void 0===t?void 0:t.map(function(e){return e.uiSchema&&p().createElement(to,e7(e9({},w),{property:e,key:e.id}))}),p().createElement("div",{className:"morePorts"},C&&(null===(n=b.morePorts)||void 0===n?void 0:n.map(function(e){return e.uiSchema&&p().createElement(to,e7(e9({},w),{property:e,key:e.id}))}))),p().createElement("a",{className:(0,K.css)(tn()),onClick:function(){return x(!C)}},C?[p().createElement(c.UpOutlined,{style:{margin:"0px 8px 0px 5px"},key:"icon"}),p().createElement("span",{key:"associate"},v("Association Fields"))]:[p().createElement(c.DownOutlined,{style:{margin:"0px 8px 0px 5px"},key:"icon"}),p().createElement("span",{key:"all"},v("All Fields"))]))}),ta=function(e){var t,n,r=eL().styles,o=(0,d.useContext)(f.SchemaOptionsContext),i=e.node,a=e.setTargetNode,l=e.targetGraph,u=i.store.data,m=u.title,h=u.name,g=u.item,v=u.attrs,b=u.select,x=u.actived,w=i.id,O=((0,s.useCurrentAppInfo)()||{data:{database:{}}}).data.database,E=(0,d.useRef)(),P=(0,d.useContext)(s.CollectionCategoriesContext);E.current=e7(e9({},g),{title:m,inherits:g.inherits&&new Proxy(g.inherits,{})});var S=g.category,k=void 0===S?[]:S,j=(0,s.useCompile)();var I=(t=e6(function(e){var t;return tt(this,function(e){return[2,null===(t=l.collections)||void 0===t?void 0:t.map(function(e){return{label:j(e.title),value:e.name}})]})}),function(e){return t.apply(this,arguments)});var T=(n=e6(function(){return tt(this,function(e){return[2,null==P?void 0:P.data.map(function(e){return{label:j(e.name),value:e.id}})]})}),function(){return n.apply(this,arguments)});return p().createElement("div",{className:r.entityContainer,style:{boxShadow:null==v?void 0:v.boxShadow,border:b?"2px dashed #f5a20a":0}},null==k?void 0:k.map(function(e,t){return p().createElement(y.Badge.Ribbon,{key:t,color:e.color,style:{width:"103%",height:"3px",marginTop:5*t-4,borderRadius:0},placement:"start"})}),p().createElement("div",{className:r.headClass,style:{background:(null==v?void 0:v.hightLight)?"#1890ff":null,paddingTop:3*k.length}},p().createElement("span",{className:r.tableNameClass},j(m)),p().createElement("div",{className:r.tableBtnClass},p().createElement(s.SchemaComponentProvider,null,p().createElement(C,{setTargetNode:a,node:i},p().createElement(s.CollectionProvider_deprecated,{collection:eh},p().createElement(s.SchemaComponent,{scope:{useUpdateCollectionActionAndRefreshCM:N,useCancelAction:A,loadCollections:I,loadCategories:T,useAsyncDataSource:F,enableInherits:(null==O?void 0:O.dialect)==="postgres",actived:!0===x},components:e9({EditOutlined:c.EditOutlined,EditCollectionAction:eU,DeleteCollectionAction:eH,ConnectChildAction:ez,ConnectParentAction:eK},o.components),schema:{type:"object",name:i.id,properties:{connectParent:{type:"void","x-visible":"{{actived}}","x-component":"ConnectParentAction","x-component-props":{item:E.current,targetGraph:l}},connectChild:{type:"void","x-component":"ConnectChildAction","x-component-props":{item:E.current,targetGraph:l},"x-visible":"{{actived}}"},update:{type:"void",title:'{{ t("Edit") }}',"x-component":"EditCollectionAction","x-component-props":{type:"primary",item:E.current,className:"btn-edit-in-head"}},delete:{type:"void","x-action":"destroy","x-component":"DeleteCollectionAction","x-component-props":{className:"btn-del",getContainer:ef,item:E.current,useAction:function(){return B({name:h,id:w})}}}}}})))))),p().createElement(ti,{targetGraph:l,collectionData:E,setTargetNode:a,node:i,loadCollections:I}))},tl=n("2749");function tc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var tu=(0,d.forwardRef)(function(){var e,t,n=er().t;var r=(e=(0,tl.useFullscreen)(document.getElementById("graph_container")),t=2,function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw r}}return i}}(e,2)||function(e,t){if(e){if("string"==typeof e)return tc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tc(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1].toggleFullscreen;return p().createElement(y.Tooltip,{title:n("Full Screen"),getPopupContainer:ef},p().createElement(y.Button,{onClick:function(){i()}},o?p().createElement(c.FullscreenExitOutlined,null):p().createElement(c.FullscreenOutlined,null)))});function ts(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}tu.displayName="FullscreenAction";function td(e,t){return!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function tp(e,t){if(e){if("string"==typeof e)return ts(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ts(e,t)}}function tf(){var e=td(["\n          .ant-menu-item {\n            height: 32px;\n            line-height: 32px;\n          }\n        "]);return tf=function(){return e},e}function tm(){var e=td(["\n        .ant-popover-inner-content {\n          padding: 0;\n        }\n      "]);return tm=function(){return e},e}var th=function(e){var t,n,r,o=e.handleFiterCollections,i=(0,d.useContext)(tK),a=i.handleSearchCollection,l=i.collectionList;var u=(t=(0,d.useState)([]),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw r}}return i}}(t,2)||tp(t,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),f=u[0],m=u[1],h=er().t,g=(0,s.useCompile)();var v=p().createElement("div",null,p().createElement(y.Input,{style:{margin:"4px 0"},bordered:!1,placeholder:h("Collection Search"),onChange:a}),p().createElement(y.Menu,{selectedKeys:f,selectable:!0,className:(0,K.css)(tf()),style:{maxHeight:"70vh",overflowY:"auto",border:"none"},items:[{type:"divider"}].concat(function(e){if(Array.isArray(e))return ts(e)}(r=l.map(function(e){return{key:e.name,label:g(e.title),onClick:function(e){e.key!==f[0]?(m([e.key]),o(e.key)):(o(!1),m([]))}}}))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||tp(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}));return p().createElement(y.Popover,{content:v,autoAdjustOverflow:!0,placement:"bottomRight",trigger:["click"],getPopupContainer:ef,overlayClassName:(0,K.css)(tm())},p().createElement(y.Button,null,p().createElement(c.MenuOutlined,null)))};function ty(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var tg=function(e){var t,n,r=(0,d.useContext)(tK).collectionList,o=(0,s.useCompile)();var i=(t=(0,q.useSearchParams)(),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw r}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return ty(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ty(e,t)}}(t,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=i[0],l=i[1],c=a.get("collections"),u=null==c?void 0:c.split(","),f=null==u?void 0:u.filter(function(e){return r.find(function(t){return t.name===e})}),m=(0,d.useMemo)(function(){return r.map(function(e){return{label:o(e.title),value:e.name}})},[r]);return p().createElement(s.Select,{value:f,showSearch:!0,getPopupContainer:ef,mode:"multiple",allowClear:!0,options:m,onChange:function(e){l([["collections",e.toString()]])},style:{minWidth:200,position:"fixed",margin:"24px",zIndex:1e3,maxWidth:"60%"}})};function tv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tb(e,t,n){return(tb="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=tx(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n||e):o.value}})(e,t,n||e)}function tx(e){return(tx=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tC(e,t){return(tC=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tw(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tw=function(){return!!e})()}var tO=function(e){var t,n,r;function o(){var e,t,n;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),e=this,t=o,n=arguments,t=tx(t),function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,tw()?Reflect.construct(t,n||[],tx(e).constructor):t.apply(e,n))}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tC(e,t)}(o,e),t=o,n=[{key:"renderMarkup",value:function(){return this.renderJSONMarkup({tagName:"rect",selector:"body"})}},{key:"update",value:function(){var e=this.cell.getAttrs().hightLight?"#1890ff":"gray";tb(tx(o.prototype),"update",this).call(this,{body:{refWidth:"50px",refHeight:"100px",fill:e}})}}],tv(t.prototype,n),o}(L.DK);function tE(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function tP(e,t,n,r,o,i,a){try{var l=e[i](a),c=l.value}catch(e){n(e);return}l.done?t(c):Promise.resolve(c).then(r,o)}function tS(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){tP(i,r,o,a,l,"next",e)}function l(e){tP(i,r,o,a,l,"throw",e)}a(void 0)})}}function tA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}function tk(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function tj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{!a&&null!=o.return&&o.return()}finally{if(l)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return tE(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tE(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tI(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}var tN=$().drop,tT=$().groupBy,tB=$().last,tM=$().maxBy,tD=$().minBy,tF=$().take,tL=$().uniq;var tR=((r={}).Both="both",r.Target="target",r.Source="source",r);var t_=((o={}).Both="both",o.Inherit="inherited",o.Entity="entity",o),tG=function(e,t){for(var n=[];(null==t?void 0:t.length)>0&&e;)n.push(t.splice(0,e));return n};function tV(){return(tV=tS(function(e,t){var n,r,o,i,c;return tI(this,function(u){switch(u.label){case 0:if(n=a.positions,r=[],o=a.getNodes(),i=a.getEdges(),(c=new(U()).graphlib.Graph).setGraph({rankdir:"TB",nodesep:50,edgesep:50,rankSep:50,align:"DL",controlPoints:!0}),c.setDefaultEdgeLabel(function(){return{}}),o.forEach(function(e,t){var n=32*e.getPorts().length+30;c.setNode(e.id,{width:250,height:n})}),U().layout(c),tG(15,c.nodes()).forEach(function(e,t){e.forEach(function(e,o){var i=a.getCellById(e);if(i){var l=n&&n.find(function(e){return e.collectionName===i.store.data.name})||{},c={x:o%15*325+50,y:400*t+100};i.position(l.x||c.x,l.y||c.y),n&&!n.find(function(e){return e.collectionName===i.store.data.name})&&r.push({collectionName:i.store.data.name,x:c.x,y:c.y})}})}),i.forEach(function(e){tz(e)}),l?"string"==typeof l?a.positionCell(tB(o),"top",{padding:100}):a.positionCell(l,"top",{padding:100}):a.positionCell(o[0],"top-left",{padding:100}),!(r.length>0&&t))return[3,2];return[4,e(r)];case 1:u.sent(),r=[],u.label=2;case 2:return[2]}})})).apply(this,arguments)}function tz(e){var t,n,r=e.store.data.connectionType,o=e.getSource(),i=e.getTarget(),l=null===(t=a.getCellById(o.cell))||void 0===t?void 0:t.position().x,c=null===(n=a.getCellById(i.cell))||void 0===n?void 0:n.position().x,u=r?{name:"topLeft",args:{dy:20}}:{name:"left"},s=r?{name:"topRight",args:{dy:20}}:"right",d=r?"normal":"er";if(e.getVertices().forEach(function(){return e.removeVertexAt(0)}),l-100>c)e.setSource({cell:o.cell,port:o.port,anchor:u}),e.setTarget({cell:i.cell,port:i.port,anchor:s}),e.setRouter(d,{direction:"H"});else if(100>Math.abs(l-c)){var p=a.getCellById(o.cell),f=a.getCellById(i.cell);e.setSource({cell:o.cell,port:o.port,anchor:u}),e.setTarget({cell:i.cell,port:i.port,anchor:u}),r?(e.setVertices([{x:p.position().x-30,y:p.position().y+20},{x:f.position().x-30,y:f.position().y+20}]),e.setRouter("normal")):e.setRouter("oneSide",{side:"left"})}else e.setSource({cell:o.cell,port:o.port,anchor:s}),e.setTarget({cell:i.cell,port:i.port,anchor:u}),e.setRouter(d,{direction:"H"})}var tK=(0,d.createContext)({});tK.displayName="CollapsedContext";var tH=function(){var e=[],t=a.getEdges(),n=a.getNodes();return t.forEach(function(t){e.push(t.getSourceCellId()),e.push(t.getTargetCellId())}),tT(n,function(t){return e.includes(t.id)?"linkNodes":"rawNodes"})},tU=function(e){var t=tH(),n=t.linkNodes,r=void 0===n?[]:n,o=t.rawNodes,i=void 0===o?[]:o,l=a.positions,c=r.concat(i||[]),u=a.getEdges(),s=new(U()).graphlib.Graph,d=[];s.setGraph({rankdir:"TB",nodesep:50,edgesep:50,rankSep:50,align:"DL",controlPoints:!0});c.forEach(function(e){s.setNode(e.id,{width:250,height:400})}),u.forEach(function(e){var t=e.getSource(),n=e.getTarget();s.setEdge(t.cell,n.cell,{})}),U().layout(s);var p=s.nodes(),f=tF(p,r.length),m=tN(p,r.length);if(f.forEach(function(e){var t,n=a.getCellById(e),r=null===(t=l.find(function(e){return e.collectionName===n.id}))||void 0===t?void 0:t.id;if(n){var o=s.node(e);d.push({id:r,collectionName:n.id,x:o.x,y:o.y}),n.position(null==o?void 0:o.x,null==o?void 0:o.y)}}),f.length){b=a.getCellById(tM(f,function(e){return a.getCellById(e).position().y})).position().y,v=a.getCellById(tD(f,function(e){return a.getCellById(e).position().x})).position().x;var h,y,g,v,b,x,C=a.getCellById(tM(f,function(e){return a.getCellById(e).position().x})).position().x,w=f.filter(function(e){return 50>Math.abs(a.getCellById(e).position().y-b)}),O=null===(x=a.getCellById(tM(w,function(e){return a.getCellById(e).position().x})))||void 0===x?void 0:x.position();if(g=Math.round(C/320)||1,h=Math.floor((4500-(C+100-O.x))/280),y=tG(g,i),h>=1){var E=tF(m,h);y=tG(g,tN(m,h)),E.forEach(function(e,t){var n=a.getCellById(e);if(n){var r,o={x:O.x+320*t+280,y:O.y};n.position(o.x,o.y);var i=null===(r=l.find(function(e){return e.collectionName===n.id}))||void 0===r?void 0:r.id;d.push({id:i,collectionName:n.id,x:o.x,y:o.y})}})}}else g=15,h=0,y=tG(15,i),v=50,b=50;if(y.forEach(function(e,t){e.forEach(function(e,n){var r=a.getCellById(e),o=n%g;if(r){var i,c={x:325*o+v,y:300*t+b+300};r.position(c.x,c.y);var u=null===(i=l.find(function(e){return e.collectionName===r.id}))||void 0===i?void 0:i.id;d.push({id:u,collectionName:r.id,x:c.x,y:c.y})}})}),u.forEach(function(e){tz(e)}),a.positionCell(c[0],"top-left",{padding:100}),!e){var P=d.filter(function(e){return e.id}),S=d.filter(function(e){return!e.id});P.length>0&&a.updatePositionAction(P,!0),S.length>0&&a.saveGraphPositionAction(S)}},tW=p().memo(function(){var e,t,n,r,o,i=(0,s.useGlobalTheme)().theme,u=eL().styles,m=tj((0,q.useSearchParams)(),2),h=m[0],g=m[1],v=h.get("collections"),b=(0,d.useContext)(f.SchemaOptionsContext),x=(0,s.useAPIClient)(),C=(0,s.useCompile)(),w=er().t,O=tj((0,d.useState)([]),2),E=O[0],P=O[1],S=tj((0,d.useState)([]),2),A=S[0],j=S[1],I=tj((0,d.useState)(!1),2),N=I[0],T=I[1],B=(0,s.useCollectionManager_deprecated)(),M=(B.collections,B.getCollections),D=(0,d.useContext)(s.CollectionCategoriesContext),H=(0,d.useRef)();H.current=D;var U=(0,s.useDataSourceManager)(),W=(0,s.useCurrentAppInfo)(),$=(0,s.useApp)(),Y=(W||{data:{database:{}}}).data.database,J=tA({},null==b?void 0:b.scope),Q=tA({},null==b?void 0:b.components);var X=(e=tS(function(e){return tI(this,function(t){switch(t.label){case 0:return[4,x.resource("graphPositions").create({values:e})];case 1:return t.sent(),[4,ee()];case 2:return t.sent(),[2]}})}),function(t){return e.apply(this,arguments)});var Z=(t=tS(function(e){var t,n=arguments;return tI(this,function(r){switch(r.label){case 0:if(t=n.length>1&&void 0!==n[1]&&n[1],v)return[3,6];if(!t)return[3,2];return[4,x.resource("graphPositions").update({values:e})];case 1:return r.sent(),[3,4];case 2:return[4,x.resource("graphPositions").update({filter:{collectionName:e.collectionName},values:tA({},e)})];case 3:r.sent(),r.label=4;case 4:return[4,ee()];case 5:r.sent(),r.label=6;case 6:return[2]}})}),function(e){return t.apply(this,arguments)});var ee=(n=tS(function(){var e;return tI(this,function(t){switch(t.label){case 0:return[4,x.resource("graphPositions").list({paginate:!1})];case 1:return e=t.sent().data,a.positions=e.data,[2,Promise.resolve()]}})}),function(){return n.apply(this,arguments)}),et=function(e){l=e,"destory"===e&&ee()};var en=(r=tS(function(e){var t,n;return tI(this,function(r){return(t=M(),a)?(a.collections=t,a.updatePositionAction=Z,a.saveGraphPositionAction=X,n=a.getNodes(),P(t),j(t),!n.length||e?!v&&ex(t):ew(t),[2]):[2]})}),function(e){return r.apply(this,arguments)}),el=(0,s.useDataSource)(),ec=function(){(a=new L.kJ({container:document.getElementById("container"),moveThreshold:0,virtual:!1,async:!0,connecting:{anchor:{name:"midSide"}},mousewheel:{enabled:!0,modifiers:["ctrl","meta"]},interacting:{magnetConnectable:!1},preventDefaultBlankAction:!0})).connectionType="both",a.direction="target",a.cacheCollection={},a.onConnectionAssociation=eu,a.onConnectionChilds=es,a.onConnectionParents=eg,L.kJ.registerPortLayout("erPortPosition",function(e){return e.map(function(e,t){return{position:{x:0,y:(t+1)*40},angle:0}})},!0),(0,z.z2)({shape:"er-rect",width:250,height:40,ports:{groups:{list:{markup:[{tagName:"rect",selector:"portBody"}],attrs:{portBody:{width:250,height:40,strokeWidth:1,visibility:"hidden"}},position:"erPortPosition"}}},body:{refWidth:100,refHeight:100},component:function(e){return p().createElement(s.CurrentAppInfoContext.Provider,{value:W},p().createElement(s.DataSourceApplicationProvider,{dataSourceManager:U,dataSource:null==el?void 0:el.key},p().createElement(s.APIClientProvider,{apiClient:x},p().createElement(s.SchemaComponentOptions,{inherit:!0,scope:J,components:Q},p().createElement(s.CollectionCategoriesContext.Provider,{value:H.current},p().createElement(y.ConfigProvider,{theme:i},p().createElement("div",{style:{height:"auto"}},p().createElement(y.App,null,p().createElement(s.ApplicationContext.Provider,{value:$},p().createElement(ta,tk(tA({},e),{setTargetNode:et,targetGraph:a})))))))))))}}),a.use(new _.T({autoResize:!0,enabled:!0,pannable:!0,pageVisible:!0,pageBreak:!1,padding:{top:10,left:500,right:300,bottom:300}})),a.use(new R.a({container:document.getElementById("graph-minimap"),width:300,height:200,padding:10,graphOptions:{async:!0,createCellView:function(e){return e.isEdge()?null:e.isNode()?tO:void 0}}})),a.use(new G.Y({enabled:!1,multiple:!0,rubberband:!0,movable:!0,className:"node-selecting",modifiers:"shift"})),a.use(new V.H({enabled:!0})),a.on("edge:mouseleave",function(e){var t=e.e,n=e.edge;t.stopPropagation(),ev(n)}),a.on("node:mouseleave",function(e){var t=e.e,n=e.node;t.stopPropagation(),n.setProp({actived:!1})}),a.on("node:moved",function(e){var t=e.e,n=e.node;t.stopPropagation();var r=a.getConnectedEdges(n),o=n.position(),i=a.positions.find(function(e){return e.collectionName===n.store.data.name});i?(i.x!==o.x||i.y!==o.y)&&Z(tA({collectionName:n.store.data.name},o)):X(tA({collectionName:n.store.data.name},o)),r.forEach(function(e){tz(e)})}),a.on("cell:mouseenter",function(e){var t=e.e,n=e.cell,r=e.edge,o=e.node;t.stopPropagation(),n.toFront(),o&&n.setProp({actived:!0}),r&&eb(r)}),a.on("blank:click",function(e){var t;(null==a?void 0:a.activeEdge)&&ev(null==a?void 0:a.activeEdge),null===(t=a.collapseNodes)||void 0===t||t.map(function(e){var t=a.getCellById(Object.keys(e)[0]);Object.values(e)[0]&&(null==t||t.setData({collapse:!1}))}),a.cleanSelection()}),a.on("node:selected",function(e){e.e,e.node.setProp({select:!0})}),a.on("node:unselected",function(e){e.e,e.node.setProp({select:!1})})},eu=function(e){var t,n=e.target,r=e.through,o=(null===(t=a.selectedCollections)||void 0===t?void 0:t.split(","))||[];o.push(n),r&&o.push(r);var i=tL(o).toString();g([["collections",i]]),a.selectedCollections=i},es=function(e){var t=a.selectedCollections.split(",")||[],n=tL(t=t.concat(e)).toString();g([["collections",n]]),a.selectedCollections=n},eg=function(e){var t=a.selectedCollections.split(",")||[],n=tL(t=t.concat(e)).toString();g([["collections",n]]),a.selectedCollections=n},ev=function(e){a.activeEdge=null;var t,n,r=null!==(n=null===(t=e.store)||void 0===t?void 0:t.data)&&void 0!==n?n:{},o=r.m2m,i=r.connectionType,l=null==o?void 0:o.find(function(t){return t!==e.id}),c=a.getCellById(l),u=function(e){var t=a.getCellById(e.store.data.target.cell),n=a.getCellById(e.store.data.source.cell);t.setProp({targetPort:!1,associated:null}),n.setProp({sourcePort:!1,associated:null}),e.setAttrs({line:{stroke:"#ddd",targetMarker:"inherited"===i?{name:"classic",fill:"#ddd"}:null}}),e.setLabels(e.getLabels().map(function(e){return tk(tA({},e),{attrs:{labelText:tk(tA({},e.attrs.labelText),{fill:"rgba(0, 0, 0, 0.3)"}),labelBody:tk(tA({},e.attrs.labelBody),{stroke:"#ddd"})}})}))};u(e),c&&u(c)},eb=function(e){a.activeEdge=e;var t,n,r=null!==(n=null===(t=e.store)||void 0===t?void 0:t.data)&&void 0!==n?n:{},o=r.associated,i=r.m2m,l=r.connectionType,c=null==i?void 0:i.find(function(t){return t!==e.id}),u=a.getCellById(c),s=function(e){e.toFront(),e.setAttrs({line:{stroke:"#1890ff",strokeWidth:1,textAnchor:"middle",textVerticalAnchor:"middle",sourceMarker:null,targetMarker:"inherited"===l?{name:"classic",fill:"#1890ff"}:null}}),e.setLabels(e.getLabels().map(function(e){return tk(tA({},e),{attrs:{labelText:tk(tA({},e.attrs.labelText),{fill:"#1890ff"}),labelBody:tk(tA({},e.attrs.labelBody),{stroke:"#1890ff"})}})}));var t=a.getCellById(e.store.data.target.cell),n=a.getCellById(e.store.data.source.cell);t.toFront(),n.toFront(),t.setProp({targetPort:e.store.data.target.port,associated:o}),n.setProp({sourcePort:e.store.data.source.port,associated:o})};s(e),u&&s(u)},ex=function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];a.clearCells();var n=ea(e),r=n.nodesData,o=n.edgesData,i=n.inheritEdges;a.data={nodes:r,edges:o},a.fromJSON({nodes:r}),a.addEdges(o),a.addEdges(i),!function(e,t){tV.apply(this,arguments)}(X,t)},ew=function(e){var t,n,r,o=a.positions,i=ea(e),c=i.nodesData,u=i.edgesData,s=i.inheritEdges,d=a.getNodes().map(function(e){return e.store.data}),p=tT(a.getEdges().map(function(e){return e.store.data}),function(e){return e.connectionType?"currentInheritEdges":"currentRelateEdges"}),f=ed(c,d),m=ep(u,p.currentRelateEdges||[]),h=ep(s,p.currentInheritEdges||[]),y=null===(t=tM(o,"y"))||void 0===t?void 0:t.y,g=null===(n=tD(o,"x"))||void 0===n?void 0:n.x,b=o.filter(function(e){return 100>Math.abs(e.y-y)}),x=tM(b,"x");f.forEach(function(e){var t=e.status,n=e.node,o=e.port,i=a.getCellById(n.id);switch(t){case"add":r=(null==x?void 0:x.x)>4500?{x:g,y:(x=tD(b,"x")).y+400}:{x:(null==x?void 0:x.x)+350,y:null==x?void 0:x.y},l=a.addNode(tk(tA({},n),{position:r})),!v&&X(tA({collectionName:n.name},r)),a&&a.positionCell(l,"top",{padding:200});break;case"insertPort":i.insertPort(o.index,o.port);break;case"deletePort":i.removePort(o.id);break;case"updateNode":i.setProp({title:n.title});break;case"delete":a.removeCell(n.id);break;default:return null}});var C=function(e){e.forEach(function(e){var t=e.status,n=e.edge,r=a.addEdge(tA({},n));switch(t){case"add":tz(r);break;case"delete":a.removeCell(n.id);break;default:return null}})};setTimeout(function(){C(m.concat(h))},300)},eO=function(e,t){"target"===t?eo(a.collections,e).forEach(function(e){var n;null===(n=a.getCellById(e))||void 0===n||n.setAttrs({hightLight:!0,direction:t,connectionType:"inherited"})}):ei(a.collections,e).forEach(function(e){var n;null===(n=a.getCellById(e.name))||void 0===n||n.setAttrs({hightLight:!0,direction:t,connectionType:"inherited"})})},eE=function(e){var t=a.getCellById(e);a.cacheCollection[e]=!0,a.getConnectedEdges(t).filter(function(t){var n;return!(null===(n=t.store.data)||void 0===n?void 0:n.connectionType)&&t.getTargetCellId()===e}).forEach(function(t){t.store.data.m2m&&t.store.data.m2m.forEach(function(t){var n=a.getCellById(t);if(n.getTargetCellId()===e){var r,o=n.getSourceCellId(),i=a.getCellById(o);!(null===(r=i.store.data.attrs)||void 0===r?void 0:r.hightLight)&&(i.setAttrs({hightLight:!0,direction:"target",connectionType:"entity"}),eE(o))}});var n,r=t.getSourceCellId(),o=a.getCellById(r);!(null===(n=o.store.data.attrs)||void 0===n?void 0:n.hightLight)&&(o.setAttrs({hightLight:!0,direction:"target",connectionType:"entity"}),eE(r))})},eP=function(e){var t=a.getCellById(e);a.getConnectedEdges(t).filter(function(t){var n;return!(null===(n=t.store.data)||void 0===n?void 0:n.connectionType)&&t.getSourceCellId()===e}).forEach(function(t){t.store.data.m2m&&t.store.data.m2m.forEach(function(t){var n=a.getCellById(t);if(n.getSourceCellId()===e){var r,o=n.getTargetCellId(),i=a.getCellById(o);!(null===(r=i.store.data.attrs)||void 0===r?void 0:r.hightLight)&&(i.setAttrs({hightLight:!0,direction:"source",connectionType:"entity"}),eP(o))}});var n,r=t.getTargetCellId(),o=a.getCellById(r);!(null===(n=o.store.data.attrs)||void 0===n?void 0:n.hightLight)&&(o.setAttrs({hightLight:!0,direction:"source",connectionType:"entity"}),eP(r))})},eA=function(e,t){"target"===t?eE(e):eP(e)},ek=function(e,t,n){for(var r=function(r){var i,l,c=o[r].getAttrs(),u=c.direction,s=c.connectionType,d=o[r].id!==e,p=!e||(null===(i=a.filterConfig)||void 0===i?void 0:i.key)!==e||u!==t,f=!e||(null===(l=a.filterConfig)||void 0===l?void 0:l.key)!==e||s!==n;o[r].id!==e&&setTimeout(function(){d&&(p||f)&&o[r].setAttrs({hightLight:!1})},0)},o=a.getNodes().filter(function(e){var t;return null===(t=e.store.data.attrs)||void 0===t?void 0:t.hightLight}),i=o.length,l=0;l<i;l++)r(l)},ej=function(e){var t=a.connectionType,n=a.direction,r=a.filterConfig,o=e===(null==r?void 0:r.key)&&"both"===n,i=e===(null==r?void 0:r.key)&&("both"===t||t===r.connectionType);e?(o&&i||ek(e,n,t),l=a.getCellById(e),a.positionCell(l,"center",{padding:0}),l.setAttrs({hightLight:!0,connectionType:t}),setTimeout(function(){["entity","both"].includes(t)&&("both"===n?(eA(e,"target"),eA(e,"source")):("target"===n&&eA(e,n),"source"===n&&eA(e,n))),["inherited","both"].includes(t)&&("both"===n?(eO(e,"target"),eO(e,"source")):eO(e,n)),a.filterConfig={key:e,direction:n,connectionType:t}},0)):(a.filterConfig=null,ek())},eI=function(e){l=null,a.getEdges().forEach(function(t){var n=t.store.data.connectionType;"entity"===e?n?t.setVisible(!1):t.setVisible(!0):"inherited"===e?n?t.setVisible(!0):t.setVisible(!1):t.setVisible(!0)})};(0,d.useLayoutEffect)(function(){return ec(),function(){a.off("cell:mouseenter"),a.off("edge:mouseleave"),a.off("node:moved"),a.off("blank:click"),a=null,l=null}},[]),(0,d.useEffect)(function(){return el.addReloadCallback(en),function(){el.removeReloadCallback(en)}},[]),(0,d.useEffect)(function(){return T(!0),ee().then(tS(function(){var e;return tI(this,function(t){return v&&A.length?(e=null==v?void 0:v.split(","),ex(A.filter(function(t){return e.includes(t.name)}),!1),tU(!0),a.selectedCollections=v):v||en(!0),T(!1),[2]})})).catch(function(e){throw T(!1),e}),function(){em()}},[h]);var eN=(o=tS(function(){var e;return tI(this,function(t){return[2,null===(e=a.collections)||void 0===e?void 0:e.map(function(e){return{label:C(e.title),value:e.name}})]})}),function(){return o.apply(this,arguments)});return p().createElement(y.Layout,null,p().createElement("div",{className:u.graphCollectionContainerClass},p().createElement(y.Spin,{spinning:N},p().createElement(s.DataSourceApplicationProvider,{dataSourceManager:U},p().createElement(tK.Provider,{value:{collectionList:A,handleSearchCollection:function(e){var t=e.target.value.toLowerCase();t?j(E.filter(function(e){return C(e.title).toLowerCase().includes(t)})):j(E)}}},p().createElement("div",{className:(0,K.cx)(u.collectionListClass)},p().createElement(s.SchemaComponent,{components:{Select:function(e){return p().createElement(s.Select,tk(tA({popupMatchSelectWidth:!1},e),{getPopupContainer:ef}))},AddCollectionAction:ey,LocateCollectionAction:th,SelectCollectionsAction:tg,DirectionAction:eS,ConnectorAction:eC,FullscreenAction:tu},schema:{type:"void",properties:{block1:{type:"void","x-collection":"collections","x-decorator":"ResourceActionProvider","x-decorator-props":{collection:eh,request:{resource:"collections",action:"list",params:{pageSize:50,filter:{inherit:!1},sort:["sort"],appends:[]}}},properties:{selectCollections:{type:"array","x-component":"SelectCollectionsAction"},actions:{type:"void","x-component":"ActionBar","x-component-props":{style:{fontSize:16}},properties:{create:{type:"void",title:'{{ t("Create collection") }}',"x-component":"AddCollectionAction","x-component-props":{type:"primary"}},fullScreen:{type:"void","x-component":"FullscreenAction"},locateCollection:{type:"void","x-component":"LocateCollectionAction","x-component-props":{handleFiterCollections:ej,icon:"MenuOutlined",useAction:function(){return{run:function(){}}}}},autoLayout:{type:"void","x-component":"Action","x-component-props":{component:function(){return p().createElement(y.Tooltip,{title:w("Auto layout"),getPopupContainer:ef},p().createElement(y.Button,{onClick:function(){tU()}},p().createElement(c.ApartmentOutlined,null)))},useAction:function(){return{run:function(){}}}}},connectionType:{type:"void","x-component":"ConnectorAction","x-component-props":{onClick:function(e){a.connectionType=e;var t=a.filterConfig;t&&ej(t.key),eI(e)},icon:"MenuOutlined",useAction:function(){return{run:function(){}}}}},direction:{type:"void","x-component":"DirectionAction","x-component-props":{onClick:function(e){a.direction=e;var t=a.filterConfig;t&&ej(t.key)}}},selectMode:{type:"void","x-component":function(){return p().createElement(y.Tooltip,{title:w("Selection")},p().createElement(y.Switch,{onChange:function(e){a.toggleSelection()}}))}}}}}}}},scope:{useAsyncDataSource:F,loadCollections:eN,useCreateActionAndRefreshCM:function(){return k(et)},enableInherits:(null==Y?void 0:Y.dialect)==="postgres"}})))),p().createElement("div",{id:"container",style:{width:"100vw"}}),p().createElement("div",{id:"graph-minimap",className:u.graphMinimap,style:{width:"300px",height:"250px",right:"10px",bottom:"20px",position:"fixed"}}))))});tW.displayName="GraphDrawPage";function t$(){var e,t,n=(e=["\n        height: calc(100vh - 160px);\n        overflow: auto;\n        margin: calc(var(--nb-spacing) * -1);\n        position: relative;\n      "],!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}})));return t$=function(){return n},n}var tq=function(e){var t,n,r=(0,s.useActionContext)().visible;var o=(0,s.useRequest)(function(){return Promise.resolve({data:{name:"t_".concat((0,u.uid)()),createdBy:!0,updatedBy:!0,sortable:!0,logging:!0,fields:[{name:"id",type:"integer",autoIncrement:!0,primaryKey:!0,allowNull:!1,uiSchema:{type:"number",title:'{{t("ID")}}',"x-component":"InputNumber","x-read-pretty":!0},interface:"id"},{interface:"createdAt",type:"date",field:"createdAt",name:"createdAt",uiSchema:{type:"datetime",title:'{{t("Created at")}}',"x-component":"DatePicker","x-component-props":{},"x-read-pretty":!0}},{interface:"createdBy",type:"belongsTo",target:"users",foreignKey:"createdById",name:"createdBy",uiSchema:{type:"object",title:'{{t("Created by")}}',"x-component":"RecordPicker","x-component-props":{fieldNames:{value:"id",label:"nickname"}},"x-read-pretty":!0}},{type:"date",field:"updatedAt",name:"updatedAt",interface:"updatedAt",uiSchema:{type:"string",title:'{{t("Last updated at")}}',"x-component":"DatePicker","x-component-props":{},"x-read-pretty":!0}},{type:"belongsTo",target:"users",foreignKey:"updatedById",name:"updatedBy",interface:"updatedBy",uiSchema:{type:"object",title:'{{t("Last updated by")}}',"x-component":"RecordPicker","x-component-props":{fieldNames:{value:"id",label:"nickname"}},"x-read-pretty":!0}}]}})},(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({},e),n=(n={manual:!0},n),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t));return(0,d.useEffect)(function(){r&&o.run()},[r]),o},tY=function(){return p().createElement("div",{className:(0,s.css)(t$()),id:"graph_container"},p().createElement(s.SchemaComponent,{schema:{type:"void","x-component":"div",properties:{editor:{type:"void","x-component":"GraphDrawPage"}}},components:{GraphDrawPage:tW,DeleteOutlined:c.DeleteOutlined},scope:{useCollectionValues:tq,useCreateActionAndRefreshCM:k}}))}}}]);