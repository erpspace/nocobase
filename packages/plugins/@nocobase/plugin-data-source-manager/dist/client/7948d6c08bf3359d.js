/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

"use strict";(self.webpackChunk_nocobase_plugin_data_source_manager=self.webpackChunk_nocobase_plugin_data_source_manager||[]).push([["721"],{947:function(e,t,n){n.r(t),n.d(t,{DataSourceContext:function(){return s},DatabaseConnectionProvider:function(){return l}});var r=n(772),a=n(156),o=n.n(a),u=n(212);function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var s=(0,a.createContext)(null);s.displayName="DataSourceContext";var l=function(e){var t,n,l=(t=(0,a.useState)(null),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],u=!0,c=!1;try{for(a=a.call(e);!(u=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);u=!0);}catch(e){c=!0,r=e}finally{try{!u&&null!=a.return&&a.return()}finally{if(c)throw r}}return o}}(t,2)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}}(t,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=l[0],f=l[1];return o().createElement(s.Provider,{value:{dataSource:i,setDataSource:f}},o().createElement(r.SchemaComponentOptions,{scope:u,components:{}},e.children))}},212:function(e,t,n){n.r(t),n.d(t,{useCreateDatabaseServer:function(){return d},useTestConnectionAction:function(){return b}});var r=n(505),a=n(721),o=n(238),u=n(772),c=n(573);function s(e,t,n,r,a,o,u){try{var c=e[o](u),s=c.value}catch(e){n(e);return}c.done?t(s):Promise.resolve(s).then(r,a)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function u(e){s(o,r,a,u,c,"next",e)}function c(e){s(o,r,a,u,c,"throw",e)}u(void 0)})}}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,a,o;r=e,a=t,o=n[t],a in r?Object.defineProperty(r,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[a]=o})}return e}function f(e,t){var n,r,a,o,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(a=(a=u.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(e,u)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var d=function(e){var t=(0,r.useForm)(),n=(0,u.useActionContext)(),c=(0,u.useAPIClient)(),s=(0,o.useTranslation)().t,d=(0,r.useField)();return d.data=d.data||{},{run:function(){return l(function(){var r,o;return f(this,function(u){switch(u.label){case 0:return[4,t.submit()];case 1:u.sent(),u.label=2;case 2:return u.trys.push([2,5,,6]),d.data.loading=!0,[4,c.resource("databaseServers").create({values:i({},t.values)})];case 3:return r=u.sent().data,d.data.loading=!1,n.setVisible(!1),[4,t.reset()];case 4:return u.sent(),null==e||e(null==r?void 0:r.data),a.message.success(s("Saved successfully")),[3,6];case 5:return o=u.sent(),d.data.loading=!1,console.log(o),[3,6];case 6:return[2]}})})()}}},b=function(){var e=(0,r.useForm)(),t=(0,u.useAPIClient)(),n=(0,o.useTranslation)().t,s=(0,r.useField)();return s.data=s.data||{},{run:function(){return l(function(){var r;return f(this,function(o){switch(o.label){case 0:return[4,e.submit()];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,4,,5]),s.data.loading=!0,[4,t.resource("dataSources").testConnection({values:i({},e.values)})];case 3:return o.sent(),s.data.loading=!1,a.message.success(n("Connection successful",{ns:c.A7})),[3,5];case 4:return r=o.sent(),s.data.loading=!1,console.log(r),[3,5];case 5:return[2]}})})()}}}}}]);