/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

(self.webpackChunk_nocobase_plugin_data_source_manager=self.webpackChunk_nocobase_plugin_data_source_manager||[]).push([["481"],{947:function(e,t,n){"use strict";n.r(t),n.d(t,{DataSourceContext:function(){return u},DatabaseConnectionProvider:function(){return c}});var r=n(772),o=n(156),i=n.n(o),l=n(212);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var u=(0,o.createContext)(null);u.displayName="DataSourceContext";var c=function(e){var t,n,c=(t=(0,o.useState)(null),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],l=!0,a=!1;try{for(o=o.call(e);!(l=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);l=!0);}catch(e){a=!0,r=e}finally{try{!l&&null!=o.return&&o.return()}finally{if(a)throw r}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}(t,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=c[0],p=c[1];return i().createElement(u.Provider,{value:{dataSource:s,setDataSource:p}},i().createElement(r.SchemaComponentOptions,{scope:l,components:{}},e.children))}},791:function(e,t,n){"use strict";n.r(t),n.d(t,{CollectionManagerPage:function(){return ty}});var r,o,i,l,a,u=n("875"),c=n("156"),s=n.n(c),p=n("772"),d=n("128"),f=n("505"),m=n("229"),y=n("584"),v=n("721"),b=n("238"),h=n("947"),g=n("563"),S=n("482"),C=n("632"),w=n("467");function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function O(e,t,n,r,o,i,l){try{var a=e[i](l),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,o)}function A(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function l(e){O(i,r,o,l,a,"next",e)}function a(e){O(i,r,o,l,a,"throw",e)}l(void 0)})}}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],l=!0,a=!1;try{for(o=o.call(e);!(l=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);l=!0);}catch(e){a=!0,r=e}finally{try{!l&&null!=o.return&&o.return()}finally{if(a)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var F=["string","bigInt","integer","uuid","uid","nanoid"],E=(0,f.observer)(function(e){var t,n,r=(0,d.useParams)().name,o=(0,p.useRecord)(),i=o.collectionName,l=o.sourceKey,a=o.name,u=(0,f.useField)(),m=(0,p.useCompile)(),y=null===(t=(0,(0,p.useCollectionManager_deprecated)().getCollection)(i||a,r).fields)||void 0===t?void 0:t.filter(function(e){return e.primaryKey||e.unique}).map(function(e){var t;return{value:e.name,label:m((null===(t=e.uiSchema)||void 0===t?void 0:t.title)||e.title||e.name)}});return(0,c.useEffect)(function(){var e;u.initialValue=(null==y?void 0:null===(e=y[0])||void 0===e?void 0:e.value)||l},[]),s().createElement("div",null,s().createElement(v.Select,{disabled:l,options:y,defaultValue:l||(null==y?void 0:null===(n=y[0])||void 0===n?void 0:n.value),onChange:null==e?void 0:e.onChange,showSearch:!0}))},{displayName:"SourceKey"}),D=(0,f.observer)(function(e){var t,n=e.disabled,r=(0,p.useAPIClient)(),o=P((0,c.useState)([]),2),i=o[0],l=o[1],a=(0,d.useParams)().name,u=(0,p.useRecord)(),m=(0,f.useField)(),y=u.collectionName,b=u.target,h=u.type,g=u.through,S=u.name,C=u[m.props.name],w=(0,p.useCollectionManager_deprecated)().getCollection,x=(0,p.useCompile)(),O=(0,f.useForm)(),E=P((0,c.useState)(C),2),D=E[0],T=E[1];return(0,c.useEffect)(function(){m.initialValue=null;var e,t=null===(e=w(["belongsTo"].includes(h)?y:["belongsToMany"].includes(h)?g:b,a))||void 0===e?void 0:e.fields;if(t){var n=null==t?void 0:t.filter(function(e){return F.includes(e.type)}).map(function(e){var t;return{value:e.name,label:x((null===(t=e.uiSchema)||void 0===t?void 0:t.title)||e.title||e.name)}});if(l(n),C){var r=n.find(function(e){return e.value===C});T((null==r?void 0:r.label)||C)}}},[h]),(0,c.useEffect)(function(){T(C)},[C]),s().createElement("div",null,s().createElement(v.Select,{disabled:n,value:D,options:i,showSearch:!0,onDropdownVisibleChange:(t=A(function(e){var t,n,o,i,u,c;return j(this,function(s){switch(s.label){case 0:if(n=(t=O.values).target,o=t.type,i=t.through,!((u=["belongsTo"].includes(o)?y||S:["belongsToMany"].includes(o)?i:n)&&e))return[3,2];return[4,r.request({url:"dataSourcesCollections/".concat(a,".").concat(u,"/fields:list"),params:{paginate:!1,filter:{$or:[{"interface.$not":null},{"options.source.$notEmpty":!0}]},sort:["sort"]}})];case 1:l(null===(c=s.sent().data.data)||void 0===c?void 0:c.filter(function(e){return F.includes(e.type)}).map(function(e){var t;return{value:e.name,label:x((null===(t=e.uiSchema)||void 0===t?void 0:t.title)||e.title||e.name)}})),s.label=2;case 2:return[2]}})}),function(e){return t.apply(this,arguments)}),onChange:function(t){var n;null==e||null===(n=e.onChange)||void 0===n||n.call(e,t),T(t)}}))},{displayName:"ForeignKey"}),T=(0,f.observer)(function(e){var t,n=e.value,r=e.disabled,o=(0,p.useRecord)(),i=o.targetKey,l=o.target,a=o.type,u=(0,d.useParams)().name,m=(0,p.useCollectionManager_deprecated)().getCollection,y=(0,p.useAPIClient)(),b=P((0,c.useState)([]),2),h=b[0],g=b[1],S=P((0,c.useState)(n||i),2),C=S[0],w=S[1],x=(0,f.useForm)(),O=(0,p.useCompile)();return(0,f.useField)().required=!0,(0,c.useEffect)(function(){if(l){var e;g(null===(e=m(l,u).fields)||void 0===e?void 0:e.filter(function(e){return!!e.primaryKey||!!e.unique||"hasMany"===a&&F.includes(e.type)}).map(function(e){var t;return{value:e.name,label:O((null==e?void 0:null===(t=e.uiSchema)||void 0===t?void 0:t.title)||e.title||e.name)}}))}},[]),s().createElement("div",null,s().createElement(v.Select,{showSearch:!0,options:h,onDropdownVisibleChange:(t=A(function(e){var t,n,r,o;return j(this,function(i){switch(i.label){case 0:if(n=(t=x.values).target,r=t.type,!(n&&e))return[3,2];return[4,y.request({url:"dataSourcesCollections/".concat(u,".").concat(n,"/fields:list"),params:{paginate:!1,filter:{$or:[{"interface.$not":null},{"options.source.$notEmpty":!0}]},sort:["sort"]}})];case 1:g(null===(o=i.sent().data.data)||void 0===o?void 0:o.filter(function(e){return!!e.primaryKey||!!e.unique||"hasMany"===r&&F.includes(e.type)}).map(function(e){var t;return{value:e.name,label:O((null===(t=e.uiSchema)||void 0===t?void 0:t.title)||e.title||e.name)}})),i.label=2;case 2:return[2]}})}),function(e){return t.apply(this,arguments)}),onChange:function(t){var n;null==e||null===(n=e.onChange)||void 0===n||n.call(e,t),w(t)},value:C,disabled:r}))},{displayName:"TargetKey"}),k=(0,f.observer)(function(){var e=(0,p.useCompile)(),t=eT().targetCollection;return s().createElement("div",null,s().createElement(v.Select,{disabled:!0,showSearch:!0,popupMatchSelectWidth:!1,value:t.name,options:[{value:t.name,label:e(t.title||t.name)}]}))},{displayName:"SourceCollection"}),I=(0,f.observer)(function(e){var t=e.disabled,n=(0,p.useCompile)(),r=P((0,c.useState)([]),2),o=r[0],i=r[1],l=(0,d.useParams)().name,a=(0,f.useField)(),u=(0,p.useCollectionManager_deprecated)(l).getCollections,m=(0,p.useRecord)()[a.props.name];return(0,c.useEffect)(function(){i(u().filter(function(e){return(!e.autoCreate||!e.isThrough)&&!0}).map(function(e){return{label:n(e.title||e.name),value:e.name}}))},[]),s().createElement("div",null,s().createElement(v.Select,{disabled:t,showSearch:!0,popupMatchSelectWidth:!1,fieldNames:{label:"label",value:"value"},defaultValue:m,options:o,onChange:function(t){var n;null==e||null===(n=e.onChange)||void 0===n||n.call(e,t)}}))},{displayName:"ThroughCollection"});function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function M(e,t,n,r,o,i,l){try{var a=e[i](l),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,o)}function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){V(e,t,n[t])})}return e}function $(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],l=!0,a=!1;try{for(o=o.call(e);!(l=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);l=!0);}catch(e){a=!0,r=e}finally{try{!l&&null!=o.return&&o.return()}finally{if(a)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var q=function(e,t,n){if(!!e){var r,o=(0,w.cloneDeep)(e.properties);(null==o?void 0:o.foreignKey)&&(o.foreignKey["x-component"]=D),!0===e.hasDefaultValue&&(o.defaultValue=(0,w.cloneDeep)(null==e?void 0:null===(r=e.default)||void 0===r?void 0:r.uiSchema),o.defaultValue.required=!1,o.defaultValue.title=n('{{ t("Default value") }}'),o.defaultValue["x-decorator"]="FormItem",o.defaultValue["x-reactions"]={dependencies:["uiSchema.x-component-props.gmt","uiSchema.x-component-props.showTime","uiSchema.x-component-props.dateFormat","uiSchema.x-component-props.timeFormat"],fulfill:{state:{componentProps:{gmt:"{{$deps[0]}}",showTime:"{{$deps[1]}}",dateFormat:"{{$deps[2]}}",timeFormat:"{{$deps[3]}}"}}}});var i=$(K({name:"f_".concat((0,u.uid)())},(0,w.cloneDeep)(e.default)),{interface:e.name});return i.reverseField&&(i.reverseField.name="f_".concat((0,u.uid)())),{type:"object",properties:V({},(0,u.uid)(),{type:"void","x-component":"Action.Drawer","x-component-props":{getContainer:"{{ getContainer }}"},"x-decorator":"Form","x-decorator-props":{useValues:function(e){return(0,p.useRequest)(function(){return Promise.resolve({data:i})},e)}},title:"".concat(n(t.title||t.name)," - ").concat(n('{{ t("Add field") }}')),properties:$(K({summary:{type:"void","x-component":"FieldSummary","x-component-props":{schemaKey:e.name}}},o),{description:{type:"string",title:'{{t("Description")}}',"x-decorator":"FormItem","x-component":"Input.TextArea"},footer:{type:"void","x-component":"Action.Drawer.Footer",properties:{action1:{title:'{{ t("Cancel") }}',"x-component":"Action","x-component-props":{useAction:"{{ useCancelAction }}"}},action2:{title:'{{ t("Submit") }}',"x-component":"Action","x-component-props":{type:"primary",useAction:"{{ useCreateCollectionField }}"}}}}})})}}},N=function(){var e=(0,f.useForm)(),t=(0,p.useActionContext)(),n=(0,p.useResourceActionContext)().refresh,r=(0,f.useField)(),o=(0,p.useAPIClient)(),i=(0,p.useRecord)(),l=(0,d.useParams)().name,a=(0,p.useDataSourceManager)();return{run:function(){var u;return(u=function(){var u,c;return function(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,function(c){switch(c.label){case 0:return[4,e.submit()];case 1:c.sent(),r.data=r.data||{},r.data.loading=!0,(u=(0,w.cloneDeep)(e.values)).autoCreateReverseField||delete u.reverseField,delete u.autoCreateReverseField,c.label=2;case 2:return c.trys.push([2,5,,6]),[4,o.request({url:"dataSourcesCollections/".concat(l,".").concat(i.name,"/fields:create"),method:"post",data:u})];case 3:return c.sent(),t.setVisible(!1),a.getDataSource(l).reload(),[4,e.reset()];case 4:return c.sent(),r.data.loading=!1,n(),[3,6];case 5:return c.sent(),r.data.loading=!1,[3,6];case 6:return[2]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=u.apply(e,t);function i(e){M(o,n,r,i,l,"next",e)}function l(e){M(o,n,r,i,l,"throw",e)}i(void 0)})})()}}},B=function(e){var t=(0,p.useRecord)();return s().createElement(U,K({item:t},e))},U=function(e){var t=e.scope,n=e.getContainer,r=e.item,o=e.children,i=e.trigger,l=e.align;e.database;var a=(0,p.useCollectionManager_deprecated)(),u=a.getInterface,d=a.getTemplate,f=a.collections,m=_((0,c.useState)(!1),2),y=m[0],h=m[1],g=_((0,c.useState)(),2),w=g[0],x=g[1],O=_((0,c.useState)({}),2),A=O[0],P=O[1],j=(0,p.useCompile)(),F=(0,b.useTranslation)().t,E=((0,p.useCurrentAppInfo)()||{data:{database:{}}}).data.database,D=(0,c.useMemo)(function(){return f.map(function(e){return{label:j(e.title),value:e.name}})},[]),T=(0,p.useFieldInterfaceOptions)(),k=(0,c.useCallback)(function(){var e=(d(r.template)||{}).availableFieldInterfaces||{},t=e.exclude,n=e.include,o=[];return T.forEach(function(e){if("relation"===e.key){var r,i=[];(null==n?void 0:n.length)?n.forEach(function(t){var n,r=null==e?void 0:null===(n=e.children)||void 0===n?void 0:n.find(function(e){return[t,t.interface].includes(e.value)});r&&i.push($(K({},r),{targetScope:null==t?void 0:t.targetScope}))}):i=(null==t?void 0:t.length)?null==e?void 0:null===(r=e.children)||void 0===r?void 0:r.filter(function(e){return!t.includes(e.value)}):null==e?void 0:e.children,(null==i?void 0:i.length)&&o.push($(K({},e),{children:i}))}}),o},[d,r]),I=(0,c.useMemo)(function(){return k().map(function(e){var t;return(null==e?void 0:null===(t=e.children)||void 0===t?void 0:t.length)===0?null:"view"===r.template?{type:"group",label:j(e.label),title:j(e.label),key:e.label,children:e.children.filter(function(e){return["m2o"].includes(e.name)}).map(function(e){return{label:j(e.title),title:j(e.title),key:e.name,dataTargetScope:e.targetScope}})}:{type:"group",label:j(e.label),title:j(e.label),key:e.label,children:null==e?void 0:e.children.filter(function(e){return!["o2o","subTable","linkTo"].includes(e.name)}).map(function(e){return{label:j(e.title),title:j(e.title),key:e.name,dataTargetScope:e.targetScope}})}}).filter(function(e){var t;return null==e?void 0:null===(t=e.children)||void 0===t?void 0:t.length})},[k]),R=(0,c.useMemo)(function(){return{style:{maxHeight:"60vh",overflow:"auto"},onClick:function(e){var t=e.item.props["data-targetScope"];t&&x(t);var n=q(u(e.key),r,j);n&&(P(n),h(!0))},items:I}},[u,I,r]);return"sql"!==r.template&&s().createElement(p.RecordProvider,{record:r},s().createElement(p.ActionContextProvider,{value:{visible:y,setVisible:h}},s().createElement(v.Dropdown,{getPopupContainer:n,trigger:i,align:l,menu:R},o||s().createElement(v.Button,{icon:s().createElement(S.PlusOutlined,null),type:"primary"},F("Add field"))),s().createElement(p.SchemaComponent,{schema:A,components:{ArrayTable:C.ArrayTable},scope:K({getContainer:n,useCancelAction:p.useCancelAction,createOnly:!0,isOverride:!1,override:!1,useCreateCollectionField:N,record:r,showReverseFieldConfig:!1,targetScope:w,collections:D,isDialect:function(e){return(null==E?void 0:E.dialect)===e},disabledJSONB:!1,createMainOnly:!0},t)})))};function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],l=!0,a=!1;try{for(o=o.call(e);!(l=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);l=!0);}catch(e){a=!0,r=e}finally{try{!l&&null!=o.return&&o.return()}finally{if(a)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return G(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var z=function(e,t){var n=[];return e.forEach(function(e){var r=e.children.filter(function(e){var n;return null==e?void 0:null===(n=e.availableTypes)||void 0===n?void 0:n.includes(t)});n.push({label:e.label,key:e.key,children:r})}),n.filter(function(e){return"sort"===t?"advanced"===e.key:e.children.length>0})},Q=(0,f.observer)(function(e){var t,n=e.value,r=e.handleFieldChange,o=(0,p.useCollectionRecord)().data,i=(0,p.useCollectionManager_deprecated)().getInterface,l=(0,p.useCompile)(),a=(0,p.useFieldInterfaceOptions)(),u=z(a,o.type),d=W((0,c.useState)(n),2),f=d[0],m=d[1],y=W((0,c.useState)(u),2),b=y[0],h=y[1],g=o.type;return(0,c.useEffect)(function(){if(1===b.length&&(null===(n=b[0])||void 0===n?void 0:null===(t=n.children)||void 0===t?void 0:t.length)===1){var e=null===(u=b[0])||void 0===u?void 0:null===(a=u.children)||void 0===a?void 0:null===(l=a[0])||void 0===l?void 0:l.name;if(e!==f){var t,n,l,a,u,c,s,p=i(e);r({interface:e,uiSchema:L({title:null==o?void 0:null===(c=o.uiSchema)||void 0===c?void 0:c.title},null==p?void 0:null===(s=p.default)||void 0===s?void 0:s.uiSchema)},o.name,!1),m(e)}}else{;if(f&&(d=f,null==(y=b)?!void 0:!y.some(function(e){var t,n;return null===(n=e.children)||void 0===n?void 0:null===(t=n.some)||void 0===t?void 0:t.call(n,function(e){return e.name===d})}))){var d,y,v,h,g,S,C,w=null===(g=b[0])||void 0===g?void 0:null===(h=g.children)||void 0===h?void 0:null===(v=h[0])||void 0===v?void 0:v.name,x=i(w);r({interface:w,uiSchema:L({title:null==o?void 0:null===(S=o.uiSchema)||void 0===S?void 0:S.title},null==x?void 0:null===(C=x.default)||void 0===C?void 0:C.uiSchema)},o.name,!1),m(w)}}},[b]),(0,c.useEffect)(function(){(null==o?void 0:o.possibleTypes)&&h(z(a,g))},[g]),["oho","obo","o2m","m2o","m2m"].includes(o.interface)?s().createElement(v.Tag,{key:n},l(null===(t=a.find(function(e){return"relation"===e.key}).children.find(function(e){return e.name===n}))||void 0===t?void 0:t.label)):s().createElement(v.Select,{"aria-label":"field-interface-".concat(null==o?void 0:o.type),role:"button",value:f,style:{width:"100%"},popupMatchSelectWidth:!1,onChange:function(e){var t,n,l=i(e);r({interface:e,uiSchema:L({title:null==o?void 0:null===(t=o.uiSchema)||void 0===t?void 0:t.title},null==l?void 0:null===(n=l.default)||void 0===n?void 0:n.uiSchema)},o.name),m(e)}},b.map(function(e){return s().createElement(v.Select.OptGroup,{key:e.key,label:l(e.label)},e.children.map(function(e){return s().createElement(v.Select.Option,{key:e.name,value:e.name},l(e.label))}))}))},{displayName:"CollectionFieldInterfaceSelect"});function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var H=(0,f.observer)(function(e){var t,n,r=e.value,o=e.handleFieldChange,i=(0,p.useRecord)();var l=(t=(0,c.useState)(r),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],l=!0,a=!1;try{for(o=o.call(e);!(l=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);l=!0);}catch(e){a=!0,r=e}finally{try{!l&&null!=o.return&&o.return()}finally{if(a)throw r}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return J(e,t)}}(t,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=l[0],u=l[1],d=function(e){u(e)},f=(0,c.useMemo)(function(){return(0,w.debounce)(function(e){var t,n;o({uiSchema:(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({},null==i?void 0:i.uiSchema),n=(n={title:e},n),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t)},i.name)},1e3)},[o,i]);return(0,c.useEffect)(function(){u(r)},[r]),s().createElement(v.Input,{value:a,onChange:function(e){var t=e.target.value;d(t),f(t)},style:{minWidth:"100px"},"aria-label":"field-title-input"})},{displayName:"FieldTitleInput"}),X=(0,f.observer)(function(e){var t=e.value,n=e.handleFieldChange,r=e.onChange,o=(0,p.useRecord)(),i=(0,w.omit)(o,["__parent","__collectionName"]);return(null==i?void 0:i.possibleTypes)?s().createElement(v.Select,{"aria-label":"field-type-".concat(t),role:"button",defaultValue:t,popupMatchSelectWidth:!1,style:{width:"100%"},options:(null==i?void 0:i.possibleTypes.map(function(e){return{label:e,value:e}}))||[],onChange:function(e){var t,l;null==r||r(e),n((t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({},i),l=(l={type:e},l),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(l)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(l)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(l,e))}),t),o.name)}}):s().createElement(v.Tag,null,t)},{displayName:"FieldType"});function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Z(e,t,n,r,o,i,l){try{var a=e[i](l),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,o)}var ee=(0,p.withDynamicSchemaProps)(function(e){var t,n,r,o,i=(0,b.useTranslation)().t,l=(0,p.useCollectionManager_deprecated)().isTitleField;var a=(t=s().useState(null),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],l=!0,a=!1;try{for(o=o.call(e);!(l=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);l=!0);}catch(e){a=!0,r=e}finally{try{!l&&null!=o.return&&o.return()}finally{if(a)throw r}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return Y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y(e,t)}}(t,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=a[0],c=a[1],d=(0,p.useDataSourceManager)(),f=(0,p.useProps)(e),m=f.setTitleField,y=f.filterByTk,h=f.dataSourceKey,g=(0,p.useRecord)(),S=(0,p.useAPIClient)(),C=eT(),w=C.refreshRM,x=C.titleField;var O=(o=(r=function(e){return function(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,function(t){switch(t.label){case 0:return c(g),[4,S.request({url:"dataSources/".concat(h,"/collections:update?filterByTk=").concat(y),method:"post",data:{titleField:e?g.name:"id"}})];case 1:return t.sent(),v.message.success(i("Saved successfully")),w(),m(e?g.name:"id"),[4,d.getDataSource(h).reload()];case 2:return t.sent(),c(null),[2]}})},function(){var e=this,t=arguments;return new Promise(function(n,o){var i=r.apply(e,t);function l(e){Z(i,n,o,l,a,"next",e)}function a(e){Z(i,n,o,l,a,"throw",e)}l(void 0)})}),function(e){return o.apply(this,arguments)});return l(g)?s().createElement(v.Tooltip,{title:i("Default title for each record"),placement:"right",overlayInnerStyle:{textAlign:"center"}},s().createElement(v.Switch,{"aria-label":"switch-title-field-".concat(null==g?void 0:g.name),size:"small",loading:(null==g?void 0:g.name)===(null==u?void 0:u.name),checked:(null==g?void 0:g.name)===(x||"id"),onChange:O})):null},{displayName:"TitleField"}),et=n("573"),en=function(){var e=(0,b.useTranslation)().t,t=(0,p.useRecord)().unsupportedFields,n=[{title:e("Field name"),dataIndex:"name",key:"name"},{title:e("Field database type",{ns:et.A7}),dataIndex:"rawType",key:"rawType"}];return(null==t?void 0:t.length)>0&&s().createElement(s().Fragment,null,s().createElement(v.Divider,{plain:!0,orientation:"left",orientationMargin:"0"},s().createElement("h3",null,e("Unknown field type",{ns:et.A7}))),s().createElement("div",{style:{marginBottom:"15px"}},e("The following field types are not compatible and do not support output and display",{ns:et.A7})),s().createElement(v.Table,{columns:n,dataSource:t,pagination:!1}))};function er(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eo(e,t,n,r,o,i,l){try{var a=e[i](l),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,o)}function ei(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function l(e){eo(i,r,o,l,a,"next",e)}function a(e){eo(i,r,o,l,a,"throw",e)}l(void 0)})}}function el(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ea(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){el(e,t,n[t])})}return e}function eu(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function ec(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],l=!0,a=!1;try{for(o=o.call(e);!(l=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);l=!0);}catch(e){a=!0,r=e}finally{try{!l&&null!=o.return&&o.return()}finally{if(a)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return er(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return er(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function es(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var ep=function(e){var t=e.schema,n=(e.record,e.parentRecord),r=e.compile;if(e.getContainer,!!t){var o=(0,w.cloneDeep)(t.properties);return(null==o?void 0:o.name)&&(o.name["x-disabled"]=!0),!0===t.hasDefaultValue&&(o.defaultValue=(0,w.cloneDeep)(t.default.uiSchema)||{},o.defaultValue.required=!1,o.defaultValue.title=r('{{ t("Default value") }}'),o.defaultValue["x-decorator"]="FormItem",o.defaultValue["x-reactions"]={dependencies:["uiSchema.x-component-props.gmt","uiSchema.x-component-props.showTime","uiSchema.x-component-props.dateFormat","uiSchema.x-component-props.timeFormat"],fulfill:{state:{componentProps:{gmt:"{{$deps[0]}}",showTime:"{{$deps[1]}}",dateFormat:"{{$deps[2]}}",timeFormat:"{{$deps[3]}}"}}}},o.defaultValue["x-disabled"]=!0),{type:"object",properties:el({},(0,u.uid)(),{type:"void","x-component":"Action.Drawer","x-component-props":{getContainer:"{{ getContainer }}"},"x-decorator":"Form","x-decorator-props":{useValues:function(e){return(0,p.useRequest)(function(){var e;return Promise.resolve({data:eu(ea({},(0,w.cloneDeep)((0,w.omit)(t.default,["uiSchema.rawTitle"]))),{autoFill:(null===(e=t.default)||void 0===e?void 0:e.autoFill)!==!1})})},e)}},title:"".concat(r((null==n?void 0:n.title)||(null==n?void 0:n.name))," - ").concat(r('{{ t("Edit field") }}')),properties:eu(ea({summary:{type:"void","x-component":"FieldSummary","x-component-props":{schemaKey:t.name}}},o),{description:{type:"string",title:'{{t("Description")}}',"x-decorator":"FormItem","x-component":"Input.TextArea"},footer:{type:"void","x-component":"Action.Drawer.Footer",properties:{action1:{title:'{{ t("Cancel") }}',"x-component":"Action","x-component-props":{useAction:"{{ useCancelAction }}"}},action2:{title:'{{ t("Submit") }}',"x-component":"Action","x-component-props":{type:"primary",useAction:"{{ useUpdateCollectionField }}"}}}}})})}}},ed=function(){var e=(0,f.useForm)(),t=(0,p.useAPIClient)(),n=(0,p.useActionContext)(),r=(0,p.useResourceActionContext)().refresh,o=eT().targetCollection,i=(0,d.useParams)().name,l=(0,p.useRecord)().name,a=(0,p.useDataSourceManager)();return{run:function(){return ei(function(){var u;return es(this,function(c){switch(c.label){case 0:return[4,e.submit()];case 1:return c.sent(),(u=(0,w.cloneDeep)(e.values)).autoCreateReverseField||delete u.reverseField,delete u.autoCreateReverseField,[4,t.request({url:"dataSourcesCollections/".concat(i,".").concat(o.name,"/fields:update?filterByTk=").concat(l),method:"post",data:u})];case 2:return c.sent(),n.setVisible(!1),a.getDataSource(i).reload(),[4,e.reset()];case 3:return c.sent(),r(),[2]}})})()}}},ef=function(e){var t=(0,p.useRecord)(),n=(0,p.useCollectionParentRecordData)();return s().createElement(em,ea({item:t,parentItem:n},e))},em=function(e){var t,n,r=e.scope,o=e.getContainer,i=e.item,l=e.parentItem,a=e.children,f=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],!(t.indexOf(n)>=0)&&(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++){if(n=i[r],!(t.indexOf(n)>=0))Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}}return o}(e,["scope","getContainer","item","parentItem","children"]),m=(0,p.useCollectionManager_deprecated)(),y=m.getInterface,v=m.collections,h=m.getCollection,g=((0,p.useCurrentAppInfo)()||{data:{database:{}}}).data.database,S=ec((0,c.useState)(!1),2),x=S[0],O=S[1],A=ec((0,c.useState)({}),2),P=A[0],j=A[1],F=(0,p.useAPIClient)(),E=(0,b.useTranslation)().t,D=(0,p.useCompile)(),T=(0,d.useParams)().name,k=(null==i?void 0:i.fields)||(null===(n=h(i.collectionName,T))||void 0===n?void 0:null===(t=n.options)||void 0===t?void 0:t.fields),I=(0,c.useMemo)(function(){return v.map(function(e){return{label:D(e.title),value:e.name}})},[]),R=(0,c.useMemo)(function(){var e,t;return(null==i?void 0:i.fields)||(null===(t=h(i.collectionName,T))||void 0===t?void 0:null===(e=t.options)||void 0===e?void 0:e.fields.filter(function(e){return["string","bigInt","integer"].includes(e.type)}).map(function(e){var t;return{value:e.name,label:D(null===(t=e.uiSchema)||void 0===t?void 0:t.title)}}))},[i.name,k]);return s().createElement(p.RecordProvider,{record:i,parent:l},s().createElement(p.ActionContextProvider,{value:{visible:x,setVisible:O}},s().createElement("a",eu(ea({},f),{onClick:ei(function(){var e,t,n,r,a,c;return es(this,function(s){switch(s.label){case 0:return[4,F.request({url:"dataSourcesCollections/".concat(T,".").concat(l.name,"/fields:get?filterByTk=").concat(i.name),params:{appends:["reverseField"]}})];case 1:return n=y(null==(t=s.sent().data)?void 0:null===(e=t.data)||void 0===e?void 0:e.interface),!(null==(r=(0,w.cloneDeep)(null==t?void 0:t.data)||{})?void 0:r.reverseField)&&(r.autoCreateReverseField=!1,r.reverseField=null==n?void 0:null===(a=n.default)||void 0===a?void 0:a.reverseField,(0,w.set)(r.reverseField,"name","f_".concat((0,u.uid)())),(0,w.set)(r.reverseField,"uiSchema.title",null===(c=i.__parent)||void 0===c?void 0:c.title)),j(ep({schema:eu(ea({},n),{default:r}),record:i,parentRecord:l,compile:D,getContainer:o})),O(!0),[2]}})})}),a||E("Edit")),s().createElement(p.SchemaComponent,{schema:P,components:{ArrayTable:C.ArrayTable},scope:eu(ea({getContainer:o,useUpdateCollectionField:ed,useCancelAction:p.useCancelAction,showReverseFieldConfig:!1,collections:I,isDialect:function(e){return(null==g?void 0:g.dialect)===e},scopeKeyOptions:R,disabledJSONB:!0},r),{createOnly:!1,createMainOnly:!1,editMainOnly:!0})})))},ey=n("648");function ev(e,t,n,r,o,i,l){try{var a=e[i](l),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,o)}function eb(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function l(e){ev(i,r,o,l,a,"next",e)}function a(e){ev(i,r,o,l,a,"throw",e)}l(void 0)})}}function eh(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var eg=function(){var e=(0,p.useResourceActionContext)().refresh,t=(0,d.useParams)().name,n=(0,p.useRecord)(),r=n.name,o=n.collectionName,i=(0,p.useAPIClient)();return{run:function(){return eb(function(){return eh(this,function(n){switch(n.label){case 0:return[4,i.request({url:"dataSourcesCollections/".concat(t,".").concat(o,"/fields:destroy?filterByTk=").concat(r),method:"post"})];case 1:return n.sent(),e(),[2]}})})()}}},eS=function(){var e=(0,p.useResourceActionContext)(),t=e.state,n=e.setState,r=e.refresh,o=(0,b.useTranslation)().t,i=(0,d.useParams)().name,l=(0,p.useAPIClient)(),a=(0,p.useRecord)().name;return{run:function(){return eb(function(){var e;return eh(this,function(u){switch(u.label){case 0:if(!(null==t?void 0:null===(e=t.selectedRowKeys)||void 0===e?void 0:e.length))return[2,v.message.error(o("Please select the records you want to delete"))];return[4,l.request({url:"dataSourcesCollections/".concat(i,".").concat(a,"/fields:destroy"),method:"post",params:{filterByTk:(null==t?void 0:t.selectedRowKeys)||[]}})];case 1:return u.sent(),null==n||n({selectedRowKeys:[]}),r(),[2]}})})()}}},eC=function(){var e=eS().run;return{run:function(){return eb(function(){return eh(this,function(t){switch(t.label){case 0:return[4,e()];case 1:return t.sent(),[2]}})})()}}},ew=function(){var e=eg().run;return{run:function(){return eb(function(){return eh(this,function(t){switch(t.label){case 0:return[4,e()];case 1:return t.sent(),[2]}})})()}}};function ex(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var eO={name:"fields",fields:[{type:"string",name:"type",interface:"input",uiSchema:{title:'{{ t("Storage type") }}',type:"string","x-component":"Select",enum:[{label:"String",value:"string"}],required:!0}},{type:"string",name:"interface",interface:"input",uiSchema:{title:'{{t("Field interface", { ns: "'.concat(et.A7,'" })}}'),type:"string","x-component":"Select",enum:"{{interfaces}}"}},{type:"string",name:"title",interface:"input",uiSchema:{title:'{{ t("Field display name") }}',type:"string","x-component":"Input",required:!0}},{type:"string",name:"name",interface:"input",uiSchema:{title:'{{ t("Field name") }}',type:"string","x-component":"Input"}},{type:"string",name:"description",interface:"input",uiSchema:{title:'{{ t("Description") }}',type:"string","x-component":"Input.TextArea"}}]},eA={type:"object",properties:(ex(l={},(0,u.uid)(),{type:"void","x-component":"ActionBar","x-component-props":{style:{marginBottom:16}},properties:{delete:{type:"void",title:'{{ t("Delete") }}',"x-component":"Action","x-visible":!1,"x-component-props":{useAction:"{{ useBulkDestroyActionAndRefreshCM }}",confirm:{title:"{{t('Delete record')}}",content:"{{t('Are you sure you want to delete it?')}}"}}},syncfromDatabase:{type:"void",title:'{{ t("Sync from database") }}',"x-component":"SyncFieldsAction","x-component-props":{type:"primary"}},syncSQL:{type:"void",title:'{{ t("Sync from database") }}',"x-component":"SyncSQLFieldsAction","x-component-props":{type:"primary"}},create:{type:"void",title:'{{ t("Add new") }}',"x-component":"AddCollectionField","x-component-props":{type:"primary"},"x-hidden":"{{ disableAddFields }}"}}}),ex(l,(0,u.uid)(),{type:"void","x-uid":"input","x-component":"Table.Void","x-component-props":{pagination:!1,rowKey:"name",rowSelection:{type:"checkbox"},dragSort:!1,useDataSource:"{{ useDataSource }}"},properties:{column1:{type:"void",title:'{{ t("Field display name") }}',"x-component":"Table.Column",properties:{"uiSchema.title":{type:"string","x-component":"FieldTitleInput","x-component-props":{handleFieldChange:"{{enqueueChange}}"}}}},column2:{type:"void","x-decorator":"Table.Column.Decorator","x-component":"Table.Column",properties:{name:{"x-component":"CollectionField","x-read-pretty":!0}}},column3:{type:"void","x-decorator":"Table.Column.Decorator","x-component":"Table.Column",title:'{{t("Field type")}}',properties:{type:{"x-component":"FieldType","x-component-props":{handleFieldChange:"{{enqueueChange}}"}}}},column4:{type:"void","x-decorator":"Table.Column.Decorator","x-component":"Table.Column",title:'{{t("Field interface", { ns: "'.concat(et.A7,'" })}}'),properties:{interface:{"x-component":"CollectionFieldInterfaceSelect","x-component-props":{handleFieldChange:"{{enqueueChange}}"}}}},column5:{type:"void","x-decorator":"Table.Column.Decorator","x-component":"Table.Column",title:'{{t("Title field")}}',properties:{titleField:{"x-component":"TitleField","x-use-component-props":"useTitleFieldProps","x-read-pretty":!1}}},column6:{type:"void","x-decorator":"Table.Column.Decorator","x-component":"Table.Column",title:'{{ t("Description") }}',properties:{description:{"x-component":"CollectionField","x-read-pretty":!0,"x-component-props":{ellipsis:!0,style:{width:100}}}}},column7:{type:"void",title:'{{ t("Actions") }}',"x-component":"Table.Column",properties:{actions:{type:"void","x-component":"Space","x-component-props":{split:"|"},properties:{update:{type:"void",title:'{{ t("Edit") }}',"x-component":"EditCollectionField","x-component-props":{role:"button","aria-label":'{{ "edit-button-" + $record.name }}',type:"primary"}},delete:{type:"void",title:'{{ t("Delete") }}',"x-disabled":"{{cm.useDeleteButtonDisabled()}}","x-component":"Action.Link","x-component-props":{confirm:{title:"{{t('Delete record')}}",content:"{{t('Are you sure you want to delete it?')}}"},useAction:"{{ useDestroyActionAndRefreshCM }}"},"x-reactions":[{dependencies:[".interface"],fulfill:{state:{visible:"{{ ['obo','oho','m2m','o2m','m2o'].includes($deps[0]) }}"}}}]}}}}}}}),l)};function eP(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ej(e,t,n,r,o,i,l){try{var a=e[i](l),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,o)}function eF(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function l(e){ej(i,r,o,l,a,"next",e)}function a(e){ej(i,r,o,l,a,"throw",e)}l(void 0)})}}function eE(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var eD=(0,c.createContext)({refreshRM:function(){},titleField:null,targetCollection:null});eD.displayName="RemoteCollectionContext";var eT=function(){return(0,c.useContext)(eD)},ek=function(){var e,t,n,r,o,i,l,a=(0,f.useField)(),u=(0,c.useMemo)(function(){return(0,g.createForm)()},[]);var m=(0,p.useAttach)(u.createArrayField((e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({},a.props),t=(t={basePath:""},t),Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e))),y=(0,b.useTranslation)().t,h=(0,d.useParams)().name,S=(0,p.useAPIClient)(),C=(0,p.useCompile)(),w=(0,c.useContext)(p.ResourceActionContext),x=((0,p.useResourceContext)()||{}).targetKey,O=(0,p.useRecord)(),A=O[x],P=O.titleField,j=O.name;var F=(n=(0,c.useState)(P),r=2,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],l=!0,a=!1;try{for(o=o.call(e);!(l=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);l=!0);}catch(e){a=!0,r=e}finally{try{!l&&null!=o.return&&o.return()}finally{if(a)throw r}}return i}}(n,2)||function(e,t){if(e){if("string"==typeof e)return eP(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eP(e,t)}}(n,r)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),R=F[0],M=F[1],V={association:{sourceKey:"name",targetKey:"name"},dragSort:!1,collection:eO,request:{url:"dataSourcesCollections/".concat(h,".").concat(j,"/fields:list"),params:{paginate:!1,filter:{$or:[{"interface.$not":null},{"options.source.$notEmpty":!0}]},sort:["sort"]}}},K=(0,p.useDataSourceManager)(),$=!1,_=[];var q=(o=eF(function(){var e,t,n,r;return eE(this,function(o){switch(o.label){case 0:if($||0===_.length)return[2];$=!0,t=(e=_.shift()).value,n=e.filterByTk,r=e.flag,o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,N(t,n,r)];case 2:return o.sent(),[3,5];case 3:return console.error("Error processing handleFieldChange:",o.sent()),[3,5];case 4:return $=!1,q(),[7];case 5:return[2]}})}),function(){return o.apply(this,arguments)});var N=(i=eF(function(e,t){var n,r=arguments;return eE(this,function(o){switch(o.label){case 0:return n=!(r.length>2)||void 0===r[2]||r[2],[4,S.request({url:"dataSourcesCollections/".concat(h,".").concat(j,"/fields:update?filterByTk=").concat(t),method:"post",data:e})];case 1:return o.sent(),K.getDataSource(h).reload(),n&&v.message.success(y("Saved successfully")),[2]}})}),function(e,t){return i.apply(this,arguments)});var U=(l=eF(function(e,t,n){var r,o,i,l,a;return eE(this,function(u){switch(u.label){case 0:return i=t.targetScope,l=(null===(r=e.props)||void 0===r?void 0:r.name)==="inherits",[4,S.request({url:"dataSources/".concat(h,"/collections:list"),params:{paginate:!1,appends:["fields"],sort:["sort"]}})];case 1:return[2,(null==(a=u.sent().data)?void 0:null===(o=a.data)||void 0===o?void 0:o.filter(function(t){if(null==n?void 0:n.includes(t.template))return!1;if(t.autoCreate&&t.isThrough||l&&"view"===t.template)return!1;var r,o=!(null==i?void 0:i.template)||i.template.includes(t.template),a=!(null==i?void 0:i[null===(r=e.props)||void 0===r?void 0:r.name])||i[e.props.name].includes(t.name);return o&&a})).map(function(e){return{label:C(e.title||e.name),value:e.name}})]}})}),function(e,t,n){return l.apply(this,arguments)});return s().createElement(eD.Provider,{value:{refreshRM:function(){w.refresh()},titleField:R,targetCollection:O}},s().createElement(ey.a,{collectionName:j}),s().createElement(p.ResourceActionProvider,V,s().createElement(f.FormContext.Provider,{value:u},s().createElement(f.FieldContext.Provider,{value:m},s().createElement(p.SchemaComponentOptions,{components:{TitleField:ee,CollectionFieldInterfaceSelect:Q,AddCollectionField:B,SourceCollection:k,TargetKey:T,SourceKey:E,FieldTitleInput:H,EditCollectionField:ef,Select:p.Select,FieldType:X,ForeignKey:D,ThroughCollection:I},inherit:!0,scope:{useDataSource:function(e){var t=(0,c.useContext)(p.ResourceActionContext),n=(0,f.useField)();return(0,c.useEffect)(function(){!t.loading&&(null==e||e.onSuccess(t.data),n.componentProps.dragSort=!!t.dragSort)},[t.loading]),t},useTitleFieldProps:function(){return{filterByTk:A,titleField:R,dataSourceKey:h,setTitleField:M}},enqueueChange:function(e,t,n){_.push({value:e,filterByTk:t,flag:n}),q()},useDestroyActionAndRefreshCM:ew,useBulkDestroyActionAndRefreshCM:eC,loadCollections:U}},s().createElement(f.RecursionField,{schema:eA,onlyRenderProperties:!0}))))),s().createElement(en,null))},eI=n("227");function eR(e,t,n,r,o,i,l){try{var a=e[i](l),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,o)}function eM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var eV=function(e){return f.Schema.compile(e,{t:p.i18n.t})},eK={name:"database-"+(0,u.uid)(),filterTargetKey:"name",targetKey:"name",sortable:!0,fields:[{type:"integer",name:"title",interface:"input",uiSchema:{title:'{{ t("Collection display name") }}',type:"number","x-component":eI.E,required:!0}},{type:"string",name:"name",interface:"input",uiSchema:{title:'{{ t("Collection name") }}',type:"string","x-component":"CollectionName",description:'{{t("Randomly generated and can be modified. Support letters, numbers and underscores, must start with an letter.")}}'}},{type:"hasMany",name:"fields",target:"fields",collectionName:"collections",sourceKey:"name",targetKey:"name",uiSchema:{}},{type:"hasMany",name:"inherits",interface:"select",uiSchema:{title:'{{ t("Inherits") }}',type:"string","x-component":"Select","x-component-props":{mode:"multiple"}}},{type:"string",name:"description",interface:"input",uiSchema:{title:'{{ t("Description") }}',type:"string","x-component":"Input"}}]},e$={type:"object",properties:(eM(a={},(0,u.uid)(),{type:"void","x-component":"ActionBar","x-component-props":{style:{marginBottom:16}},properties:{filter:{type:"void",title:'{{ t("Filter") }}',default:{$and:[{title:{$includes:""}},{name:{$includes:""}}]},"x-action":"filter","x-component":"Filter.Action","x-use-component-props":"cm.useFilterActionProps","x-component-props":{icon:"FilterOutlined"},"x-align":"left"},refresh:{type:"void",title:'{{ t("Refresh") }}',"x-component":"Action","x-use-component-props":"useRefreshActionProps","x-component-props":{icon:"ReloadOutlined"}},delete:{type:"void",title:'{{ t("Delete") }}',"x-component":"DeleteCollection","x-component-props":{role:"button",isBulk:!0},"x-visible":"{{allowCollectionDeletion}}"},create:{type:"void",title:'{{ t("Create collection") }}',"x-component":"AddCollection","x-component-props":{type:"primary"},"x-visible":"{{allowCollectionCreate}}"}}}),eM(a,(0,u.uid)(),{type:"void","x-uid":"input","x-component":"Table.Void","x-component-props":{rowKey:"name",rowSelection:{type:"checkbox"},useDataSource:"{{cm.useDataSourceFromRAC }}",useAction:function(){var e=(0,p.useAPIClient)(),t=(0,b.useTranslation)().t;return{move:function(n,r){var o;return(o=function(){return function(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,function(o){switch(o.label){case 0:return[4,e.resource("dataSources").move({sourceId:n.key,targetId:r.key})];case 1:return o.sent(),v.message.success(t("Saved successfully"),.2),[2]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=o.apply(e,t);function l(e){eR(i,n,r,l,a,"next",e)}function a(e){eR(i,n,r,l,a,"throw",e)}l(void 0)})})()}}}},properties:{column1:{type:"void","x-decorator":"Table.Column.Decorator","x-component":"Table.Column",properties:{title:{"x-component":"CollectionField","x-read-pretty":!0}}},column2:{type:"void","x-decorator":"Table.Column.Decorator","x-component":"Table.Column",properties:{name:{type:"string","x-component":"CollectionField","x-read-pretty":!0}}},column5:{type:"void","x-decorator":"Table.Column.Decorator","x-component":"Table.Column",properties:{description:{"x-component":"CollectionField","x-read-pretty":!0,"x-component-props":{ellipsis:!0}}}},column6:{type:"void",title:'{{ t("Actions") }}',"x-component":"Table.Column",properties:{actions:{type:"void","x-component":"Space","x-component-props":{split:"|"},properties:{view:{type:"void",title:'{{ t("Configure fields") }}',"x-component":"Action.Link","x-component-props":{},properties:{drawer:{type:"void","x-component":"Action.Drawer","x-component-props":{destroyOnClose:!0,width:"70%"},"x-reactions":function(e){var t=e.path.segments[1],n=e.path.segments[0],r=e.form.getValuesIn("".concat(n,".").concat(t));r&&(e.title="".concat(eV(r.title||r.name)," - ").concat(eV('{{ t("Configure fields") }}')))},properties:{collectionFields:{type:"void","x-component":"CollectionFields"}}}},"x-hidden":"{{disabledConfigureFields}}"},update:{type:"void",title:'{{ t("Edit") }}',"x-component":"EditCollection","x-component-props":{role:"button","aria-label":'{{ "edit-button-" + $record.name }}',type:"primary"}},delete:{type:"void",title:'{{ t("Delete") }}',"x-visible":"{{allowCollectionDeletion}}","x-component":"DeleteCollection","x-component-props":{role:"button","aria-label":'{{ "delete-button-" + $record.name }}',type:"primary",className:"nb-action-link"}}}}}}}}),a)};function e_(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eq(e,t,n,r,o,i,l){try{var a=e[i](l),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,o)}function eN(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function l(e){eq(i,r,o,l,a,"next",e)}function a(e){eq(i,r,o,l,a,"throw",e)}l(void 0)})}}function eB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}function eU(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function eG(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],l=!0,a=!1;try{for(o=o.call(e);!(l=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);l=!0);}catch(e){a=!0,r=e}finally{try{!l&&null!=o.return&&o.return()}finally{if(a)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return e_(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e_(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eL(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var eW=function(e,t){return function(n,r){n.loading=!0,e(n,r,t).then(m.action.bound(function(e){n.dataSource=e,n.loading=!1})).catch(function(e){return console.log(e)})}},ez=function(){var e=eG((0,c.useState)([]),2);return[e[0],e[1]]},eQ=function(){var e=(0,p.useRecord)(),t=(0,f.useForm)();return{run:function(){return eN(function(){var n,r,o,i;return eL(this,function(l){return i=null===(o=t.values)||void 0===o?void 0:null===(r=o.children)||void 0===r?void 0:null===(n=r.slice)||void 0===n?void 0:n.call(r),t.setValuesIn("children",i.filter(function(t){return t.name!==e.name})),[2]})})()}}},eJ=function(){return{run:function(){return eN(function(){return eL(this,function(e){return[2]})})()}}},eH=function(e){return"".concat(e||"").concat((0,u.uid)())},eX=function(){var e,t,n,r=(0,b.useTranslation)().t,o=(0,p.useCollectionManager_deprecated)().interfaces,i=((0,p.useCurrentAppInfo)()||{data:{database:{}}}).data.database,l=(0,p.useDataSourceManager)(),a=(0,c.useContext)(p.SchemaComponentContext),m=(0,d.useParams)().name,g=(0,c.useContext)(p.CollectionCategoriesContext),S=(0,p.useAPIClient)(),C=(0,p.useCompile)();var w=(e=eN(function(){return eL(this,function(e){return[2,g.data.map(function(e){return{label:C(e.name),value:e.id}})]})}),function(){return e.apply(this,arguments)});var x=(t=eN(function(){return eL(this,function(e){return[2,S.resource("storages").list().then(function(e){var t,n=e.data;return null==n?void 0:null===(t=n.data)||void 0===t?void 0:t.map(function(e){return{label:r(C(e.title)),value:e.name}})})]})}),function(){return t.apply(this,arguments)}),O=(0,c.useMemo)(function(){var e;return e=m,{type:"object",properties:eM({},(0,u.uid)(),{type:"void","x-collection":"dataSources","x-decorator":"ResourceActionProvider","x-decorator-props":{collection:eK,dragSort:!1,request:{url:"dataSources/".concat(e,"/collections:list"),params:{pageSize:50,sort:"sort",filter:{"hidden.$isFalsy":!0},appends:["category"]}}},properties:{tabs:{type:"void","x-component":"ConfigurationTabs"}}})}},[m]),A=S.resource("dataSources",m),P=eG((0,c.useState)({}),2),j=P[0],F=P[1];(0,c.useEffect)(function(){try{A.get({filterByTk:m}).then(function(e){F(null==e?void 0:e.data)})}catch(e){console.log(e)}},[m]);var E=(n=eN(function(e){return eL(this,function(t){return[2,Promise.resolve({data:e.form.values.fields}).then(function(e){var t=e.data;return null==t?void 0:t.map(function(e){var t;return{label:C(null===(t=e.uiSchema)||void 0===t?void 0:t.title)||e.name,value:e.name}})})]})}),function(e){return n.apply(this,arguments)}),D=(0,c.useMemo)(function(){return eU(eB({},a),{designable:!1,dataSourceData:j})},[a,j]);return s().createElement(p.SchemaComponentContext.Provider,{value:D},s().createElement(p.SchemaComponent,{schema:O,components:{AddSubFieldAction:p.AddSubFieldAction,EditSubFieldAction:p.EditSubFieldAction,FieldSummary:p.FieldSummary,TemplateSummay:p.TemplateSummary,CollectionFields:ek},scope:{useRefreshActionProps:function(){var e=(0,c.useContext)(p.ResourceActionContext),t=(0,p.useAPIClient)(),n=(0,f.useField)(),o=(0,d.useParams)().name;n.data=n.data||{};var i=(0,c.useContext)(h.DataSourceContext),a=i.setDataSource,u=i.dataSource;return{onClick:function(){return eN(function(){var i,c,s,p,d;return eL(this,function(d){switch(d.label){case 0:n.data.loading=!0,d.label=1;case 1:return d.trys.push([1,4,,5]),[4,t.request({url:"dataSources:refresh?filterByTk=".concat(o,"&clientStatus=").concat((null==u?void 0:u.status)||"loaded"),method:"post"})];case 2:return s=d.sent().data,n.data.loading=!1,a(eU(eB({},null==s?void 0:s.data),{name:o})),(null==s?void 0:null===(i=s.data)||void 0===i?void 0:i.status)==="reloading"?v.message.warning(r("Data source synchronization in progress")):(null==s?void 0:null===(c=s.data)||void 0===c?void 0:c.status)==="loaded"&&(v.message.success(r("Data source synchronization successful")),null==e||null===(p=e.refresh)||void 0===p||p.call(e)),[4,l.getDataSource(o).reload()];case 3:return d.sent(),[3,5];case 4:return d.sent(),n.data.loading=!1,[3,5];case 5:return[2]}})})()}}},useDestroySubField:eQ,useBulkDestroySubField:eJ,useSelectedRowKeys:ez,useAsyncDataSource:eW,loadFilterTargetKeys:E,loadCategories:w,loadStorages:x,useNewId:eH,useCancelAction:p.useCancelAction,interfaces:o,enableInherits:(null==i?void 0:i.dialect)==="postgres",isPG:(null==i?void 0:i.dialect)==="postgres",getPickerFormat:y.getPickerFormat}}))},eY=n("948"),eZ=n("527"),e0=n.n(eZ),e1=function(e,t){if("ConfigContext"in v.ConfigProvider)return(0,(0,c.useContext)(v.ConfigProvider.ConfigContext).getPrefixCls)(e,null==t?void 0:t.prefixCls);var n,r=null!==(n=null==t?void 0:t.prefixCls)&&void 0!==n?n:"ant-";return"".concat(r).concat(null!=e?e:"")},e2=Object.assign((0,f.connect)(v.Input,(0,f.mapProps)(function(e,t){var n,r;return n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({},e),r=(r={suffix:s().createElement("span",null,(null==t?void 0:t.loading)||(null==t?void 0:t.validating)?s().createElement(S.LoadingOutlined,null):e.suffix)},r),Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(r)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))}),n}),(0,f.mapReadPretty)(function(e){var t=e1("description-input",e),n=(0,p.useCollectionRecord)().data,r=n.name,o=n.tableName;return s().createElement("div",{className:e0()(t,e.className),style:e.style},r!==o&&o?s().createElement(s().Fragment,null,r," ",s().createElement("span",{style:{color:"GrayText"}},"(",o,")")):e.value)})));function e3(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function e4(e,t,n,r,o,i,l){try{var a=e[i](l),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,o)}function e6(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function l(e){e4(i,r,o,l,a,"next",e)}function a(e){e4(i,r,o,l,a,"throw",e)}l(void 0)})}}function e5(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var e7=function(e){var t=e.item,n=(0,b.useTranslation)().t,r=(0,p.useCompile)();return s().createElement(v.Space,null,s().createElement(v.Badge,{color:t.color}),n(r(t.name)))},e8=(0,f.observer)(function(e){var t,n,r,o=(t=(0,c.useState)(null),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],l=!0,a=!1;try{for(o=o.call(e);!(l=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);l=!0);}catch(e){a=!0,r=e}finally{try{!l&&null!=o.return&&o.return()}finally{if(a)throw r}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return e3(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e3(e,t)}}(t,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],l=o[1],a=(0,c.useContext)(p.CollectionCategoriesContext).refresh,u=(0,p.useResourceActionContext)().refresh,d=(0,p.useAPIClient)();var f=(r=e6(function(e){var t,n;return e5(this,function(r){switch(r.label){case 0:if(t=e.active,n=e.over,setTimeout(function(){l(null)}),!(n&&n.id!==t.id))return[3,4];return[4,d.resource("collectionCategories").move({sourceId:t.id,targetId:n.id})];case 1:return r.sent(),[4,a()];case 2:return r.sent(),[4,u()];case 3:r.sent(),r.label=4;case 4:return[2]}})}),function(e){return r.apply(this,arguments)}),m=(0,eY.useSensor)(eY.MouseSensor,{activationConstraint:{distance:10}}),y=(0,eY.useSensors)(m);return s().createElement(eY.DndContext,{sensors:y,onDragEnd:f,onDragStart:function(e){var t;l(null===(t=e.active)||void 0===t?void 0:t.data.current)}},e.children,s().createElement(eY.DragOverlay,null,i?s().createElement("span",{style:{whiteSpace:"nowrap"}},s().createElement(e7,{item:i})):null))},{displayName:"DndProvider"}),e9=function(){var e,t=(0,b.useTranslation)().t,n=(0,c.useContext)(p.CollectionCategoriesContext).data,r=(0,p.useCompile)();if(!n)return null;var o=n.sort(function(e,t){return t.sort-e.sort}).concat().map(function(e){var t,n;return t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({},e),n=(n={schema:e$},n),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t});o.find(function(e){return"all"===e.id})||o.unshift({name:'{{t("All collections")}}',id:"all",sort:0,closable:!1,schema:e$});var i=(e=e6(function(){return e5(this,function(e){return[2,n.map(function(e){return{label:t(r(e.name)),value:e.id}})]})}),function(){return e.apply(this,arguments)});return s().createElement(e8,null,s().createElement(v.Card,{bordered:!1},s().createElement(p.SchemaComponentOptions,{components:{CollectionFields:ek,CollectionName:e2},inherit:!0,scope:{loadCategories:i}},s().createElement(f.RecursionField,{schema:e$,onlyRenderProperties:!0}))))},te=n("60");function tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function tn(e,t,n,r,o,i,l){try{var a=e[i](l),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,o)}function tr(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function l(e){tn(i,r,o,l,a,"next",e)}function a(e){tn(i,r,o,l,a,"throw",e)}l(void 0)})}}function to(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ti(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){to(e,t,n[t])})}return e}function tl(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function ta(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],l=!0,a=!1;try{for(o=o.call(e);!(l=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);l=!0);}catch(e){a=!0,r=e}finally{try{!l&&null!=o.return&&o.return()}finally{if(a)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return tt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tt(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tu(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var tc=function(e,t,n,r){if(!!e){var o=(0,w.cloneDeep)(e.configurableProperties)||{title:{"x-component":"CollectionField","x-decorator":"FormItem"},name:{"x-component":"CollectionField","x-decorator":"FormItem"}};return!0===e.hasDefaultValue&&(o.defaultValue=(0,w.cloneDeep)(e.default.uiSchema),o.defaultValue.title=n('{{ t("Default value") }}'),o.defaultValue["x-decorator"]="FormItem"),{type:"object",properties:to({},(0,u.uid)(),{type:"void","x-component":"Action.Drawer","x-decorator":"Form","x-decorator-props":{useValues:"{{ useValuesFromRecord }}"},title:'{{ t("Edit collection") }}',properties:tl(ti({},(0,w.omit)(o,"category","inherits","moreOptions")),{filterTargetKey:{title:'{{ t("Record unique key") }}',type:"single",description:(0,y.tval)("If a collection lacks a primary key, you must configure a unique record key to locate row records within a block, failure to configure this will prevent the creation of data blocks for the collection.",{ns:et.A7}),"x-decorator":"FormItem","x-component":"Select","x-component-props":{multiple:!0},enum:"{{filterTargetKeyOptions}}"},footer:{type:"void","x-component":"Action.Drawer.Footer",properties:{action1:{title:'{{ t("Cancel") }}',"x-component":"Action","x-component-props":{useAction:"{{ useCancelAction }}"}},action2:{title:'{{ t("Submit") }}',"x-component":"Action","x-component-props":{type:"primary",useAction:"{{ useUpdateCollectionActionAndRefreshCM }}"}}}}})})}}},ts=function(e){var t=(0,p.useRecord)(),n=(0,p.useRequest)(function(){var e;return Promise.resolve({data:tl(ti({},(0,w.omit)((0,w.cloneDeep)(t),["__parent","__collectionName"])),{category:null==t?void 0:null===(e=t.category)||void 0===e?void 0:e.map(function(e){return e.id})})})},tl(ti({},e),{manual:!0})),r=(0,p.useActionContext)();return(0,c.useEffect)(function(){r.visible&&n.run()},[r.visible]),n},tp=function(e){var t=(0,p.useCollectionManager_deprecated)().refreshCM,n=(0,f.useForm)(),r=(0,p.useActionContext)(),o=(0,d.useParams)().name,i=(0,p.useResourceActionContext)().refresh,l=(0,p.useResourceContext)().targetKey,a=(0,p.useRecord)()[l],u=(0,p.useAPIClient)(),c=(0,p.useDataSourceManager)();return{run:function(){return tr(function(){return tu(this,function(e){switch(e.label){case 0:return[4,n.submit()];case 1:return e.sent(),[4,u.request({url:"dataSources/".concat(o,"/collections:update?filterByTk=").concat(a),method:"post",data:ti({},(0,w.omit)(n.values,["fields","autoGenId","createdAt","updatedAt","createdBy","updatedBy","sortable"]))})];case 2:return e.sent(),[4,c.getDataSource(o).reload()];case 3:return e.sent(),r.setVisible(!1),[4,n.reset()];case 4:return e.sent(),i(),[4,t()];case 5:return e.sent(),[2]}})})()}}},td=function(e){var t=(0,p.useRecord)();return s().createElement(tf,ti({item:t},e))},tf=function(e){var t,n=e.scope,r=e.getContainer,o=e.item,i=e.children,l=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],!(t.indexOf(n)>=0)&&(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++){if(n=i[r],!(t.indexOf(n)>=0))Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}}return o}(e,["scope","getContainer","item","children"]),a=(0,p.useCollectionManager_deprecated)().getTemplate,u=ta((0,c.useState)(!1),2),d=u[0],f=u[1],m=ta((0,c.useState)({}),2),y=m[0],v=m[1],h=(0,b.useTranslation)().t,g=(0,p.useCompile)(),S=null===(t=o.fields)||void 0===t?void 0:t.map(function(e){var t;return{label:(null===(t=e.uiSchema)||void 0===t?void 0:t.title)?g(e.uiSchema.title):e.name,value:e.name}});return s().createElement(p.RecordProvider,{record:o},s().createElement(p.ActionContextProvider,{value:{visible:d,setVisible:f}},s().createElement("a",tl(ti({},l),{onClick:tr(function(){return tu(this,function(e){return v(tc(ti({},a(o.template)),o,g,r)),f(!0),[2]})})}),i||h("Edit")),s().createElement(p.SchemaComponent,{schema:y,components:{ArrayTable:C.ArrayTable},scope:ti({getContainer:r,useValuesFromRecord:ts,useUpdateCollectionActionAndRefreshCM:tp,useCancelAction:p.useCancelAction,createOnly:!1,filterTargetKeyOptions:S,isView:o.view,createMainOnly:!0},n)})))};var tm={type:"object",properties:(r={},o=(0,u.uid)(),i={"x-component":"ConfigurationTable"},o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i,r)},ty=function(){var e=(0,p.usePlugin)(te.default),t=new URLSearchParams((0,d.useLocation)().search).get("type"),n=t&&e.types.get(t);return s().createElement(p.SchemaComponent,{schema:tm,components:{CollectionCategoriesProvider:p.CollectionCategoriesProvider,ConfigurationTable:eX,ConfigurationTabs:e9,AddFieldAction:p.AddFieldAction,AddCollectionField:p.AddCollectionField,AddCollection:(null==n?void 0:n.AddCollection)||p.AddCollection,AddCollectionAction:p.AddCollectionAction,DuplicateCollectionAction:p.DuplicateCollectionAction,DuplicateCollection:p.DuplicateCollection,EditCollection:(null==n?void 0:n.EditCollection)||td,DeleteCollection:(null==n?void 0:n.DeleteCollection)||p.DeleteCollection,DeleteCollectionAction:p.DeleteCollectionAction,EditFieldAction:p.EditFieldAction,EditCollectionField:p.EditCollectionField,OverridingCollectionField:p.OverridingCollectionField,OverridingFieldAction:p.OverridingFieldAction,ViewCollectionField:p.ViewCollectionField,ViewFieldAction:p.ViewFieldAction,SyncFieldsAction:p.SyncFieldsAction,SyncFieldsActionCom:p.SyncFieldsActionCom,SyncSQLFieldsAction:p.SyncSQLFieldsAction},scope:{allowCollectionDeletion:!!(null==n?void 0:n.allowCollectionDeletion),disabledConfigureFields:null==n?void 0:n.disabledConfigureFields,disableAddFields:null==n?void 0:n.disableAddFields,allowCollectionCreate:!!(null==n?void 0:n.allowCollectionCreate)}})}},212:function(e,t,n){"use strict";n.r(t),n.d(t,{useCreateDatabaseServer:function(){return d},useTestConnectionAction:function(){return f}});var r=n(505),o=n(721),i=n(238),l=n(772),a=n(573);function u(e,t,n,r,o,i,l){try{var a=e[i](l),u=a.value}catch(e){n(e);return}a.done?t(u):Promise.resolve(u).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function l(e){u(i,r,o,l,a,"next",e)}function a(e){u(i,r,o,l,a,"throw",e)}l(void 0)})}}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}function p(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var d=function(e){var t=(0,r.useForm)(),n=(0,l.useActionContext)(),a=(0,l.useAPIClient)(),u=(0,i.useTranslation)().t,d=(0,r.useField)();return d.data=d.data||{},{run:function(){return c(function(){var r,i;return p(this,function(l){switch(l.label){case 0:return[4,t.submit()];case 1:l.sent(),l.label=2;case 2:return l.trys.push([2,5,,6]),d.data.loading=!0,[4,a.resource("databaseServers").create({values:s({},t.values)})];case 3:return r=l.sent().data,d.data.loading=!1,n.setVisible(!1),[4,t.reset()];case 4:return l.sent(),null==e||e(null==r?void 0:r.data),o.message.success(u("Saved successfully")),[3,6];case 5:return i=l.sent(),d.data.loading=!1,console.log(i),[3,6];case 6:return[2]}})})()}}},f=function(){var e=(0,r.useForm)(),t=(0,l.useAPIClient)(),n=(0,i.useTranslation)().t,u=(0,r.useField)();return u.data=u.data||{},{run:function(){return c(function(){var r;return p(this,function(i){switch(i.label){case 0:return[4,e.submit()];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),u.data.loading=!0,[4,t.resource("dataSources").testConnection({values:s({},e.values)})];case 3:return i.sent(),u.data.loading=!1,o.message.success(n("Connection successful",{ns:a.A7})),[3,5];case 4:return r=i.sent(),u.data.loading=!1,console.log(r),[3,5];case 5:return[2]}})})()}}}},527:function(e){!function(){"use strict";var t={}.hasOwnProperty;function n(){for(var e="",o=0;o<arguments.length;o++){var i=arguments[o];i&&(e=r(e,function(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return n.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var o="";for(var i in e)t.call(e,i)&&e[i]&&(o=r(o,i));return o}(i)))}return e}function r(e,t){return t?e?e+" "+t:e+t:e}e.exports?(n.default=n,e.exports=n):"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],function(){return n}):window.classNames=n}()}}]);