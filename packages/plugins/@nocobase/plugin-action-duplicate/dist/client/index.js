/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react-i18next"),require("@formily/core"),require("@nocobase/client"),require("lodash"),require("antd"),require("@formily/react"),require("react"),require("@emotion/css")):"function"==typeof define&&define.amd?define("@nocobase/plugin-action-duplicate",["react-i18next","@formily/core","@nocobase/client","lodash","antd","@formily/react","react","@emotion/css"],t):"object"==typeof exports?exports["@nocobase/plugin-action-duplicate"]=t(require("react-i18next"),require("@formily/core"),require("@nocobase/client"),require("lodash"),require("antd"),require("@formily/react"),require("react"),require("@emotion/css")):e["@nocobase/plugin-action-duplicate"]=t(e["react-i18next"],e["@formily/core"],e["@nocobase/client"],e.lodash,e.antd,e["@formily/react"],e.react,e["@emotion/css"])}(self,function(e,t,n,r,o,i,c,a){return function(){"use strict";var l={964:function(e){e.exports=a},563:function(e){e.exports=t},505:function(e){e.exports=i},772:function(e){e.exports=n},721:function(e){e.exports=o},467:function(e){e.exports=r},156:function(e){e.exports=c},238:function(t){t.exports=e}},u={};function s(e){var t=u[e];if(void 0!==t)return t.exports;var n=u[e]={exports:{}};return l[e](n,n.exports,s),n.exports}s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,{a:t}),t},s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var p={};s.r(p),s.d(p,{PluginActionDuplicateClient:function(){return er},default:function(){return eo},DuplicateAction:function(){return M},actionDesignerCss:function(){return F}});var d=s("772"),f=s("964"),m=s("505"),b=s("721"),y=s("467"),v=s.n(y),h=s("156"),g=s.n(h),x=s("238");function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function P(e,t,n,r,o,i,c){try{var a=e[i](c),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,o)}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){S(e,t,n[t])})}return e}function w(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],c=!0,a=!1;try{for(o=o.call(e);!(c=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);c=!0);}catch(e){a=!0,r=e}finally{try{!c&&null!=o.return&&o.return()}finally{if(a)throw r}}return i}}(e,t)||C(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){return!t&&(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function C(e,t){if(e){if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}}function A(){var e=j(["\n  position: relative;\n  &:hover {\n    .general-schema-designer {\n      display: block;\n    }\n  }\n  .general-schema-designer {\n    position: absolute;\n    z-index: 999;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    display: none;\n    background: var(--colorBgSettingsHover);\n    border: 0;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    pointer-events: none;\n    > .general-schema-designer-icons {\n      position: absolute;\n      right: 2px;\n      top: 2px;\n      line-height: 16px;\n      pointer-events: all;\n      .ant-space-item {\n        background-color: var(--colorSettings);\n        color: #fff;\n        line-height: 16px;\n        width: 16px;\n        padding-left: 1px;\n        align-self: stretch;\n      }\n    }\n  }\n"]);return A=function(){return e},e}function E(){var e=j(["\n            .general-schema-designer {\n              top: -10px;\n              bottom: -10px;\n              left: -10px;\n              right: -10px;\n            }\n          "]);return E=function(){return e},e}var F=(0,f.css)(A()),M=(0,m.observer)(function(e){var t,n,r,o,i,c,a,l=e.children,u=b.App.useApp().message,s=(0,m.useField)(),p=(0,m.useFieldSchema)(),y=(0,d.useAPIClient)(),j=s.disabled||e.disabled,A=(0,d.useDesignable)().designable,M=k((0,h.useState)(!1),2),T=M[0],I=M[1],q=k((0,h.useState)(!1),2),_=q[0],R=q[1],z=(0,d.useBlockRequestContext)(),B=z.service,L=z.__parent,$=z.block,K=z.resource,V=p["x-component-props"],N=V.duplicateFields,G=V.duplicateMode,U=void 0===G?"quickDulicate":G,H=V.duplicateCollection,J=(0,d.useRecord)(),Q=(0,d.useCollectionParentRecordData)(),W=(0,d.useCollection)(),X=J.id,Y=J.__collection,Z=(0,d.useActionContext)(),ee=(0,d.useCollection_deprecated)().name,et=(0,d.useCollectionManager_deprecated)().getCollectionFields,en=(0,x.useTranslation)().t,er=et(Y||ee),eo=(0,d.useFormBlockContext)(),ei=(0,d.useACLActionParamsContext)(),ec=(0,d.useDataSourceKey)(),ea=(0,d.useDataSourceHeaders)(ec);var el=Array.isArray(W.filterTargetKey)?(o=Object).assign.apply(o,[{}].concat(function(e){if(Array.isArray(e))return O(e)}(t=W.filterTargetKey.map(function(e){return S({},e,J[e])}))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||C(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())):J[W.filterTargetKey]||X,eu=(0,h.useMemo)(function(){var e;return{opacity:A&&((null==s?void 0:null===(e=s.data)||void 0===e?void 0:e.hidden)||!ei)&&.1}},[A,null==s?void 0:null===(i=s.data)||void 0===i?void 0:i.hidden]),es={key:"duplicate",dataId:el,default:!0,fields:(null==N?void 0:N.filter(function(e){return er.find(function(t){return e.includes(t.name)})}))||[],collection:Y||ee},ep="Action.Link"===p["x-component"];var ed=(r=(n=function(){var e,t,n,r,o;return function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,function(i){switch(i.label){case 0:R(!0),i.label=1;case 1:return i.trys.push([1,7,,8]),[4,(0,d.fetchTemplateData)(y,es,ea)];case 2:return e=i.sent(),[4,K.create({values:D({},e)})];case 3:if(i.sent(),u.success(en("Saved successfully")),"form"!==$)return[3,4];return null==L||null===(n=L.service)||void 0===n||null===(t=n.refresh)||void 0===t||t.call(n),[3,6];case 4:return[4,null==B?void 0:null===(r=B.refresh)||void 0===r?void 0:r.call(B)];case 5:i.sent(),i.label=6;case 6:return R(!1),[3,8];case 7:return o=i.sent(),R(!1),console.error(o),[3,8];case 8:return[2]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var i=n.apply(e,t);function c(e){P(i,r,o,c,a,"next",e)}function a(e){P(i,r,o,c,a,"throw",e)}c(void 0)})}),function(){return r.apply(this,arguments)}),ef=function(){!j&&!_&&ei&&((null==N?void 0:N.length)>0?"quickDulicate"===U?ed():I(!0):u.error(en("Please configure the duplicate fields")))};return g().createElement("div",{className:(0,f.cx)(F,S({},(0,f.css)(E()),ep))},g().createElement(d.FormBlockContext.Provider,{value:w(D({},eo),{duplicateData:{display:!1,enabled:!0,defaultTemplate:es}})},g().createElement("div",null,ep?g().createElement("a",{className:"nb-action-link",role:e.role,"aria-label":e["aria-label"],disabled:j,style:D({opacity:A&&(null==s?void 0:null===(c=s.data)||void 0===c?void 0:c.hidden)&&.1,cursor:_?"not-allowed":"pointer",position:"relative"},eu),onClick:ef},_?en("Duplicating"):l||en("Duplicate")):g().createElement(b.Button,w(D({role:e.role,"aria-label":e["aria-label"],disabled:j,style:{opacity:A&&(null==s?void 0:null===(a=s.data)||void 0===a?void 0:a.hidden)&&.1}},e),{onClick:ef}),_?en("Duplicating"):l||en("Duplicate")),g().createElement(d.TabsContextProvider,null,g().createElement(d.CollectionProvider_deprecated,{name:H||ee},g().createElement(d.RecordProvider,{record:w(D({},Q),{__collection:H||Y})},g().createElement(d.ActionContextProvider,{value:w(D({},Z),{visible:T,setVisible:I})},g().createElement(d.PopupSettingsProvider,{enableURL:!1},g().createElement(d.RefreshComponentProvider,{refresh:v().noop},g().createElement(d.NocoBaseRecursionField,{schema:p,basePath:s.address,onlyRenderProperties:!0}))))))))))},{displayName:"DuplicateAction"}),T=s("563");function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function q(e,t,n,r,o,i,c){try{var a=e[i](c),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,o)}function _(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function c(e){q(i,r,o,c,a,"next",e)}function a(e){q(i,r,o,c,a,"throw",e)}c(void 0)})}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){R(e,t,n[t])})}return e}function B(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function L(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var $=(0,m.connect)(b.Tree,(0,m.mapProps)(function(e,t){(0,h.useEffect)(function(){t.value=e.defaultCheckedKeys||[]},[]);var n,r,o=(n=(0,h.useState)(e.defaultCheckedKeys||[]),r=2,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],c=!0,a=!1;try{for(o=o.call(e);!(c=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);c=!0);}catch(e){a=!0,r=e}finally{try{!c&&null!=o.return&&o.return()}finally{if(a)throw r}}return i}}(n,2)||function(e,t){if(e){if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}}(n,r)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],c=o[1],a=function(e){c(e),t.value=e};t.onCheck=a;var l=(0,m.useForm)();return B(z({},e),{checkedKeys:i,onCheck:a,treeData:null==e?void 0:e.treeData.map(function(e){if("quickDulicate"===l.values.duplicateMode){var t,n=null==e?void 0:null===(t=e.children)||void 0===t?void 0:t.map(function(e){return B(z({},e),{disabled:!1})});return B(z({},e),{disabled:!1,children:n})}return e})})})),K=function(e,t){for(var n=0;n<(null==e?void 0:e.length);n++){var r=e[n],o=r.children,i=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],!(t.indexOf(n)>=0)&&(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++){if(n=i[r],!(t.indexOf(n)>=0))Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}}return o}(r,["children"]);t.push(i.key),o&&K(o,t)}return t},V=function(e){return e.reduceProperties(function(e,t){return"FormBlockProvider"===t["x-decorator"]?t:V(t)},null)},N=[{name:"Customize",Component:function(e){return e.children},children:[{name:"editButton",Component:d.ActionDesigner.ButtonEditor,useComponentProps:function(){return(0,d.useSchemaToolbar)().buttonEditorProps}},{name:"linkageRules",Component:d.SchemaSettingsLinkageRules,useComponentProps:function(){var e=(0,d.useCollection_deprecated)().name;return B(z({},(0,d.useSchemaToolbar)().linkageRulesProps),{collectionName:e})}},{name:"duplicationMode",Component:function(){var e,t,n,r,o=(0,d.useDesignable)().dn,i=(0,x.useTranslation)().t,c=(0,m.useField)(),a=(0,m.useFieldSchema)(),l=(0,d.useCollection_deprecated)().name,u=(0,d.useCollectionState)(l),s=u.collectionList,p=u.getEnableFieldTree,f=u.getOnLoadData,b=u.getOnCheck,v=(0,y.cloneDeep)((null===(e=a["x-component-props"])||void 0===e?void 0:e.duplicateFields)||[]),O=(0,d.useRecord)(),P=(0,h.useCallback)(function(e,t,n){n.query("duplicateFields").take(function(r){r.componentProps.treeData=e,r.componentProps.defaultCheckedKeys=t,r.setInitialValue(t),null==r||r.onCheck(t),n.setValues(B(z({},n.values),{treeData:e}))})},[]);return g().createElement(d.SchemaSettingsModalItem,{title:i("Duplicate mode"),components:{Tree:$},scope:{getEnableFieldTree:p,collectionName:(null===(t=a["x-component-props"])||void 0===t?void 0:t.duplicateCollection)||(null==O?void 0:O.__collection)||l,currentCollection:(null==O?void 0:O.__collection)||l,getOnLoadData:f,getOnCheck:b,treeData:null===(n=a["x-component-props"])||void 0===n?void 0:n.treeData,duplicateValues:v,onFieldInputValueChange:T.onFieldInputValueChange},schema:{type:"object",title:i("Duplicate mode"),properties:{duplicateMode:{"x-decorator":"FormItem","x-component":"Radio.Group",title:i("Duplicate mode"),default:(null===(r=a["x-component-props"])||void 0===r?void 0:r.duplicateMode)||"quickDulicate",enum:[{value:"quickDulicate",label:'{{t("Direct duplicate")}}'},{value:"continueduplicate",label:'{{t("Copy into the form and continue to fill in")}}'}]},collection:{type:"string",title:'{{ t("Target collection") }}',required:!0,description:i("If collection inherits, choose inherited collections as templates"),default:"{{ collectionName }}","x-display":s.length>1?"visible":"hidden","x-decorator":"FormItem","x-component":"Select","x-component-props":{options:s},"x-reactions":[{dependencies:[".duplicateMode"],fulfill:{state:{disabled:'{{ $deps[0]==="quickDulicate" }}',value:'{{ $deps[0]==="quickDulicate"? currentCollection:collectionName }}'}}}]},syncFromForm:{type:"void",title:'{{ t("Sync from form fields") }}',"x-component":"Action.Link","x-component-props":{type:"primary",style:{float:"right",position:"relative",zIndex:1200},useAction:function(){var e,t=(0,h.useMemo)(function(){return V(a)},[a]);return(0,d.useSyncFromForm)(t,(null===(e=a["x-component-props"])||void 0===e?void 0:e.duplicateCollection)||(null==O?void 0:O.__collection)||l,P)}},"x-reactions":[{dependencies:[".duplicateMode"],fulfill:{state:{visible:'{{ $deps[0]!=="quickDulicate" }}'}}}]},selectAll:{type:"void",title:'{{ t("Select all") }}',"x-component":"Action.Link","x-reactions":[{dependencies:[".duplicateMode"],fulfill:{state:{visible:'{{ $deps[0]==="quickDulicate"}}'}}}],"x-component-props":{type:"primary",style:{float:"right",position:"relative",zIndex:1200},useAction:function(){var e;return e=(0,m.useForm)(),{run:function(){return _(function(){return L(this,function(t){return e.query("duplicateFields").take(function(e){var t,n=K(e.componentProps.treeData,[]);e.componentProps.defaultCheckedKeys=n,e.setInitialValue(n),null==e||null===(t=e.onCheck)||void 0===t||t.call(e,n)}),[2]})})()}}}}},unselectAll:{type:"void",title:'{{ t("UnSelect all") }}',"x-component":"Action.Link","x-reactions":[{dependencies:[".duplicateMode",".duplicateFields"],fulfill:{state:{visible:"{{ $deps[0]===\"quickDulicate\"&&$form.getValuesIn('duplicateFields').length>0 }}"}}}],"x-component-props":{type:"primary",style:{float:"right",position:"relative",zIndex:1200,marginRight:"10px"},useAction:function(){var e;return e=(0,m.useForm)(),{run:function(){return _(function(){return L(this,function(t){return e.query("duplicateFields").take(function(e){e.componentProps.defaultCheckedKeys=[],e.setInitialValue([]),null==e||e.onCheck([])}),[2]})})()}}}}},duplicateFields:{type:"array",title:'{{ t("Data fields") }}',required:!0,description:i("Only the selected fields will be used as the initialization data for the form"),"x-decorator":"FormItem","x-component":$,"x-component-props":{defaultCheckedKeys:v,treeData:[],checkable:!0,checkStrictly:!0,selectable:!1,loadData:"{{ getOnLoadData($self) }}",onCheck:"{{ getOnCheck($self) }}",rootStyle:{padding:"8px 0",border:"1px solid #d9d9d9",borderRadius:"2px",maxHeight:"30vh",overflow:"auto",margin:"2px 0"}},"x-reactions":[{dependencies:[".collection",".duplicateMode"],fulfill:{state:{disabled:"{{ !$deps[0] }}",componentProps:{treeData:"{{ getEnableFieldTree($deps[0], $self,treeData) }}"}}}}]}}},onSubmit:function(e){var t,n,r=e.duplicateMode,i=e.collection,l=e.duplicateFields,u=e.treeData,s=Array.isArray(l)?l:l.checked||[];c.componentProps.duplicateMode=r,c.componentProps.duplicateFields=s,a["x-component-props"]=a["x-component-props"]||{},a["x-component-props"].duplicateMode=r,a["x-component-props"].duplicateFields=s,a["x-component-props"].duplicateCollection=i,a["x-component-props"].treeData=u||(null===(t=c.componentProps)||void 0===t?void 0:t.treeData),o.emit("patch",{schema:(R(n={},"x-uid",a["x-uid"]),R(n,"x-component-props",z({},a["x-component-props"])),n)}),o.refresh()}})},useVisible:function(){return"duplicate"===(0,m.useFieldSchema)()["x-action"]}},{name:"openMode",Component:d.SchemaSettingOpenModeSchemaItems,useComponentProps:function(){var e=(0,d.useOpenModeContext)().hideOpenMode,t=(0,x.useTranslation)().t;return{openMode:!e,openSize:!e,modeOptions:(0,h.useMemo)(function(){return[{label:t("Drawer"),value:"drawer"},{label:t("Dialog"),value:"modal"}]},[t])}}},{name:"remove",sort:100,Component:d.ActionDesigner.RemoveButton,useComponentProps:function(){return(0,d.useSchemaToolbar)().removeButtonProps}}]}],G=new d.SchemaSettings({name:"ActionSettings:duplicate",items:N}),U=new d.SchemaSettings({name:"actionSettings:duplicate",items:N}),H=function(e){return g().createElement(d.ACLActionProvider,null,e.children)},J=function(e){var t,n,r=(0,d.useOpenModeContext)().defaultOpenMode;return g().createElement(d.ActionInitializerItem,(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})}return e}({},e),n=(n={schema:{type:"void","x-action":"duplicate","x-acl-action":"create",title:'{{ t("Duplicate") }}',"x-component":"Action.Link","x-decorator":"DuplicateActionDecorator","x-component-props":{openMode:r,component:"DuplicateAction"},properties:{drawer:{type:"void",title:'{{ t("Duplicate") }}',"x-component":"Action.Container","x-component-props":{className:"nb-action-popup"},properties:{tabs:{type:"void","x-component":"Tabs","x-component-props":{},"x-initializer":"popup:addTab",properties:{tab1:{type:"void",title:'{{t("Duplicate")}}',"x-component":"Tabs.TabPane","x-designer":"Tabs.Designer","x-component-props":{},properties:{grid:{type:"void","x-component":"Grid","x-initializer":"popup:addNew:addBlock",properties:{}}}}}}}}}}},n),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t))},Q=function(e){return g().createElement(d.SchemaComponentOptions,{components:{DuplicateActionInitializer:J,DuplicateAction:M}},e.children)};function W(e,t,n,r,o,i,c){try{var a=e[i](c),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,o)}function X(e,t,n){return(X=en()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&ee(o,n.prototype),o}).apply(null,arguments)}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function et(e){var t="function"==typeof Map?new Map:void 0;return(et=function(e){var n;if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return X(e,arguments,Z(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ee(r,e)})(e)}function en(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(en=function(){return!!e})()}var er=function(e){var t,n,r;function o(){var e,t,n;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),e=this,t=o,n=arguments,t=Z(t),function(e,t){return t&&("object"===function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,en()?Reflect.construct(t,n||[],Z(e).constructor):t.apply(e,n))}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ee(e,t)}(o,e),t=o,n=[{key:"load",value:function(){var e,t=this;return(e=function(){var e;return function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,function(n){return t.app.use(Q),t.app.addComponents({DuplicateActionInitializer:J,DuplicateAction:M,DuplicateActionDecorator:H}),t.app.schemaSettingsManager.add(G),t.app.schemaSettingsManager.add(U),e={title:'{{t("Duplicate")}}',Component:"DuplicateActionInitializer",schema:{"x-component":"Action.Link","x-action":"duplicate","x-toolbar":"ActionSchemaToolbar","x-settings":"actionSettings:duplicate","x-decorator":"DuplicateActionDecorator","x-component-props":{type:"primary"}},useVisible:function(){return(0,d.useActionAvailable)("create")}},t.app.schemaInitializerManager.addItem("table:configureItemActions","actions.duplicate",e),[2]})},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function c(e){W(i,r,o,c,a,"next",e)}function a(e){W(i,r,o,c,a,"throw",e)}c(void 0)})})()}}],Y(t.prototype,n),o}(et(d.Plugin)),eo=er;return p}()});